<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Advent of Code - 2021 Solutions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../qmd/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">2021 Solutions</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Advent of Code</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2022.html" class="sidebar-item-text sidebar-link">2022 Solutions</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2021.html" class="sidebar-item-text sidebar-link active">2021 Solutions</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2020.html" class="sidebar-item-text sidebar-link">2020 Solutions</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2019.html" class="sidebar-item-text sidebar-link">2019 Solutions</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2018.html" class="sidebar-item-text sidebar-link">2018 Solutions</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2017.html" class="sidebar-item-text sidebar-link">2017 Solutions</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2016.html" class="sidebar-item-text sidebar-link">2016 Solutions</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2015.html" class="sidebar-item-text sidebar-link">2015 Solutions</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#imports" id="toc-imports" class="nav-link active" data-scroll-target="#imports">Imports</a></li>
  <li><a href="#day-1-sonar-sweep" id="toc-day-1-sonar-sweep" class="nav-link" data-scroll-target="#day-1-sonar-sweep">Day 1: Sonar Sweep</a>
  <ul class="collapse">
  <li><a href="#part-1" id="toc-part-1" class="nav-link" data-scroll-target="#part-1">Part 1</a></li>
  <li><a href="#part-2" id="toc-part-2" class="nav-link" data-scroll-target="#part-2">Part 2</a></li>
  </ul></li>
  <li><a href="#day-2-dive" id="toc-day-2-dive" class="nav-link" data-scroll-target="#day-2-dive">Day 2: Dive!</a>
  <ul class="collapse">
  <li><a href="#part-1-1" id="toc-part-1-1" class="nav-link" data-scroll-target="#part-1-1">Part 1</a></li>
  <li><a href="#part-2-1" id="toc-part-2-1" class="nav-link" data-scroll-target="#part-2-1">Part 2</a></li>
  </ul></li>
  <li><a href="#day-3-binary-diagnostic" id="toc-day-3-binary-diagnostic" class="nav-link" data-scroll-target="#day-3-binary-diagnostic">Day 3: Binary Diagnostic</a>
  <ul class="collapse">
  <li><a href="#part-1-2" id="toc-part-1-2" class="nav-link" data-scroll-target="#part-1-2">Part 1</a></li>
  <li><a href="#part-2-2" id="toc-part-2-2" class="nav-link" data-scroll-target="#part-2-2">Part 2</a></li>
  </ul></li>
  <li><a href="#day-4-giant-squid" id="toc-day-4-giant-squid" class="nav-link" data-scroll-target="#day-4-giant-squid">Day 4: Giant Squid</a>
  <ul class="collapse">
  <li><a href="#part-1-3" id="toc-part-1-3" class="nav-link" data-scroll-target="#part-1-3">Part 1</a></li>
  <li><a href="#part-2-3" id="toc-part-2-3" class="nav-link" data-scroll-target="#part-2-3">Part 2</a></li>
  </ul></li>
  <li><a href="#day-5-hydrothermal-venture" id="toc-day-5-hydrothermal-venture" class="nav-link" data-scroll-target="#day-5-hydrothermal-venture">Day 5: Hydrothermal Venture</a>
  <ul class="collapse">
  <li><a href="#part-1-4" id="toc-part-1-4" class="nav-link" data-scroll-target="#part-1-4">Part 1</a></li>
  <li><a href="#part-2-4" id="toc-part-2-4" class="nav-link" data-scroll-target="#part-2-4">Part 2</a></li>
  </ul></li>
  <li><a href="#day-6-lanternfish" id="toc-day-6-lanternfish" class="nav-link" data-scroll-target="#day-6-lanternfish">Day 6: Lanternfish</a>
  <ul class="collapse">
  <li><a href="#part-1-5" id="toc-part-1-5" class="nav-link" data-scroll-target="#part-1-5">Part 1</a></li>
  <li><a href="#part-2-5" id="toc-part-2-5" class="nav-link" data-scroll-target="#part-2-5">Part 2</a></li>
  </ul></li>
  <li><a href="#day-7-the-treachery-of-whales" id="toc-day-7-the-treachery-of-whales" class="nav-link" data-scroll-target="#day-7-the-treachery-of-whales">Day 7: The Treachery of Whales</a>
  <ul class="collapse">
  <li><a href="#part-1-6" id="toc-part-1-6" class="nav-link" data-scroll-target="#part-1-6">Part 1</a></li>
  <li><a href="#part-2-6" id="toc-part-2-6" class="nav-link" data-scroll-target="#part-2-6">Part 2</a></li>
  </ul></li>
  <li><a href="#day-8-seven-segment-search" id="toc-day-8-seven-segment-search" class="nav-link" data-scroll-target="#day-8-seven-segment-search">Day 8: Seven Segment Search</a>
  <ul class="collapse">
  <li><a href="#part-1-7" id="toc-part-1-7" class="nav-link" data-scroll-target="#part-1-7">Part 1</a></li>
  <li><a href="#part-2-7" id="toc-part-2-7" class="nav-link" data-scroll-target="#part-2-7">Part 2</a></li>
  </ul></li>
  <li><a href="#day-9-smoke-basin" id="toc-day-9-smoke-basin" class="nav-link" data-scroll-target="#day-9-smoke-basin">Day 9: Smoke Basin</a>
  <ul class="collapse">
  <li><a href="#part-1-8" id="toc-part-1-8" class="nav-link" data-scroll-target="#part-1-8">Part 1</a></li>
  <li><a href="#part-2-8" id="toc-part-2-8" class="nav-link" data-scroll-target="#part-2-8">Part 2</a></li>
  </ul></li>
  <li><a href="#day-10-syntax-scoring" id="toc-day-10-syntax-scoring" class="nav-link" data-scroll-target="#day-10-syntax-scoring">Day 10: Syntax Scoring</a>
  <ul class="collapse">
  <li><a href="#part-1-9" id="toc-part-1-9" class="nav-link" data-scroll-target="#part-1-9">Part 1</a></li>
  <li><a href="#part-2-9" id="toc-part-2-9" class="nav-link" data-scroll-target="#part-2-9">Part 2</a></li>
  </ul></li>
  <li><a href="#day-11-dumbo-octopus" id="toc-day-11-dumbo-octopus" class="nav-link" data-scroll-target="#day-11-dumbo-octopus">Day 11: Dumbo Octopus</a>
  <ul class="collapse">
  <li><a href="#part-1-10" id="toc-part-1-10" class="nav-link" data-scroll-target="#part-1-10">Part 1</a></li>
  <li><a href="#part-2-10" id="toc-part-2-10" class="nav-link" data-scroll-target="#part-2-10">Part 2</a></li>
  </ul></li>
  <li><a href="#day-12-passage-pathing" id="toc-day-12-passage-pathing" class="nav-link" data-scroll-target="#day-12-passage-pathing">Day 12: Passage Pathing</a>
  <ul class="collapse">
  <li><a href="#part-1-11" id="toc-part-1-11" class="nav-link" data-scroll-target="#part-1-11">Part 1</a></li>
  <li><a href="#part-2-11" id="toc-part-2-11" class="nav-link" data-scroll-target="#part-2-11">Part 2</a></li>
  </ul></li>
  <li><a href="#day-13-transparent-origami" id="toc-day-13-transparent-origami" class="nav-link" data-scroll-target="#day-13-transparent-origami">Day 13: Transparent Origami</a>
  <ul class="collapse">
  <li><a href="#part-1-12" id="toc-part-1-12" class="nav-link" data-scroll-target="#part-1-12">Part 1</a></li>
  <li><a href="#part-2-12" id="toc-part-2-12" class="nav-link" data-scroll-target="#part-2-12">Part 2</a></li>
  </ul></li>
  <li><a href="#day-14-extended-polymerization" id="toc-day-14-extended-polymerization" class="nav-link" data-scroll-target="#day-14-extended-polymerization">Day 14: Extended Polymerization</a>
  <ul class="collapse">
  <li><a href="#part-1-13" id="toc-part-1-13" class="nav-link" data-scroll-target="#part-1-13">Part 1</a></li>
  <li><a href="#part-2-13" id="toc-part-2-13" class="nav-link" data-scroll-target="#part-2-13">Part 2</a></li>
  </ul></li>
  <li><a href="#day-15-chiton" id="toc-day-15-chiton" class="nav-link" data-scroll-target="#day-15-chiton">Day 15: Chiton</a>
  <ul class="collapse">
  <li><a href="#part-1-14" id="toc-part-1-14" class="nav-link" data-scroll-target="#part-1-14">Part 1</a></li>
  <li><a href="#part-2-14" id="toc-part-2-14" class="nav-link" data-scroll-target="#part-2-14">Part 2</a></li>
  </ul></li>
  <li><a href="#day-16-packet-decoder" id="toc-day-16-packet-decoder" class="nav-link" data-scroll-target="#day-16-packet-decoder">Day 16: Packet Decoder</a>
  <ul class="collapse">
  <li><a href="#part-1-15" id="toc-part-1-15" class="nav-link" data-scroll-target="#part-1-15">Part 1</a></li>
  <li><a href="#part-2-15" id="toc-part-2-15" class="nav-link" data-scroll-target="#part-2-15">Part 2</a></li>
  </ul></li>
  <li><a href="#day-17-trick-shot" id="toc-day-17-trick-shot" class="nav-link" data-scroll-target="#day-17-trick-shot">Day 17: Trick Shot</a>
  <ul class="collapse">
  <li><a href="#part-1-16" id="toc-part-1-16" class="nav-link" data-scroll-target="#part-1-16">Part 1</a></li>
  <li><a href="#part-2-16" id="toc-part-2-16" class="nav-link" data-scroll-target="#part-2-16">Part 2</a></li>
  </ul></li>
  <li><a href="#day-18-snailfish" id="toc-day-18-snailfish" class="nav-link" data-scroll-target="#day-18-snailfish">Day 18: Snailfish</a>
  <ul class="collapse">
  <li><a href="#part-1-17" id="toc-part-1-17" class="nav-link" data-scroll-target="#part-1-17">Part 1</a></li>
  <li><a href="#part-2-17" id="toc-part-2-17" class="nav-link" data-scroll-target="#part-2-17">Part 2</a></li>
  </ul></li>
  <li><a href="#day-19-beacon-scanner" id="toc-day-19-beacon-scanner" class="nav-link" data-scroll-target="#day-19-beacon-scanner">Day 19: Beacon Scanner</a>
  <ul class="collapse">
  <li><a href="#part-1-18" id="toc-part-1-18" class="nav-link" data-scroll-target="#part-1-18">Part 1</a></li>
  <li><a href="#part-2-18" id="toc-part-2-18" class="nav-link" data-scroll-target="#part-2-18">Part 2</a></li>
  </ul></li>
  <li><a href="#day-20-trench-map" id="toc-day-20-trench-map" class="nav-link" data-scroll-target="#day-20-trench-map">Day 20: Trench Map</a>
  <ul class="collapse">
  <li><a href="#part-1-and-2" id="toc-part-1-and-2" class="nav-link" data-scroll-target="#part-1-and-2">Part 1 and 2</a></li>
  </ul></li>
  <li><a href="#day-21-dirac-dice" id="toc-day-21-dirac-dice" class="nav-link" data-scroll-target="#day-21-dirac-dice">Day 21: Dirac Dice</a>
  <ul class="collapse">
  <li><a href="#part-1-19" id="toc-part-1-19" class="nav-link" data-scroll-target="#part-1-19">Part 1</a></li>
  <li><a href="#part-2-19" id="toc-part-2-19" class="nav-link" data-scroll-target="#part-2-19">Part 2</a></li>
  </ul></li>
  <li><a href="#day-22-reactor-reboot" id="toc-day-22-reactor-reboot" class="nav-link" data-scroll-target="#day-22-reactor-reboot">Day 22: Reactor Reboot</a>
  <ul class="collapse">
  <li><a href="#part-1-20" id="toc-part-1-20" class="nav-link" data-scroll-target="#part-1-20">Part 1</a></li>
  <li><a href="#part-2-20" id="toc-part-2-20" class="nav-link" data-scroll-target="#part-2-20">Part 2</a></li>
  </ul></li>
  <li><a href="#day-23-amphipod" id="toc-day-23-amphipod" class="nav-link" data-scroll-target="#day-23-amphipod">Day 23: Amphipod</a>
  <ul class="collapse">
  <li><a href="#part-1-21" id="toc-part-1-21" class="nav-link" data-scroll-target="#part-1-21">Part 1</a></li>
  <li><a href="#part-2-21" id="toc-part-2-21" class="nav-link" data-scroll-target="#part-2-21">Part 2</a></li>
  </ul></li>
  <li><a href="#day-24-arithmetic-logic-unit" id="toc-day-24-arithmetic-logic-unit" class="nav-link" data-scroll-target="#day-24-arithmetic-logic-unit">Day 24: Arithmetic Logic Unit</a>
  <ul class="collapse">
  <li><a href="#part-1-22" id="toc-part-1-22" class="nav-link" data-scroll-target="#part-1-22">Part 1</a></li>
  <li><a href="#part-2-22" id="toc-part-2-22" class="nav-link" data-scroll-target="#part-2-22">Part 2</a></li>
  </ul></li>
  <li><a href="#day-25-sea-cucumber" id="toc-day-25-sea-cucumber" class="nav-link" data-scroll-target="#day-25-sea-cucumber">Day 25: Sea Cucumber</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">2021 Solutions</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="imports" class="level1">
<h1>Imports</h1>
<div class="cell" data-execution_count="1">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> functools</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> queue</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">1</span>, os.path.join(sys.path[<span class="dv">0</span>], <span class="st">".."</span>))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> utils</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>load <span class="op">=</span> utils.year_load(<span class="dv">2021</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>datadir <span class="op">=</span> Path(<span class="st">"../data/2021"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="day-1-sonar-sweep" class="level1">
<h1><a href="https://adventofcode.com/2021/day/1">Day 1: Sonar Sweep</a></h1>
<section id="part-1" class="level2">
<h2 class="anchored" data-anchor-id="part-1">Part 1</h2>
<div class="cell" data-execution_count="2">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">1</span>, <span class="st">"np"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>(np.diff(data) <span class="op">&gt;</span> <span class="dv">0</span>).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2" class="level2">
<h2 class="anchored" data-anchor-id="part-2">Part 2</h2>
<div class="cell" data-execution_count="3">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>(pd.Series(data).rolling(<span class="dv">3</span>).<span class="bu">sum</span>().diff() <span class="op">&gt;</span> <span class="dv">0</span>).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-2-dive" class="level1">
<h1><a href="https://adventofcode.com/2021/day/2">Day 2: Dive!</a></h1>
<section id="part-1-1" class="level2">
<h2 class="anchored" data-anchor-id="part-1-1">Part 1</h2>
<div class="cell" data-execution_count="4">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [x.strip().split() <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">2</span>)]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data, columns<span class="op">=</span>[<span class="st">'instruction'</span>, <span class="st">'amount'</span>])</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"amount"</span>] <span class="op">=</span> df[<span class="st">"amount"</span>].<span class="bu">apply</span>(<span class="bu">int</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> df.groupby(<span class="st">"instruction"</span>).<span class="bu">sum</span>()</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>(totals.loc[<span class="st">'forward'</span>] <span class="op">*</span> (totals.loc[<span class="st">'down'</span>] <span class="op">-</span> totals.loc[<span class="st">'up'</span>])).iat[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-1" class="level2">
<h2 class="anchored" data-anchor-id="part-2-1">Part 2</h2>
<div class="cell" data-execution_count="5">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>ops <span class="op">=</span> {<span class="st">'down'</span>: <span class="kw">lambda</span> x, y: (x[<span class="dv">0</span>] <span class="op">+</span> y, x[<span class="dv">1</span>], x[<span class="dv">2</span>]),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'up'</span>: <span class="kw">lambda</span> x, y: (x[<span class="dv">0</span>] <span class="op">-</span> y, x[<span class="dv">1</span>], x[<span class="dv">2</span>]),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">'forward'</span>: <span class="kw">lambda</span> x, y: (x[<span class="dv">0</span>], x[<span class="dv">1</span>] <span class="op">+</span> y, x[<span class="dv">2</span>] <span class="op">+</span> x[<span class="dv">0</span>]<span class="op">*</span>y)}</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> data:</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> ops[row[<span class="dv">0</span>]](state, <span class="bu">int</span>(row[<span class="dv">1</span>]))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(state[<span class="dv">1</span>] <span class="op">*</span> state[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-3-binary-diagnostic" class="level1">
<h1><a href="https://adventofcode.com/2021/day/3">Day 3: Binary Diagnostic</a></h1>
<section id="part-1-2" class="level2">
<h2 class="anchored" data-anchor-id="part-1-2">Part 1</h2>
<div class="cell" data-execution_count="6">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_fwf(datadir <span class="op">/</span> <span class="st">"3.txt"</span>, widths<span class="op">=</span>[<span class="dv">1</span>]<span class="op">*</span><span class="dv">12</span>, header<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> binarize(array):</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">int</span>(<span class="st">''</span>.join(<span class="bu">str</span>(x) <span class="cf">for</span> x <span class="kw">in</span> array.reshape(<span class="op">-</span><span class="dv">1</span>)), <span class="dv">2</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>bits <span class="op">=</span> df.median().to_numpy(dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>binarize(bits) <span class="op">*</span> binarize(<span class="dv">1</span> <span class="op">-</span> bits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-2" class="level2">
<h2 class="anchored" data-anchor-id="part-2-2">Part 2</h2>
<div class="cell" data-execution_count="7">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>oxygen <span class="op">=</span> df</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>co2 <span class="op">=</span> df</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> df.columns:</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    oxygen <span class="op">=</span> oxygen[oxygen[column] <span class="op">==</span> <span class="bu">int</span>(oxygen[column].median() <span class="op">+</span> <span class="fl">0.5</span>)]</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(co2) <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        co2 <span class="op">=</span> co2[co2[column] <span class="op">!=</span> <span class="bu">int</span>(co2[column].median() <span class="op">+</span> <span class="fl">0.5</span>)]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>binarize(oxygen.to_numpy()) <span class="op">*</span> binarize(co2.to_numpy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-4-giant-squid" class="level1">
<h1><a href="https://adventofcode.com/2021/day/4">Day 4: Giant Squid</a></h1>
<section id="part-1-3" class="level2">
<h2 class="anchored" data-anchor-id="part-1-3">Part 1</h2>
<div class="cell" data-execution_count="8">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">4</span>, <span class="st">"raw"</span>).split(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>numbers <span class="op">=</span> np.array([<span class="bu">int</span>(x) <span class="cf">for</span> x <span class="kw">in</span> data[<span class="dv">0</span>].strip().split(<span class="st">","</span>)])</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>boards <span class="op">=</span> np.array([<span class="bu">int</span>(x) <span class="cf">for</span> x <span class="kw">in</span> <span class="st">" "</span>.join(data[<span class="dv">1</span>:]).replace(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="st">" "</span>).split()]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> winning_array(boards):</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ((boards <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>).<span class="bu">all</span>(axis<span class="op">=</span><span class="dv">2</span>) <span class="op">|</span> (boards <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>).<span class="bu">all</span>(axis<span class="op">=</span><span class="dv">1</span>)).<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> number <span class="kw">in</span> numbers:</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    boards[np.where(boards <span class="op">==</span> number)] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> winning_array(boards).<span class="bu">any</span>():</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> np.where(winning_array(boards))</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">sum</span>(np.ma.array(boards, mask<span class="op">=</span>(boards <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>))[index]) <span class="op">*</span> number</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-3" class="level2">
<h2 class="anchored" data-anchor-id="part-2-3">Part 2</h2>
<p>Figure out which board will win last. Once it wins, what would its final score be?</p>
<div class="cell" data-execution_count="9">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> number <span class="kw">in</span> numbers:</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    boards[np.where(boards <span class="op">==</span> number)] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    wins <span class="op">=</span> winning_array(boards)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> wins.<span class="bu">sum</span>() <span class="op">==</span> <span class="bu">len</span>(boards) <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        index <span class="op">=</span> np.where(<span class="op">~</span>wins)[<span class="dv">0</span>]</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> wins.<span class="bu">all</span>():</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">sum</span>(np.ma.array(boards, mask<span class="op">=</span>(boards <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>))[index]) <span class="op">*</span> number</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-5-hydrothermal-venture" class="level1">
<h1><a href="https://adventofcode.com/2021/day/5">Day 5: Hydrothermal Venture</a></h1>
<section id="part-1-4" class="level2">
<h2 class="anchored" data-anchor-id="part-1-4">Part 1</h2>
<div class="cell" data-execution_count="10">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(datadir <span class="op">/</span> <span class="st">'5.txt'</span>, names<span class="op">=</span>[<span class="st">'x1'</span>, <span class="st">'middle'</span>, <span class="st">'y2'</span>])</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>data[[<span class="st">'y1'</span>, <span class="st">'x2'</span>]] <span class="op">=</span> data[<span class="st">'middle'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: pd.Series(x.split(<span class="st">'-&gt;'</span>)).astype(<span class="st">'int'</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> np.zeros((<span class="dv">1000</span>, <span class="dv">1000</span>))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> endpoints_to_line(x1, x2, y1, y2):</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    steps <span class="op">=</span> <span class="bu">max</span>(<span class="bu">abs</span>(x1 <span class="op">-</span> x2), <span class="bu">abs</span>(y1<span class="op">-</span> y2))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> np.array([np.sign(x2 <span class="op">-</span> x1), np.sign(y2 <span class="op">-</span> y1)])</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    points <span class="op">=</span> [np.array([x1, y1]) <span class="op">+</span> delta <span class="op">*</span> n <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(steps <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">tuple</span>(np.array(points).T.tolist())</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>on_axis <span class="op">=</span> data[(data[<span class="st">'x1'</span>] <span class="op">==</span> data[<span class="st">'x2'</span>]) <span class="op">|</span> (data[<span class="st">'y1'</span>] <span class="op">==</span> data[<span class="st">'y2'</span>])]</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> on_axis.itertuples():</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    grid[endpoints_to_line(row.x1, row.x2, row.y1, row.y2)] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>(grid <span class="op">&gt;</span> <span class="dv">1</span>).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-4" class="level2">
<h2 class="anchored" data-anchor-id="part-2-4">Part 2</h2>
<div class="cell" data-execution_count="11">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>skewed <span class="op">=</span> data[(data[<span class="st">'x1'</span>] <span class="op">!=</span> data[<span class="st">'x2'</span>]) <span class="op">&amp;</span> (data[<span class="st">'y1'</span>] <span class="op">!=</span> data[<span class="st">'y2'</span>])]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> skewed.itertuples():</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    grid[endpoints_to_line(row.x1, row.x2, row.y1, row.y2)] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>(grid <span class="op">&gt;</span> <span class="dv">1</span>).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-6-lanternfish" class="level1">
<h1><a href="https://adventofcode.com/2021/day/6">Day 6: Lanternfish</a></h1>
<section id="part-1-5" class="level2">
<h2 class="anchored" data-anchor-id="part-1-5">Part 1</h2>
<div class="cell" data-execution_count="12">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">6</span>, <span class="st">"np"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>population, _ <span class="op">=</span> np.histogram(data, <span class="bu">range</span>(<span class="dv">10</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>transition_matrix <span class="op">=</span> np.roll(np.eye(<span class="dv">9</span>, dtype<span class="op">=</span><span class="bu">int</span>), <span class="dv">1</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>transition_matrix[<span class="dv">6</span>, <span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>(np.linalg.matrix_power(transition_matrix, <span class="dv">80</span>) <span class="op">@</span> population).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-5" class="level2">
<h2 class="anchored" data-anchor-id="part-2-5">Part 2</h2>
<div class="cell" data-execution_count="13">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>(np.linalg.matrix_power(transition_matrix, <span class="dv">256</span>) <span class="op">@</span> population).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-7-the-treachery-of-whales" class="level1">
<h1><a href="https://adventofcode.com/2021/day/7">Day 7: The Treachery of Whales</a></h1>
<section id="part-1-6" class="level2">
<h2 class="anchored" data-anchor-id="part-1-6">Part 1</h2>
<div class="cell" data-execution_count="14">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">7</span>, <span class="st">"np"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">abs</span>(data <span class="op">-</span> np.median(data)).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-6" class="level2">
<h2 class="anchored" data-anchor-id="part-2-6">Part 2</h2>
<div class="cell" data-execution_count="15">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cost(position):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> np.<span class="bu">abs</span>(data <span class="op">-</span> position)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ((delta) <span class="op">*</span> (delta <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> <span class="dv">2</span>).<span class="bu">sum</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>options <span class="op">=</span> [cost(<span class="bu">int</span>(data.mean())), cost(<span class="bu">int</span>(data.mean() <span class="op">+</span> <span class="fl">0.5</span>))]</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="bu">min</span>(options)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-8-seven-segment-search" class="level1">
<h1><a href="https://adventofcode.com/2021/day/8">Day 8: Seven Segment Search</a></h1>
<section id="part-1-7" class="level2">
<h2 class="anchored" data-anchor-id="part-1-7">Part 1</h2>
<div class="cell" data-execution_count="16">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">8</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>segments <span class="op">=</span> [line.split(<span class="st">"|"</span>)[<span class="dv">1</span>].strip().split() <span class="cf">for</span> line <span class="kw">in</span> data]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>mylen <span class="op">=</span> np.vectorize(<span class="bu">len</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>np.isin(mylen(segments), [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">7</span>]).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-7" class="level2">
<h2 class="anchored" data-anchor-id="part-2-7">Part 2</h2>
<p>This is an obvious task for constraint programming. It feels a bit like cheating, so I’ll see if I can come up with a home-grown approach at a later stage. I’ll start by describing the segment pattern of each digit. I’m deliberately using numbers for the segment positions and letters for the segment names so that I don’t get confused.</p>
<p>We can do part 2 by exploiting the structure in our data.</p>
<p>We know that every digit occurs before the pipe for every row in our input.</p>
<p>Using that, we can immediately identify segment 1, segments {36} segments {24} and segments {57}.</p>
<p>The three five segment numbers let us disambiguate {147}, {25}, {36}. 147 occur in every group, 25 in only 1 and 36 in two</p>
<p>The three six segment numbers let us disambiguate {1267}, {345}.</p>
<ul>
<li><p>1 is the segment present in 3 but not in 2.</p></li>
<li><p>2 is the segment present in 4, not present in 2, and present in every 6</p></li>
<li><p>3 is the segment present in 2 which is not present in every 6</p></li>
<li><p>4 is the segment present in 4, not present in 2, and not present in every 6</p></li>
<li><p>5 is the segment not present in 4 which only occurs once in 5</p></li>
<li><p>6 is the segment which is present in 2 and is present in every 6</p></li>
<li><p>7 is the segment present in every 5, not present in every 6, not present in 4</p>
<p>It’s not super elegant, and I kind of prefer just using the generalised constraints programming.</p></li>
</ul>
</section>
</section>
<section id="day-9-smoke-basin" class="level1">
<h1><a href="https://adventofcode.com/2021/day/9">Day 9: Smoke Basin</a></h1>
<section id="part-1-8" class="level2">
<h2 class="anchored" data-anchor-id="part-1-8">Part 1</h2>
<div class="cell" data-execution_count="17">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_fwf(datadir <span class="op">/</span> <span class="st">'9.txt'</span>, widths<span class="op">=</span>[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>, header<span class="op">=</span><span class="va">None</span>).to_numpy()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.pad(data, pad_width<span class="op">=</span><span class="dv">1</span>, mode<span class="op">=</span><span class="st">'constant'</span>, constant_values<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> ((data <span class="op">&lt;</span> np.roll(data, <span class="op">-</span><span class="dv">1</span>, axis<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (data <span class="op">&lt;</span> np.roll(data, <span class="dv">1</span>, axis<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (data <span class="op">&lt;</span> np.roll(data, <span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (data <span class="op">&lt;</span> np.roll(data, <span class="dv">1</span>)))</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>np.ma.array(data <span class="op">+</span> <span class="dv">1</span>, mask<span class="op">=~</span>mask).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-8" class="level2">
<h2 class="anchored" data-anchor-id="part-2-8">Part 2</h2>
<div class="cell" data-execution_count="18">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> up(x, y): <span class="cf">return</span> x, y <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> down(x, y): <span class="cf">return</span> x, y <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> left(x, y): <span class="cf">return</span> x <span class="op">-</span> <span class="dv">1</span>, y</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> right(x, y): <span class="cf">return</span> x <span class="op">+</span> <span class="dv">1</span>, y</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>moves <span class="op">=</span> [up, down, left, right]</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> basin(x ,y):</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    visited <span class="op">=</span> np.zeros(data.shape, dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> [(x, y)]</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> neighbors:</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> neighbors.pop()</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> data[x, y] <span class="op">==</span> <span class="dv">9</span> <span class="kw">or</span> visited[x, y]:</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        visited[x, y] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> move <span class="kw">in</span> moves:</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>            new_x, new_y <span class="op">=</span> move(x, y)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> visited[new_x, new_y]:</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>                neighbors.append((new_x, new_y))</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>low_points <span class="op">=</span> <span class="bu">zip</span>(<span class="op">*</span>np.where(mask))</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>sizes <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: basin(<span class="op">*</span>x), low_points))</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.product(<span class="bu">sorted</span>(sizes)[<span class="op">-</span><span class="dv">3</span>:]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-10-syntax-scoring" class="level1">
<h1><a href="https://adventofcode.com/2021/day/10">Day 10: Syntax Scoring</a></h1>
<section id="part-1-9" class="level2">
<h2 class="anchored" data-anchor-id="part-1-9">Part 1</h2>
<div class="cell" data-execution_count="19">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> load(<span class="dv">10</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>pairs <span class="op">=</span> [<span class="st">"[]"</span>, <span class="st">"()"</span>, <span class="st">"&lt;&gt;"</span>, <span class="st">"</span><span class="sc">{}</span><span class="st">"</span>]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize(string):</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    old_string <span class="op">=</span> string</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> pair <span class="kw">in</span> pairs:</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> string.replace(pair, <span class="st">""</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> string <span class="op">==</span> old_string:</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        old_string <span class="op">=</span> string</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> string</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> {<span class="st">")"</span>: <span class="dv">3</span>, <span class="st">"]"</span>: <span class="dv">57</span>, <span class="st">"}"</span>: <span class="dv">1197</span>, <span class="st">"&gt;"</span>: <span class="dv">25137</span>}</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> lines:</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    normalized <span class="op">=</span> normalize(line)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> np.array([normalized.find(pair[<span class="dv">1</span>]) <span class="cf">for</span> pair <span class="kw">in</span> pairs])</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (indices <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>).<span class="bu">all</span>():</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    index <span class="op">=</span> <span class="bu">min</span>(index <span class="cf">for</span> index <span class="kw">in</span> indices <span class="cf">if</span> index <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> scores[normalized[index]]</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(total)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-9" class="level2">
<h2 class="anchored" data-anchor-id="part-2-9">Part 2</h2>
<div class="cell" data-execution_count="20">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>delimiters <span class="op">=</span> <span class="st">" ([{&lt;"</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> []</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> lines:</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    normalized <span class="op">=</span> normalize(line.strip())</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> np.array([normalized.find(pair[<span class="dv">1</span>]) <span class="cf">for</span> pair <span class="kw">in</span> pairs])</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (indices <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>).<span class="bu">any</span>():</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    scores.append(functools.<span class="bu">reduce</span>(<span class="kw">lambda</span> x, y: <span class="dv">5</span> <span class="op">*</span> x <span class="op">+</span> delimiters.find(y), normalized[::<span class="op">-</span><span class="dv">1</span>], <span class="dv">0</span>))</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="bu">int</span>(np.median(scores))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-11-dumbo-octopus" class="level1">
<h1><a href="https://adventofcode.com/2021/day/11">Day 11: Dumbo Octopus</a></h1>
<section id="part-1-10" class="level2">
<h2 class="anchored" data-anchor-id="part-1-10">Part 1</h2>
<div class="cell" data-execution_count="21">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_neighbors(x, y):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ((x <span class="op">-</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span>, x, x, x <span class="op">+</span> <span class="dv">1</span>, x <span class="op">+</span> <span class="dv">1</span>, x <span class="op">+</span> <span class="dv">1</span>),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>            (y <span class="op">-</span> <span class="dv">1</span>, y, y <span class="op">+</span> <span class="dv">1</span>, y <span class="op">-</span> <span class="dv">1</span>, y <span class="op">+</span> <span class="dv">1</span>, y <span class="op">-</span> <span class="dv">1</span>, y, y <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> step(board):</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  board <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  flashed <span class="op">=</span> np.zeros(board.shape, dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  indices <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(<span class="op">*</span>np.where(board <span class="op">&gt;</span> <span class="dv">9</span>)))</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> indices:</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>      x, y <span class="op">=</span> indices.pop()</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> flashed[x, y]:</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>          <span class="cf">continue</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>      flashed[x, y] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>      neighbors <span class="op">=</span> find_neighbors(x, y)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>      board[neighbors] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> neighbor <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>neighbors):</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> board[neighbor] <span class="op">&gt;</span> <span class="dv">9</span>:</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>              indices.append(neighbor)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  board[np.where(flashed)] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> flashed.<span class="bu">sum</span>()</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_fwf(datadir <span class="op">/</span> <span class="st">'11.txt'</span>, widths<span class="op">=</span>[<span class="dv">1</span>]<span class="op">*</span><span class="dv">10</span>, header<span class="op">=</span><span class="va">None</span>).to_numpy(dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.pad(data, pad_width<span class="op">=</span><span class="dv">1</span>, mode<span class="op">=</span><span class="st">'constant'</span>, constant_values<span class="op">=-</span>np.inf)</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> data.copy()</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    result <span class="op">+=</span> step(arr)</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-10" class="level2">
<h2 class="anchored" data-anchor-id="part-2-10">Part 2</h2>
<div class="cell" data-execution_count="22">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> data.copy()</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> arr[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>].<span class="bu">sum</span>() <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    step(arr)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>count</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-12-passage-pathing" class="level1">
<h1><a href="https://adventofcode.com/2021/day/12">Day 12: Passage Pathing</a></h1>
<section id="part-1-11" class="level2">
<h2 class="anchored" data-anchor-id="part-1-11">Part 1</h2>
<div class="cell" data-execution_count="23">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> flatten(mylist):</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (element <span class="cf">for</span> sublist <span class="kw">in</span> mylist <span class="cf">for</span> element <span class="kw">in</span> sublist)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> edges_to_tree(edges, repeat_visits <span class="op">=</span> <span class="dv">0</span>):</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    tree <span class="op">=</span> defaultdict(<span class="bu">set</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> e1, e2 <span class="kw">in</span> edges:</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        tree[e1].add(e2)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        tree[e2].add(e1)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tree</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> remove_node(tree, node):</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    tree <span class="op">=</span> tree.copy()</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> tree[node]</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">del</span> tree[node]</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> neighbor <span class="kw">in</span> neighbors:</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        tree[neighbor] <span class="op">=</span> tree[neighbor] <span class="op">-</span> <span class="bu">set</span>([node])</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tree</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> paths(tree, node, end):</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node <span class="op">==</span> end:</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [(end,)]</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> tree[node]:</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    new_tree <span class="op">=</span> tree <span class="cf">if</span> node <span class="op">==</span> node.upper() <span class="cf">else</span> remove_node(tree, node)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [(node,) <span class="op">+</span> x <span class="cf">for</span> x <span class="kw">in</span> flatten([paths(new_tree, neighbor, end) <span class="cf">for</span> neighbor <span class="kw">in</span> tree[node]])]</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">12</span>)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>edges <span class="op">=</span> [line.strip().split(<span class="st">"-"</span>) <span class="cf">for</span> line <span class="kw">in</span> data]</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>tree <span class="op">=</span> edges_to_tree(edges)</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(paths(tree, <span class="st">"start"</span>, <span class="st">"end"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-11" class="level2">
<h2 class="anchored" data-anchor-id="part-2-11">Part 2</h2>
<div class="cell" data-execution_count="24">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> paths(tree):</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> inner(subtree, node, end, state):</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> node <span class="op">==</span> end:</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> [(end,)]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> subtree[node]:</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> []</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>        new_tree <span class="op">=</span> subtree <span class="cf">if</span> node <span class="op">==</span> node.upper() <span class="cf">else</span> remove_node(subtree, node)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>        tail <span class="op">=</span> [inner(new_tree, neighbor, end, state) <span class="cf">for</span> neighbor <span class="kw">in</span> subtree[node]]</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> state <span class="op">==</span> <span class="dv">1</span> <span class="kw">and</span> node <span class="op">!=</span> <span class="st">"start"</span>:</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>            tail <span class="op">+=</span> [inner(subtree, neighbor, end, <span class="dv">0</span>) <span class="cf">for</span> neighbor <span class="kw">in</span> subtree[node]]</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [(node,) <span class="op">+</span> x <span class="cf">for</span> x <span class="kw">in</span> flatten(tail)]</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> inner(tree, <span class="st">"start"</span>, <span class="st">"end"</span>, <span class="dv">1</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="bu">set</span>(paths(tree)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-13-transparent-origami" class="level1">
<h1><a href="https://adventofcode.com/2021/day/13">Day 13: Transparent Origami</a></h1>
<section id="part-1-12" class="level2">
<h2 class="anchored" data-anchor-id="part-1-12">Part 1</h2>
<div class="cell" data-execution_count="25">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> load(<span class="dv">13</span>, <span class="st">"np"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> np.zeros(start.<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span>, dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>arr[start[:, <span class="dv">0</span>], start[:, <span class="dv">1</span>]] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>top  <span class="op">=</span> arr[:<span class="dv">655</span>]</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>bottom <span class="op">=</span> arr[<span class="dv">656</span>:]</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>bottom <span class="op">=</span> np.pad(bottom, ((<span class="dv">0</span>, top.shape[<span class="dv">0</span>] <span class="op">-</span> bottom.shape[<span class="dv">0</span>]), (<span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((top <span class="op">|</span> np.flip(bottom, <span class="dv">0</span>)).<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-12" class="level2">
<h2 class="anchored" data-anchor-id="part-2-12">Part 2</h2>
<div class="cell" data-execution_count="26">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>replacement <span class="op">=</span> np.vectorize(<span class="kw">lambda</span> x: <span class="st">"█"</span> <span class="cf">if</span> x <span class="cf">else</span> <span class="st">" "</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>instructions <span class="op">=</span> [<span class="st">"x=655"</span>, <span class="st">"y=447"</span>, <span class="st">"x=327"</span>, <span class="st">"y=223"</span>, <span class="st">"x=163"</span>, <span class="st">"y=111"</span>, <span class="st">"x=81"</span>, <span class="st">"y=55"</span>, <span class="st">"x=40"</span>, <span class="st">"y=27"</span>, <span class="st">"y=13"</span>, <span class="st">"y=6"</span>]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> instruction <span class="kw">in</span> instructions:</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    direction, position <span class="op">=</span> instruction.split(<span class="st">"="</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    position <span class="op">=</span> <span class="bu">int</span>(position)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    arr <span class="op">=</span> arr.T <span class="cf">if</span> direction <span class="op">==</span> <span class="st">"y"</span> <span class="cf">else</span> arr</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    top <span class="op">=</span> arr[:position]</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    bottom <span class="op">=</span> arr[position <span class="op">+</span> <span class="dv">1</span>:]</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> top.shape[<span class="dv">0</span>] <span class="op">&lt;</span> bottom.shape[<span class="dv">0</span>]:</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        top <span class="op">=</span> np.pad(top, ((bottom.shape[<span class="dv">0</span>] <span class="op">-</span> top.shape[<span class="dv">0</span>], <span class="dv">0</span>), (<span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        bottom <span class="op">=</span> np.pad(bottom, ((<span class="dv">0</span>, top.shape[<span class="dv">0</span>] <span class="op">-</span> bottom.shape[<span class="dv">0</span>]), (<span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    arr <span class="op">=</span> np.flip(bottom, <span class="dv">0</span>) <span class="op">|</span> top</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    arr <span class="op">=</span> arr.T <span class="cf">if</span> direction <span class="op">==</span> <span class="st">"y"</span> <span class="cf">else</span> arr</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> replacement(arr.T):</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">''</span>.join(row))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-14-extended-polymerization" class="level1">
<h1><a href="https://adventofcode.com/2021/day/14">Day 14: Extended Polymerization</a></h1>
<p>Here’s another puzzle that seems tailor made for a transition matrix based approach. We are given an initial state, and a set of rules for producing the next state from the current state. The rules are all phrased in terms of pairs, so we should work in the basis of pairs of elements.</p>
<p>A rule like CH -&gt; B should be interpreted as state “CH” produces states “CB” and “BH” in the next generation.</p>
<section id="part-1-13" class="level2">
<h2 class="anchored" data-anchor-id="part-1-13">Part 1</h2>
<div class="cell" data-execution_count="27">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>state_string <span class="op">=</span> <span class="st">"VCOPVNKPFOOVPVSBKCOF"</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">14</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>transition_elements <span class="op">=</span> <span class="st">''</span>.join(line.strip().replace(<span class="st">" -&gt; "</span>, <span class="st">""</span>) <span class="cf">for</span> line <span class="kw">in</span> data)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>elements <span class="op">=</span> <span class="bu">sorted</span>(<span class="bu">set</span>(state_string <span class="op">+</span> transition_elements))</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(elements)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> encode(pair):</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> elements.index(pair[<span class="dv">0</span>]) <span class="op">*</span> n <span class="op">+</span> elements.index(pair[<span class="dv">1</span>])</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>initial_pairs <span class="op">=</span> [encode(state_string[i:i<span class="op">+</span><span class="dv">2</span>]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(state_string) <span class="op">-</span> <span class="dv">1</span>)]</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>initial_state <span class="op">=</span> np.zeros(n <span class="op">**</span> <span class="dv">2</span>, dtype<span class="op">=</span>np.int64)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pair <span class="kw">in</span> initial_pairs:</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    initial_state[pair] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>transition_matrix <span class="op">=</span> np.zeros((n<span class="op">**</span><span class="dv">2</span>, n<span class="op">**</span><span class="dv">2</span>), dtype<span class="op">=</span>np.int64)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> data:</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    source, target <span class="op">=</span> line.strip().split(<span class="st">" -&gt; "</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    transition_matrix[encode(source), encode(source[<span class="dv">0</span>] <span class="op">+</span> target)] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    transition_matrix[encode(source), encode(target <span class="op">+</span> source[<span class="dv">1</span>])] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count(state):</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    result[state_string[<span class="dv">0</span>]] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    result[state_string[<span class="op">-</span><span class="dv">1</span>]] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index, number <span class="kw">in</span> <span class="bu">enumerate</span>(state):</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>        result[elements[<span class="bu">int</span>(index <span class="op">%</span> n)]] <span class="op">+=</span> number</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>        result[elements[<span class="bu">int</span>(index <span class="op">//</span> n)]] <span class="op">+=</span> number</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {k : <span class="bu">int</span>(v <span class="op">/</span> <span class="dv">2</span>) <span class="cf">for</span> k, v <span class="kw">in</span> result.items()}</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> count(initial_state.T <span class="op">@</span> (np.linalg.matrix_power(transition_matrix, <span class="dv">10</span>)))</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>pd.Series(totals).<span class="bu">max</span>() <span class="op">-</span> pd.Series(totals).<span class="bu">min</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-13" class="level2">
<h2 class="anchored" data-anchor-id="part-2-13">Part 2</h2>
<div class="cell" data-execution_count="28">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> count(initial_state.T <span class="op">@</span> (np.linalg.matrix_power(transition_matrix, <span class="dv">40</span>)))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>pd.Series(totals).<span class="bu">max</span>() <span class="op">-</span> pd.Series(totals).<span class="bu">min</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-15-chiton" class="level1">
<h1><a href="https://adventofcode.com/2021/day/15">Day 15: Chiton</a></h1>
<section id="part-1-14" class="level2">
<h2 class="anchored" data-anchor-id="part-1-14">Part 1</h2>
<p>This is a shortest path search, where we’ll use a priority queue to store the items and their cost. Reusing my A* implementation then gives</p>
<div class="cell" data-execution_count="29">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_fwf(datadir <span class="op">/</span> <span class="st">'15.txt'</span>, widths<span class="op">=</span>[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>, header<span class="op">=</span><span class="va">None</span>).to_numpy(dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> neighbors(state, data<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> state</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    xmax, ymax <span class="op">=</span> data.shape</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    candidates <span class="op">=</span> [(x<span class="op">-</span><span class="dv">1</span>, y), (x <span class="op">+</span> <span class="dv">1</span>, y), (x, y <span class="op">-</span> <span class="dv">1</span>), (x, y <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [c <span class="cf">for</span> c <span class="kw">in</span> candidates <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;=</span> c[<span class="dv">0</span>] <span class="op">&lt;</span> xmax <span class="kw">and</span> <span class="dv">0</span> <span class="op">&lt;=</span> c[<span class="dv">1</span>] <span class="op">&lt;</span> ymax]</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cost(state, neighbor, data<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span> <span class="cf">if</span> data <span class="kw">is</span> <span class="va">None</span> <span class="cf">else</span> <span class="dv">0</span> <span class="cf">if</span> state <span class="op">==</span> neighbor <span class="cf">else</span> data[neighbor]</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> heuristic(node, end):</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">abs</span>(node[<span class="dv">0</span>] <span class="op">-</span> end[<span class="dv">0</span>]) <span class="op">+</span> <span class="bu">abs</span>(node[<span class="dv">1</span>] <span class="op">-</span> end[<span class="dv">1</span>])</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>utils.astar((<span class="dv">0</span>, <span class="dv">0</span>), (<span class="dv">99</span>, <span class="dv">99</span>), neighbors, heuristic, cost, data<span class="op">=</span>data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-14" class="level2">
<h2 class="anchored" data-anchor-id="part-2-14">Part 2</h2>
<div class="cell" data-execution_count="30">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>x, y <span class="op">=</span> data.shape</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> np.zeros([<span class="dv">5</span>  <span class="op">*</span> x, <span class="dv">5</span> <span class="op">*</span> y], dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>        arr[i <span class="op">*</span> x: (i <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> x, j <span class="op">*</span> y : (j <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> y] <span class="op">=</span> data <span class="op">+</span> i <span class="op">+</span> j</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> ((arr <span class="op">-</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">9</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>utils.astar((<span class="dv">0</span>, <span class="dv">0</span>), (<span class="dv">499</span>, <span class="dv">499</span>), neighbors, heuristic, cost, data<span class="op">=</span>arr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-16-packet-decoder" class="level1">
<h1><a href="https://adventofcode.com/2021/day/16">Day 16: Packet Decoder</a></h1>
<section id="part-1-15" class="level2">
<h2 class="anchored" data-anchor-id="part-1-15">Part 1</h2>
<div class="cell" data-execution_count="31">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>nybbles <span class="op">=</span> {<span class="bu">hex</span>(i)[<span class="dv">2</span>:]: <span class="bu">bin</span>(i)[<span class="dv">2</span>:].rjust(<span class="dv">4</span>, <span class="st">'0'</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">16</span>)}</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse(bitstring):</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(bitstring) <span class="op">==</span> <span class="dv">0</span> <span class="kw">or</span> <span class="bu">set</span>(bitstring) <span class="op">==</span> <span class="bu">set</span>(<span class="st">"0"</span>):</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span>, <span class="dv">0</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    version <span class="op">=</span> <span class="bu">int</span>(bitstring[:<span class="dv">3</span>], <span class="dv">2</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    type_id <span class="op">=</span> <span class="bu">int</span>(bitstring[offset:offset <span class="op">+</span> <span class="dv">3</span>], <span class="dv">2</span>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">+=</span>  <span class="dv">3</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> type_id <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>            chunk <span class="op">=</span> bitstring[offset:offset <span class="op">+</span> <span class="dv">5</span>]</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">+=</span> <span class="dv">5</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> chunk[<span class="dv">0</span>] <span class="op">!=</span> <span class="st">"1"</span>:</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> version, offset</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    kind <span class="op">=</span> bitstring[offset]</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> kind <span class="op">==</span> <span class="st">"0"</span>:</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>        length <span class="op">=</span> <span class="bu">int</span>(bitstring[offset: offset <span class="op">+</span> <span class="dv">15</span>], <span class="dv">2</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>        offset <span class="op">+=</span> <span class="dv">15</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>        target <span class="op">=</span> offset <span class="op">+</span> length</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> offset <span class="op">!=</span> target:</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>            dv, do <span class="op">=</span> parse(bitstring[offset:])</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>            version <span class="op">+=</span> dv</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">+=</span> do</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> version, target</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> kind <span class="op">==</span> <span class="st">"1"</span>:</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>        n_operators <span class="op">=</span> <span class="bu">int</span>(bitstring[offset: offset <span class="op">+</span> <span class="dv">11</span>], <span class="dv">2</span>)</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>        offset <span class="op">+=</span> <span class="dv">11</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_operators):</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>            dv, do <span class="op">=</span> parse(bitstring[offset:])</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>            version <span class="op">+=</span> dv</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">+=</span> do</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> version, offset</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">16</span>)[<span class="dv">0</span>].strip()</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>bits <span class="op">=</span> <span class="st">''</span>.join(nybbles[x.lower()] <span class="cf">for</span> x <span class="kw">in</span> data)</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>parse(bits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-15" class="level2">
<h2 class="anchored" data-anchor-id="part-2-15">Part 2</h2>
<p>For part 2, we have to completely ignore the version number and actually do something with the data associated with each packet. Actually moving through the packet happens in the same way, but what we have to do at each level is sufficiently different that it’s not worth it to try and reuse the parsing function.</p>
<div class="cell" data-execution_count="32">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_one_packet(bitstring):</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    type_id <span class="op">=</span> <span class="bu">int</span>(bitstring[offset:offset <span class="op">+</span> <span class="dv">3</span>], <span class="dv">2</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">+=</span>  <span class="dv">3</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> type_id <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> <span class="st">""</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>            chunk <span class="op">=</span> bitstring[offset:offset <span class="op">+</span> <span class="dv">5</span>]</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>            result <span class="op">+=</span> chunk[<span class="dv">1</span>:]</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">+=</span> <span class="dv">5</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> chunk[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"0"</span>:</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">int</span>(result, <span class="dv">2</span>), offset</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    kind <span class="op">=</span> bitstring[offset]</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    operands <span class="op">=</span> []</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> kind <span class="op">==</span> <span class="st">"0"</span>:</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>        length <span class="op">=</span> <span class="bu">int</span>(bitstring[offset: offset <span class="op">+</span> <span class="dv">15</span>], <span class="dv">2</span>)</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>        offset <span class="op">+=</span> <span class="dv">15</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>        target <span class="op">=</span> offset <span class="op">+</span> length</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> offset <span class="op">&lt;</span> target:</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>            operand, do <span class="op">=</span> evaluate_one_packet(bitstring[offset:])</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>            operands.append(operand)</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">+=</span> do</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> kind <span class="op">==</span> <span class="st">"1"</span>:</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>        n_operators <span class="op">=</span> <span class="bu">int</span>(bitstring[offset: offset <span class="op">+</span> <span class="dv">11</span>], <span class="dv">2</span>)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>        offset <span class="op">+=</span> <span class="dv">11</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_operators):</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>            operand, do <span class="op">=</span> evaluate_one_packet(bitstring[offset:])</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>            operands.append(operand)</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">+=</span> do</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>    operators <span class="op">=</span> [<span class="bu">sum</span>, np.product, <span class="bu">min</span>, <span class="bu">max</span>,</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>                 <span class="va">None</span>,</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">lambda</span> x: x[<span class="dv">0</span>] <span class="op">&gt;</span> x[<span class="dv">1</span>], <span class="kw">lambda</span> x: x[<span class="dv">0</span>] <span class="op">&lt;</span> x[<span class="dv">1</span>], <span class="kw">lambda</span> x: x[<span class="dv">0</span>] <span class="op">==</span> x[<span class="dv">1</span>]]</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> operators[type_id](operands), offset</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(evaluate_one_packet(bits)[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-17-trick-shot" class="level1">
<h1><a href="https://adventofcode.com/2021/day/17">Day 17: Trick Shot</a></h1>
<section id="part-1-16" class="level2">
<h2 class="anchored" data-anchor-id="part-1-16">Part 1</h2>
<p>First pen and paper solution for this year.</p>
<p>Things to note:</p>
<ol type="1">
<li>x and y are completely decoupled</li>
<li>There exists a time velocity x<sub>0</sub> such that the probe will be within the target area for all t &gt; some t<sub>i</sub></li>
<li>As long as the up velocity is greater than this, then by the time the probe reaches the baseline in y, it will have stopped in x.</li>
<li>The arc up and down is symmetric; a probe launched from y=0 at t=0 with v=v0 will hit y=0 at t=2v0 + 1</li>
<li>This probe will have velocity (-v0 - 1) at that point</li>
<li>If -v0 - 1 &lt; bottom of target, then the probe will entirely miss the target in the next step</li>
<li>The greater v0 is, the higher the probe will go; ymax = ½ v0 (v0 + 1)</li>
<li>So we just set -v0 - 1 = -126 =&gt; v0 = 125</li>
<li>So ymax = 125 * 126 / 2 = 7875.</li>
<li>∎</li>
</ol>
</section>
<section id="part-2-16" class="level2">
<h2 class="anchored" data-anchor-id="part-2-16">Part 2</h2>
<div class="cell" data-execution_count="33">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>xmin, xmax <span class="op">=</span>  <span class="dv">217</span>, <span class="dv">240</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>ymin, ymax <span class="op">=</span> <span class="op">-</span><span class="dv">126</span>, <span class="op">-</span><span class="dv">69</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>parabola <span class="op">=</span> <span class="kw">lambda</span> v, t: (t <span class="op">*</span> v <span class="op">-</span> <span class="bu">int</span>(t <span class="op">*</span> (t <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>time_map <span class="op">=</span> defaultdict(<span class="bu">list</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> vy <span class="kw">in</span> <span class="bu">range</span>(ymin, <span class="op">-</span>ymin):</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> time <span class="kw">in</span> [t <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">3</span> <span class="op">-</span> <span class="dv">2</span><span class="op">*</span>ymin) <span class="cf">if</span> parabola(vy, t) <span class="kw">in</span> <span class="bu">range</span>(ymin, ymax <span class="op">+</span> <span class="dv">1</span>)]:</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        time_map[time].append(vy)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> x_times(vx):</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    times <span class="op">=</span> [t <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, vx) <span class="cf">if</span> parabola(vx, t) <span class="kw">in</span> <span class="bu">range</span>(xmin, xmax <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> vx <span class="op">-</span> <span class="dv">1</span> <span class="kw">in</span> times:</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>        times <span class="op">+=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">max</span>(times) <span class="op">+</span> <span class="dv">1</span>, <span class="bu">max</span>(time_map.keys()) <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> times</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> []</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> vx <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">int</span>(<span class="fl">0.5</span> <span class="op">+</span> np.sqrt(<span class="fl">0.25</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> xmin)), xmax <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    times <span class="op">=</span> x_times(vx)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> time <span class="kw">in</span> times:</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> vy <span class="kw">in</span> time_map[time]:</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>            result.append((vx, vy))</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(<span class="bu">set</span>(result)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-18-snailfish" class="level1">
<h1><a href="https://adventofcode.com/2021/day/18">Day 18: Snailfish</a></h1>
<section id="part-1-17" class="level2">
<h2 class="anchored" data-anchor-id="part-1-17">Part 1</h2>
<div class="cell" data-execution_count="34">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> to_node(thing, depth):</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(thing, <span class="bu">int</span>):</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> thing</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">isinstance</span>(thing, Pair):</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> node <span class="kw">in</span> thing.traverse():</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>            node.depth <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> thing</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Pair(thing[<span class="dv">0</span>], thing[<span class="dv">1</span>], depth<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Pair:</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, left, right, depth<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.depth <span class="op">=</span> depth</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> to_node(left, depth)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.right <span class="op">=</span> to_node(right, depth)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> leftmost(<span class="va">self</span>):</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span> <span class="cf">if</span> <span class="bu">isinstance</span>(<span class="va">self</span>.left, <span class="bu">int</span>) <span class="cf">else</span> <span class="va">self</span>.left.leftmost()</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> rightmost(<span class="va">self</span>):</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span> <span class="cf">if</span> <span class="bu">isinstance</span>(<span class="va">self</span>.right, <span class="bu">int</span>) <span class="cf">else</span> <span class="va">self</span>.right.rightmost()</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="bu">sum</span>(<span class="va">self</span>):</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>        left <span class="op">=</span> <span class="va">self</span>.left <span class="cf">if</span> <span class="bu">isinstance</span>(<span class="va">self</span>.left, <span class="bu">int</span>) <span class="cf">else</span> <span class="va">self</span>.left.<span class="bu">sum</span>()</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>        right <span class="op">=</span> <span class="va">self</span>.right <span class="cf">if</span> <span class="bu">isinstance</span>(<span class="va">self</span>.right, <span class="bu">int</span>) <span class="cf">else</span> <span class="va">self</span>.right.<span class="bu">sum</span>()</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">3</span><span class="op">*</span>left <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>right</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> traverse(<span class="va">self</span>):</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>        left <span class="op">=</span> [] <span class="cf">if</span> <span class="bu">isinstance</span>(<span class="va">self</span>.left, <span class="bu">int</span>) <span class="cf">else</span> <span class="va">self</span>.left.traverse()</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>        right <span class="op">=</span> [] <span class="cf">if</span> <span class="bu">isinstance</span>(<span class="va">self</span>.right, <span class="bu">int</span>) <span class="cf">else</span> <span class="va">self</span>.right.traverse()</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> left <span class="op">+</span> [<span class="va">self</span>] <span class="op">+</span> right</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="bu">reduce</span>(<span class="va">self</span>):</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>            altered <span class="op">=</span> <span class="va">False</span></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>            altered <span class="op">=</span> <span class="va">self</span>.explode()</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> altered:</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>                altered <span class="op">=</span> <span class="va">self</span>.split()</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> altered:</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> split(<span class="va">self</span>):</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> node <span class="kw">in</span> <span class="va">self</span>.traverse():</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> d <span class="kw">in</span> [<span class="st">'left'</span>, <span class="st">'right'</span>]:</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>                val  <span class="op">=</span> <span class="bu">getattr</span>(node, d)</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">isinstance</span>(val, <span class="bu">int</span>) <span class="kw">and</span> val <span class="op">&gt;=</span> <span class="dv">10</span>:</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">setattr</span>(node, d, Pair(val <span class="op">//</span> <span class="dv">2</span>, val <span class="op">//</span> <span class="dv">2</span> <span class="op">+</span> val <span class="op">%</span> <span class="dv">2</span>, node.depth <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> explode(<span class="va">self</span>):</span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a>        traversal <span class="op">=</span> <span class="va">self</span>.traverse()</span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, node <span class="kw">in</span> <span class="bu">enumerate</span>(traversal):</span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> node.depth <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">==</span> <span class="bu">len</span>(traversal) <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a>                    parent <span class="op">=</span> traversal[idx <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a>                    direction <span class="op">=</span> <span class="st">"right"</span></span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> traversal[idx <span class="op">+</span> <span class="dv">1</span>].left <span class="op">==</span> node:</span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a>                    parent <span class="op">=</span> traversal[idx <span class="op">+</span> <span class="dv">1</span>]</span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a>                    direction <span class="op">=</span> <span class="st">"left"</span></span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a>                    parent <span class="op">=</span> traversal[idx <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a>                    direction <span class="op">=</span> <span class="st">"right"</span></span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a>                <span class="bu">setattr</span>(parent, direction, <span class="dv">0</span>)</span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(traversal[idx <span class="op">-</span> <span class="dv">1</span>].left, <span class="bu">int</span>):</span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a>                        traversal[idx <span class="op">-</span> <span class="dv">1</span>].left <span class="op">+=</span> node.left</span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a>                        left_neighbor <span class="op">=</span> traversal[idx <span class="op">-</span><span class="dv">1</span>].left.rightmost()</span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a>                        left_neighbor.right <span class="op">+=</span> node.left</span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">!=</span> <span class="bu">len</span>(traversal) <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(traversal[idx <span class="op">+</span> <span class="dv">1</span>].right, <span class="bu">int</span>):</span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a>                        traversal[idx <span class="op">+</span> <span class="dv">1</span>].right <span class="op">+=</span> node.right</span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a>                        right_neighbor <span class="op">=</span> traversal[idx <span class="op">+</span> <span class="dv">1</span>].right.leftmost()</span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a>                        right_neighbor.left <span class="op">+=</span> node.right</span>
<span id="cb34-78"><a href="#cb34-78" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb34-79"><a href="#cb34-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb34-80"><a href="#cb34-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-81"><a href="#cb34-81" aria-hidden="true" tabindex="-1"></a>snumbers <span class="op">=</span> [<span class="bu">eval</span>(line.strip()) <span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">18</span>)]</span>
<span id="cb34-82"><a href="#cb34-82" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> Pair(<span class="op">*</span>snumbers[<span class="dv">0</span>])</span>
<span id="cb34-83"><a href="#cb34-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> snumber <span class="kw">in</span> snumbers[<span class="dv">1</span>:]:</span>
<span id="cb34-84"><a href="#cb34-84" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> Pair(result, Pair(<span class="op">*</span>snumber)).<span class="bu">reduce</span>()</span>
<span id="cb34-85"><a href="#cb34-85" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result.<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-17" class="level2">
<h2 class="anchored" data-anchor-id="part-2-17">Part 2</h2>
<div class="cell" data-execution_count="35">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>maxval <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> left, right <span class="kw">in</span> itertools.permutations(snumbers, <span class="dv">2</span>):</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> (Pair(left, right).<span class="bu">reduce</span>()).<span class="bu">sum</span>()</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    maxval <span class="op">=</span> total <span class="cf">if</span> total <span class="op">&gt;</span> maxval <span class="cf">else</span> maxval</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>maxval</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-19-beacon-scanner" class="level1">
<h1><a href="https://adventofcode.com/2021/day/19">Day 19: Beacon Scanner</a></h1>
<section id="part-1-18" class="level2">
<h2 class="anchored" data-anchor-id="part-1-18">Part 1</h2>
<p>We’ll start by generating the 24 rotation matrices. There are six possible ways of permuting the axes, and eight possible sign conventions. Half of the sign conventions will be left-handed, so we discard them</p>
<div class="cell" data-execution_count="36">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>rotations <span class="op">=</span> []</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> permutation <span class="kw">in</span> (itertools.permutations([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>], <span class="dv">3</span>)):</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    arr <span class="op">=</span> np.zeros((<span class="dv">3</span>, <span class="dv">3</span>), dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    arr[np.array([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>]), permutation] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> sign <span class="kw">in</span> itertools.product([<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>], repeat<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        rotation <span class="op">=</span> arr.copy() <span class="op">*</span> sign</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> np.linalg.det(rotation) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>            rotations.append(rotation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then we find overlapping scanners in the input and populate a map (x, y) with the matrices to convert from y coordinates to x coordinates</p>
<div class="cell" data-execution_count="37">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.spatial.distance <span class="im">import</span> pdist, squareform</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>foo <span class="op">=</span> load(<span class="dv">19</span>, <span class="st">"raw"</span>)[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>scanners <span class="op">=</span> foo.split(<span class="st">'</span><span class="ch">\n\n</span><span class="st">'</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>scanners <span class="op">=</span> [np.array([<span class="bu">list</span>(<span class="bu">map</span>(<span class="bu">int</span>, line.split(<span class="st">','</span>))) <span class="cf">for</span> line <span class="kw">in</span> scanner.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)[<span class="dv">1</span>:]], dtype<span class="op">=</span><span class="bu">int</span>) <span class="cf">for</span> scanner <span class="kw">in</span> scanners]</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>distances <span class="op">=</span> [squareform(pdist(scanner)) <span class="cf">for</span> scanner <span class="kw">in</span> scanners]</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>mapping <span class="op">=</span> {}</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a, b <span class="kw">in</span> itertools.combinations(<span class="bu">range</span>(<span class="bu">len</span>(scanners)), <span class="dv">2</span>):</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    pairs <span class="op">=</span> []</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    d0 <span class="op">=</span> distances[a]</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    d1 <span class="op">=</span> distances[b]</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(d0)):</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(d1)):</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(np.intersect1d(d1[j], d0[i])) <span class="op">&gt;=</span> <span class="dv">12</span>:</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>                pairs.append((i, j))</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    pairs <span class="op">=</span> np.array(pairs)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(pairs) <span class="op">&lt;</span> <span class="dv">12</span>:</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    x0 <span class="op">=</span> scanners[a][pairs[:, <span class="dv">0</span>]]</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    y0 <span class="op">=</span> scanners[b][pairs[:, <span class="dv">1</span>]]</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> rotation <span class="kw">in</span> rotations:</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>        c <span class="op">=</span> x0[<span class="dv">0</span>] <span class="op">-</span> y0[<span class="dv">0</span>] <span class="op">@</span> rotation</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (x0[<span class="dv">1</span>:] <span class="op">==</span> (y0[<span class="dv">1</span>:] <span class="op">@</span> rotation <span class="op">+</span> c)).<span class="bu">all</span>():</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>            mapping[(a, b)] <span class="op">=</span> [rotation, c]</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>            mapping[(b, a)] <span class="op">=</span> [rotation.T, <span class="op">-</span>c <span class="op">@</span> rotation.T]</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We do some linear algebra to extend this map to all the scanners</p>
<div class="cell" data-execution_count="38">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    done <span class="op">=</span> <span class="va">True</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(scanners)):</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>        columns <span class="op">=</span> [pair[<span class="dv">1</span>] <span class="cf">for</span> pair <span class="kw">in</span> mapping.keys() <span class="cf">if</span> pair[<span class="dv">0</span>] <span class="op">==</span> x]</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> y, z <span class="kw">in</span> itertools.combinations(columns, <span class="dv">2</span>):</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (y, z) <span class="kw">not</span> <span class="kw">in</span> mapping:</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                done <span class="op">=</span> <span class="va">False</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>                Q1, a1 <span class="op">=</span> mapping[(x, y)]</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>                Q2, a2 <span class="op">=</span> mapping[(x, z)]</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>                mapping[(z, y)] <span class="op">=</span> [Q1 <span class="op">@</span> Q2.T, (a1 <span class="op">-</span> a2) <span class="op">@</span> Q2.T]</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                mapping[(y, z)] <span class="op">=</span> [Q2 <span class="op">@</span> Q1.T, (a2 <span class="op">-</span> a1) <span class="op">@</span> Q1.T]</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> done:</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And then we convert all the initial coordinates to one representation and find its length</p>
<div class="cell" data-execution_count="39">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>coords <span class="op">=</span> [<span class="bu">tuple</span>(x) <span class="cf">for</span> x <span class="kw">in</span> scanners[<span class="dv">0</span>]]</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(scanners)):</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    Q, a <span class="op">=</span> mapping[<span class="dv">0</span>, idx]</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    coords <span class="op">+=</span> [<span class="bu">tuple</span>(x) <span class="cf">for</span> x <span class="kw">in</span> (np.array(scanners[idx]) <span class="op">@</span> Q <span class="op">+</span> a)]</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(<span class="bu">set</span>(coords)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-18" class="level2">
<h2 class="anchored" data-anchor-id="part-2-18">Part 2</h2>
<p>What is the largest Manhattan distance between any two scanners?</p>
<div class="cell" data-execution_count="40">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>maxval <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, j <span class="kw">in</span> itertools.combinations(<span class="bu">range</span>(<span class="bu">len</span>(scanners)), <span class="dv">2</span>):</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="bu">sum</span>(<span class="bu">abs</span>(mapping[(i, j)][<span class="dv">1</span>]))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> total <span class="op">&gt;</span> maxval:</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>        maxval <span class="op">=</span> total</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>maxval</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-20-trench-map" class="level1">
<h1><a href="https://adventofcode.com/2021/day/20">Day 20: Trench Map</a></h1>
<section id="part-1-and-2" class="level2">
<h2 class="anchored" data-anchor-id="part-1-and-2">Part 1 and 2</h2>
<div class="cell" data-execution_count="41">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">20</span>, <span class="st">"raw"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>pixel_map <span class="op">=</span> {<span class="st">"."</span>: <span class="dv">0</span>, <span class="st">"#"</span>: <span class="dv">1</span>}</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>key, array <span class="op">=</span> data.split(<span class="st">'</span><span class="ch">\n\n</span><span class="st">'</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>key <span class="op">=</span> np.array([pixel_map[x] <span class="cf">for</span> x <span class="kw">in</span> key.strip()], dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>new <span class="op">=</span> np.array([[pixel_map[x] <span class="cf">for</span> x <span class="kw">in</span> line.strip()] <span class="cf">for</span> line <span class="kw">in</span> array.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)[:<span class="op">-</span><span class="dv">1</span>]])</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">51</span>):</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    old <span class="op">=</span> np.pad(new, <span class="dv">2</span>, constant_values <span class="op">=</span> (n <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>))</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    new <span class="op">=</span> old.copy()</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(old) <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(old) <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>            index <span class="op">=</span> <span class="bu">sum</span>((<span class="dv">2</span> <span class="op">**</span> np.arange(<span class="dv">9</span>)) <span class="op">*</span> old[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">2</span>, j<span class="op">-</span><span class="dv">1</span>:j<span class="op">+</span><span class="dv">2</span>].ravel()[::<span class="op">-</span><span class="dv">1</span>] )</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>            new[i, j] <span class="op">=</span> key[index]</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    new <span class="op">=</span> new[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">==</span> <span class="dv">2</span> <span class="kw">or</span> n <span class="op">==</span> <span class="dv">50</span>:</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(new.<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-21-dirac-dice" class="level1">
<h1><a href="https://adventofcode.com/2021/day/21">Day 21: Dirac Dice</a></h1>
<section id="part-1-19" class="level2">
<h2 class="anchored" data-anchor-id="part-1-19">Part 1</h2>
<div class="cell" data-execution_count="42">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>positions, scores, count <span class="op">=</span> [<span class="dv">4</span>, <span class="dv">6</span>], [<span class="dv">0</span>, <span class="dv">0</span>], <span class="dv">0</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> step_one(position, score, count):</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    position <span class="op">=</span> (position <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> count <span class="op">+</span> <span class="dv">5</span>) <span class="op">%</span> <span class="dv">10</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> position, score <span class="op">+</span> position, count <span class="op">+</span> <span class="dv">3</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">max</span>(scores) <span class="op">&lt;</span> <span class="dv">1000</span>:</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    positions[i], scores[i <span class="op">%</span> <span class="dv">2</span>], count <span class="op">=</span> step_one(positions[i<span class="op">%</span><span class="dv">2</span>], scores[i<span class="op">%</span><span class="dv">2</span>], count)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> i</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>count <span class="op">*</span> <span class="bu">min</span>(scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-19" class="level2">
<h2 class="anchored" data-anchor-id="part-2-19">Part 2</h2>
<div class="cell" data-execution_count="43">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>states <span class="op">=</span> {((<span class="dv">4</span>, <span class="dv">0</span>), (<span class="dv">6</span>, <span class="dv">0</span>)): <span class="dv">1</span>}</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>wins <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The frequency table for the 3x3 dice</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>rolls <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">3</span>, <span class="dv">1</span>]</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> step_one(states, player):</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    new_states <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> state <span class="kw">in</span> states:</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> step <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>, <span class="dv">10</span>):</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>            new_position <span class="op">=</span> ((state[player][<span class="dv">0</span>] <span class="op">+</span> step) <span class="op">-</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">10</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>            new_score <span class="op">=</span> state[player][<span class="dv">1</span>] <span class="op">+</span> new_position</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> new_score <span class="op">&gt;=</span> <span class="dv">21</span>:</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>                wins[player] <span class="op">+=</span> states[state] <span class="op">*</span> rolls[step]</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>                new_state <span class="op">=</span> <span class="bu">list</span>(state)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>                new_state[player] <span class="op">=</span> (new_position, new_score)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>                new_states[<span class="bu">tuple</span>(new_state)] <span class="op">+=</span> states[state] <span class="op">*</span> rolls[step]</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_states, wins</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> states:</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    states, wins <span class="op">=</span> step_one(states, i)</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> i</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>(wins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-22-reactor-reboot" class="level1">
<h1><a href="https://adventofcode.com/2021/day/22">Day 22: Reactor Reboot</a></h1>
<section id="part-1-20" class="level2">
<h2 class="anchored" data-anchor-id="part-1-20">Part 1</h2>
<p>The first part can be solved trivially by using numpy’s indexing</p>
<div class="cell" data-execution_count="44">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>offset <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>board <span class="op">=</span> np.zeros((<span class="dv">101</span>, <span class="dv">101</span>, <span class="dv">101</span>), dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_line(line):</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    command, line <span class="op">=</span> line.split(<span class="st">" "</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> [x.split(<span class="st">".."</span>) <span class="cf">for</span> x <span class="kw">in</span> line.strip().split(<span class="st">","</span>)]</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> command, [[<span class="bu">int</span>(x[<span class="dv">0</span>][<span class="dv">2</span>:]), <span class="bu">int</span>(x[<span class="dv">1</span>]) <span class="op">+</span> <span class="dv">1</span>] <span class="cf">for</span> x <span class="kw">in</span> indices]</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> load(<span class="dv">22</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>commands <span class="op">=</span> [parse_line(line) <span class="cf">for</span> line <span class="kw">in</span> lines]</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> {<span class="st">"on"</span>: <span class="dv">1</span>, <span class="st">"off"</span>: <span class="dv">0</span>}</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>maxval <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> command, indices <span class="kw">in</span> commands:</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> np.ravel(indices) <span class="op">+</span> offset</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">max</span>(<span class="bu">abs</span>(idx)) <span class="op">&gt;</span> maxval:</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>        maxval <span class="op">=</span> <span class="bu">max</span>(<span class="bu">abs</span>(idx))</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (idx <span class="op">&lt;</span> <span class="dv">0</span>).<span class="bu">any</span>() <span class="kw">or</span> (idx <span class="op">&gt;</span> <span class="dv">100</span>).<span class="bu">any</span>():</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>    board[idx[<span class="dv">0</span>]:idx[<span class="dv">1</span>], idx[<span class="dv">2</span>]:idx[<span class="dv">3</span>], idx[<span class="dv">4</span>]:idx[<span class="dv">5</span>]] <span class="op">=</span> values[command]</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>board.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-20" class="level2">
<h2 class="anchored" data-anchor-id="part-2-20">Part 2</h2>
<p>The above approach doesn’t work for part two since the field of play is too large; we have ~ 100k elements in each direction, which give ~10**15 elements in total; far too much to keep in memory.</p>
<p>The first step is to realise that the vast majority of the empty space is never touched – so there’s no reason to store all those zeros.</p>
<p>What we can do instead is to store a set containing only the coordinates which are turned on. Turning on more coordinates corresponds to making the union with the new coordinate, while turning off coordinates is a set difference. This automatically accounts for not lighting coordinates which are already lit, and not turning off coordinates which are already off.</p>
<p>Unfortunately, this is still too memory intensive – from the example solution, we see that at the end of the process, 2,758,514,936,282,235 coordinates are on, which is way too many to store individually.</p>
<p>We need an approach that only looks at corners of cuboids, and doesn’t need to store the individual coordinates at all.</p>
<p>If there were only “on” instructions, we could use the inclusion-exclusion principle, along with the fact that the intersection of two cuboids is always another cuboid, or empty.</p>
<p>That is, the volume lit by one “on” instruction is just the volume of the cuboid it represents. The volume lit by two is the sum of the volumes of each, minus the volume of their intersection. The volume lit by three is:</p>
<ul>
<li>The volume of the individual cuboids</li>
<li>Minus the volume of all the pairwise intersections</li>
<li>Plus the volume of the triple intersection</li>
</ul>
<p>And this extends to the general case. The volume lit after the n<sup>th</sup> instruction, N, is:</p>
<p>The volume lit after the (n-1)th instruction plus the volume of N, minus the sum of the volumes of the pairwise intersection of N with all previous instructions, plus the sum of the volumes of intersection of N with all previously calculated pairs, and so on.</p>
<p>Turning a cuboid off is equivalent to removing the intersection between it and all the other cuboids from the sum, and then accounting for the double counting by adding back the triple intersections etc. But that’s the same as we’re doing for the positive cuboid, except for the off cuboid we never add the volume of the individual cuboid</p>
<p>We’re going to need a way of calculating the intersection of two cuboids. But that’s just the intersection of 3 pairs of lines, since the cuboids are axis-aligned. And we can intersect two line segments and hence two cuboids as follows</p>
<div class="cell" data-execution_count="45">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> intersect_segments(x1, x2):</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    pair <span class="op">=</span> [<span class="bu">max</span>(x1[<span class="dv">0</span>], x2[<span class="dv">0</span>]), <span class="bu">min</span>(x1[<span class="dv">1</span>], x2[<span class="dv">1</span>])]</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pair <span class="cf">if</span> pair[<span class="dv">1</span>] <span class="op">&gt;</span> pair[<span class="dv">0</span>] <span class="cf">else</span> <span class="va">False</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> intersect_cuboids(c1, c2):</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> [intersect_segments(<span class="op">*</span>pair) <span class="cf">for</span> pair <span class="kw">in</span> <span class="bu">zip</span>(c1, c2)]</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result <span class="cf">if</span> <span class="bu">all</span>(result) <span class="cf">else</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The segments were originally given as closed intervals, but the parsing converted them to open intervals. The length of each is thus the endpoint minus the starting point. The volume of a cuboid is just the product the three lengths:</p>
<div class="cell" data-execution_count="46">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cuboid_volume(cuboid):</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.product([[line[<span class="dv">1</span>] <span class="op">-</span> line[<span class="dv">0</span>]] <span class="cf">for</span> line <span class="kw">in</span> cuboid])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The approach we’ll take is to process the list of instructions sequentially, calculating the various intersections as we go. They’ll go in a list where the first element represents the positive terms, and the second represents the negative terms. The final score is then just the sum of the positive values minus the sum of the negative values</p>
<p>Putting it all together gives the following. For each instruction, we intersect with all previous cuboids, and swap the signs. If it’s an “on” instruction, we also add the whole region to the list of positive volumes.</p>
<div class="cell" data-execution_count="47">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reboot(instructions):</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> [[], []]</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> instruction, region <span class="kw">in</span> instructions:</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>        extra <span class="op">=</span> [region] <span class="cf">if</span> instruction <span class="op">==</span> <span class="st">"on"</span> <span class="cf">else</span> []</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>        clipped_state <span class="op">=</span> [[c <span class="cf">for</span> cuboid <span class="kw">in</span> s <span class="cf">if</span> (c :<span class="op">=</span> intersect_cuboids(cuboid, region))] <span class="cf">for</span> s <span class="kw">in</span> state]</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> [state[<span class="dv">0</span>] <span class="op">+</span> clipped_state[<span class="dv">1</span>] <span class="op">+</span> extra, state[<span class="dv">1</span>] <span class="op">+</span> clipped_state[<span class="dv">0</span>]]</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(<span class="bu">map</span>(cuboid_volume, state[<span class="dv">0</span>])) <span class="op">-</span> <span class="bu">sum</span>(<span class="bu">map</span>(cuboid_volume, state[<span class="dv">1</span>]))</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>reboot(commands)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-23-amphipod" class="level1">
<h1><a href="https://adventofcode.com/2021/day/23">Day 23: Amphipod</a></h1>
<section id="part-1-21" class="level2">
<h2 class="anchored" data-anchor-id="part-1-21">Part 1</h2>
<p>This is definitely not pretty, and takes a bunch of time to run as well, but it works. This is a pathfinding problem: Given some initial state, our goal is to move to the final state with as small a cost as possible.</p>
<p>The tricky thing is to find the neighboring positions that can be reached from a given position with a valid move. There are only two types of moves</p>
<ul>
<li>Room to hallway</li>
<li>Hallway to room</li>
</ul>
<p>The third type (room straight to final room) is just the composition of the above two moves.</p>
<p>Once we have a method for finding neighbors, actually running the pathfinding is comparatively simple. This could probably be improved by including a heuristic for how far away a given state is from the finish, but getting finding and calculating a suitable heuristic is fiddly.</p>
<div class="cell" data-execution_count="48">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>value_to_letter <span class="op">=</span> {<span class="dv">0</span>: <span class="st">" "</span>, <span class="dv">1</span>: <span class="st">"A"</span>, <span class="dv">10</span>: <span class="st">"B"</span>, <span class="dv">100</span>: <span class="st">"C"</span>, <span class="dv">1000</span>: <span class="st">"D"</span>}</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>letter_to_value <span class="op">=</span> {v: k <span class="cf">for</span> k, v <span class="kw">in</span> value_to_letter.items()}</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>number_to_room <span class="op">=</span> {<span class="dv">10</span><span class="op">**</span>i: i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>)}</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>room_to_number <span class="op">=</span> {v: k <span class="cf">for</span> k, v <span class="kw">in</span> number_to_room.items()}</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_blockers(room, n):</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    top_row <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">4</span><span class="op">*</span>n, <span class="dv">4</span> <span class="op">*</span> n <span class="op">+</span> <span class="dv">7</span>))</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    distances <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    left <span class="op">=</span> top_row[:room <span class="op">+</span> <span class="dv">2</span>][::<span class="op">-</span><span class="dv">1</span>], np.cumsum(distances[:room <span class="op">+</span> <span class="dv">2</span>][::<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    right <span class="op">=</span> top_row[room <span class="op">+</span> <span class="dv">2</span>:], np.cumsum(distances[room <span class="op">+</span> <span class="dv">2</span>:])</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> left, right</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_moves(position, n<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>      position <span class="op">=</span> np.array(position)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">def</span> is_endgame(room):</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">set</span>(position[n <span class="op">*</span> room: n <span class="op">*</span> (room <span class="op">+</span> <span class="dv">1</span>)]) <span class="op">&lt;=</span> <span class="bu">set</span>([<span class="dv">0</span>, room_to_number[room]])</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>      possible_moves <span class="op">=</span> []</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> i <span class="kw">in</span> [idx <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>n <span class="cf">for</span> idx, val <span class="kw">in</span> <span class="bu">enumerate</span>(position[<span class="dv">4</span><span class="op">*</span>n:]) <span class="cf">if</span> val <span class="op">!=</span> <span class="dv">0</span>]:</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>            room <span class="op">=</span> number_to_room[position[i]]</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> is_endgame(room):</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">continue</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>            left, right <span class="op">=</span> find_blockers(room, n)</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>            moves, costs <span class="op">=</span> left <span class="cf">if</span> i <span class="kw">in</span> left[<span class="dv">0</span>] <span class="cf">else</span> right</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>            index <span class="op">=</span> moves.index(i)</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (position[moves[:index]] <span class="op">!=</span> <span class="dv">0</span>).<span class="bu">any</span>():</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">continue</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">=</span> np.argwhere(position[n <span class="op">*</span> room: n<span class="op">*</span>(room <span class="op">+</span> <span class="dv">1</span>)] <span class="op">==</span> <span class="dv">0</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>            new_position <span class="op">=</span> n <span class="op">*</span> room <span class="op">+</span> offset</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>            cost <span class="op">=</span> costs[index] <span class="op">+</span> n <span class="op">-</span> <span class="dv">1</span> <span class="op">-</span> offset</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>            possible_moves.append((i, new_position, cost))</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> room <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>            target <span class="op">=</span> room <span class="op">*</span> n</span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> is_endgame(room):</span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">continue</span></span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">=</span> np.argwhere(position[target: target <span class="op">+</span> n])[<span class="op">-</span><span class="dv">1</span>][<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>            moves, costs <span class="op">=</span> [], []</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> block, steps <span class="kw">in</span> find_blockers(room, n):</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>                  free <span class="op">=</span> np.maximum.accumulate(position[block]) <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">if</span> <span class="kw">not</span> free.<span class="bu">any</span>():</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>                  n_free <span class="op">=</span> np.argwhere(free)[<span class="op">-</span><span class="dv">1</span>][<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>                  moves <span class="op">+=</span> block[:n_free]</span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>                  costs <span class="op">+=</span> <span class="bu">list</span>(steps[:n_free] <span class="op">+</span> n <span class="op">-</span> offset <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>            possible_moves <span class="op">+=</span> [(target <span class="op">+</span> offset, move, cost) <span class="cf">for</span> move, cost <span class="kw">in</span> <span class="bu">zip</span>(moves, costs)]</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> possible_moves</span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> navigate(source, destination):</span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> (<span class="bu">len</span>(source) <span class="op">-</span> <span class="dv">7</span>) <span class="op">//</span> <span class="dv">4</span></span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a>    q <span class="op">=</span> queue.PriorityQueue()</span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a>    q.put((<span class="dv">0</span>, source))</span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a>    seen <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> q:</span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a>        cost, position <span class="op">=</span> q.get()</span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> position <span class="op">==</span> destination:</span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> cost</span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> position <span class="kw">in</span> seen:</span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a>        seen.add(<span class="bu">tuple</span>(position))</span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> source_index, target_index, distance <span class="kw">in</span> find_moves(position, n):</span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a>            new_position <span class="op">=</span> <span class="bu">list</span>(position)</span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a>            value <span class="op">=</span> position[source_index]</span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a>            new_position[source_index] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a>            new_position[target_index] <span class="op">=</span> value</span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a>            q.put((cost <span class="op">+</span> value <span class="op">*</span> distance, <span class="bu">tuple</span>(new_position)))</span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.inf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>With all of that out of the way, actually solving the puzzle is just a question of calling the navigate function. First for part 1</p>
<div class="cell" data-execution_count="49">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>source <span class="op">=</span> <span class="bu">tuple</span>(letter_to_value[x] <span class="cf">for</span> x <span class="kw">in</span> <span class="st">"CDCABABD       "</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>destination <span class="op">=</span> <span class="bu">tuple</span>(letter_to_value[x] <span class="cf">for</span> x <span class="kw">in</span> <span class="st">'AABBCCDD       '</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>navigate(source, destination)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-21" class="level2">
<h2 class="anchored" data-anchor-id="part-2-21">Part 2</h2>
<p>And then for part 2</p>
<div class="cell" data-execution_count="50">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> <span class="bu">tuple</span>(letter_to_value[x] <span class="cf">for</span> x <span class="kw">in</span> <span class="st">"CDDDCBCABABABCAD       "</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> <span class="bu">tuple</span>(letter_to_value[x] <span class="cf">for</span> x <span class="kw">in</span> <span class="st">"AAAABBBBCCCCDDDD       "</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>navigate(s, d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-24-arithmetic-logic-unit" class="level1">
<h1><a href="https://adventofcode.com/2021/day/24">Day 24: Arithmetic Logic Unit</a></h1>
<section id="part-1-22" class="level2">
<h2 class="anchored" data-anchor-id="part-1-22">Part 1</h2>
<p>Rarely in AOC have I had a worse ratio of thinking employed to code written - this code looks way simpler than for day 23, but getting there was a real challenge.</p>
<p>I think this is the intended approach, since it uses the realisation that if we multiply z by 26 6 times, then to get back below zero, we need to divide 7 times. So each time there’s a divide, the value of w is fixed.</p>
<div class="cell" data-execution_count="51">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">24</span>, <span class="st">"raw"</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>chunks <span class="op">=</span> [[y.split() <span class="cf">for</span> y <span class="kw">in</span> x.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>) <span class="cf">if</span> y] <span class="cf">for</span> x <span class="kw">in</span> data.split(<span class="st">"inp w</span><span class="ch">\n</span><span class="st">"</span>)][<span class="dv">1</span>:]</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">14</span>]</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> [[chunk[index][<span class="dv">2</span>] <span class="cf">for</span> index <span class="kw">in</span> indices] <span class="cf">for</span> chunk <span class="kw">in</span> chunks]</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>triples <span class="op">=</span> [[<span class="bu">int</span>(n) <span class="cf">for</span> n <span class="kw">in</span> row] <span class="cf">for</span> row <span class="kw">in</span> table]</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run(triple, z, w):</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    a, b, c <span class="op">=</span> triple</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> w <span class="op">==</span> z <span class="op">%</span> <span class="dv">26</span> <span class="op">+</span> b:</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> z <span class="op">//</span> a</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (z <span class="op">//</span> a) <span class="op">*</span> <span class="dv">26</span> <span class="op">+</span> w <span class="op">+</span> c</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>zs <span class="op">=</span> [[<span class="dv">0</span>, <span class="dv">0</span>]]</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> triple <span class="kw">in</span> triples:</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    new_zs <span class="op">=</span> []</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> prefix, z <span class="kw">in</span> zs:</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> triple[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">26</span>:</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>            w <span class="op">=</span> z <span class="op">%</span> <span class="dv">26</span> <span class="op">+</span> triple[<span class="dv">1</span>]</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>            ws <span class="op">=</span> [w] <span class="cf">if</span> <span class="dv">1</span> <span class="op">&lt;=</span> w <span class="op">&lt;</span> <span class="dv">10</span> <span class="cf">else</span> []</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>            ws <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>        new_zs <span class="op">+=</span> [(<span class="dv">10</span> <span class="op">*</span> prefix <span class="op">+</span> w, run(triple, z, w)) <span class="cf">for</span> w <span class="kw">in</span> ws]</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>    zs <span class="op">=</span> new_zs</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>(x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> zs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can be slightly smarter with pen and paper. The test is always z % 26 + something, which means that we always get out w<sub>n</sub> + c<sub>n</sub> for some n, since (z // a) * 26 % 26 = 0. Keeping track of the order in which the a = 1 and a = 26 instructions arrive, we can match each of the 14 instructions to exactly one other, giving a series of relationships like w<sub>1</sub> = w<sub>14</sub> + 8. Then it’s just a question of forcing the early digit of each pair to the highest possible allowed value.</p>
</section>
<section id="part-2-22" class="level2">
<h2 class="anchored" data-anchor-id="part-2-22">Part 2</h2>
<p>After all that, luckily part 2 is trivial</p>
<div class="cell" data-execution_count="52">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="bu">min</span>(<span class="bu">int</span>(x[<span class="dv">0</span>]) <span class="cf">for</span> x <span class="kw">in</span> zs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-25-sea-cucumber" class="level1">
<h1><a href="https://adventofcode.com/2021/day/25">Day 25: Sea Cucumber</a></h1>
<p>🎄</p>
<div class="cell" data-execution_count="53">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>lookup <span class="op">=</span> {<span class="st">"."</span>: <span class="dv">0</span>, <span class="st">"&gt;"</span>: <span class="dv">1</span>, <span class="st">"v"</span>: <span class="op">-</span><span class="dv">1</span>}</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>reverse <span class="op">=</span> {v: k <span class="cf">for</span> k, v <span class="kw">in</span> lookup.items()}</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">25</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>array <span class="op">=</span> np.array([[lookup[char] <span class="cf">for</span> char <span class="kw">in</span> line.strip()] <span class="cf">for</span> line <span class="kw">in</span> data], dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> move_one(array, direction<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    critter <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> direction <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    critters <span class="op">=</span> np.where(array <span class="op">==</span> critter)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    filtered <span class="op">=</span> np.roll(array, <span class="op">-</span><span class="dv">1</span>, axis<span class="op">=</span>direction)[critters] <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    old_positions <span class="op">=</span> (critters[<span class="dv">0</span>][filtered], critters[<span class="dv">1</span>][filtered])</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    new_positions <span class="op">=</span> [x.copy() <span class="cf">for</span> x <span class="kw">in</span> old_positions]</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    new_positions[direction] <span class="op">=</span> (new_positions[direction] <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> array.shape[direction]</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>    array[old_positions] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>    array[<span class="bu">tuple</span>(new_positions)] <span class="op">=</span> critter</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">not</span> filtered.<span class="bu">any</span>()</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> to_string(array):</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join([<span class="st">''</span>.join([reverse[value] <span class="cf">for</span> value <span class="kw">in</span> line]) <span class="cf">for</span> line <span class="kw">in</span> array])</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>    m1 <span class="op">=</span> move_one(array, <span class="dv">1</span>)</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>    m2 <span class="op">=</span> move_one(array, <span class="dv">0</span>)</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>    i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> m1 <span class="kw">and</span> m2:</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>i</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb54" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> 2021 Solutions</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu"># Imports</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> functools</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> queue</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">1</span>, os.path.join(sys.path[<span class="dv">0</span>], <span class="st">".."</span>))</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> utils</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>load <span class="op">=</span> utils.year_load(<span class="dv">2021</span>)</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>datadir <span class="op">=</span> Path(<span class="st">"../data/2021"</span>)</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 1: Sonar Sweep](https://adventofcode.com/2021/day/1)</span></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">1</span>, <span class="st">"np"</span>)</span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>(np.diff(data) <span class="op">&gt;</span> <span class="dv">0</span>).<span class="bu">sum</span>()</span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a>(pd.Series(data).rolling(<span class="dv">3</span>).<span class="bu">sum</span>().diff() <span class="op">&gt;</span> <span class="dv">0</span>).<span class="bu">sum</span>()</span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 2: Dive!](https://adventofcode.com/2021/day/2)</span></span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-54"><a href="#cb54-54" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [x.strip().split() <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">2</span>)]</span>
<span id="cb54-55"><a href="#cb54-55" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data, columns<span class="op">=</span>[<span class="st">'instruction'</span>, <span class="st">'amount'</span>])</span>
<span id="cb54-56"><a href="#cb54-56" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"amount"</span>] <span class="op">=</span> df[<span class="st">"amount"</span>].<span class="bu">apply</span>(<span class="bu">int</span>)</span>
<span id="cb54-57"><a href="#cb54-57" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> df.groupby(<span class="st">"instruction"</span>).<span class="bu">sum</span>()</span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a>(totals.loc[<span class="st">'forward'</span>] <span class="op">*</span> (totals.loc[<span class="st">'down'</span>] <span class="op">-</span> totals.loc[<span class="st">'up'</span>])).iat[<span class="dv">0</span>]</span>
<span id="cb54-59"><a href="#cb54-59" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-60"><a href="#cb54-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-61"><a href="#cb54-61" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-62"><a href="#cb54-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-65"><a href="#cb54-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-66"><a href="#cb54-66" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb54-67"><a href="#cb54-67" aria-hidden="true" tabindex="-1"></a>ops <span class="op">=</span> {<span class="st">'down'</span>: <span class="kw">lambda</span> x, y: (x[<span class="dv">0</span>] <span class="op">+</span> y, x[<span class="dv">1</span>], x[<span class="dv">2</span>]),</span>
<span id="cb54-68"><a href="#cb54-68" aria-hidden="true" tabindex="-1"></a>       <span class="st">'up'</span>: <span class="kw">lambda</span> x, y: (x[<span class="dv">0</span>] <span class="op">-</span> y, x[<span class="dv">1</span>], x[<span class="dv">2</span>]),</span>
<span id="cb54-69"><a href="#cb54-69" aria-hidden="true" tabindex="-1"></a>       <span class="st">'forward'</span>: <span class="kw">lambda</span> x, y: (x[<span class="dv">0</span>], x[<span class="dv">1</span>] <span class="op">+</span> y, x[<span class="dv">2</span>] <span class="op">+</span> x[<span class="dv">0</span>]<span class="op">*</span>y)}</span>
<span id="cb54-70"><a href="#cb54-70" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> data:</span>
<span id="cb54-71"><a href="#cb54-71" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> ops[row[<span class="dv">0</span>]](state, <span class="bu">int</span>(row[<span class="dv">1</span>]))</span>
<span id="cb54-72"><a href="#cb54-72" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(state[<span class="dv">1</span>] <span class="op">*</span> state[<span class="dv">2</span>])</span>
<span id="cb54-73"><a href="#cb54-73" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-74"><a href="#cb54-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-75"><a href="#cb54-75" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 3: Binary Diagnostic](https://adventofcode.com/2021/day/3)</span></span>
<span id="cb54-76"><a href="#cb54-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-77"><a href="#cb54-77" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-78"><a href="#cb54-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-81"><a href="#cb54-81" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-82"><a href="#cb54-82" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_fwf(datadir <span class="op">/</span> <span class="st">"3.txt"</span>, widths<span class="op">=</span>[<span class="dv">1</span>]<span class="op">*</span><span class="dv">12</span>, header<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb54-83"><a href="#cb54-83" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> binarize(array):</span>
<span id="cb54-84"><a href="#cb54-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">int</span>(<span class="st">''</span>.join(<span class="bu">str</span>(x) <span class="cf">for</span> x <span class="kw">in</span> array.reshape(<span class="op">-</span><span class="dv">1</span>)), <span class="dv">2</span>)</span>
<span id="cb54-85"><a href="#cb54-85" aria-hidden="true" tabindex="-1"></a>bits <span class="op">=</span> df.median().to_numpy(dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb54-86"><a href="#cb54-86" aria-hidden="true" tabindex="-1"></a>binarize(bits) <span class="op">*</span> binarize(<span class="dv">1</span> <span class="op">-</span> bits)</span>
<span id="cb54-87"><a href="#cb54-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-88"><a href="#cb54-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-89"><a href="#cb54-89" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-90"><a href="#cb54-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-93"><a href="#cb54-93" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-94"><a href="#cb54-94" aria-hidden="true" tabindex="-1"></a>oxygen <span class="op">=</span> df</span>
<span id="cb54-95"><a href="#cb54-95" aria-hidden="true" tabindex="-1"></a>co2 <span class="op">=</span> df</span>
<span id="cb54-96"><a href="#cb54-96" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> df.columns:</span>
<span id="cb54-97"><a href="#cb54-97" aria-hidden="true" tabindex="-1"></a>    oxygen <span class="op">=</span> oxygen[oxygen[column] <span class="op">==</span> <span class="bu">int</span>(oxygen[column].median() <span class="op">+</span> <span class="fl">0.5</span>)]</span>
<span id="cb54-98"><a href="#cb54-98" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(co2) <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb54-99"><a href="#cb54-99" aria-hidden="true" tabindex="-1"></a>        co2 <span class="op">=</span> co2[co2[column] <span class="op">!=</span> <span class="bu">int</span>(co2[column].median() <span class="op">+</span> <span class="fl">0.5</span>)]</span>
<span id="cb54-100"><a href="#cb54-100" aria-hidden="true" tabindex="-1"></a>binarize(oxygen.to_numpy()) <span class="op">*</span> binarize(co2.to_numpy())</span>
<span id="cb54-101"><a href="#cb54-101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-102"><a href="#cb54-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-103"><a href="#cb54-103" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 4: Giant Squid](https://adventofcode.com/2021/day/4)</span></span>
<span id="cb54-104"><a href="#cb54-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-105"><a href="#cb54-105" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-106"><a href="#cb54-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-109"><a href="#cb54-109" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-110"><a href="#cb54-110" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">4</span>, <span class="st">"raw"</span>).split(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>)</span>
<span id="cb54-111"><a href="#cb54-111" aria-hidden="true" tabindex="-1"></a>numbers <span class="op">=</span> np.array([<span class="bu">int</span>(x) <span class="cf">for</span> x <span class="kw">in</span> data[<span class="dv">0</span>].strip().split(<span class="st">","</span>)])</span>
<span id="cb54-112"><a href="#cb54-112" aria-hidden="true" tabindex="-1"></a>boards <span class="op">=</span> np.array([<span class="bu">int</span>(x) <span class="cf">for</span> x <span class="kw">in</span> <span class="st">" "</span>.join(data[<span class="dv">1</span>:]).replace(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="st">" "</span>).split()]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb54-113"><a href="#cb54-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-114"><a href="#cb54-114" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> winning_array(boards):</span>
<span id="cb54-115"><a href="#cb54-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ((boards <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>).<span class="bu">all</span>(axis<span class="op">=</span><span class="dv">2</span>) <span class="op">|</span> (boards <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>).<span class="bu">all</span>(axis<span class="op">=</span><span class="dv">1</span>)).<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb54-116"><a href="#cb54-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-117"><a href="#cb54-117" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> number <span class="kw">in</span> numbers:</span>
<span id="cb54-118"><a href="#cb54-118" aria-hidden="true" tabindex="-1"></a>    boards[np.where(boards <span class="op">==</span> number)] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb54-119"><a href="#cb54-119" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> winning_array(boards).<span class="bu">any</span>():</span>
<span id="cb54-120"><a href="#cb54-120" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb54-121"><a href="#cb54-121" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> np.where(winning_array(boards))</span>
<span id="cb54-122"><a href="#cb54-122" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">sum</span>(np.ma.array(boards, mask<span class="op">=</span>(boards <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>))[index]) <span class="op">*</span> number</span>
<span id="cb54-123"><a href="#cb54-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-124"><a href="#cb54-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-125"><a href="#cb54-125" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-126"><a href="#cb54-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-127"><a href="#cb54-127" aria-hidden="true" tabindex="-1"></a>Figure out which board will win last. Once it wins, what would its final score be?</span>
<span id="cb54-128"><a href="#cb54-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-131"><a href="#cb54-131" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-132"><a href="#cb54-132" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> number <span class="kw">in</span> numbers:</span>
<span id="cb54-133"><a href="#cb54-133" aria-hidden="true" tabindex="-1"></a>    boards[np.where(boards <span class="op">==</span> number)] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb54-134"><a href="#cb54-134" aria-hidden="true" tabindex="-1"></a>    wins <span class="op">=</span> winning_array(boards)</span>
<span id="cb54-135"><a href="#cb54-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> wins.<span class="bu">sum</span>() <span class="op">==</span> <span class="bu">len</span>(boards) <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb54-136"><a href="#cb54-136" aria-hidden="true" tabindex="-1"></a>        index <span class="op">=</span> np.where(<span class="op">~</span>wins)[<span class="dv">0</span>]</span>
<span id="cb54-137"><a href="#cb54-137" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> wins.<span class="bu">all</span>():</span>
<span id="cb54-138"><a href="#cb54-138" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb54-139"><a href="#cb54-139" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">sum</span>(np.ma.array(boards, mask<span class="op">=</span>(boards <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>))[index]) <span class="op">*</span> number</span>
<span id="cb54-140"><a href="#cb54-140" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-141"><a href="#cb54-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-142"><a href="#cb54-142" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 5: Hydrothermal Venture](https://adventofcode.com/2021/day/5)</span></span>
<span id="cb54-143"><a href="#cb54-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-144"><a href="#cb54-144" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-145"><a href="#cb54-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-148"><a href="#cb54-148" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-149"><a href="#cb54-149" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(datadir <span class="op">/</span> <span class="st">'5.txt'</span>, names<span class="op">=</span>[<span class="st">'x1'</span>, <span class="st">'middle'</span>, <span class="st">'y2'</span>])</span>
<span id="cb54-150"><a href="#cb54-150" aria-hidden="true" tabindex="-1"></a>data[[<span class="st">'y1'</span>, <span class="st">'x2'</span>]] <span class="op">=</span> data[<span class="st">'middle'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: pd.Series(x.split(<span class="st">'-&gt;'</span>)).astype(<span class="st">'int'</span>))</span>
<span id="cb54-151"><a href="#cb54-151" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> np.zeros((<span class="dv">1000</span>, <span class="dv">1000</span>))</span>
<span id="cb54-152"><a href="#cb54-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-153"><a href="#cb54-153" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> endpoints_to_line(x1, x2, y1, y2):</span>
<span id="cb54-154"><a href="#cb54-154" aria-hidden="true" tabindex="-1"></a>    steps <span class="op">=</span> <span class="bu">max</span>(<span class="bu">abs</span>(x1 <span class="op">-</span> x2), <span class="bu">abs</span>(y1<span class="op">-</span> y2))</span>
<span id="cb54-155"><a href="#cb54-155" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> np.array([np.sign(x2 <span class="op">-</span> x1), np.sign(y2 <span class="op">-</span> y1)])</span>
<span id="cb54-156"><a href="#cb54-156" aria-hidden="true" tabindex="-1"></a>    points <span class="op">=</span> [np.array([x1, y1]) <span class="op">+</span> delta <span class="op">*</span> n <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(steps <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb54-157"><a href="#cb54-157" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">tuple</span>(np.array(points).T.tolist())</span>
<span id="cb54-158"><a href="#cb54-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-159"><a href="#cb54-159" aria-hidden="true" tabindex="-1"></a>on_axis <span class="op">=</span> data[(data[<span class="st">'x1'</span>] <span class="op">==</span> data[<span class="st">'x2'</span>]) <span class="op">|</span> (data[<span class="st">'y1'</span>] <span class="op">==</span> data[<span class="st">'y2'</span>])]</span>
<span id="cb54-160"><a href="#cb54-160" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> on_axis.itertuples():</span>
<span id="cb54-161"><a href="#cb54-161" aria-hidden="true" tabindex="-1"></a>    grid[endpoints_to_line(row.x1, row.x2, row.y1, row.y2)] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-162"><a href="#cb54-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-163"><a href="#cb54-163" aria-hidden="true" tabindex="-1"></a>(grid <span class="op">&gt;</span> <span class="dv">1</span>).<span class="bu">sum</span>()</span>
<span id="cb54-164"><a href="#cb54-164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-165"><a href="#cb54-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-166"><a href="#cb54-166" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-167"><a href="#cb54-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-170"><a href="#cb54-170" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-171"><a href="#cb54-171" aria-hidden="true" tabindex="-1"></a>skewed <span class="op">=</span> data[(data[<span class="st">'x1'</span>] <span class="op">!=</span> data[<span class="st">'x2'</span>]) <span class="op">&amp;</span> (data[<span class="st">'y1'</span>] <span class="op">!=</span> data[<span class="st">'y2'</span>])]</span>
<span id="cb54-172"><a href="#cb54-172" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> skewed.itertuples():</span>
<span id="cb54-173"><a href="#cb54-173" aria-hidden="true" tabindex="-1"></a>    grid[endpoints_to_line(row.x1, row.x2, row.y1, row.y2)] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-174"><a href="#cb54-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-175"><a href="#cb54-175" aria-hidden="true" tabindex="-1"></a>(grid <span class="op">&gt;</span> <span class="dv">1</span>).<span class="bu">sum</span>()</span>
<span id="cb54-176"><a href="#cb54-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-177"><a href="#cb54-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-178"><a href="#cb54-178" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 6: Lanternfish](https://adventofcode.com/2021/day/6)</span></span>
<span id="cb54-179"><a href="#cb54-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-180"><a href="#cb54-180" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-181"><a href="#cb54-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-184"><a href="#cb54-184" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-185"><a href="#cb54-185" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">6</span>, <span class="st">"np"</span>)</span>
<span id="cb54-186"><a href="#cb54-186" aria-hidden="true" tabindex="-1"></a>population, _ <span class="op">=</span> np.histogram(data, <span class="bu">range</span>(<span class="dv">10</span>))</span>
<span id="cb54-187"><a href="#cb54-187" aria-hidden="true" tabindex="-1"></a>transition_matrix <span class="op">=</span> np.roll(np.eye(<span class="dv">9</span>, dtype<span class="op">=</span><span class="bu">int</span>), <span class="dv">1</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb54-188"><a href="#cb54-188" aria-hidden="true" tabindex="-1"></a>transition_matrix[<span class="dv">6</span>, <span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb54-189"><a href="#cb54-189" aria-hidden="true" tabindex="-1"></a>(np.linalg.matrix_power(transition_matrix, <span class="dv">80</span>) <span class="op">@</span> population).<span class="bu">sum</span>()</span>
<span id="cb54-190"><a href="#cb54-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-191"><a href="#cb54-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-192"><a href="#cb54-192" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-193"><a href="#cb54-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-196"><a href="#cb54-196" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-197"><a href="#cb54-197" aria-hidden="true" tabindex="-1"></a>(np.linalg.matrix_power(transition_matrix, <span class="dv">256</span>) <span class="op">@</span> population).<span class="bu">sum</span>()</span>
<span id="cb54-198"><a href="#cb54-198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-199"><a href="#cb54-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-200"><a href="#cb54-200" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 7: The Treachery of Whales](https://adventofcode.com/2021/day/7)</span></span>
<span id="cb54-201"><a href="#cb54-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-202"><a href="#cb54-202" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-203"><a href="#cb54-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-206"><a href="#cb54-206" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-207"><a href="#cb54-207" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">7</span>, <span class="st">"np"</span>)</span>
<span id="cb54-208"><a href="#cb54-208" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">abs</span>(data <span class="op">-</span> np.median(data)).<span class="bu">sum</span>()</span>
<span id="cb54-209"><a href="#cb54-209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-210"><a href="#cb54-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-211"><a href="#cb54-211" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-212"><a href="#cb54-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-215"><a href="#cb54-215" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-216"><a href="#cb54-216" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cost(position):</span>
<span id="cb54-217"><a href="#cb54-217" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> np.<span class="bu">abs</span>(data <span class="op">-</span> position)</span>
<span id="cb54-218"><a href="#cb54-218" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ((delta) <span class="op">*</span> (delta <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> <span class="dv">2</span>).<span class="bu">sum</span>()</span>
<span id="cb54-219"><a href="#cb54-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-220"><a href="#cb54-220" aria-hidden="true" tabindex="-1"></a>options <span class="op">=</span> [cost(<span class="bu">int</span>(data.mean())), cost(<span class="bu">int</span>(data.mean() <span class="op">+</span> <span class="fl">0.5</span>))]</span>
<span id="cb54-221"><a href="#cb54-221" aria-hidden="true" tabindex="-1"></a><span class="bu">min</span>(options)</span>
<span id="cb54-222"><a href="#cb54-222" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-223"><a href="#cb54-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-224"><a href="#cb54-224" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 8: Seven Segment Search](https://adventofcode.com/2021/day/8)</span></span>
<span id="cb54-225"><a href="#cb54-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-226"><a href="#cb54-226" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-227"><a href="#cb54-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-230"><a href="#cb54-230" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-231"><a href="#cb54-231" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">8</span>)</span>
<span id="cb54-232"><a href="#cb54-232" aria-hidden="true" tabindex="-1"></a>segments <span class="op">=</span> [line.split(<span class="st">"|"</span>)[<span class="dv">1</span>].strip().split() <span class="cf">for</span> line <span class="kw">in</span> data]</span>
<span id="cb54-233"><a href="#cb54-233" aria-hidden="true" tabindex="-1"></a>mylen <span class="op">=</span> np.vectorize(<span class="bu">len</span>)</span>
<span id="cb54-234"><a href="#cb54-234" aria-hidden="true" tabindex="-1"></a>np.isin(mylen(segments), [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">7</span>]).<span class="bu">sum</span>()</span>
<span id="cb54-235"><a href="#cb54-235" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-236"><a href="#cb54-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-237"><a href="#cb54-237" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-238"><a href="#cb54-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-239"><a href="#cb54-239" aria-hidden="true" tabindex="-1"></a>This is an obvious task for constraint programming. It feels a bit like cheating, so I'll see if I can come up with a home-grown approach at a later stage. I'll start by describing the segment pattern of each digit. I'm deliberately using numbers for the segment positions and letters for the segment names so that I don't get confused.</span>
<span id="cb54-240"><a href="#cb54-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-241"><a href="#cb54-241" aria-hidden="true" tabindex="-1"></a>We can do part 2 by exploiting the structure in our data.</span>
<span id="cb54-242"><a href="#cb54-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-243"><a href="#cb54-243" aria-hidden="true" tabindex="-1"></a>We know that every digit occurs before the pipe for every row in our input.</span>
<span id="cb54-244"><a href="#cb54-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-245"><a href="#cb54-245" aria-hidden="true" tabindex="-1"></a>Using that, we can immediately identify segment 1, segments {36} segments {24} and segments {57}.</span>
<span id="cb54-246"><a href="#cb54-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-247"><a href="#cb54-247" aria-hidden="true" tabindex="-1"></a>The three five segment numbers let us disambiguate {147}, {25}, {36}. 147 occur in every group, 25 in only 1 and 36 in two</span>
<span id="cb54-248"><a href="#cb54-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-249"><a href="#cb54-249" aria-hidden="true" tabindex="-1"></a>The three six segment numbers let us disambiguate {1267}, {345}.</span>
<span id="cb54-250"><a href="#cb54-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-251"><a href="#cb54-251" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>1 is the segment present in 3 but not in 2.</span>
<span id="cb54-252"><a href="#cb54-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-253"><a href="#cb54-253" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>2 is the segment present in 4, not present in 2, and present in every 6</span>
<span id="cb54-254"><a href="#cb54-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-255"><a href="#cb54-255" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>3 is the segment present in 2 which is not present in every 6</span>
<span id="cb54-256"><a href="#cb54-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-257"><a href="#cb54-257" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>4 is the segment present in 4, not present in 2, and not present in every 6</span>
<span id="cb54-258"><a href="#cb54-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-259"><a href="#cb54-259" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>5 is the segment not present in 4 which only occurs once in 5</span>
<span id="cb54-260"><a href="#cb54-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-261"><a href="#cb54-261" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>6 is the segment which is present in 2 and is present in every 6</span>
<span id="cb54-262"><a href="#cb54-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-263"><a href="#cb54-263" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>7 is the segment present in every 5, not present in every 6, not present in 4</span>
<span id="cb54-264"><a href="#cb54-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-265"><a href="#cb54-265" aria-hidden="true" tabindex="-1"></a>    It's not super elegant, and I kind of prefer just using the generalised constraints programming.</span>
<span id="cb54-266"><a href="#cb54-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-267"><a href="#cb54-267" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 9: Smoke Basin](https://adventofcode.com/2021/day/9)</span></span>
<span id="cb54-268"><a href="#cb54-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-269"><a href="#cb54-269" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-270"><a href="#cb54-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-273"><a href="#cb54-273" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-274"><a href="#cb54-274" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_fwf(datadir <span class="op">/</span> <span class="st">'9.txt'</span>, widths<span class="op">=</span>[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>, header<span class="op">=</span><span class="va">None</span>).to_numpy()</span>
<span id="cb54-275"><a href="#cb54-275" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.pad(data, pad_width<span class="op">=</span><span class="dv">1</span>, mode<span class="op">=</span><span class="st">'constant'</span>, constant_values<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb54-276"><a href="#cb54-276" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> ((data <span class="op">&lt;</span> np.roll(data, <span class="op">-</span><span class="dv">1</span>, axis<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb54-277"><a href="#cb54-277" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (data <span class="op">&lt;</span> np.roll(data, <span class="dv">1</span>, axis<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb54-278"><a href="#cb54-278" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (data <span class="op">&lt;</span> np.roll(data, <span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb54-279"><a href="#cb54-279" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (data <span class="op">&lt;</span> np.roll(data, <span class="dv">1</span>)))</span>
<span id="cb54-280"><a href="#cb54-280" aria-hidden="true" tabindex="-1"></a>np.ma.array(data <span class="op">+</span> <span class="dv">1</span>, mask<span class="op">=~</span>mask).<span class="bu">sum</span>()</span>
<span id="cb54-281"><a href="#cb54-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-282"><a href="#cb54-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-283"><a href="#cb54-283" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-284"><a href="#cb54-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-287"><a href="#cb54-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-288"><a href="#cb54-288" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> up(x, y): <span class="cf">return</span> x, y <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb54-289"><a href="#cb54-289" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> down(x, y): <span class="cf">return</span> x, y <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb54-290"><a href="#cb54-290" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> left(x, y): <span class="cf">return</span> x <span class="op">-</span> <span class="dv">1</span>, y</span>
<span id="cb54-291"><a href="#cb54-291" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> right(x, y): <span class="cf">return</span> x <span class="op">+</span> <span class="dv">1</span>, y</span>
<span id="cb54-292"><a href="#cb54-292" aria-hidden="true" tabindex="-1"></a>moves <span class="op">=</span> [up, down, left, right]</span>
<span id="cb54-293"><a href="#cb54-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-294"><a href="#cb54-294" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> basin(x ,y):</span>
<span id="cb54-295"><a href="#cb54-295" aria-hidden="true" tabindex="-1"></a>    visited <span class="op">=</span> np.zeros(data.shape, dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb54-296"><a href="#cb54-296" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> [(x, y)]</span>
<span id="cb54-297"><a href="#cb54-297" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-298"><a href="#cb54-298" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> neighbors:</span>
<span id="cb54-299"><a href="#cb54-299" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> neighbors.pop()</span>
<span id="cb54-300"><a href="#cb54-300" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> data[x, y] <span class="op">==</span> <span class="dv">9</span> <span class="kw">or</span> visited[x, y]:</span>
<span id="cb54-301"><a href="#cb54-301" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb54-302"><a href="#cb54-302" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-303"><a href="#cb54-303" aria-hidden="true" tabindex="-1"></a>        visited[x, y] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb54-304"><a href="#cb54-304" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> move <span class="kw">in</span> moves:</span>
<span id="cb54-305"><a href="#cb54-305" aria-hidden="true" tabindex="-1"></a>            new_x, new_y <span class="op">=</span> move(x, y)</span>
<span id="cb54-306"><a href="#cb54-306" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> visited[new_x, new_y]:</span>
<span id="cb54-307"><a href="#cb54-307" aria-hidden="true" tabindex="-1"></a>                neighbors.append((new_x, new_y))</span>
<span id="cb54-308"><a href="#cb54-308" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb54-309"><a href="#cb54-309" aria-hidden="true" tabindex="-1"></a>low_points <span class="op">=</span> <span class="bu">zip</span>(<span class="op">*</span>np.where(mask))</span>
<span id="cb54-310"><a href="#cb54-310" aria-hidden="true" tabindex="-1"></a>sizes <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: basin(<span class="op">*</span>x), low_points))</span>
<span id="cb54-311"><a href="#cb54-311" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.product(<span class="bu">sorted</span>(sizes)[<span class="op">-</span><span class="dv">3</span>:]))</span>
<span id="cb54-312"><a href="#cb54-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-313"><a href="#cb54-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-314"><a href="#cb54-314" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 10: Syntax Scoring](https://adventofcode.com/2021/day/10)</span></span>
<span id="cb54-315"><a href="#cb54-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-316"><a href="#cb54-316" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-317"><a href="#cb54-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-320"><a href="#cb54-320" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-321"><a href="#cb54-321" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> load(<span class="dv">10</span>)</span>
<span id="cb54-322"><a href="#cb54-322" aria-hidden="true" tabindex="-1"></a>pairs <span class="op">=</span> [<span class="st">"[]"</span>, <span class="st">"()"</span>, <span class="st">"&lt;&gt;"</span>, <span class="st">"</span><span class="sc">{}</span><span class="st">"</span>]</span>
<span id="cb54-323"><a href="#cb54-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-324"><a href="#cb54-324" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize(string):</span>
<span id="cb54-325"><a href="#cb54-325" aria-hidden="true" tabindex="-1"></a>    old_string <span class="op">=</span> string</span>
<span id="cb54-326"><a href="#cb54-326" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb54-327"><a href="#cb54-327" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> pair <span class="kw">in</span> pairs:</span>
<span id="cb54-328"><a href="#cb54-328" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> string.replace(pair, <span class="st">""</span>)</span>
<span id="cb54-329"><a href="#cb54-329" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> string <span class="op">==</span> old_string:</span>
<span id="cb54-330"><a href="#cb54-330" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb54-331"><a href="#cb54-331" aria-hidden="true" tabindex="-1"></a>        old_string <span class="op">=</span> string</span>
<span id="cb54-332"><a href="#cb54-332" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> string</span>
<span id="cb54-333"><a href="#cb54-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-334"><a href="#cb54-334" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> {<span class="st">")"</span>: <span class="dv">3</span>, <span class="st">"]"</span>: <span class="dv">57</span>, <span class="st">"}"</span>: <span class="dv">1197</span>, <span class="st">"&gt;"</span>: <span class="dv">25137</span>}</span>
<span id="cb54-335"><a href="#cb54-335" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-336"><a href="#cb54-336" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> lines:</span>
<span id="cb54-337"><a href="#cb54-337" aria-hidden="true" tabindex="-1"></a>    normalized <span class="op">=</span> normalize(line)</span>
<span id="cb54-338"><a href="#cb54-338" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> np.array([normalized.find(pair[<span class="dv">1</span>]) <span class="cf">for</span> pair <span class="kw">in</span> pairs])</span>
<span id="cb54-339"><a href="#cb54-339" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (indices <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>).<span class="bu">all</span>():</span>
<span id="cb54-340"><a href="#cb54-340" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb54-341"><a href="#cb54-341" aria-hidden="true" tabindex="-1"></a>    index <span class="op">=</span> <span class="bu">min</span>(index <span class="cf">for</span> index <span class="kw">in</span> indices <span class="cf">if</span> index <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb54-342"><a href="#cb54-342" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> scores[normalized[index]]</span>
<span id="cb54-343"><a href="#cb54-343" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(total)</span>
<span id="cb54-344"><a href="#cb54-344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-345"><a href="#cb54-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-346"><a href="#cb54-346" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-347"><a href="#cb54-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-350"><a href="#cb54-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-351"><a href="#cb54-351" aria-hidden="true" tabindex="-1"></a>delimiters <span class="op">=</span> <span class="st">" ([{&lt;"</span></span>
<span id="cb54-352"><a href="#cb54-352" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> []</span>
<span id="cb54-353"><a href="#cb54-353" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> lines:</span>
<span id="cb54-354"><a href="#cb54-354" aria-hidden="true" tabindex="-1"></a>    normalized <span class="op">=</span> normalize(line.strip())</span>
<span id="cb54-355"><a href="#cb54-355" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> np.array([normalized.find(pair[<span class="dv">1</span>]) <span class="cf">for</span> pair <span class="kw">in</span> pairs])</span>
<span id="cb54-356"><a href="#cb54-356" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (indices <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>).<span class="bu">any</span>():</span>
<span id="cb54-357"><a href="#cb54-357" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb54-358"><a href="#cb54-358" aria-hidden="true" tabindex="-1"></a>    scores.append(functools.<span class="bu">reduce</span>(<span class="kw">lambda</span> x, y: <span class="dv">5</span> <span class="op">*</span> x <span class="op">+</span> delimiters.find(y), normalized[::<span class="op">-</span><span class="dv">1</span>], <span class="dv">0</span>))</span>
<span id="cb54-359"><a href="#cb54-359" aria-hidden="true" tabindex="-1"></a><span class="bu">int</span>(np.median(scores))</span>
<span id="cb54-360"><a href="#cb54-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-361"><a href="#cb54-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-362"><a href="#cb54-362" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 11: Dumbo Octopus](https://adventofcode.com/2021/day/11)</span></span>
<span id="cb54-363"><a href="#cb54-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-364"><a href="#cb54-364" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-365"><a href="#cb54-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-368"><a href="#cb54-368" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-369"><a href="#cb54-369" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_neighbors(x, y):</span>
<span id="cb54-370"><a href="#cb54-370" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ((x <span class="op">-</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span>, x, x, x <span class="op">+</span> <span class="dv">1</span>, x <span class="op">+</span> <span class="dv">1</span>, x <span class="op">+</span> <span class="dv">1</span>),</span>
<span id="cb54-371"><a href="#cb54-371" aria-hidden="true" tabindex="-1"></a>            (y <span class="op">-</span> <span class="dv">1</span>, y, y <span class="op">+</span> <span class="dv">1</span>, y <span class="op">-</span> <span class="dv">1</span>, y <span class="op">+</span> <span class="dv">1</span>, y <span class="op">-</span> <span class="dv">1</span>, y, y <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb54-372"><a href="#cb54-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-373"><a href="#cb54-373" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> step(board):</span>
<span id="cb54-374"><a href="#cb54-374" aria-hidden="true" tabindex="-1"></a>  board <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-375"><a href="#cb54-375" aria-hidden="true" tabindex="-1"></a>  flashed <span class="op">=</span> np.zeros(board.shape, dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb54-376"><a href="#cb54-376" aria-hidden="true" tabindex="-1"></a>  indices <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(<span class="op">*</span>np.where(board <span class="op">&gt;</span> <span class="dv">9</span>)))</span>
<span id="cb54-377"><a href="#cb54-377" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> indices:</span>
<span id="cb54-378"><a href="#cb54-378" aria-hidden="true" tabindex="-1"></a>      x, y <span class="op">=</span> indices.pop()</span>
<span id="cb54-379"><a href="#cb54-379" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> flashed[x, y]:</span>
<span id="cb54-380"><a href="#cb54-380" aria-hidden="true" tabindex="-1"></a>          <span class="cf">continue</span></span>
<span id="cb54-381"><a href="#cb54-381" aria-hidden="true" tabindex="-1"></a>      flashed[x, y] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb54-382"><a href="#cb54-382" aria-hidden="true" tabindex="-1"></a>      neighbors <span class="op">=</span> find_neighbors(x, y)</span>
<span id="cb54-383"><a href="#cb54-383" aria-hidden="true" tabindex="-1"></a>      board[neighbors] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-384"><a href="#cb54-384" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> neighbor <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>neighbors):</span>
<span id="cb54-385"><a href="#cb54-385" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> board[neighbor] <span class="op">&gt;</span> <span class="dv">9</span>:</span>
<span id="cb54-386"><a href="#cb54-386" aria-hidden="true" tabindex="-1"></a>              indices.append(neighbor)</span>
<span id="cb54-387"><a href="#cb54-387" aria-hidden="true" tabindex="-1"></a>  board[np.where(flashed)] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-388"><a href="#cb54-388" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> flashed.<span class="bu">sum</span>()</span>
<span id="cb54-389"><a href="#cb54-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-390"><a href="#cb54-390" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-391"><a href="#cb54-391" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_fwf(datadir <span class="op">/</span> <span class="st">'11.txt'</span>, widths<span class="op">=</span>[<span class="dv">1</span>]<span class="op">*</span><span class="dv">10</span>, header<span class="op">=</span><span class="va">None</span>).to_numpy(dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb54-392"><a href="#cb54-392" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.pad(data, pad_width<span class="op">=</span><span class="dv">1</span>, mode<span class="op">=</span><span class="st">'constant'</span>, constant_values<span class="op">=-</span>np.inf)</span>
<span id="cb54-393"><a href="#cb54-393" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> data.copy()</span>
<span id="cb54-394"><a href="#cb54-394" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb54-395"><a href="#cb54-395" aria-hidden="true" tabindex="-1"></a>    result <span class="op">+=</span> step(arr)</span>
<span id="cb54-396"><a href="#cb54-396" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result)</span>
<span id="cb54-397"><a href="#cb54-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-398"><a href="#cb54-398" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-399"><a href="#cb54-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-400"><a href="#cb54-400" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-401"><a href="#cb54-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-404"><a href="#cb54-404" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-405"><a href="#cb54-405" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-406"><a href="#cb54-406" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> data.copy()</span>
<span id="cb54-407"><a href="#cb54-407" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> arr[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>].<span class="bu">sum</span>() <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb54-408"><a href="#cb54-408" aria-hidden="true" tabindex="-1"></a>    step(arr)</span>
<span id="cb54-409"><a href="#cb54-409" aria-hidden="true" tabindex="-1"></a>    count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-410"><a href="#cb54-410" aria-hidden="true" tabindex="-1"></a>count</span>
<span id="cb54-411"><a href="#cb54-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-412"><a href="#cb54-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-413"><a href="#cb54-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-414"><a href="#cb54-414" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 12: Passage Pathing](https://adventofcode.com/2021/day/12)</span></span>
<span id="cb54-415"><a href="#cb54-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-416"><a href="#cb54-416" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-417"><a href="#cb54-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-420"><a href="#cb54-420" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-421"><a href="#cb54-421" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> flatten(mylist):</span>
<span id="cb54-422"><a href="#cb54-422" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (element <span class="cf">for</span> sublist <span class="kw">in</span> mylist <span class="cf">for</span> element <span class="kw">in</span> sublist)</span>
<span id="cb54-423"><a href="#cb54-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-424"><a href="#cb54-424" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> edges_to_tree(edges, repeat_visits <span class="op">=</span> <span class="dv">0</span>):</span>
<span id="cb54-425"><a href="#cb54-425" aria-hidden="true" tabindex="-1"></a>    tree <span class="op">=</span> defaultdict(<span class="bu">set</span>)</span>
<span id="cb54-426"><a href="#cb54-426" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> e1, e2 <span class="kw">in</span> edges:</span>
<span id="cb54-427"><a href="#cb54-427" aria-hidden="true" tabindex="-1"></a>        tree[e1].add(e2)</span>
<span id="cb54-428"><a href="#cb54-428" aria-hidden="true" tabindex="-1"></a>        tree[e2].add(e1)</span>
<span id="cb54-429"><a href="#cb54-429" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tree</span>
<span id="cb54-430"><a href="#cb54-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-431"><a href="#cb54-431" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> remove_node(tree, node):</span>
<span id="cb54-432"><a href="#cb54-432" aria-hidden="true" tabindex="-1"></a>    tree <span class="op">=</span> tree.copy()</span>
<span id="cb54-433"><a href="#cb54-433" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> tree[node]</span>
<span id="cb54-434"><a href="#cb54-434" aria-hidden="true" tabindex="-1"></a>    <span class="kw">del</span> tree[node]</span>
<span id="cb54-435"><a href="#cb54-435" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> neighbor <span class="kw">in</span> neighbors:</span>
<span id="cb54-436"><a href="#cb54-436" aria-hidden="true" tabindex="-1"></a>        tree[neighbor] <span class="op">=</span> tree[neighbor] <span class="op">-</span> <span class="bu">set</span>([node])</span>
<span id="cb54-437"><a href="#cb54-437" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tree</span>
<span id="cb54-438"><a href="#cb54-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-439"><a href="#cb54-439" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> paths(tree, node, end):</span>
<span id="cb54-440"><a href="#cb54-440" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node <span class="op">==</span> end:</span>
<span id="cb54-441"><a href="#cb54-441" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [(end,)]</span>
<span id="cb54-442"><a href="#cb54-442" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> tree[node]:</span>
<span id="cb54-443"><a href="#cb54-443" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb54-444"><a href="#cb54-444" aria-hidden="true" tabindex="-1"></a>    new_tree <span class="op">=</span> tree <span class="cf">if</span> node <span class="op">==</span> node.upper() <span class="cf">else</span> remove_node(tree, node)</span>
<span id="cb54-445"><a href="#cb54-445" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [(node,) <span class="op">+</span> x <span class="cf">for</span> x <span class="kw">in</span> flatten([paths(new_tree, neighbor, end) <span class="cf">for</span> neighbor <span class="kw">in</span> tree[node]])]</span>
<span id="cb54-446"><a href="#cb54-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-447"><a href="#cb54-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-448"><a href="#cb54-448" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">12</span>)</span>
<span id="cb54-449"><a href="#cb54-449" aria-hidden="true" tabindex="-1"></a>edges <span class="op">=</span> [line.strip().split(<span class="st">"-"</span>) <span class="cf">for</span> line <span class="kw">in</span> data]</span>
<span id="cb54-450"><a href="#cb54-450" aria-hidden="true" tabindex="-1"></a>tree <span class="op">=</span> edges_to_tree(edges)</span>
<span id="cb54-451"><a href="#cb54-451" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(paths(tree, <span class="st">"start"</span>, <span class="st">"end"</span>))</span>
<span id="cb54-452"><a href="#cb54-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-453"><a href="#cb54-453" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-454"><a href="#cb54-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-455"><a href="#cb54-455" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-456"><a href="#cb54-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-459"><a href="#cb54-459" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-460"><a href="#cb54-460" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> paths(tree):</span>
<span id="cb54-461"><a href="#cb54-461" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> inner(subtree, node, end, state):</span>
<span id="cb54-462"><a href="#cb54-462" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> node <span class="op">==</span> end:</span>
<span id="cb54-463"><a href="#cb54-463" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> [(end,)]</span>
<span id="cb54-464"><a href="#cb54-464" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> subtree[node]:</span>
<span id="cb54-465"><a href="#cb54-465" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> []</span>
<span id="cb54-466"><a href="#cb54-466" aria-hidden="true" tabindex="-1"></a>        new_tree <span class="op">=</span> subtree <span class="cf">if</span> node <span class="op">==</span> node.upper() <span class="cf">else</span> remove_node(subtree, node)</span>
<span id="cb54-467"><a href="#cb54-467" aria-hidden="true" tabindex="-1"></a>        tail <span class="op">=</span> [inner(new_tree, neighbor, end, state) <span class="cf">for</span> neighbor <span class="kw">in</span> subtree[node]]</span>
<span id="cb54-468"><a href="#cb54-468" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> state <span class="op">==</span> <span class="dv">1</span> <span class="kw">and</span> node <span class="op">!=</span> <span class="st">"start"</span>:</span>
<span id="cb54-469"><a href="#cb54-469" aria-hidden="true" tabindex="-1"></a>            tail <span class="op">+=</span> [inner(subtree, neighbor, end, <span class="dv">0</span>) <span class="cf">for</span> neighbor <span class="kw">in</span> subtree[node]]</span>
<span id="cb54-470"><a href="#cb54-470" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [(node,) <span class="op">+</span> x <span class="cf">for</span> x <span class="kw">in</span> flatten(tail)]</span>
<span id="cb54-471"><a href="#cb54-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-472"><a href="#cb54-472" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> inner(tree, <span class="st">"start"</span>, <span class="st">"end"</span>, <span class="dv">1</span>)</span>
<span id="cb54-473"><a href="#cb54-473" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="bu">set</span>(paths(tree)))</span>
<span id="cb54-474"><a href="#cb54-474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-475"><a href="#cb54-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-476"><a href="#cb54-476" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 13: Transparent Origami](https://adventofcode.com/2021/day/13)</span></span>
<span id="cb54-477"><a href="#cb54-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-478"><a href="#cb54-478" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-479"><a href="#cb54-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-482"><a href="#cb54-482" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-483"><a href="#cb54-483" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> load(<span class="dv">13</span>, <span class="st">"np"</span>)</span>
<span id="cb54-484"><a href="#cb54-484" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> np.zeros(start.<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span>, dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb54-485"><a href="#cb54-485" aria-hidden="true" tabindex="-1"></a>arr[start[:, <span class="dv">0</span>], start[:, <span class="dv">1</span>]] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb54-486"><a href="#cb54-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-487"><a href="#cb54-487" aria-hidden="true" tabindex="-1"></a>top  <span class="op">=</span> arr[:<span class="dv">655</span>]</span>
<span id="cb54-488"><a href="#cb54-488" aria-hidden="true" tabindex="-1"></a>bottom <span class="op">=</span> arr[<span class="dv">656</span>:]</span>
<span id="cb54-489"><a href="#cb54-489" aria-hidden="true" tabindex="-1"></a>bottom <span class="op">=</span> np.pad(bottom, ((<span class="dv">0</span>, top.shape[<span class="dv">0</span>] <span class="op">-</span> bottom.shape[<span class="dv">0</span>]), (<span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb54-490"><a href="#cb54-490" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((top <span class="op">|</span> np.flip(bottom, <span class="dv">0</span>)).<span class="bu">sum</span>())</span>
<span id="cb54-491"><a href="#cb54-491" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-492"><a href="#cb54-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-493"><a href="#cb54-493" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-494"><a href="#cb54-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-497"><a href="#cb54-497" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-498"><a href="#cb54-498" aria-hidden="true" tabindex="-1"></a>replacement <span class="op">=</span> np.vectorize(<span class="kw">lambda</span> x: <span class="st">"█"</span> <span class="cf">if</span> x <span class="cf">else</span> <span class="st">" "</span>)</span>
<span id="cb54-499"><a href="#cb54-499" aria-hidden="true" tabindex="-1"></a>instructions <span class="op">=</span> [<span class="st">"x=655"</span>, <span class="st">"y=447"</span>, <span class="st">"x=327"</span>, <span class="st">"y=223"</span>, <span class="st">"x=163"</span>, <span class="st">"y=111"</span>, <span class="st">"x=81"</span>, <span class="st">"y=55"</span>, <span class="st">"x=40"</span>, <span class="st">"y=27"</span>, <span class="st">"y=13"</span>, <span class="st">"y=6"</span>]</span>
<span id="cb54-500"><a href="#cb54-500" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> instruction <span class="kw">in</span> instructions:</span>
<span id="cb54-501"><a href="#cb54-501" aria-hidden="true" tabindex="-1"></a>    direction, position <span class="op">=</span> instruction.split(<span class="st">"="</span>)</span>
<span id="cb54-502"><a href="#cb54-502" aria-hidden="true" tabindex="-1"></a>    position <span class="op">=</span> <span class="bu">int</span>(position)</span>
<span id="cb54-503"><a href="#cb54-503" aria-hidden="true" tabindex="-1"></a>    arr <span class="op">=</span> arr.T <span class="cf">if</span> direction <span class="op">==</span> <span class="st">"y"</span> <span class="cf">else</span> arr</span>
<span id="cb54-504"><a href="#cb54-504" aria-hidden="true" tabindex="-1"></a>    top <span class="op">=</span> arr[:position]</span>
<span id="cb54-505"><a href="#cb54-505" aria-hidden="true" tabindex="-1"></a>    bottom <span class="op">=</span> arr[position <span class="op">+</span> <span class="dv">1</span>:]</span>
<span id="cb54-506"><a href="#cb54-506" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> top.shape[<span class="dv">0</span>] <span class="op">&lt;</span> bottom.shape[<span class="dv">0</span>]:</span>
<span id="cb54-507"><a href="#cb54-507" aria-hidden="true" tabindex="-1"></a>        top <span class="op">=</span> np.pad(top, ((bottom.shape[<span class="dv">0</span>] <span class="op">-</span> top.shape[<span class="dv">0</span>], <span class="dv">0</span>), (<span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb54-508"><a href="#cb54-508" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb54-509"><a href="#cb54-509" aria-hidden="true" tabindex="-1"></a>        bottom <span class="op">=</span> np.pad(bottom, ((<span class="dv">0</span>, top.shape[<span class="dv">0</span>] <span class="op">-</span> bottom.shape[<span class="dv">0</span>]), (<span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb54-510"><a href="#cb54-510" aria-hidden="true" tabindex="-1"></a>    arr <span class="op">=</span> np.flip(bottom, <span class="dv">0</span>) <span class="op">|</span> top</span>
<span id="cb54-511"><a href="#cb54-511" aria-hidden="true" tabindex="-1"></a>    arr <span class="op">=</span> arr.T <span class="cf">if</span> direction <span class="op">==</span> <span class="st">"y"</span> <span class="cf">else</span> arr</span>
<span id="cb54-512"><a href="#cb54-512" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> replacement(arr.T):</span>
<span id="cb54-513"><a href="#cb54-513" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">''</span>.join(row))</span>
<span id="cb54-514"><a href="#cb54-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-515"><a href="#cb54-515" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-516"><a href="#cb54-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-517"><a href="#cb54-517" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 14: Extended Polymerization](https://adventofcode.com/2021/day/14)</span></span>
<span id="cb54-518"><a href="#cb54-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-519"><a href="#cb54-519" aria-hidden="true" tabindex="-1"></a>Here's another puzzle that seems tailor made for a transition matrix based approach. We are given an initial state, and a set of rules for producing the next state from the current state. The rules are all phrased in terms of pairs, so we should work in the basis of pairs of elements.</span>
<span id="cb54-520"><a href="#cb54-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-521"><a href="#cb54-521" aria-hidden="true" tabindex="-1"></a>A rule like CH -<span class="sc">\&gt;</span> B should be interpreted as state "CH" produces states "CB" and "BH" in the next generation.</span>
<span id="cb54-522"><a href="#cb54-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-523"><a href="#cb54-523" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-524"><a href="#cb54-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-527"><a href="#cb54-527" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-528"><a href="#cb54-528" aria-hidden="true" tabindex="-1"></a>state_string <span class="op">=</span> <span class="st">"VCOPVNKPFOOVPVSBKCOF"</span></span>
<span id="cb54-529"><a href="#cb54-529" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">14</span>)</span>
<span id="cb54-530"><a href="#cb54-530" aria-hidden="true" tabindex="-1"></a>transition_elements <span class="op">=</span> <span class="st">''</span>.join(line.strip().replace(<span class="st">" -&gt; "</span>, <span class="st">""</span>) <span class="cf">for</span> line <span class="kw">in</span> data)</span>
<span id="cb54-531"><a href="#cb54-531" aria-hidden="true" tabindex="-1"></a>elements <span class="op">=</span> <span class="bu">sorted</span>(<span class="bu">set</span>(state_string <span class="op">+</span> transition_elements))</span>
<span id="cb54-532"><a href="#cb54-532" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(elements)</span>
<span id="cb54-533"><a href="#cb54-533" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> encode(pair):</span>
<span id="cb54-534"><a href="#cb54-534" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> elements.index(pair[<span class="dv">0</span>]) <span class="op">*</span> n <span class="op">+</span> elements.index(pair[<span class="dv">1</span>])</span>
<span id="cb54-535"><a href="#cb54-535" aria-hidden="true" tabindex="-1"></a>initial_pairs <span class="op">=</span> [encode(state_string[i:i<span class="op">+</span><span class="dv">2</span>]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(state_string) <span class="op">-</span> <span class="dv">1</span>)]</span>
<span id="cb54-536"><a href="#cb54-536" aria-hidden="true" tabindex="-1"></a>initial_state <span class="op">=</span> np.zeros(n <span class="op">**</span> <span class="dv">2</span>, dtype<span class="op">=</span>np.int64)</span>
<span id="cb54-537"><a href="#cb54-537" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pair <span class="kw">in</span> initial_pairs:</span>
<span id="cb54-538"><a href="#cb54-538" aria-hidden="true" tabindex="-1"></a>    initial_state[pair] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-539"><a href="#cb54-539" aria-hidden="true" tabindex="-1"></a>transition_matrix <span class="op">=</span> np.zeros((n<span class="op">**</span><span class="dv">2</span>, n<span class="op">**</span><span class="dv">2</span>), dtype<span class="op">=</span>np.int64)</span>
<span id="cb54-540"><a href="#cb54-540" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> data:</span>
<span id="cb54-541"><a href="#cb54-541" aria-hidden="true" tabindex="-1"></a>    source, target <span class="op">=</span> line.strip().split(<span class="st">" -&gt; "</span>)</span>
<span id="cb54-542"><a href="#cb54-542" aria-hidden="true" tabindex="-1"></a>    transition_matrix[encode(source), encode(source[<span class="dv">0</span>] <span class="op">+</span> target)] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb54-543"><a href="#cb54-543" aria-hidden="true" tabindex="-1"></a>    transition_matrix[encode(source), encode(target <span class="op">+</span> source[<span class="dv">1</span>])] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb54-544"><a href="#cb54-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-545"><a href="#cb54-545" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count(state):</span>
<span id="cb54-546"><a href="#cb54-546" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb54-547"><a href="#cb54-547" aria-hidden="true" tabindex="-1"></a>    result[state_string[<span class="dv">0</span>]] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-548"><a href="#cb54-548" aria-hidden="true" tabindex="-1"></a>    result[state_string[<span class="op">-</span><span class="dv">1</span>]] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-549"><a href="#cb54-549" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index, number <span class="kw">in</span> <span class="bu">enumerate</span>(state):</span>
<span id="cb54-550"><a href="#cb54-550" aria-hidden="true" tabindex="-1"></a>        result[elements[<span class="bu">int</span>(index <span class="op">%</span> n)]] <span class="op">+=</span> number</span>
<span id="cb54-551"><a href="#cb54-551" aria-hidden="true" tabindex="-1"></a>        result[elements[<span class="bu">int</span>(index <span class="op">//</span> n)]] <span class="op">+=</span> number</span>
<span id="cb54-552"><a href="#cb54-552" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {k : <span class="bu">int</span>(v <span class="op">/</span> <span class="dv">2</span>) <span class="cf">for</span> k, v <span class="kw">in</span> result.items()}</span>
<span id="cb54-553"><a href="#cb54-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-554"><a href="#cb54-554" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> count(initial_state.T <span class="op">@</span> (np.linalg.matrix_power(transition_matrix, <span class="dv">10</span>)))</span>
<span id="cb54-555"><a href="#cb54-555" aria-hidden="true" tabindex="-1"></a>pd.Series(totals).<span class="bu">max</span>() <span class="op">-</span> pd.Series(totals).<span class="bu">min</span>()</span>
<span id="cb54-556"><a href="#cb54-556" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-557"><a href="#cb54-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-558"><a href="#cb54-558" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-559"><a href="#cb54-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-562"><a href="#cb54-562" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-563"><a href="#cb54-563" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> count(initial_state.T <span class="op">@</span> (np.linalg.matrix_power(transition_matrix, <span class="dv">40</span>)))</span>
<span id="cb54-564"><a href="#cb54-564" aria-hidden="true" tabindex="-1"></a>pd.Series(totals).<span class="bu">max</span>() <span class="op">-</span> pd.Series(totals).<span class="bu">min</span>()</span>
<span id="cb54-565"><a href="#cb54-565" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-566"><a href="#cb54-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-567"><a href="#cb54-567" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 15: Chiton](https://adventofcode.com/2021/day/15)</span></span>
<span id="cb54-568"><a href="#cb54-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-569"><a href="#cb54-569" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-570"><a href="#cb54-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-571"><a href="#cb54-571" aria-hidden="true" tabindex="-1"></a>This is a shortest path search, where we'll use a priority queue to store the items and their cost. Reusing my A<span class="sc">\*</span> implementation then gives</span>
<span id="cb54-572"><a href="#cb54-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-575"><a href="#cb54-575" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-576"><a href="#cb54-576" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_fwf(datadir <span class="op">/</span> <span class="st">'15.txt'</span>, widths<span class="op">=</span>[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>, header<span class="op">=</span><span class="va">None</span>).to_numpy(dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb54-577"><a href="#cb54-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-578"><a href="#cb54-578" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> neighbors(state, data<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb54-579"><a href="#cb54-579" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> state</span>
<span id="cb54-580"><a href="#cb54-580" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb54-581"><a href="#cb54-581" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb54-582"><a href="#cb54-582" aria-hidden="true" tabindex="-1"></a>    xmax, ymax <span class="op">=</span> data.shape</span>
<span id="cb54-583"><a href="#cb54-583" aria-hidden="true" tabindex="-1"></a>    candidates <span class="op">=</span> [(x<span class="op">-</span><span class="dv">1</span>, y), (x <span class="op">+</span> <span class="dv">1</span>, y), (x, y <span class="op">-</span> <span class="dv">1</span>), (x, y <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb54-584"><a href="#cb54-584" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [c <span class="cf">for</span> c <span class="kw">in</span> candidates <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;=</span> c[<span class="dv">0</span>] <span class="op">&lt;</span> xmax <span class="kw">and</span> <span class="dv">0</span> <span class="op">&lt;=</span> c[<span class="dv">1</span>] <span class="op">&lt;</span> ymax]</span>
<span id="cb54-585"><a href="#cb54-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-586"><a href="#cb54-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-587"><a href="#cb54-587" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cost(state, neighbor, data<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb54-588"><a href="#cb54-588" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span> <span class="cf">if</span> data <span class="kw">is</span> <span class="va">None</span> <span class="cf">else</span> <span class="dv">0</span> <span class="cf">if</span> state <span class="op">==</span> neighbor <span class="cf">else</span> data[neighbor]</span>
<span id="cb54-589"><a href="#cb54-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-590"><a href="#cb54-590" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> heuristic(node, end):</span>
<span id="cb54-591"><a href="#cb54-591" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">abs</span>(node[<span class="dv">0</span>] <span class="op">-</span> end[<span class="dv">0</span>]) <span class="op">+</span> <span class="bu">abs</span>(node[<span class="dv">1</span>] <span class="op">-</span> end[<span class="dv">1</span>])</span>
<span id="cb54-592"><a href="#cb54-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-593"><a href="#cb54-593" aria-hidden="true" tabindex="-1"></a>utils.astar((<span class="dv">0</span>, <span class="dv">0</span>), (<span class="dv">99</span>, <span class="dv">99</span>), neighbors, heuristic, cost, data<span class="op">=</span>data)</span>
<span id="cb54-594"><a href="#cb54-594" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-595"><a href="#cb54-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-596"><a href="#cb54-596" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-597"><a href="#cb54-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-600"><a href="#cb54-600" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-601"><a href="#cb54-601" aria-hidden="true" tabindex="-1"></a>x, y <span class="op">=</span> data.shape</span>
<span id="cb54-602"><a href="#cb54-602" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> np.zeros([<span class="dv">5</span>  <span class="op">*</span> x, <span class="dv">5</span> <span class="op">*</span> y], dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb54-603"><a href="#cb54-603" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb54-604"><a href="#cb54-604" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb54-605"><a href="#cb54-605" aria-hidden="true" tabindex="-1"></a>        arr[i <span class="op">*</span> x: (i <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> x, j <span class="op">*</span> y : (j <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> y] <span class="op">=</span> data <span class="op">+</span> i <span class="op">+</span> j</span>
<span id="cb54-606"><a href="#cb54-606" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> ((arr <span class="op">-</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">9</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb54-607"><a href="#cb54-607" aria-hidden="true" tabindex="-1"></a>utils.astar((<span class="dv">0</span>, <span class="dv">0</span>), (<span class="dv">499</span>, <span class="dv">499</span>), neighbors, heuristic, cost, data<span class="op">=</span>arr)</span>
<span id="cb54-608"><a href="#cb54-608" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-609"><a href="#cb54-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-610"><a href="#cb54-610" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 16: Packet Decoder](https://adventofcode.com/2021/day/16)</span></span>
<span id="cb54-611"><a href="#cb54-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-612"><a href="#cb54-612" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-613"><a href="#cb54-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-616"><a href="#cb54-616" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-617"><a href="#cb54-617" aria-hidden="true" tabindex="-1"></a>nybbles <span class="op">=</span> {<span class="bu">hex</span>(i)[<span class="dv">2</span>:]: <span class="bu">bin</span>(i)[<span class="dv">2</span>:].rjust(<span class="dv">4</span>, <span class="st">'0'</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">16</span>)}</span>
<span id="cb54-618"><a href="#cb54-618" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse(bitstring):</span>
<span id="cb54-619"><a href="#cb54-619" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(bitstring) <span class="op">==</span> <span class="dv">0</span> <span class="kw">or</span> <span class="bu">set</span>(bitstring) <span class="op">==</span> <span class="bu">set</span>(<span class="st">"0"</span>):</span>
<span id="cb54-620"><a href="#cb54-620" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span>, <span class="dv">0</span></span>
<span id="cb54-621"><a href="#cb54-621" aria-hidden="true" tabindex="-1"></a>    version <span class="op">=</span> <span class="bu">int</span>(bitstring[:<span class="dv">3</span>], <span class="dv">2</span>)</span>
<span id="cb54-622"><a href="#cb54-622" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb54-623"><a href="#cb54-623" aria-hidden="true" tabindex="-1"></a>    type_id <span class="op">=</span> <span class="bu">int</span>(bitstring[offset:offset <span class="op">+</span> <span class="dv">3</span>], <span class="dv">2</span>)</span>
<span id="cb54-624"><a href="#cb54-624" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">+=</span>  <span class="dv">3</span></span>
<span id="cb54-625"><a href="#cb54-625" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> type_id <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb54-626"><a href="#cb54-626" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb54-627"><a href="#cb54-627" aria-hidden="true" tabindex="-1"></a>            chunk <span class="op">=</span> bitstring[offset:offset <span class="op">+</span> <span class="dv">5</span>]</span>
<span id="cb54-628"><a href="#cb54-628" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">+=</span> <span class="dv">5</span></span>
<span id="cb54-629"><a href="#cb54-629" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> chunk[<span class="dv">0</span>] <span class="op">!=</span> <span class="st">"1"</span>:</span>
<span id="cb54-630"><a href="#cb54-630" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb54-631"><a href="#cb54-631" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> version, offset</span>
<span id="cb54-632"><a href="#cb54-632" aria-hidden="true" tabindex="-1"></a>    kind <span class="op">=</span> bitstring[offset]</span>
<span id="cb54-633"><a href="#cb54-633" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-634"><a href="#cb54-634" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> kind <span class="op">==</span> <span class="st">"0"</span>:</span>
<span id="cb54-635"><a href="#cb54-635" aria-hidden="true" tabindex="-1"></a>        length <span class="op">=</span> <span class="bu">int</span>(bitstring[offset: offset <span class="op">+</span> <span class="dv">15</span>], <span class="dv">2</span>)</span>
<span id="cb54-636"><a href="#cb54-636" aria-hidden="true" tabindex="-1"></a>        offset <span class="op">+=</span> <span class="dv">15</span></span>
<span id="cb54-637"><a href="#cb54-637" aria-hidden="true" tabindex="-1"></a>        target <span class="op">=</span> offset <span class="op">+</span> length</span>
<span id="cb54-638"><a href="#cb54-638" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> offset <span class="op">!=</span> target:</span>
<span id="cb54-639"><a href="#cb54-639" aria-hidden="true" tabindex="-1"></a>            dv, do <span class="op">=</span> parse(bitstring[offset:])</span>
<span id="cb54-640"><a href="#cb54-640" aria-hidden="true" tabindex="-1"></a>            version <span class="op">+=</span> dv</span>
<span id="cb54-641"><a href="#cb54-641" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">+=</span> do</span>
<span id="cb54-642"><a href="#cb54-642" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> version, target</span>
<span id="cb54-643"><a href="#cb54-643" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> kind <span class="op">==</span> <span class="st">"1"</span>:</span>
<span id="cb54-644"><a href="#cb54-644" aria-hidden="true" tabindex="-1"></a>        n_operators <span class="op">=</span> <span class="bu">int</span>(bitstring[offset: offset <span class="op">+</span> <span class="dv">11</span>], <span class="dv">2</span>)</span>
<span id="cb54-645"><a href="#cb54-645" aria-hidden="true" tabindex="-1"></a>        offset <span class="op">+=</span> <span class="dv">11</span></span>
<span id="cb54-646"><a href="#cb54-646" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_operators):</span>
<span id="cb54-647"><a href="#cb54-647" aria-hidden="true" tabindex="-1"></a>            dv, do <span class="op">=</span> parse(bitstring[offset:])</span>
<span id="cb54-648"><a href="#cb54-648" aria-hidden="true" tabindex="-1"></a>            version <span class="op">+=</span> dv</span>
<span id="cb54-649"><a href="#cb54-649" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">+=</span> do</span>
<span id="cb54-650"><a href="#cb54-650" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> version, offset</span>
<span id="cb54-651"><a href="#cb54-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-652"><a href="#cb54-652" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">16</span>)[<span class="dv">0</span>].strip()</span>
<span id="cb54-653"><a href="#cb54-653" aria-hidden="true" tabindex="-1"></a>bits <span class="op">=</span> <span class="st">''</span>.join(nybbles[x.lower()] <span class="cf">for</span> x <span class="kw">in</span> data)</span>
<span id="cb54-654"><a href="#cb54-654" aria-hidden="true" tabindex="-1"></a>parse(bits)</span>
<span id="cb54-655"><a href="#cb54-655" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-656"><a href="#cb54-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-657"><a href="#cb54-657" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-658"><a href="#cb54-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-659"><a href="#cb54-659" aria-hidden="true" tabindex="-1"></a>For part 2, we have to completely ignore the version number and actually do something with the data associated with each packet. Actually moving through the packet happens in the same way, but what we have to do at each level is sufficiently different that it's not worth it to try and reuse the parsing function.</span>
<span id="cb54-660"><a href="#cb54-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-663"><a href="#cb54-663" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-664"><a href="#cb54-664" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_one_packet(bitstring):</span>
<span id="cb54-665"><a href="#cb54-665" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb54-666"><a href="#cb54-666" aria-hidden="true" tabindex="-1"></a>    type_id <span class="op">=</span> <span class="bu">int</span>(bitstring[offset:offset <span class="op">+</span> <span class="dv">3</span>], <span class="dv">2</span>)</span>
<span id="cb54-667"><a href="#cb54-667" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">+=</span>  <span class="dv">3</span></span>
<span id="cb54-668"><a href="#cb54-668" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> type_id <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb54-669"><a href="#cb54-669" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> <span class="st">""</span></span>
<span id="cb54-670"><a href="#cb54-670" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb54-671"><a href="#cb54-671" aria-hidden="true" tabindex="-1"></a>            chunk <span class="op">=</span> bitstring[offset:offset <span class="op">+</span> <span class="dv">5</span>]</span>
<span id="cb54-672"><a href="#cb54-672" aria-hidden="true" tabindex="-1"></a>            result <span class="op">+=</span> chunk[<span class="dv">1</span>:]</span>
<span id="cb54-673"><a href="#cb54-673" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">+=</span> <span class="dv">5</span></span>
<span id="cb54-674"><a href="#cb54-674" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> chunk[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"0"</span>:</span>
<span id="cb54-675"><a href="#cb54-675" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb54-676"><a href="#cb54-676" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">int</span>(result, <span class="dv">2</span>), offset</span>
<span id="cb54-677"><a href="#cb54-677" aria-hidden="true" tabindex="-1"></a>    kind <span class="op">=</span> bitstring[offset]</span>
<span id="cb54-678"><a href="#cb54-678" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-679"><a href="#cb54-679" aria-hidden="true" tabindex="-1"></a>    operands <span class="op">=</span> []</span>
<span id="cb54-680"><a href="#cb54-680" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> kind <span class="op">==</span> <span class="st">"0"</span>:</span>
<span id="cb54-681"><a href="#cb54-681" aria-hidden="true" tabindex="-1"></a>        length <span class="op">=</span> <span class="bu">int</span>(bitstring[offset: offset <span class="op">+</span> <span class="dv">15</span>], <span class="dv">2</span>)</span>
<span id="cb54-682"><a href="#cb54-682" aria-hidden="true" tabindex="-1"></a>        offset <span class="op">+=</span> <span class="dv">15</span></span>
<span id="cb54-683"><a href="#cb54-683" aria-hidden="true" tabindex="-1"></a>        target <span class="op">=</span> offset <span class="op">+</span> length</span>
<span id="cb54-684"><a href="#cb54-684" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> offset <span class="op">&lt;</span> target:</span>
<span id="cb54-685"><a href="#cb54-685" aria-hidden="true" tabindex="-1"></a>            operand, do <span class="op">=</span> evaluate_one_packet(bitstring[offset:])</span>
<span id="cb54-686"><a href="#cb54-686" aria-hidden="true" tabindex="-1"></a>            operands.append(operand)</span>
<span id="cb54-687"><a href="#cb54-687" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">+=</span> do</span>
<span id="cb54-688"><a href="#cb54-688" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> kind <span class="op">==</span> <span class="st">"1"</span>:</span>
<span id="cb54-689"><a href="#cb54-689" aria-hidden="true" tabindex="-1"></a>        n_operators <span class="op">=</span> <span class="bu">int</span>(bitstring[offset: offset <span class="op">+</span> <span class="dv">11</span>], <span class="dv">2</span>)</span>
<span id="cb54-690"><a href="#cb54-690" aria-hidden="true" tabindex="-1"></a>        offset <span class="op">+=</span> <span class="dv">11</span></span>
<span id="cb54-691"><a href="#cb54-691" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_operators):</span>
<span id="cb54-692"><a href="#cb54-692" aria-hidden="true" tabindex="-1"></a>            operand, do <span class="op">=</span> evaluate_one_packet(bitstring[offset:])</span>
<span id="cb54-693"><a href="#cb54-693" aria-hidden="true" tabindex="-1"></a>            operands.append(operand)</span>
<span id="cb54-694"><a href="#cb54-694" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">+=</span> do</span>
<span id="cb54-695"><a href="#cb54-695" aria-hidden="true" tabindex="-1"></a>    operators <span class="op">=</span> [<span class="bu">sum</span>, np.product, <span class="bu">min</span>, <span class="bu">max</span>,</span>
<span id="cb54-696"><a href="#cb54-696" aria-hidden="true" tabindex="-1"></a>                 <span class="va">None</span>,</span>
<span id="cb54-697"><a href="#cb54-697" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">lambda</span> x: x[<span class="dv">0</span>] <span class="op">&gt;</span> x[<span class="dv">1</span>], <span class="kw">lambda</span> x: x[<span class="dv">0</span>] <span class="op">&lt;</span> x[<span class="dv">1</span>], <span class="kw">lambda</span> x: x[<span class="dv">0</span>] <span class="op">==</span> x[<span class="dv">1</span>]]</span>
<span id="cb54-698"><a href="#cb54-698" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> operators[type_id](operands), offset</span>
<span id="cb54-699"><a href="#cb54-699" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(evaluate_one_packet(bits)[<span class="dv">0</span>])</span>
<span id="cb54-700"><a href="#cb54-700" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-701"><a href="#cb54-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-702"><a href="#cb54-702" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 17: Trick Shot](https://adventofcode.com/2021/day/17)</span></span>
<span id="cb54-703"><a href="#cb54-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-704"><a href="#cb54-704" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-705"><a href="#cb54-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-706"><a href="#cb54-706" aria-hidden="true" tabindex="-1"></a>First pen and paper solution for this year.</span>
<span id="cb54-707"><a href="#cb54-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-708"><a href="#cb54-708" aria-hidden="true" tabindex="-1"></a>Things to note:</span>
<span id="cb54-709"><a href="#cb54-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-710"><a href="#cb54-710" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>x and y are completely decoupled</span>
<span id="cb54-711"><a href="#cb54-711" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>There exists a time velocity x~0~ such that the probe will be within the target area for all t <span class="sc">\&gt;</span> some t~i~</span>
<span id="cb54-712"><a href="#cb54-712" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>As long as the up velocity is greater than this, then by the time the probe reaches the baseline in y, it will have stopped in x.</span>
<span id="cb54-713"><a href="#cb54-713" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>The arc up and down is symmetric; a probe launched from y=0 at t=0 with v=v0 will hit y=0 at t=2v0 + 1</span>
<span id="cb54-714"><a href="#cb54-714" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>This probe will have velocity (-v0 - 1) at that point</span>
<span id="cb54-715"><a href="#cb54-715" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>If -v0 - 1 <span class="sc">\&lt;</span> bottom of target, then the probe will entirely miss the target in the next step</span>
<span id="cb54-716"><a href="#cb54-716" aria-hidden="true" tabindex="-1"></a><span class="ss">7.  </span>The greater v0 is, the higher the probe will go; ymax = ½ v0 (v0 + 1)</span>
<span id="cb54-717"><a href="#cb54-717" aria-hidden="true" tabindex="-1"></a><span class="ss">8.  </span>So we just set -v0 - 1 = -126 =<span class="sc">\&gt;</span> v0 = 125</span>
<span id="cb54-718"><a href="#cb54-718" aria-hidden="true" tabindex="-1"></a><span class="ss">9.  </span>So ymax = 125 <span class="sc">\*</span> 126 / 2 = 7875.</span>
<span id="cb54-719"><a href="#cb54-719" aria-hidden="true" tabindex="-1"></a><span class="ss">10. </span>∎</span>
<span id="cb54-720"><a href="#cb54-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-721"><a href="#cb54-721" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-722"><a href="#cb54-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-725"><a href="#cb54-725" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-726"><a href="#cb54-726" aria-hidden="true" tabindex="-1"></a>xmin, xmax <span class="op">=</span>  <span class="dv">217</span>, <span class="dv">240</span></span>
<span id="cb54-727"><a href="#cb54-727" aria-hidden="true" tabindex="-1"></a>ymin, ymax <span class="op">=</span> <span class="op">-</span><span class="dv">126</span>, <span class="op">-</span><span class="dv">69</span></span>
<span id="cb54-728"><a href="#cb54-728" aria-hidden="true" tabindex="-1"></a>parabola <span class="op">=</span> <span class="kw">lambda</span> v, t: (t <span class="op">*</span> v <span class="op">-</span> <span class="bu">int</span>(t <span class="op">*</span> (t <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb54-729"><a href="#cb54-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-730"><a href="#cb54-730" aria-hidden="true" tabindex="-1"></a>time_map <span class="op">=</span> defaultdict(<span class="bu">list</span>)</span>
<span id="cb54-731"><a href="#cb54-731" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> vy <span class="kw">in</span> <span class="bu">range</span>(ymin, <span class="op">-</span>ymin):</span>
<span id="cb54-732"><a href="#cb54-732" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> time <span class="kw">in</span> [t <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">3</span> <span class="op">-</span> <span class="dv">2</span><span class="op">*</span>ymin) <span class="cf">if</span> parabola(vy, t) <span class="kw">in</span> <span class="bu">range</span>(ymin, ymax <span class="op">+</span> <span class="dv">1</span>)]:</span>
<span id="cb54-733"><a href="#cb54-733" aria-hidden="true" tabindex="-1"></a>        time_map[time].append(vy)</span>
<span id="cb54-734"><a href="#cb54-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-735"><a href="#cb54-735" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> x_times(vx):</span>
<span id="cb54-736"><a href="#cb54-736" aria-hidden="true" tabindex="-1"></a>    times <span class="op">=</span> [t <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, vx) <span class="cf">if</span> parabola(vx, t) <span class="kw">in</span> <span class="bu">range</span>(xmin, xmax <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb54-737"><a href="#cb54-737" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> vx <span class="op">-</span> <span class="dv">1</span> <span class="kw">in</span> times:</span>
<span id="cb54-738"><a href="#cb54-738" aria-hidden="true" tabindex="-1"></a>        times <span class="op">+=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">max</span>(times) <span class="op">+</span> <span class="dv">1</span>, <span class="bu">max</span>(time_map.keys()) <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb54-739"><a href="#cb54-739" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> times</span>
<span id="cb54-740"><a href="#cb54-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-741"><a href="#cb54-741" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> []</span>
<span id="cb54-742"><a href="#cb54-742" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> vx <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">int</span>(<span class="fl">0.5</span> <span class="op">+</span> np.sqrt(<span class="fl">0.25</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> xmin)), xmax <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb54-743"><a href="#cb54-743" aria-hidden="true" tabindex="-1"></a>    times <span class="op">=</span> x_times(vx)</span>
<span id="cb54-744"><a href="#cb54-744" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> time <span class="kw">in</span> times:</span>
<span id="cb54-745"><a href="#cb54-745" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> vy <span class="kw">in</span> time_map[time]:</span>
<span id="cb54-746"><a href="#cb54-746" aria-hidden="true" tabindex="-1"></a>            result.append((vx, vy))</span>
<span id="cb54-747"><a href="#cb54-747" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(<span class="bu">set</span>(result)))</span>
<span id="cb54-748"><a href="#cb54-748" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-749"><a href="#cb54-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-750"><a href="#cb54-750" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 18: Snailfish](https://adventofcode.com/2021/day/18)</span></span>
<span id="cb54-751"><a href="#cb54-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-752"><a href="#cb54-752" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-753"><a href="#cb54-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-756"><a href="#cb54-756" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-757"><a href="#cb54-757" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> to_node(thing, depth):</span>
<span id="cb54-758"><a href="#cb54-758" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(thing, <span class="bu">int</span>):</span>
<span id="cb54-759"><a href="#cb54-759" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> thing</span>
<span id="cb54-760"><a href="#cb54-760" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">isinstance</span>(thing, Pair):</span>
<span id="cb54-761"><a href="#cb54-761" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> node <span class="kw">in</span> thing.traverse():</span>
<span id="cb54-762"><a href="#cb54-762" aria-hidden="true" tabindex="-1"></a>            node.depth <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-763"><a href="#cb54-763" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> thing</span>
<span id="cb54-764"><a href="#cb54-764" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb54-765"><a href="#cb54-765" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Pair(thing[<span class="dv">0</span>], thing[<span class="dv">1</span>], depth<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb54-766"><a href="#cb54-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-767"><a href="#cb54-767" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Pair:</span>
<span id="cb54-768"><a href="#cb54-768" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, left, right, depth<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb54-769"><a href="#cb54-769" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.depth <span class="op">=</span> depth</span>
<span id="cb54-770"><a href="#cb54-770" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left <span class="op">=</span> to_node(left, depth)</span>
<span id="cb54-771"><a href="#cb54-771" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.right <span class="op">=</span> to_node(right, depth)</span>
<span id="cb54-772"><a href="#cb54-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-773"><a href="#cb54-773" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> leftmost(<span class="va">self</span>):</span>
<span id="cb54-774"><a href="#cb54-774" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span> <span class="cf">if</span> <span class="bu">isinstance</span>(<span class="va">self</span>.left, <span class="bu">int</span>) <span class="cf">else</span> <span class="va">self</span>.left.leftmost()</span>
<span id="cb54-775"><a href="#cb54-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-776"><a href="#cb54-776" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> rightmost(<span class="va">self</span>):</span>
<span id="cb54-777"><a href="#cb54-777" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span> <span class="cf">if</span> <span class="bu">isinstance</span>(<span class="va">self</span>.right, <span class="bu">int</span>) <span class="cf">else</span> <span class="va">self</span>.right.rightmost()</span>
<span id="cb54-778"><a href="#cb54-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-779"><a href="#cb54-779" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="bu">sum</span>(<span class="va">self</span>):</span>
<span id="cb54-780"><a href="#cb54-780" aria-hidden="true" tabindex="-1"></a>        left <span class="op">=</span> <span class="va">self</span>.left <span class="cf">if</span> <span class="bu">isinstance</span>(<span class="va">self</span>.left, <span class="bu">int</span>) <span class="cf">else</span> <span class="va">self</span>.left.<span class="bu">sum</span>()</span>
<span id="cb54-781"><a href="#cb54-781" aria-hidden="true" tabindex="-1"></a>        right <span class="op">=</span> <span class="va">self</span>.right <span class="cf">if</span> <span class="bu">isinstance</span>(<span class="va">self</span>.right, <span class="bu">int</span>) <span class="cf">else</span> <span class="va">self</span>.right.<span class="bu">sum</span>()</span>
<span id="cb54-782"><a href="#cb54-782" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">3</span><span class="op">*</span>left <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>right</span>
<span id="cb54-783"><a href="#cb54-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-784"><a href="#cb54-784" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> traverse(<span class="va">self</span>):</span>
<span id="cb54-785"><a href="#cb54-785" aria-hidden="true" tabindex="-1"></a>        left <span class="op">=</span> [] <span class="cf">if</span> <span class="bu">isinstance</span>(<span class="va">self</span>.left, <span class="bu">int</span>) <span class="cf">else</span> <span class="va">self</span>.left.traverse()</span>
<span id="cb54-786"><a href="#cb54-786" aria-hidden="true" tabindex="-1"></a>        right <span class="op">=</span> [] <span class="cf">if</span> <span class="bu">isinstance</span>(<span class="va">self</span>.right, <span class="bu">int</span>) <span class="cf">else</span> <span class="va">self</span>.right.traverse()</span>
<span id="cb54-787"><a href="#cb54-787" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> left <span class="op">+</span> [<span class="va">self</span>] <span class="op">+</span> right</span>
<span id="cb54-788"><a href="#cb54-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-789"><a href="#cb54-789" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="bu">reduce</span>(<span class="va">self</span>):</span>
<span id="cb54-790"><a href="#cb54-790" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb54-791"><a href="#cb54-791" aria-hidden="true" tabindex="-1"></a>            altered <span class="op">=</span> <span class="va">False</span></span>
<span id="cb54-792"><a href="#cb54-792" aria-hidden="true" tabindex="-1"></a>            altered <span class="op">=</span> <span class="va">self</span>.explode()</span>
<span id="cb54-793"><a href="#cb54-793" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> altered:</span>
<span id="cb54-794"><a href="#cb54-794" aria-hidden="true" tabindex="-1"></a>                altered <span class="op">=</span> <span class="va">self</span>.split()</span>
<span id="cb54-795"><a href="#cb54-795" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> altered:</span>
<span id="cb54-796"><a href="#cb54-796" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb54-797"><a href="#cb54-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-798"><a href="#cb54-798" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> split(<span class="va">self</span>):</span>
<span id="cb54-799"><a href="#cb54-799" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> node <span class="kw">in</span> <span class="va">self</span>.traverse():</span>
<span id="cb54-800"><a href="#cb54-800" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> d <span class="kw">in</span> [<span class="st">'left'</span>, <span class="st">'right'</span>]:</span>
<span id="cb54-801"><a href="#cb54-801" aria-hidden="true" tabindex="-1"></a>                val  <span class="op">=</span> <span class="bu">getattr</span>(node, d)</span>
<span id="cb54-802"><a href="#cb54-802" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">isinstance</span>(val, <span class="bu">int</span>) <span class="kw">and</span> val <span class="op">&gt;=</span> <span class="dv">10</span>:</span>
<span id="cb54-803"><a href="#cb54-803" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">setattr</span>(node, d, Pair(val <span class="op">//</span> <span class="dv">2</span>, val <span class="op">//</span> <span class="dv">2</span> <span class="op">+</span> val <span class="op">%</span> <span class="dv">2</span>, node.depth <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb54-804"><a href="#cb54-804" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb54-805"><a href="#cb54-805" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb54-806"><a href="#cb54-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-807"><a href="#cb54-807" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> explode(<span class="va">self</span>):</span>
<span id="cb54-808"><a href="#cb54-808" aria-hidden="true" tabindex="-1"></a>        traversal <span class="op">=</span> <span class="va">self</span>.traverse()</span>
<span id="cb54-809"><a href="#cb54-809" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, node <span class="kw">in</span> <span class="bu">enumerate</span>(traversal):</span>
<span id="cb54-810"><a href="#cb54-810" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> node.depth <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb54-811"><a href="#cb54-811" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">==</span> <span class="bu">len</span>(traversal) <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb54-812"><a href="#cb54-812" aria-hidden="true" tabindex="-1"></a>                    parent <span class="op">=</span> traversal[idx <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb54-813"><a href="#cb54-813" aria-hidden="true" tabindex="-1"></a>                    direction <span class="op">=</span> <span class="st">"right"</span></span>
<span id="cb54-814"><a href="#cb54-814" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> traversal[idx <span class="op">+</span> <span class="dv">1</span>].left <span class="op">==</span> node:</span>
<span id="cb54-815"><a href="#cb54-815" aria-hidden="true" tabindex="-1"></a>                    parent <span class="op">=</span> traversal[idx <span class="op">+</span> <span class="dv">1</span>]</span>
<span id="cb54-816"><a href="#cb54-816" aria-hidden="true" tabindex="-1"></a>                    direction <span class="op">=</span> <span class="st">"left"</span></span>
<span id="cb54-817"><a href="#cb54-817" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb54-818"><a href="#cb54-818" aria-hidden="true" tabindex="-1"></a>                    parent <span class="op">=</span> traversal[idx <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb54-819"><a href="#cb54-819" aria-hidden="true" tabindex="-1"></a>                    direction <span class="op">=</span> <span class="st">"right"</span></span>
<span id="cb54-820"><a href="#cb54-820" aria-hidden="true" tabindex="-1"></a>                <span class="bu">setattr</span>(parent, direction, <span class="dv">0</span>)</span>
<span id="cb54-821"><a href="#cb54-821" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb54-822"><a href="#cb54-822" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(traversal[idx <span class="op">-</span> <span class="dv">1</span>].left, <span class="bu">int</span>):</span>
<span id="cb54-823"><a href="#cb54-823" aria-hidden="true" tabindex="-1"></a>                        traversal[idx <span class="op">-</span> <span class="dv">1</span>].left <span class="op">+=</span> node.left</span>
<span id="cb54-824"><a href="#cb54-824" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb54-825"><a href="#cb54-825" aria-hidden="true" tabindex="-1"></a>                        left_neighbor <span class="op">=</span> traversal[idx <span class="op">-</span><span class="dv">1</span>].left.rightmost()</span>
<span id="cb54-826"><a href="#cb54-826" aria-hidden="true" tabindex="-1"></a>                        left_neighbor.right <span class="op">+=</span> node.left</span>
<span id="cb54-827"><a href="#cb54-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-828"><a href="#cb54-828" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">!=</span> <span class="bu">len</span>(traversal) <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb54-829"><a href="#cb54-829" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(traversal[idx <span class="op">+</span> <span class="dv">1</span>].right, <span class="bu">int</span>):</span>
<span id="cb54-830"><a href="#cb54-830" aria-hidden="true" tabindex="-1"></a>                        traversal[idx <span class="op">+</span> <span class="dv">1</span>].right <span class="op">+=</span> node.right</span>
<span id="cb54-831"><a href="#cb54-831" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb54-832"><a href="#cb54-832" aria-hidden="true" tabindex="-1"></a>                        right_neighbor <span class="op">=</span> traversal[idx <span class="op">+</span> <span class="dv">1</span>].right.leftmost()</span>
<span id="cb54-833"><a href="#cb54-833" aria-hidden="true" tabindex="-1"></a>                        right_neighbor.left <span class="op">+=</span> node.right</span>
<span id="cb54-834"><a href="#cb54-834" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb54-835"><a href="#cb54-835" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb54-836"><a href="#cb54-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-837"><a href="#cb54-837" aria-hidden="true" tabindex="-1"></a>snumbers <span class="op">=</span> [<span class="bu">eval</span>(line.strip()) <span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">18</span>)]</span>
<span id="cb54-838"><a href="#cb54-838" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> Pair(<span class="op">*</span>snumbers[<span class="dv">0</span>])</span>
<span id="cb54-839"><a href="#cb54-839" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> snumber <span class="kw">in</span> snumbers[<span class="dv">1</span>:]:</span>
<span id="cb54-840"><a href="#cb54-840" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> Pair(result, Pair(<span class="op">*</span>snumber)).<span class="bu">reduce</span>()</span>
<span id="cb54-841"><a href="#cb54-841" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result.<span class="bu">sum</span>())</span>
<span id="cb54-842"><a href="#cb54-842" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-843"><a href="#cb54-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-844"><a href="#cb54-844" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-845"><a href="#cb54-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-848"><a href="#cb54-848" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-849"><a href="#cb54-849" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb54-850"><a href="#cb54-850" aria-hidden="true" tabindex="-1"></a>maxval <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-851"><a href="#cb54-851" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> left, right <span class="kw">in</span> itertools.permutations(snumbers, <span class="dv">2</span>):</span>
<span id="cb54-852"><a href="#cb54-852" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> (Pair(left, right).<span class="bu">reduce</span>()).<span class="bu">sum</span>()</span>
<span id="cb54-853"><a href="#cb54-853" aria-hidden="true" tabindex="-1"></a>    maxval <span class="op">=</span> total <span class="cf">if</span> total <span class="op">&gt;</span> maxval <span class="cf">else</span> maxval</span>
<span id="cb54-854"><a href="#cb54-854" aria-hidden="true" tabindex="-1"></a>maxval</span>
<span id="cb54-855"><a href="#cb54-855" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-856"><a href="#cb54-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-857"><a href="#cb54-857" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 19: Beacon Scanner](https://adventofcode.com/2021/day/19)</span></span>
<span id="cb54-858"><a href="#cb54-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-859"><a href="#cb54-859" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-860"><a href="#cb54-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-861"><a href="#cb54-861" aria-hidden="true" tabindex="-1"></a>We'll start by generating the 24 rotation matrices. There are six possible ways of permuting the axes, and eight possible sign conventions. Half of the sign conventions will be left-handed, so we discard them</span>
<span id="cb54-862"><a href="#cb54-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-865"><a href="#cb54-865" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-866"><a href="#cb54-866" aria-hidden="true" tabindex="-1"></a>rotations <span class="op">=</span> []</span>
<span id="cb54-867"><a href="#cb54-867" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> permutation <span class="kw">in</span> (itertools.permutations([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>], <span class="dv">3</span>)):</span>
<span id="cb54-868"><a href="#cb54-868" aria-hidden="true" tabindex="-1"></a>    arr <span class="op">=</span> np.zeros((<span class="dv">3</span>, <span class="dv">3</span>), dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb54-869"><a href="#cb54-869" aria-hidden="true" tabindex="-1"></a>    arr[np.array([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>]), permutation] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb54-870"><a href="#cb54-870" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> sign <span class="kw">in</span> itertools.product([<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>], repeat<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb54-871"><a href="#cb54-871" aria-hidden="true" tabindex="-1"></a>        rotation <span class="op">=</span> arr.copy() <span class="op">*</span> sign</span>
<span id="cb54-872"><a href="#cb54-872" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> np.linalg.det(rotation) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb54-873"><a href="#cb54-873" aria-hidden="true" tabindex="-1"></a>            rotations.append(rotation)</span>
<span id="cb54-874"><a href="#cb54-874" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-875"><a href="#cb54-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-876"><a href="#cb54-876" aria-hidden="true" tabindex="-1"></a>Then we find overlapping scanners in the input and populate a map (x, y) with the matrices to convert from y coordinates to x coordinates</span>
<span id="cb54-877"><a href="#cb54-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-880"><a href="#cb54-880" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-881"><a href="#cb54-881" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.spatial.distance <span class="im">import</span> pdist, squareform</span>
<span id="cb54-882"><a href="#cb54-882" aria-hidden="true" tabindex="-1"></a>foo <span class="op">=</span> load(<span class="dv">19</span>, <span class="st">"raw"</span>)[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb54-883"><a href="#cb54-883" aria-hidden="true" tabindex="-1"></a>scanners <span class="op">=</span> foo.split(<span class="st">'</span><span class="ch">\n\n</span><span class="st">'</span>)</span>
<span id="cb54-884"><a href="#cb54-884" aria-hidden="true" tabindex="-1"></a>scanners <span class="op">=</span> [np.array([<span class="bu">list</span>(<span class="bu">map</span>(<span class="bu">int</span>, line.split(<span class="st">','</span>))) <span class="cf">for</span> line <span class="kw">in</span> scanner.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)[<span class="dv">1</span>:]], dtype<span class="op">=</span><span class="bu">int</span>) <span class="cf">for</span> scanner <span class="kw">in</span> scanners]</span>
<span id="cb54-885"><a href="#cb54-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-886"><a href="#cb54-886" aria-hidden="true" tabindex="-1"></a>distances <span class="op">=</span> [squareform(pdist(scanner)) <span class="cf">for</span> scanner <span class="kw">in</span> scanners]</span>
<span id="cb54-887"><a href="#cb54-887" aria-hidden="true" tabindex="-1"></a>mapping <span class="op">=</span> {}</span>
<span id="cb54-888"><a href="#cb54-888" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a, b <span class="kw">in</span> itertools.combinations(<span class="bu">range</span>(<span class="bu">len</span>(scanners)), <span class="dv">2</span>):</span>
<span id="cb54-889"><a href="#cb54-889" aria-hidden="true" tabindex="-1"></a>    pairs <span class="op">=</span> []</span>
<span id="cb54-890"><a href="#cb54-890" aria-hidden="true" tabindex="-1"></a>    d0 <span class="op">=</span> distances[a]</span>
<span id="cb54-891"><a href="#cb54-891" aria-hidden="true" tabindex="-1"></a>    d1 <span class="op">=</span> distances[b]</span>
<span id="cb54-892"><a href="#cb54-892" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(d0)):</span>
<span id="cb54-893"><a href="#cb54-893" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(d1)):</span>
<span id="cb54-894"><a href="#cb54-894" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(np.intersect1d(d1[j], d0[i])) <span class="op">&gt;=</span> <span class="dv">12</span>:</span>
<span id="cb54-895"><a href="#cb54-895" aria-hidden="true" tabindex="-1"></a>                pairs.append((i, j))</span>
<span id="cb54-896"><a href="#cb54-896" aria-hidden="true" tabindex="-1"></a>    pairs <span class="op">=</span> np.array(pairs)</span>
<span id="cb54-897"><a href="#cb54-897" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(pairs) <span class="op">&lt;</span> <span class="dv">12</span>:</span>
<span id="cb54-898"><a href="#cb54-898" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb54-899"><a href="#cb54-899" aria-hidden="true" tabindex="-1"></a>    x0 <span class="op">=</span> scanners[a][pairs[:, <span class="dv">0</span>]]</span>
<span id="cb54-900"><a href="#cb54-900" aria-hidden="true" tabindex="-1"></a>    y0 <span class="op">=</span> scanners[b][pairs[:, <span class="dv">1</span>]]</span>
<span id="cb54-901"><a href="#cb54-901" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> rotation <span class="kw">in</span> rotations:</span>
<span id="cb54-902"><a href="#cb54-902" aria-hidden="true" tabindex="-1"></a>        c <span class="op">=</span> x0[<span class="dv">0</span>] <span class="op">-</span> y0[<span class="dv">0</span>] <span class="op">@</span> rotation</span>
<span id="cb54-903"><a href="#cb54-903" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (x0[<span class="dv">1</span>:] <span class="op">==</span> (y0[<span class="dv">1</span>:] <span class="op">@</span> rotation <span class="op">+</span> c)).<span class="bu">all</span>():</span>
<span id="cb54-904"><a href="#cb54-904" aria-hidden="true" tabindex="-1"></a>            mapping[(a, b)] <span class="op">=</span> [rotation, c]</span>
<span id="cb54-905"><a href="#cb54-905" aria-hidden="true" tabindex="-1"></a>            mapping[(b, a)] <span class="op">=</span> [rotation.T, <span class="op">-</span>c <span class="op">@</span> rotation.T]</span>
<span id="cb54-906"><a href="#cb54-906" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb54-907"><a href="#cb54-907" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-908"><a href="#cb54-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-909"><a href="#cb54-909" aria-hidden="true" tabindex="-1"></a>We do some linear algebra to extend this map to all the scanners</span>
<span id="cb54-910"><a href="#cb54-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-913"><a href="#cb54-913" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-914"><a href="#cb54-914" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb54-915"><a href="#cb54-915" aria-hidden="true" tabindex="-1"></a>    done <span class="op">=</span> <span class="va">True</span></span>
<span id="cb54-916"><a href="#cb54-916" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(scanners)):</span>
<span id="cb54-917"><a href="#cb54-917" aria-hidden="true" tabindex="-1"></a>        columns <span class="op">=</span> [pair[<span class="dv">1</span>] <span class="cf">for</span> pair <span class="kw">in</span> mapping.keys() <span class="cf">if</span> pair[<span class="dv">0</span>] <span class="op">==</span> x]</span>
<span id="cb54-918"><a href="#cb54-918" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> y, z <span class="kw">in</span> itertools.combinations(columns, <span class="dv">2</span>):</span>
<span id="cb54-919"><a href="#cb54-919" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (y, z) <span class="kw">not</span> <span class="kw">in</span> mapping:</span>
<span id="cb54-920"><a href="#cb54-920" aria-hidden="true" tabindex="-1"></a>                done <span class="op">=</span> <span class="va">False</span></span>
<span id="cb54-921"><a href="#cb54-921" aria-hidden="true" tabindex="-1"></a>                Q1, a1 <span class="op">=</span> mapping[(x, y)]</span>
<span id="cb54-922"><a href="#cb54-922" aria-hidden="true" tabindex="-1"></a>                Q2, a2 <span class="op">=</span> mapping[(x, z)]</span>
<span id="cb54-923"><a href="#cb54-923" aria-hidden="true" tabindex="-1"></a>                mapping[(z, y)] <span class="op">=</span> [Q1 <span class="op">@</span> Q2.T, (a1 <span class="op">-</span> a2) <span class="op">@</span> Q2.T]</span>
<span id="cb54-924"><a href="#cb54-924" aria-hidden="true" tabindex="-1"></a>                mapping[(y, z)] <span class="op">=</span> [Q2 <span class="op">@</span> Q1.T, (a2 <span class="op">-</span> a1) <span class="op">@</span> Q1.T]</span>
<span id="cb54-925"><a href="#cb54-925" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> done:</span>
<span id="cb54-926"><a href="#cb54-926" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb54-927"><a href="#cb54-927" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-928"><a href="#cb54-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-929"><a href="#cb54-929" aria-hidden="true" tabindex="-1"></a>And then we convert all the initial coordinates to one representation and find its length</span>
<span id="cb54-930"><a href="#cb54-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-933"><a href="#cb54-933" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-934"><a href="#cb54-934" aria-hidden="true" tabindex="-1"></a>coords <span class="op">=</span> [<span class="bu">tuple</span>(x) <span class="cf">for</span> x <span class="kw">in</span> scanners[<span class="dv">0</span>]]</span>
<span id="cb54-935"><a href="#cb54-935" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(scanners)):</span>
<span id="cb54-936"><a href="#cb54-936" aria-hidden="true" tabindex="-1"></a>    Q, a <span class="op">=</span> mapping[<span class="dv">0</span>, idx]</span>
<span id="cb54-937"><a href="#cb54-937" aria-hidden="true" tabindex="-1"></a>    coords <span class="op">+=</span> [<span class="bu">tuple</span>(x) <span class="cf">for</span> x <span class="kw">in</span> (np.array(scanners[idx]) <span class="op">@</span> Q <span class="op">+</span> a)]</span>
<span id="cb54-938"><a href="#cb54-938" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(<span class="bu">set</span>(coords)))</span>
<span id="cb54-939"><a href="#cb54-939" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-940"><a href="#cb54-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-941"><a href="#cb54-941" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-942"><a href="#cb54-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-943"><a href="#cb54-943" aria-hidden="true" tabindex="-1"></a>What is the largest Manhattan distance between any two scanners?</span>
<span id="cb54-944"><a href="#cb54-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-947"><a href="#cb54-947" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-948"><a href="#cb54-948" aria-hidden="true" tabindex="-1"></a>maxval <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-949"><a href="#cb54-949" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, j <span class="kw">in</span> itertools.combinations(<span class="bu">range</span>(<span class="bu">len</span>(scanners)), <span class="dv">2</span>):</span>
<span id="cb54-950"><a href="#cb54-950" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="bu">sum</span>(<span class="bu">abs</span>(mapping[(i, j)][<span class="dv">1</span>]))</span>
<span id="cb54-951"><a href="#cb54-951" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> total <span class="op">&gt;</span> maxval:</span>
<span id="cb54-952"><a href="#cb54-952" aria-hidden="true" tabindex="-1"></a>        maxval <span class="op">=</span> total</span>
<span id="cb54-953"><a href="#cb54-953" aria-hidden="true" tabindex="-1"></a>maxval</span>
<span id="cb54-954"><a href="#cb54-954" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-955"><a href="#cb54-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-956"><a href="#cb54-956" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 20: Trench Map](https://adventofcode.com/2021/day/20)</span></span>
<span id="cb54-957"><a href="#cb54-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-958"><a href="#cb54-958" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1 and 2</span></span>
<span id="cb54-959"><a href="#cb54-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-962"><a href="#cb54-962" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-963"><a href="#cb54-963" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">20</span>, <span class="st">"raw"</span>)</span>
<span id="cb54-964"><a href="#cb54-964" aria-hidden="true" tabindex="-1"></a>pixel_map <span class="op">=</span> {<span class="st">"."</span>: <span class="dv">0</span>, <span class="st">"#"</span>: <span class="dv">1</span>}</span>
<span id="cb54-965"><a href="#cb54-965" aria-hidden="true" tabindex="-1"></a>key, array <span class="op">=</span> data.split(<span class="st">'</span><span class="ch">\n\n</span><span class="st">'</span>)</span>
<span id="cb54-966"><a href="#cb54-966" aria-hidden="true" tabindex="-1"></a>key <span class="op">=</span> np.array([pixel_map[x] <span class="cf">for</span> x <span class="kw">in</span> key.strip()], dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb54-967"><a href="#cb54-967" aria-hidden="true" tabindex="-1"></a>new <span class="op">=</span> np.array([[pixel_map[x] <span class="cf">for</span> x <span class="kw">in</span> line.strip()] <span class="cf">for</span> line <span class="kw">in</span> array.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)[:<span class="op">-</span><span class="dv">1</span>]])</span>
<span id="cb54-968"><a href="#cb54-968" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">51</span>):</span>
<span id="cb54-969"><a href="#cb54-969" aria-hidden="true" tabindex="-1"></a>    old <span class="op">=</span> np.pad(new, <span class="dv">2</span>, constant_values <span class="op">=</span> (n <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>))</span>
<span id="cb54-970"><a href="#cb54-970" aria-hidden="true" tabindex="-1"></a>    new <span class="op">=</span> old.copy()</span>
<span id="cb54-971"><a href="#cb54-971" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(old) <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb54-972"><a href="#cb54-972" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(old) <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb54-973"><a href="#cb54-973" aria-hidden="true" tabindex="-1"></a>            index <span class="op">=</span> <span class="bu">sum</span>((<span class="dv">2</span> <span class="op">**</span> np.arange(<span class="dv">9</span>)) <span class="op">*</span> old[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">2</span>, j<span class="op">-</span><span class="dv">1</span>:j<span class="op">+</span><span class="dv">2</span>].ravel()[::<span class="op">-</span><span class="dv">1</span>] )</span>
<span id="cb54-974"><a href="#cb54-974" aria-hidden="true" tabindex="-1"></a>            new[i, j] <span class="op">=</span> key[index]</span>
<span id="cb54-975"><a href="#cb54-975" aria-hidden="true" tabindex="-1"></a>    new <span class="op">=</span> new[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb54-976"><a href="#cb54-976" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">==</span> <span class="dv">2</span> <span class="kw">or</span> n <span class="op">==</span> <span class="dv">50</span>:</span>
<span id="cb54-977"><a href="#cb54-977" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(new.<span class="bu">sum</span>())</span>
<span id="cb54-978"><a href="#cb54-978" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-979"><a href="#cb54-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-980"><a href="#cb54-980" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 21: Dirac Dice](https://adventofcode.com/2021/day/21)</span></span>
<span id="cb54-981"><a href="#cb54-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-982"><a href="#cb54-982" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-983"><a href="#cb54-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-986"><a href="#cb54-986" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-987"><a href="#cb54-987" aria-hidden="true" tabindex="-1"></a>positions, scores, count <span class="op">=</span> [<span class="dv">4</span>, <span class="dv">6</span>], [<span class="dv">0</span>, <span class="dv">0</span>], <span class="dv">0</span></span>
<span id="cb54-988"><a href="#cb54-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-989"><a href="#cb54-989" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> step_one(position, score, count):</span>
<span id="cb54-990"><a href="#cb54-990" aria-hidden="true" tabindex="-1"></a>    position <span class="op">=</span> (position <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> count <span class="op">+</span> <span class="dv">5</span>) <span class="op">%</span> <span class="dv">10</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb54-991"><a href="#cb54-991" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> position, score <span class="op">+</span> position, count <span class="op">+</span> <span class="dv">3</span></span>
<span id="cb54-992"><a href="#cb54-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-993"><a href="#cb54-993" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-994"><a href="#cb54-994" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">max</span>(scores) <span class="op">&lt;</span> <span class="dv">1000</span>:</span>
<span id="cb54-995"><a href="#cb54-995" aria-hidden="true" tabindex="-1"></a>    positions[i], scores[i <span class="op">%</span> <span class="dv">2</span>], count <span class="op">=</span> step_one(positions[i<span class="op">%</span><span class="dv">2</span>], scores[i<span class="op">%</span><span class="dv">2</span>], count)</span>
<span id="cb54-996"><a href="#cb54-996" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> i</span>
<span id="cb54-997"><a href="#cb54-997" aria-hidden="true" tabindex="-1"></a>count <span class="op">*</span> <span class="bu">min</span>(scores)</span>
<span id="cb54-998"><a href="#cb54-998" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-999"><a href="#cb54-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1000"><a href="#cb54-1000" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-1001"><a href="#cb54-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1004"><a href="#cb54-1004" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1005"><a href="#cb54-1005" aria-hidden="true" tabindex="-1"></a>states <span class="op">=</span> {((<span class="dv">4</span>, <span class="dv">0</span>), (<span class="dv">6</span>, <span class="dv">0</span>)): <span class="dv">1</span>}</span>
<span id="cb54-1006"><a href="#cb54-1006" aria-hidden="true" tabindex="-1"></a>wins <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb54-1007"><a href="#cb54-1007" aria-hidden="true" tabindex="-1"></a><span class="co"># The frequency table for the 3x3 dice</span></span>
<span id="cb54-1008"><a href="#cb54-1008" aria-hidden="true" tabindex="-1"></a>rolls <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">3</span>, <span class="dv">1</span>]</span>
<span id="cb54-1009"><a href="#cb54-1009" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> step_one(states, player):</span>
<span id="cb54-1010"><a href="#cb54-1010" aria-hidden="true" tabindex="-1"></a>    new_states <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb54-1011"><a href="#cb54-1011" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> state <span class="kw">in</span> states:</span>
<span id="cb54-1012"><a href="#cb54-1012" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> step <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>, <span class="dv">10</span>):</span>
<span id="cb54-1013"><a href="#cb54-1013" aria-hidden="true" tabindex="-1"></a>            new_position <span class="op">=</span> ((state[player][<span class="dv">0</span>] <span class="op">+</span> step) <span class="op">-</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">10</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb54-1014"><a href="#cb54-1014" aria-hidden="true" tabindex="-1"></a>            new_score <span class="op">=</span> state[player][<span class="dv">1</span>] <span class="op">+</span> new_position</span>
<span id="cb54-1015"><a href="#cb54-1015" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> new_score <span class="op">&gt;=</span> <span class="dv">21</span>:</span>
<span id="cb54-1016"><a href="#cb54-1016" aria-hidden="true" tabindex="-1"></a>                wins[player] <span class="op">+=</span> states[state] <span class="op">*</span> rolls[step]</span>
<span id="cb54-1017"><a href="#cb54-1017" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb54-1018"><a href="#cb54-1018" aria-hidden="true" tabindex="-1"></a>                new_state <span class="op">=</span> <span class="bu">list</span>(state)</span>
<span id="cb54-1019"><a href="#cb54-1019" aria-hidden="true" tabindex="-1"></a>                new_state[player] <span class="op">=</span> (new_position, new_score)</span>
<span id="cb54-1020"><a href="#cb54-1020" aria-hidden="true" tabindex="-1"></a>                new_states[<span class="bu">tuple</span>(new_state)] <span class="op">+=</span> states[state] <span class="op">*</span> rolls[step]</span>
<span id="cb54-1021"><a href="#cb54-1021" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_states, wins</span>
<span id="cb54-1022"><a href="#cb54-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1023"><a href="#cb54-1023" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-1024"><a href="#cb54-1024" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> states:</span>
<span id="cb54-1025"><a href="#cb54-1025" aria-hidden="true" tabindex="-1"></a>    states, wins <span class="op">=</span> step_one(states, i)</span>
<span id="cb54-1026"><a href="#cb54-1026" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> i</span>
<span id="cb54-1027"><a href="#cb54-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1028"><a href="#cb54-1028" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>(wins)</span>
<span id="cb54-1029"><a href="#cb54-1029" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1030"><a href="#cb54-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1031"><a href="#cb54-1031" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 22: Reactor Reboot](https://adventofcode.com/2021/day/22)</span></span>
<span id="cb54-1032"><a href="#cb54-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1033"><a href="#cb54-1033" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-1034"><a href="#cb54-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1035"><a href="#cb54-1035" aria-hidden="true" tabindex="-1"></a>The first part can be solved trivially by using numpy's indexing</span>
<span id="cb54-1036"><a href="#cb54-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1039"><a href="#cb54-1039" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1040"><a href="#cb54-1040" aria-hidden="true" tabindex="-1"></a>offset <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb54-1041"><a href="#cb54-1041" aria-hidden="true" tabindex="-1"></a>board <span class="op">=</span> np.zeros((<span class="dv">101</span>, <span class="dv">101</span>, <span class="dv">101</span>), dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb54-1042"><a href="#cb54-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1043"><a href="#cb54-1043" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_line(line):</span>
<span id="cb54-1044"><a href="#cb54-1044" aria-hidden="true" tabindex="-1"></a>    command, line <span class="op">=</span> line.split(<span class="st">" "</span>)</span>
<span id="cb54-1045"><a href="#cb54-1045" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> [x.split(<span class="st">".."</span>) <span class="cf">for</span> x <span class="kw">in</span> line.strip().split(<span class="st">","</span>)]</span>
<span id="cb54-1046"><a href="#cb54-1046" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> command, [[<span class="bu">int</span>(x[<span class="dv">0</span>][<span class="dv">2</span>:]), <span class="bu">int</span>(x[<span class="dv">1</span>]) <span class="op">+</span> <span class="dv">1</span>] <span class="cf">for</span> x <span class="kw">in</span> indices]</span>
<span id="cb54-1047"><a href="#cb54-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1048"><a href="#cb54-1048" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> load(<span class="dv">22</span>)</span>
<span id="cb54-1049"><a href="#cb54-1049" aria-hidden="true" tabindex="-1"></a>commands <span class="op">=</span> [parse_line(line) <span class="cf">for</span> line <span class="kw">in</span> lines]</span>
<span id="cb54-1050"><a href="#cb54-1050" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> {<span class="st">"on"</span>: <span class="dv">1</span>, <span class="st">"off"</span>: <span class="dv">0</span>}</span>
<span id="cb54-1051"><a href="#cb54-1051" aria-hidden="true" tabindex="-1"></a>maxval <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-1052"><a href="#cb54-1052" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> command, indices <span class="kw">in</span> commands:</span>
<span id="cb54-1053"><a href="#cb54-1053" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> np.ravel(indices) <span class="op">+</span> offset</span>
<span id="cb54-1054"><a href="#cb54-1054" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">max</span>(<span class="bu">abs</span>(idx)) <span class="op">&gt;</span> maxval:</span>
<span id="cb54-1055"><a href="#cb54-1055" aria-hidden="true" tabindex="-1"></a>        maxval <span class="op">=</span> <span class="bu">max</span>(<span class="bu">abs</span>(idx))</span>
<span id="cb54-1056"><a href="#cb54-1056" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (idx <span class="op">&lt;</span> <span class="dv">0</span>).<span class="bu">any</span>() <span class="kw">or</span> (idx <span class="op">&gt;</span> <span class="dv">100</span>).<span class="bu">any</span>():</span>
<span id="cb54-1057"><a href="#cb54-1057" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb54-1058"><a href="#cb54-1058" aria-hidden="true" tabindex="-1"></a>    board[idx[<span class="dv">0</span>]:idx[<span class="dv">1</span>], idx[<span class="dv">2</span>]:idx[<span class="dv">3</span>], idx[<span class="dv">4</span>]:idx[<span class="dv">5</span>]] <span class="op">=</span> values[command]</span>
<span id="cb54-1059"><a href="#cb54-1059" aria-hidden="true" tabindex="-1"></a>board.<span class="bu">sum</span>()</span>
<span id="cb54-1060"><a href="#cb54-1060" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1061"><a href="#cb54-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1062"><a href="#cb54-1062" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-1063"><a href="#cb54-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1064"><a href="#cb54-1064" aria-hidden="true" tabindex="-1"></a>The above approach doesn't work for part two since the field of play is too large; we have \~ 100k elements in each direction, which give \~10<span class="sc">\*\*</span>15 elements in total; far too much to keep in memory.</span>
<span id="cb54-1065"><a href="#cb54-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1066"><a href="#cb54-1066" aria-hidden="true" tabindex="-1"></a>The first step is to realise that the vast majority of the empty space is never touched – so there's no reason to store all those zeros.</span>
<span id="cb54-1067"><a href="#cb54-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1068"><a href="#cb54-1068" aria-hidden="true" tabindex="-1"></a>What we can do instead is to store a set containing only the coordinates which are turned on. Turning on more coordinates corresponds to making the union with the new coordinate, while turning off coordinates is a set difference. This automatically accounts for not lighting coordinates which are already lit, and not turning off coordinates which are already off.</span>
<span id="cb54-1069"><a href="#cb54-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1070"><a href="#cb54-1070" aria-hidden="true" tabindex="-1"></a>Unfortunately, this is still too memory intensive – from the example solution, we see that at the end of the process, 2,758,514,936,282,235 coordinates are on, which is way too many to store individually.</span>
<span id="cb54-1071"><a href="#cb54-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1072"><a href="#cb54-1072" aria-hidden="true" tabindex="-1"></a>We need an approach that only looks at corners of cuboids, and doesn't need to store the individual coordinates at all.</span>
<span id="cb54-1073"><a href="#cb54-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1074"><a href="#cb54-1074" aria-hidden="true" tabindex="-1"></a>If there were only "on" instructions, we could use the inclusion-exclusion principle, along with the fact that the intersection of two cuboids is always another cuboid, or empty.</span>
<span id="cb54-1075"><a href="#cb54-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1076"><a href="#cb54-1076" aria-hidden="true" tabindex="-1"></a>That is, the volume lit by one "on" instruction is just the volume of the cuboid it represents. The volume lit by two is the sum of the volumes of each, minus the volume of their intersection. The volume lit by three is:</span>
<span id="cb54-1077"><a href="#cb54-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1078"><a href="#cb54-1078" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The volume of the individual cuboids</span>
<span id="cb54-1079"><a href="#cb54-1079" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Minus the volume of all the pairwise intersections</span>
<span id="cb54-1080"><a href="#cb54-1080" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Plus the volume of the triple intersection</span>
<span id="cb54-1081"><a href="#cb54-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1082"><a href="#cb54-1082" aria-hidden="true" tabindex="-1"></a>And this extends to the general case. The volume lit after the n^th^ instruction, N, is:</span>
<span id="cb54-1083"><a href="#cb54-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1084"><a href="#cb54-1084" aria-hidden="true" tabindex="-1"></a>The volume lit after the (n-1)th instruction plus the volume of N, minus the sum of the volumes of the pairwise intersection of N with all previous instructions, plus the sum of the volumes of intersection of N with all previously calculated pairs, and so on.</span>
<span id="cb54-1085"><a href="#cb54-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1086"><a href="#cb54-1086" aria-hidden="true" tabindex="-1"></a>Turning a cuboid off is equivalent to removing the intersection between it and all the other cuboids from the sum, and then accounting for the double counting by adding back the triple intersections etc. But that's the same as we're doing for the positive cuboid, except for the off cuboid we never add the volume of the individual cuboid</span>
<span id="cb54-1087"><a href="#cb54-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1088"><a href="#cb54-1088" aria-hidden="true" tabindex="-1"></a>We're going to need a way of calculating the intersection of two cuboids. But that's just the intersection of 3 pairs of lines, since the cuboids are axis-aligned. And we can intersect two line segments and hence two cuboids as follows</span>
<span id="cb54-1089"><a href="#cb54-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1092"><a href="#cb54-1092" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1093"><a href="#cb54-1093" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> intersect_segments(x1, x2):</span>
<span id="cb54-1094"><a href="#cb54-1094" aria-hidden="true" tabindex="-1"></a>    pair <span class="op">=</span> [<span class="bu">max</span>(x1[<span class="dv">0</span>], x2[<span class="dv">0</span>]), <span class="bu">min</span>(x1[<span class="dv">1</span>], x2[<span class="dv">1</span>])]</span>
<span id="cb54-1095"><a href="#cb54-1095" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pair <span class="cf">if</span> pair[<span class="dv">1</span>] <span class="op">&gt;</span> pair[<span class="dv">0</span>] <span class="cf">else</span> <span class="va">False</span></span>
<span id="cb54-1096"><a href="#cb54-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1097"><a href="#cb54-1097" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> intersect_cuboids(c1, c2):</span>
<span id="cb54-1098"><a href="#cb54-1098" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> [intersect_segments(<span class="op">*</span>pair) <span class="cf">for</span> pair <span class="kw">in</span> <span class="bu">zip</span>(c1, c2)]</span>
<span id="cb54-1099"><a href="#cb54-1099" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result <span class="cf">if</span> <span class="bu">all</span>(result) <span class="cf">else</span> <span class="va">False</span></span>
<span id="cb54-1100"><a href="#cb54-1100" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1101"><a href="#cb54-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1102"><a href="#cb54-1102" aria-hidden="true" tabindex="-1"></a>The segments were originally given as closed intervals, but the parsing converted them to open intervals. The length of each is thus the endpoint minus the starting point. The volume of a cuboid is just the product the three lengths:</span>
<span id="cb54-1103"><a href="#cb54-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1106"><a href="#cb54-1106" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1107"><a href="#cb54-1107" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cuboid_volume(cuboid):</span>
<span id="cb54-1108"><a href="#cb54-1108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.product([[line[<span class="dv">1</span>] <span class="op">-</span> line[<span class="dv">0</span>]] <span class="cf">for</span> line <span class="kw">in</span> cuboid])</span>
<span id="cb54-1109"><a href="#cb54-1109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1110"><a href="#cb54-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1111"><a href="#cb54-1111" aria-hidden="true" tabindex="-1"></a>The approach we'll take is to process the list of instructions sequentially, calculating the various intersections as we go. They'll go in a list where the first element represents the positive terms, and the second represents the negative terms. The final score is then just the sum of the positive values minus the sum of the negative values</span>
<span id="cb54-1112"><a href="#cb54-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1113"><a href="#cb54-1113" aria-hidden="true" tabindex="-1"></a>Putting it all together gives the following. For each instruction, we intersect with all previous cuboids, and swap the signs. If it's an "on" instruction, we also add the whole region to the list of positive volumes.</span>
<span id="cb54-1114"><a href="#cb54-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1117"><a href="#cb54-1117" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1118"><a href="#cb54-1118" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reboot(instructions):</span>
<span id="cb54-1119"><a href="#cb54-1119" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> [[], []]</span>
<span id="cb54-1120"><a href="#cb54-1120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> instruction, region <span class="kw">in</span> instructions:</span>
<span id="cb54-1121"><a href="#cb54-1121" aria-hidden="true" tabindex="-1"></a>        extra <span class="op">=</span> [region] <span class="cf">if</span> instruction <span class="op">==</span> <span class="st">"on"</span> <span class="cf">else</span> []</span>
<span id="cb54-1122"><a href="#cb54-1122" aria-hidden="true" tabindex="-1"></a>        clipped_state <span class="op">=</span> [[c <span class="cf">for</span> cuboid <span class="kw">in</span> s <span class="cf">if</span> (c :<span class="op">=</span> intersect_cuboids(cuboid, region))] <span class="cf">for</span> s <span class="kw">in</span> state]</span>
<span id="cb54-1123"><a href="#cb54-1123" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> [state[<span class="dv">0</span>] <span class="op">+</span> clipped_state[<span class="dv">1</span>] <span class="op">+</span> extra, state[<span class="dv">1</span>] <span class="op">+</span> clipped_state[<span class="dv">0</span>]]</span>
<span id="cb54-1124"><a href="#cb54-1124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(<span class="bu">map</span>(cuboid_volume, state[<span class="dv">0</span>])) <span class="op">-</span> <span class="bu">sum</span>(<span class="bu">map</span>(cuboid_volume, state[<span class="dv">1</span>]))</span>
<span id="cb54-1125"><a href="#cb54-1125" aria-hidden="true" tabindex="-1"></a>reboot(commands)</span>
<span id="cb54-1126"><a href="#cb54-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1127"><a href="#cb54-1127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1128"><a href="#cb54-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1129"><a href="#cb54-1129" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 23: Amphipod](https://adventofcode.com/2021/day/23)</span></span>
<span id="cb54-1130"><a href="#cb54-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1131"><a href="#cb54-1131" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-1132"><a href="#cb54-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1133"><a href="#cb54-1133" aria-hidden="true" tabindex="-1"></a>This is definitely not pretty, and takes a bunch of time to run as well, but it works. This is a pathfinding problem: Given some initial state, our goal is to move to the final state with as small a cost as possible.</span>
<span id="cb54-1134"><a href="#cb54-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1135"><a href="#cb54-1135" aria-hidden="true" tabindex="-1"></a>The tricky thing is to find the neighboring positions that can be reached from a given position with a valid move. There are only two types of moves</span>
<span id="cb54-1136"><a href="#cb54-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1137"><a href="#cb54-1137" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Room to hallway</span>
<span id="cb54-1138"><a href="#cb54-1138" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Hallway to room</span>
<span id="cb54-1139"><a href="#cb54-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1140"><a href="#cb54-1140" aria-hidden="true" tabindex="-1"></a>The third type (room straight to final room) is just the composition of the above two moves.</span>
<span id="cb54-1141"><a href="#cb54-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1142"><a href="#cb54-1142" aria-hidden="true" tabindex="-1"></a>Once we have a method for finding neighbors, actually running the pathfinding is comparatively simple. This could probably be improved by including a heuristic for how far away a given state is from the finish, but getting finding and calculating a suitable heuristic is fiddly.</span>
<span id="cb54-1143"><a href="#cb54-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1146"><a href="#cb54-1146" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1147"><a href="#cb54-1147" aria-hidden="true" tabindex="-1"></a>value_to_letter <span class="op">=</span> {<span class="dv">0</span>: <span class="st">" "</span>, <span class="dv">1</span>: <span class="st">"A"</span>, <span class="dv">10</span>: <span class="st">"B"</span>, <span class="dv">100</span>: <span class="st">"C"</span>, <span class="dv">1000</span>: <span class="st">"D"</span>}</span>
<span id="cb54-1148"><a href="#cb54-1148" aria-hidden="true" tabindex="-1"></a>letter_to_value <span class="op">=</span> {v: k <span class="cf">for</span> k, v <span class="kw">in</span> value_to_letter.items()}</span>
<span id="cb54-1149"><a href="#cb54-1149" aria-hidden="true" tabindex="-1"></a>number_to_room <span class="op">=</span> {<span class="dv">10</span><span class="op">**</span>i: i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>)}</span>
<span id="cb54-1150"><a href="#cb54-1150" aria-hidden="true" tabindex="-1"></a>room_to_number <span class="op">=</span> {v: k <span class="cf">for</span> k, v <span class="kw">in</span> number_to_room.items()}</span>
<span id="cb54-1151"><a href="#cb54-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1152"><a href="#cb54-1152" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_blockers(room, n):</span>
<span id="cb54-1153"><a href="#cb54-1153" aria-hidden="true" tabindex="-1"></a>    top_row <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">4</span><span class="op">*</span>n, <span class="dv">4</span> <span class="op">*</span> n <span class="op">+</span> <span class="dv">7</span>))</span>
<span id="cb54-1154"><a href="#cb54-1154" aria-hidden="true" tabindex="-1"></a>    distances <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb54-1155"><a href="#cb54-1155" aria-hidden="true" tabindex="-1"></a>    left <span class="op">=</span> top_row[:room <span class="op">+</span> <span class="dv">2</span>][::<span class="op">-</span><span class="dv">1</span>], np.cumsum(distances[:room <span class="op">+</span> <span class="dv">2</span>][::<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb54-1156"><a href="#cb54-1156" aria-hidden="true" tabindex="-1"></a>    right <span class="op">=</span> top_row[room <span class="op">+</span> <span class="dv">2</span>:], np.cumsum(distances[room <span class="op">+</span> <span class="dv">2</span>:])</span>
<span id="cb54-1157"><a href="#cb54-1157" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> left, right</span>
<span id="cb54-1158"><a href="#cb54-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1159"><a href="#cb54-1159" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_moves(position, n<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb54-1160"><a href="#cb54-1160" aria-hidden="true" tabindex="-1"></a>      position <span class="op">=</span> np.array(position)</span>
<span id="cb54-1161"><a href="#cb54-1161" aria-hidden="true" tabindex="-1"></a>      <span class="kw">def</span> is_endgame(room):</span>
<span id="cb54-1162"><a href="#cb54-1162" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">set</span>(position[n <span class="op">*</span> room: n <span class="op">*</span> (room <span class="op">+</span> <span class="dv">1</span>)]) <span class="op">&lt;=</span> <span class="bu">set</span>([<span class="dv">0</span>, room_to_number[room]])</span>
<span id="cb54-1163"><a href="#cb54-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1164"><a href="#cb54-1164" aria-hidden="true" tabindex="-1"></a>      possible_moves <span class="op">=</span> []</span>
<span id="cb54-1165"><a href="#cb54-1165" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> i <span class="kw">in</span> [idx <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>n <span class="cf">for</span> idx, val <span class="kw">in</span> <span class="bu">enumerate</span>(position[<span class="dv">4</span><span class="op">*</span>n:]) <span class="cf">if</span> val <span class="op">!=</span> <span class="dv">0</span>]:</span>
<span id="cb54-1166"><a href="#cb54-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1167"><a href="#cb54-1167" aria-hidden="true" tabindex="-1"></a>            room <span class="op">=</span> number_to_room[position[i]]</span>
<span id="cb54-1168"><a href="#cb54-1168" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> is_endgame(room):</span>
<span id="cb54-1169"><a href="#cb54-1169" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">continue</span></span>
<span id="cb54-1170"><a href="#cb54-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1171"><a href="#cb54-1171" aria-hidden="true" tabindex="-1"></a>            left, right <span class="op">=</span> find_blockers(room, n)</span>
<span id="cb54-1172"><a href="#cb54-1172" aria-hidden="true" tabindex="-1"></a>            moves, costs <span class="op">=</span> left <span class="cf">if</span> i <span class="kw">in</span> left[<span class="dv">0</span>] <span class="cf">else</span> right</span>
<span id="cb54-1173"><a href="#cb54-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1174"><a href="#cb54-1174" aria-hidden="true" tabindex="-1"></a>            index <span class="op">=</span> moves.index(i)</span>
<span id="cb54-1175"><a href="#cb54-1175" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (position[moves[:index]] <span class="op">!=</span> <span class="dv">0</span>).<span class="bu">any</span>():</span>
<span id="cb54-1176"><a href="#cb54-1176" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">continue</span></span>
<span id="cb54-1177"><a href="#cb54-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1178"><a href="#cb54-1178" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">=</span> np.argwhere(position[n <span class="op">*</span> room: n<span class="op">*</span>(room <span class="op">+</span> <span class="dv">1</span>)] <span class="op">==</span> <span class="dv">0</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb54-1179"><a href="#cb54-1179" aria-hidden="true" tabindex="-1"></a>            new_position <span class="op">=</span> n <span class="op">*</span> room <span class="op">+</span> offset</span>
<span id="cb54-1180"><a href="#cb54-1180" aria-hidden="true" tabindex="-1"></a>            cost <span class="op">=</span> costs[index] <span class="op">+</span> n <span class="op">-</span> <span class="dv">1</span> <span class="op">-</span> offset</span>
<span id="cb54-1181"><a href="#cb54-1181" aria-hidden="true" tabindex="-1"></a>            possible_moves.append((i, new_position, cost))</span>
<span id="cb54-1182"><a href="#cb54-1182" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> room <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb54-1183"><a href="#cb54-1183" aria-hidden="true" tabindex="-1"></a>            target <span class="op">=</span> room <span class="op">*</span> n</span>
<span id="cb54-1184"><a href="#cb54-1184" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> is_endgame(room):</span>
<span id="cb54-1185"><a href="#cb54-1185" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">continue</span></span>
<span id="cb54-1186"><a href="#cb54-1186" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">=</span> np.argwhere(position[target: target <span class="op">+</span> n])[<span class="op">-</span><span class="dv">1</span>][<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb54-1187"><a href="#cb54-1187" aria-hidden="true" tabindex="-1"></a>            moves, costs <span class="op">=</span> [], []</span>
<span id="cb54-1188"><a href="#cb54-1188" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> block, steps <span class="kw">in</span> find_blockers(room, n):</span>
<span id="cb54-1189"><a href="#cb54-1189" aria-hidden="true" tabindex="-1"></a>                  free <span class="op">=</span> np.maximum.accumulate(position[block]) <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb54-1190"><a href="#cb54-1190" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">if</span> <span class="kw">not</span> free.<span class="bu">any</span>():</span>
<span id="cb54-1191"><a href="#cb54-1191" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb54-1192"><a href="#cb54-1192" aria-hidden="true" tabindex="-1"></a>                  n_free <span class="op">=</span> np.argwhere(free)[<span class="op">-</span><span class="dv">1</span>][<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb54-1193"><a href="#cb54-1193" aria-hidden="true" tabindex="-1"></a>                  moves <span class="op">+=</span> block[:n_free]</span>
<span id="cb54-1194"><a href="#cb54-1194" aria-hidden="true" tabindex="-1"></a>                  costs <span class="op">+=</span> <span class="bu">list</span>(steps[:n_free] <span class="op">+</span> n <span class="op">-</span> offset <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb54-1195"><a href="#cb54-1195" aria-hidden="true" tabindex="-1"></a>            possible_moves <span class="op">+=</span> [(target <span class="op">+</span> offset, move, cost) <span class="cf">for</span> move, cost <span class="kw">in</span> <span class="bu">zip</span>(moves, costs)]</span>
<span id="cb54-1196"><a href="#cb54-1196" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> possible_moves</span>
<span id="cb54-1197"><a href="#cb54-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1198"><a href="#cb54-1198" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> navigate(source, destination):</span>
<span id="cb54-1199"><a href="#cb54-1199" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> (<span class="bu">len</span>(source) <span class="op">-</span> <span class="dv">7</span>) <span class="op">//</span> <span class="dv">4</span></span>
<span id="cb54-1200"><a href="#cb54-1200" aria-hidden="true" tabindex="-1"></a>    q <span class="op">=</span> queue.PriorityQueue()</span>
<span id="cb54-1201"><a href="#cb54-1201" aria-hidden="true" tabindex="-1"></a>    q.put((<span class="dv">0</span>, source))</span>
<span id="cb54-1202"><a href="#cb54-1202" aria-hidden="true" tabindex="-1"></a>    seen <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb54-1203"><a href="#cb54-1203" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> q:</span>
<span id="cb54-1204"><a href="#cb54-1204" aria-hidden="true" tabindex="-1"></a>        cost, position <span class="op">=</span> q.get()</span>
<span id="cb54-1205"><a href="#cb54-1205" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> position <span class="op">==</span> destination:</span>
<span id="cb54-1206"><a href="#cb54-1206" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> cost</span>
<span id="cb54-1207"><a href="#cb54-1207" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> position <span class="kw">in</span> seen:</span>
<span id="cb54-1208"><a href="#cb54-1208" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb54-1209"><a href="#cb54-1209" aria-hidden="true" tabindex="-1"></a>        seen.add(<span class="bu">tuple</span>(position))</span>
<span id="cb54-1210"><a href="#cb54-1210" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> source_index, target_index, distance <span class="kw">in</span> find_moves(position, n):</span>
<span id="cb54-1211"><a href="#cb54-1211" aria-hidden="true" tabindex="-1"></a>            new_position <span class="op">=</span> <span class="bu">list</span>(position)</span>
<span id="cb54-1212"><a href="#cb54-1212" aria-hidden="true" tabindex="-1"></a>            value <span class="op">=</span> position[source_index]</span>
<span id="cb54-1213"><a href="#cb54-1213" aria-hidden="true" tabindex="-1"></a>            new_position[source_index] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-1214"><a href="#cb54-1214" aria-hidden="true" tabindex="-1"></a>            new_position[target_index] <span class="op">=</span> value</span>
<span id="cb54-1215"><a href="#cb54-1215" aria-hidden="true" tabindex="-1"></a>            q.put((cost <span class="op">+</span> value <span class="op">*</span> distance, <span class="bu">tuple</span>(new_position)))</span>
<span id="cb54-1216"><a href="#cb54-1216" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.inf</span>
<span id="cb54-1217"><a href="#cb54-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1218"><a href="#cb54-1218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1219"><a href="#cb54-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1220"><a href="#cb54-1220" aria-hidden="true" tabindex="-1"></a>With all of that out of the way, actually solving the puzzle is just a question of calling the navigate function. First for part 1</span>
<span id="cb54-1221"><a href="#cb54-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1224"><a href="#cb54-1224" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1225"><a href="#cb54-1225" aria-hidden="true" tabindex="-1"></a>source <span class="op">=</span> <span class="bu">tuple</span>(letter_to_value[x] <span class="cf">for</span> x <span class="kw">in</span> <span class="st">"CDCABABD       "</span>)</span>
<span id="cb54-1226"><a href="#cb54-1226" aria-hidden="true" tabindex="-1"></a>destination <span class="op">=</span> <span class="bu">tuple</span>(letter_to_value[x] <span class="cf">for</span> x <span class="kw">in</span> <span class="st">'AABBCCDD       '</span>)</span>
<span id="cb54-1227"><a href="#cb54-1227" aria-hidden="true" tabindex="-1"></a>navigate(source, destination)</span>
<span id="cb54-1228"><a href="#cb54-1228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1229"><a href="#cb54-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1230"><a href="#cb54-1230" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-1231"><a href="#cb54-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1232"><a href="#cb54-1232" aria-hidden="true" tabindex="-1"></a>And then for part 2</span>
<span id="cb54-1233"><a href="#cb54-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1236"><a href="#cb54-1236" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1237"><a href="#cb54-1237" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> <span class="bu">tuple</span>(letter_to_value[x] <span class="cf">for</span> x <span class="kw">in</span> <span class="st">"CDDDCBCABABABCAD       "</span>)</span>
<span id="cb54-1238"><a href="#cb54-1238" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> <span class="bu">tuple</span>(letter_to_value[x] <span class="cf">for</span> x <span class="kw">in</span> <span class="st">"AAAABBBBCCCCDDDD       "</span>)</span>
<span id="cb54-1239"><a href="#cb54-1239" aria-hidden="true" tabindex="-1"></a>navigate(s, d)</span>
<span id="cb54-1240"><a href="#cb54-1240" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1241"><a href="#cb54-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1242"><a href="#cb54-1242" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 24: Arithmetic Logic Unit](https://adventofcode.com/2021/day/24)</span></span>
<span id="cb54-1243"><a href="#cb54-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1244"><a href="#cb54-1244" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-1245"><a href="#cb54-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1246"><a href="#cb54-1246" aria-hidden="true" tabindex="-1"></a>Rarely in AOC have I had a worse ratio of thinking employed to code written - this code looks way simpler than for day 23, but getting there was a real challenge.</span>
<span id="cb54-1247"><a href="#cb54-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1248"><a href="#cb54-1248" aria-hidden="true" tabindex="-1"></a>I think this is the intended approach, since it uses the realisation that if we multiply z by 26 6 times, then to get back below zero, we need to divide 7 times. So each time there's a divide, the value of w is fixed.</span>
<span id="cb54-1249"><a href="#cb54-1249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1252"><a href="#cb54-1252" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1253"><a href="#cb54-1253" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">24</span>, <span class="st">"raw"</span>)</span>
<span id="cb54-1254"><a href="#cb54-1254" aria-hidden="true" tabindex="-1"></a>chunks <span class="op">=</span> [[y.split() <span class="cf">for</span> y <span class="kw">in</span> x.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>) <span class="cf">if</span> y] <span class="cf">for</span> x <span class="kw">in</span> data.split(<span class="st">"inp w</span><span class="ch">\n</span><span class="st">"</span>)][<span class="dv">1</span>:]</span>
<span id="cb54-1255"><a href="#cb54-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1256"><a href="#cb54-1256" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">14</span>]</span>
<span id="cb54-1257"><a href="#cb54-1257" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> [[chunk[index][<span class="dv">2</span>] <span class="cf">for</span> index <span class="kw">in</span> indices] <span class="cf">for</span> chunk <span class="kw">in</span> chunks]</span>
<span id="cb54-1258"><a href="#cb54-1258" aria-hidden="true" tabindex="-1"></a>triples <span class="op">=</span> [[<span class="bu">int</span>(n) <span class="cf">for</span> n <span class="kw">in</span> row] <span class="cf">for</span> row <span class="kw">in</span> table]</span>
<span id="cb54-1259"><a href="#cb54-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1260"><a href="#cb54-1260" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run(triple, z, w):</span>
<span id="cb54-1261"><a href="#cb54-1261" aria-hidden="true" tabindex="-1"></a>    a, b, c <span class="op">=</span> triple</span>
<span id="cb54-1262"><a href="#cb54-1262" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> w <span class="op">==</span> z <span class="op">%</span> <span class="dv">26</span> <span class="op">+</span> b:</span>
<span id="cb54-1263"><a href="#cb54-1263" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> z <span class="op">//</span> a</span>
<span id="cb54-1264"><a href="#cb54-1264" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (z <span class="op">//</span> a) <span class="op">*</span> <span class="dv">26</span> <span class="op">+</span> w <span class="op">+</span> c</span>
<span id="cb54-1265"><a href="#cb54-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1266"><a href="#cb54-1266" aria-hidden="true" tabindex="-1"></a>zs <span class="op">=</span> [[<span class="dv">0</span>, <span class="dv">0</span>]]</span>
<span id="cb54-1267"><a href="#cb54-1267" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> triple <span class="kw">in</span> triples:</span>
<span id="cb54-1268"><a href="#cb54-1268" aria-hidden="true" tabindex="-1"></a>    new_zs <span class="op">=</span> []</span>
<span id="cb54-1269"><a href="#cb54-1269" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> prefix, z <span class="kw">in</span> zs:</span>
<span id="cb54-1270"><a href="#cb54-1270" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> triple[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">26</span>:</span>
<span id="cb54-1271"><a href="#cb54-1271" aria-hidden="true" tabindex="-1"></a>            w <span class="op">=</span> z <span class="op">%</span> <span class="dv">26</span> <span class="op">+</span> triple[<span class="dv">1</span>]</span>
<span id="cb54-1272"><a href="#cb54-1272" aria-hidden="true" tabindex="-1"></a>            ws <span class="op">=</span> [w] <span class="cf">if</span> <span class="dv">1</span> <span class="op">&lt;=</span> w <span class="op">&lt;</span> <span class="dv">10</span> <span class="cf">else</span> []</span>
<span id="cb54-1273"><a href="#cb54-1273" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb54-1274"><a href="#cb54-1274" aria-hidden="true" tabindex="-1"></a>            ws <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb54-1275"><a href="#cb54-1275" aria-hidden="true" tabindex="-1"></a>        new_zs <span class="op">+=</span> [(<span class="dv">10</span> <span class="op">*</span> prefix <span class="op">+</span> w, run(triple, z, w)) <span class="cf">for</span> w <span class="kw">in</span> ws]</span>
<span id="cb54-1276"><a href="#cb54-1276" aria-hidden="true" tabindex="-1"></a>    zs <span class="op">=</span> new_zs</span>
<span id="cb54-1277"><a href="#cb54-1277" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>(x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> zs)</span>
<span id="cb54-1278"><a href="#cb54-1278" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1279"><a href="#cb54-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1280"><a href="#cb54-1280" aria-hidden="true" tabindex="-1"></a>We can be slightly smarter with pen and paper. The test is always z % 26 + something, which means that we always get out w~n~ + c~n~ for some n, since (z // a) <span class="sc">\*</span> 26 % 26 = 0. Keeping track of the order in which the a = 1 and a = 26 instructions arrive, we can match each of the 14 instructions to exactly one other, giving a series of relationships like w~1~ = w~14~ + 8. Then it's just a question of forcing the early digit of each pair to the highest possible allowed value.</span>
<span id="cb54-1281"><a href="#cb54-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1282"><a href="#cb54-1282" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-1283"><a href="#cb54-1283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1284"><a href="#cb54-1284" aria-hidden="true" tabindex="-1"></a>After all that, luckily part 2 is trivial</span>
<span id="cb54-1285"><a href="#cb54-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1288"><a href="#cb54-1288" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1289"><a href="#cb54-1289" aria-hidden="true" tabindex="-1"></a><span class="bu">min</span>(<span class="bu">int</span>(x[<span class="dv">0</span>]) <span class="cf">for</span> x <span class="kw">in</span> zs)</span>
<span id="cb54-1290"><a href="#cb54-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1291"><a href="#cb54-1291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1292"><a href="#cb54-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1293"><a href="#cb54-1293" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 25: Sea Cucumber](https://adventofcode.com/2021/day/25)</span></span>
<span id="cb54-1294"><a href="#cb54-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1295"><a href="#cb54-1295" aria-hidden="true" tabindex="-1"></a>🎄</span>
<span id="cb54-1296"><a href="#cb54-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1299"><a href="#cb54-1299" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1300"><a href="#cb54-1300" aria-hidden="true" tabindex="-1"></a>lookup <span class="op">=</span> {<span class="st">"."</span>: <span class="dv">0</span>, <span class="st">"&gt;"</span>: <span class="dv">1</span>, <span class="st">"v"</span>: <span class="op">-</span><span class="dv">1</span>}</span>
<span id="cb54-1301"><a href="#cb54-1301" aria-hidden="true" tabindex="-1"></a>reverse <span class="op">=</span> {v: k <span class="cf">for</span> k, v <span class="kw">in</span> lookup.items()}</span>
<span id="cb54-1302"><a href="#cb54-1302" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">25</span>)</span>
<span id="cb54-1303"><a href="#cb54-1303" aria-hidden="true" tabindex="-1"></a>array <span class="op">=</span> np.array([[lookup[char] <span class="cf">for</span> char <span class="kw">in</span> line.strip()] <span class="cf">for</span> line <span class="kw">in</span> data], dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb54-1304"><a href="#cb54-1304" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> move_one(array, direction<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb54-1305"><a href="#cb54-1305" aria-hidden="true" tabindex="-1"></a>    critter <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> direction <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb54-1306"><a href="#cb54-1306" aria-hidden="true" tabindex="-1"></a>    critters <span class="op">=</span> np.where(array <span class="op">==</span> critter)</span>
<span id="cb54-1307"><a href="#cb54-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1308"><a href="#cb54-1308" aria-hidden="true" tabindex="-1"></a>    filtered <span class="op">=</span> np.roll(array, <span class="op">-</span><span class="dv">1</span>, axis<span class="op">=</span>direction)[critters] <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb54-1309"><a href="#cb54-1309" aria-hidden="true" tabindex="-1"></a>    old_positions <span class="op">=</span> (critters[<span class="dv">0</span>][filtered], critters[<span class="dv">1</span>][filtered])</span>
<span id="cb54-1310"><a href="#cb54-1310" aria-hidden="true" tabindex="-1"></a>    new_positions <span class="op">=</span> [x.copy() <span class="cf">for</span> x <span class="kw">in</span> old_positions]</span>
<span id="cb54-1311"><a href="#cb54-1311" aria-hidden="true" tabindex="-1"></a>    new_positions[direction] <span class="op">=</span> (new_positions[direction] <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> array.shape[direction]</span>
<span id="cb54-1312"><a href="#cb54-1312" aria-hidden="true" tabindex="-1"></a>    array[old_positions] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-1313"><a href="#cb54-1313" aria-hidden="true" tabindex="-1"></a>    array[<span class="bu">tuple</span>(new_positions)] <span class="op">=</span> critter</span>
<span id="cb54-1314"><a href="#cb54-1314" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">not</span> filtered.<span class="bu">any</span>()</span>
<span id="cb54-1315"><a href="#cb54-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1316"><a href="#cb54-1316" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> to_string(array):</span>
<span id="cb54-1317"><a href="#cb54-1317" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join([<span class="st">''</span>.join([reverse[value] <span class="cf">for</span> value <span class="kw">in</span> line]) <span class="cf">for</span> line <span class="kw">in</span> array])</span>
<span id="cb54-1318"><a href="#cb54-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1319"><a href="#cb54-1319" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-1320"><a href="#cb54-1320" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb54-1321"><a href="#cb54-1321" aria-hidden="true" tabindex="-1"></a>    m1 <span class="op">=</span> move_one(array, <span class="dv">1</span>)</span>
<span id="cb54-1322"><a href="#cb54-1322" aria-hidden="true" tabindex="-1"></a>    m2 <span class="op">=</span> move_one(array, <span class="dv">0</span>)</span>
<span id="cb54-1323"><a href="#cb54-1323" aria-hidden="true" tabindex="-1"></a>    i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-1324"><a href="#cb54-1324" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> m1 <span class="kw">and</span> m2:</span>
<span id="cb54-1325"><a href="#cb54-1325" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb54-1326"><a href="#cb54-1326" aria-hidden="true" tabindex="-1"></a>i</span>
<span id="cb54-1327"><a href="#cb54-1327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">
        <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/cutonbuminband/AOC">Github</a>
  </li>  
</ul>
      </div>
  </div>
</footer>



</body></html>