<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>AOC - 2019 Solutions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../qmd/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../qmd/2019.html">2019 Solutions</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">AOC</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2022.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2022 Solutions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2021.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2021 Solutions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2020.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2020 Solutions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2019.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">2019 Solutions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2018.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2018 Solutions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2017.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2017 Solutions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2016.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2016 Solutions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2015.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2015 Solutions</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#imports" id="toc-imports" class="nav-link active" data-scroll-target="#imports">Imports</a></li>
  <li><a href="#day-1-the-tyranny-of-the-rocket-equation" id="toc-day-1-the-tyranny-of-the-rocket-equation" class="nav-link" data-scroll-target="#day-1-the-tyranny-of-the-rocket-equation">Day 1: The Tyranny of the Rocket Equation</a>
  <ul class="collapse">
  <li><a href="#part-1" id="toc-part-1" class="nav-link" data-scroll-target="#part-1">Part 1</a></li>
  <li><a href="#part-2" id="toc-part-2" class="nav-link" data-scroll-target="#part-2">Part 2</a></li>
  </ul></li>
  <li><a href="#day-2-1202-program-alarm" id="toc-day-2-1202-program-alarm" class="nav-link" data-scroll-target="#day-2-1202-program-alarm">Day 2: 1202 Program Alarm</a>
  <ul class="collapse">
  <li><a href="#part-1-1" id="toc-part-1-1" class="nav-link" data-scroll-target="#part-1-1">Part 1</a></li>
  </ul></li>
  <li><a href="#day-3-crossed-wires" id="toc-day-3-crossed-wires" class="nav-link" data-scroll-target="#day-3-crossed-wires">Day 3: Crossed Wires</a>
  <ul class="collapse">
  <li><a href="#part-1-2" id="toc-part-1-2" class="nav-link" data-scroll-target="#part-1-2">Part 1</a></li>
  <li><a href="#part-2-1" id="toc-part-2-1" class="nav-link" data-scroll-target="#part-2-1">Part 2</a></li>
  <li><a href="#bonus" id="toc-bonus" class="nav-link" data-scroll-target="#bonus">Bonus</a></li>
  </ul></li>
  <li><a href="#day-4-secure-container" id="toc-day-4-secure-container" class="nav-link" data-scroll-target="#day-4-secure-container">Day 4: Secure Container</a>
  <ul class="collapse">
  <li><a href="#part-1-3" id="toc-part-1-3" class="nav-link" data-scroll-target="#part-1-3">Part 1</a></li>
  <li><a href="#part-2-2" id="toc-part-2-2" class="nav-link" data-scroll-target="#part-2-2">Part 2</a></li>
  </ul></li>
  <li><a href="#day-5-sunny-with-a-chance-of-asteroids" id="toc-day-5-sunny-with-a-chance-of-asteroids" class="nav-link" data-scroll-target="#day-5-sunny-with-a-chance-of-asteroids">Day 5: Sunny with a Chance of Asteroids</a>
  <ul class="collapse">
  <li><a href="#part-1-4" id="toc-part-1-4" class="nav-link" data-scroll-target="#part-1-4">Part 1</a></li>
  <li><a href="#part-2-3" id="toc-part-2-3" class="nav-link" data-scroll-target="#part-2-3">Part 2</a></li>
  </ul></li>
  <li><a href="#day-6-universal-orbit-map" id="toc-day-6-universal-orbit-map" class="nav-link" data-scroll-target="#day-6-universal-orbit-map">Day 6: Universal Orbit Map</a>
  <ul class="collapse">
  <li><a href="#part-1-5" id="toc-part-1-5" class="nav-link" data-scroll-target="#part-1-5">Part 1</a></li>
  <li><a href="#part-2-4" id="toc-part-2-4" class="nav-link" data-scroll-target="#part-2-4">Part 2</a></li>
  </ul></li>
  <li><a href="#day-7-amplification-circuit" id="toc-day-7-amplification-circuit" class="nav-link" data-scroll-target="#day-7-amplification-circuit">Day 7: Amplification Circuit</a>
  <ul class="collapse">
  <li><a href="#part-1-6" id="toc-part-1-6" class="nav-link" data-scroll-target="#part-1-6">Part 1</a></li>
  <li><a href="#part-2-5" id="toc-part-2-5" class="nav-link" data-scroll-target="#part-2-5">Part 2</a></li>
  </ul></li>
  <li><a href="#day-8-space-image-format" id="toc-day-8-space-image-format" class="nav-link" data-scroll-target="#day-8-space-image-format">Day 8: Space Image Format</a>
  <ul class="collapse">
  <li><a href="#part-1-7" id="toc-part-1-7" class="nav-link" data-scroll-target="#part-1-7">Part 1</a></li>
  <li><a href="#part-2-6" id="toc-part-2-6" class="nav-link" data-scroll-target="#part-2-6">Part 2</a></li>
  </ul></li>
  <li><a href="#day-9-sensor-boost" id="toc-day-9-sensor-boost" class="nav-link" data-scroll-target="#day-9-sensor-boost">Day 9: Sensor Boost</a>
  <ul class="collapse">
  <li><a href="#part-1-8" id="toc-part-1-8" class="nav-link" data-scroll-target="#part-1-8">Part 1</a></li>
  <li><a href="#part-2-7" id="toc-part-2-7" class="nav-link" data-scroll-target="#part-2-7">Part 2</a></li>
  </ul></li>
  <li><a href="#day-10-monitoring-station" id="toc-day-10-monitoring-station" class="nav-link" data-scroll-target="#day-10-monitoring-station">Day 10: Monitoring Station</a>
  <ul class="collapse">
  <li><a href="#part-1-9" id="toc-part-1-9" class="nav-link" data-scroll-target="#part-1-9">Part 1</a></li>
  <li><a href="#part-2-8" id="toc-part-2-8" class="nav-link" data-scroll-target="#part-2-8">Part 2</a></li>
  </ul></li>
  <li><a href="#day-11-space-police" id="toc-day-11-space-police" class="nav-link" data-scroll-target="#day-11-space-police">Day 11: Space Police</a>
  <ul class="collapse">
  <li><a href="#part-1-10" id="toc-part-1-10" class="nav-link" data-scroll-target="#part-1-10">Part 1</a></li>
  <li><a href="#part-2-9" id="toc-part-2-9" class="nav-link" data-scroll-target="#part-2-9">Part 2</a></li>
  </ul></li>
  <li><a href="#day-12-the-n-body-problem" id="toc-day-12-the-n-body-problem" class="nav-link" data-scroll-target="#day-12-the-n-body-problem">Day 12: The N-Body Problem</a>
  <ul class="collapse">
  <li><a href="#part-1-11" id="toc-part-1-11" class="nav-link" data-scroll-target="#part-1-11">Part 1</a></li>
  <li><a href="#part-2-10" id="toc-part-2-10" class="nav-link" data-scroll-target="#part-2-10">Part 2</a></li>
  </ul></li>
  <li><a href="#day-13-care-package" id="toc-day-13-care-package" class="nav-link" data-scroll-target="#day-13-care-package">Day 13: Care Package</a>
  <ul class="collapse">
  <li><a href="#part-1-12" id="toc-part-1-12" class="nav-link" data-scroll-target="#part-1-12">Part 1</a></li>
  <li><a href="#part-2-11" id="toc-part-2-11" class="nav-link" data-scroll-target="#part-2-11">Part 2</a></li>
  </ul></li>
  <li><a href="#day-14-space-stoichiometry" id="toc-day-14-space-stoichiometry" class="nav-link" data-scroll-target="#day-14-space-stoichiometry">Day 14: Space Stoichiometry</a>
  <ul class="collapse">
  <li><a href="#part-1-13" id="toc-part-1-13" class="nav-link" data-scroll-target="#part-1-13">Part 1</a></li>
  <li><a href="#part-2-12" id="toc-part-2-12" class="nav-link" data-scroll-target="#part-2-12">Part 2</a></li>
  </ul></li>
  <li><a href="#day-15-oxygen-system" id="toc-day-15-oxygen-system" class="nav-link" data-scroll-target="#day-15-oxygen-system">Day 15: Oxygen System</a>
  <ul class="collapse">
  <li><a href="#part-1-14" id="toc-part-1-14" class="nav-link" data-scroll-target="#part-1-14">Part 1</a></li>
  <li><a href="#part-2-13" id="toc-part-2-13" class="nav-link" data-scroll-target="#part-2-13">Part 2</a></li>
  </ul></li>
  <li><a href="#day-16-flawed-frequency-transmission" id="toc-day-16-flawed-frequency-transmission" class="nav-link" data-scroll-target="#day-16-flawed-frequency-transmission">Day 16: Flawed Frequency Transmission</a>
  <ul class="collapse">
  <li><a href="#part-1-15" id="toc-part-1-15" class="nav-link" data-scroll-target="#part-1-15">Part 1</a></li>
  <li><a href="#part-2-14" id="toc-part-2-14" class="nav-link" data-scroll-target="#part-2-14">Part 2</a></li>
  </ul></li>
  <li><a href="#day-17-set-and-forget" id="toc-day-17-set-and-forget" class="nav-link" data-scroll-target="#day-17-set-and-forget">Day 17: Set and Forget</a>
  <ul class="collapse">
  <li><a href="#part-1-16" id="toc-part-1-16" class="nav-link" data-scroll-target="#part-1-16">Part 1</a></li>
  <li><a href="#part-2-15" id="toc-part-2-15" class="nav-link" data-scroll-target="#part-2-15">Part 2</a></li>
  </ul></li>
  <li><a href="#day-18-many-worlds-interpretation" id="toc-day-18-many-worlds-interpretation" class="nav-link" data-scroll-target="#day-18-many-worlds-interpretation">Day 18: Many-Worlds Interpretation</a>
  <ul class="collapse">
  <li><a href="#part-1-17" id="toc-part-1-17" class="nav-link" data-scroll-target="#part-1-17">Part 1</a></li>
  <li><a href="#part-2-16" id="toc-part-2-16" class="nav-link" data-scroll-target="#part-2-16">Part 2</a></li>
  </ul></li>
  <li><a href="#day-19-tractor-beam" id="toc-day-19-tractor-beam" class="nav-link" data-scroll-target="#day-19-tractor-beam">Day 19: Tractor Beam</a>
  <ul class="collapse">
  <li><a href="#part-1-18" id="toc-part-1-18" class="nav-link" data-scroll-target="#part-1-18">Part 1</a></li>
  <li><a href="#part-2-17" id="toc-part-2-17" class="nav-link" data-scroll-target="#part-2-17">Part 2</a></li>
  </ul></li>
  <li><a href="#day-20-donut-maze" id="toc-day-20-donut-maze" class="nav-link" data-scroll-target="#day-20-donut-maze">Day 20: Donut Maze</a>
  <ul class="collapse">
  <li><a href="#part-1-19" id="toc-part-1-19" class="nav-link" data-scroll-target="#part-1-19">Part 1</a></li>
  <li><a href="#part-2-18" id="toc-part-2-18" class="nav-link" data-scroll-target="#part-2-18">Part 2</a></li>
  </ul></li>
  <li><a href="#day-21-springdroid-adventure" id="toc-day-21-springdroid-adventure" class="nav-link" data-scroll-target="#day-21-springdroid-adventure">Day 21: Springdroid Adventure</a>
  <ul class="collapse">
  <li><a href="#part-1-20" id="toc-part-1-20" class="nav-link" data-scroll-target="#part-1-20">Part 1</a></li>
  <li><a href="#part-2-19" id="toc-part-2-19" class="nav-link" data-scroll-target="#part-2-19">Part 2</a></li>
  </ul></li>
  <li><a href="#day-22-slam-shuffle" id="toc-day-22-slam-shuffle" class="nav-link" data-scroll-target="#day-22-slam-shuffle">Day 22: Slam Shuffle</a>
  <ul class="collapse">
  <li><a href="#part-1-21" id="toc-part-1-21" class="nav-link" data-scroll-target="#part-1-21">Part 1</a></li>
  <li><a href="#part-2-20" id="toc-part-2-20" class="nav-link" data-scroll-target="#part-2-20">Part 2</a></li>
  </ul></li>
  <li><a href="#day-23-category-six" id="toc-day-23-category-six" class="nav-link" data-scroll-target="#day-23-category-six">Day 23: Category Six</a>
  <ul class="collapse">
  <li><a href="#part-1-22" id="toc-part-1-22" class="nav-link" data-scroll-target="#part-1-22">Part 1</a></li>
  <li><a href="#part-2-21" id="toc-part-2-21" class="nav-link" data-scroll-target="#part-2-21">Part 2</a></li>
  </ul></li>
  <li><a href="#day-24-planet-of-discord" id="toc-day-24-planet-of-discord" class="nav-link" data-scroll-target="#day-24-planet-of-discord">Day 24: Planet of Discord</a>
  <ul class="collapse">
  <li><a href="#part-1-23" id="toc-part-1-23" class="nav-link" data-scroll-target="#part-1-23">Part 1</a></li>
  <li><a href="#part-2-22" id="toc-part-2-22" class="nav-link" data-scroll-target="#part-2-22">Part 2</a></li>
  </ul></li>
  <li><a href="#day-25-cryostasis" id="toc-day-25-cryostasis" class="nav-link" data-scroll-target="#day-25-cryostasis">Day 25: Cryostasis</a>
  <ul class="collapse">
  <li><a href="#part-1-24" id="toc-part-1-24" class="nav-link" data-scroll-target="#part-1-24">Part 1</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">2019 Solutions</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="imports" class="level1">
<h1>Imports</h1>
<div class="cell" data-execution_count="1">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> collections</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> functools</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict, deque</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> queue <span class="im">import</span> PriorityQueue</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> more_itertools</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">1</span>, os.path.join(sys.path[<span class="dv">0</span>], <span class="st">".."</span>))</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> utils</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> intcode <span class="im">import</span> IntCodeProgram</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>load <span class="op">=</span> utils.year_load(<span class="dv">2019</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="day-1-the-tyranny-of-the-rocket-equation" class="level1">
<h1><a href="https://adventofcode.com/2019/day/1">Day 1: The Tyranny of the Rocket Equation</a></h1>
<section id="part-1" class="level2">
<h2 class="anchored" data-anchor-id="part-1">Part 1</h2>
<div class="cell" data-execution_count="2">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">1</span>, <span class="st">"np"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>(data <span class="op">//</span> <span class="dv">3</span> <span class="op">-</span> <span class="dv">2</span>).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2" class="level2">
<h2 class="anchored" data-anchor-id="part-2">Part 2</h2>
<div class="cell" data-execution_count="3">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="bu">list</span>(data)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> val <span class="kw">in</span> data:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    fuel <span class="op">=</span> <span class="bu">max</span>(val <span class="op">//</span> <span class="dv">3</span> <span class="op">-</span> <span class="dv">2</span>, <span class="dv">0</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> fuel</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> fuel:</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        data.append(fuel)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-2-1202-program-alarm" class="level1">
<h1><a href="https://adventofcode.com/2019/day/2">Day 2: 1202 Program Alarm</a></h1>
<section id="part-1-1" class="level2">
<h2 class="anchored" data-anchor-id="part-1-1">Part 1</h2>
<div class="cell" data-execution_count="4">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram([<span class="bu">int</span>(x) <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">2</span>)[<span class="dv">0</span>].split(<span class="st">","</span>)])</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> solve(program, noun<span class="op">=</span><span class="dv">12</span>, verb<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    program.reset()</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    program.program[<span class="dv">1</span>] <span class="op">=</span> noun</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    program.program[<span class="dv">2</span>] <span class="op">=</span> verb</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        val <span class="op">=</span> <span class="bu">next</span>(program.run())</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">StopIteration</span>:</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> program.program[<span class="dv">0</span>]</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>solve(program)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="5">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> noun, verb <span class="kw">in</span> itertools.product(<span class="bu">range</span>(<span class="dv">100</span>), <span class="bu">range</span>(<span class="dv">100</span>)):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> solve(program, noun, verb)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> result <span class="op">==</span> <span class="dv">19690720</span>:</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> noun <span class="op">+</span> verb</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-3-crossed-wires" class="level1">
<h1><a href="https://adventofcode.com/2019/day/3">Day 3: Crossed Wires</a></h1>
<section id="part-1-2" class="level2">
<h2 class="anchored" data-anchor-id="part-1-2">Part 1</h2>
<div class="cell" data-execution_count="6">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> [x.split(<span class="st">","</span>) <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">3</span>)]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> path_to_segments(path):</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    directions <span class="op">=</span> {<span class="st">"U"</span>: <span class="ot">1j</span>, <span class="st">"D"</span>: <span class="op">-</span><span class="ot">1j</span>, <span class="st">"R"</span>: <span class="dv">1</span>, <span class="st">"L"</span>: <span class="op">-</span><span class="dv">1</span>}</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    deltas <span class="op">=</span> [<span class="bu">int</span>(p[<span class="dv">1</span>:]) <span class="op">*</span> directions[p[<span class="dv">0</span>]] <span class="cf">for</span> p <span class="kw">in</span> path]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    ends <span class="op">=</span> np.cumsum(deltas)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    lengths <span class="op">=</span> np.cumsum(np.<span class="bu">abs</span>(deltas))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> np.vstack([np.roll(ends, <span class="dv">1</span>), ends, np.roll(lengths, <span class="dv">1</span>)]).T</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    result[<span class="dv">0</span>, <span class="dv">0</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    result[<span class="dv">0</span>, <span class="dv">2</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> intersection(s1, s2):</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((s1[<span class="dv">1</span>] <span class="op">-</span> s1[<span class="dv">0</span>]) <span class="op">*</span> (s2[<span class="dv">1</span>] <span class="op">-</span> s2[<span class="dv">0</span>])).imag <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (s1[<span class="dv">0</span>] <span class="op">-</span> s1[<span class="dv">1</span>]).imag <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        s2, s1 <span class="op">=</span> s1, s2</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (s1[<span class="dv">0</span>].real <span class="op">-</span> s2[<span class="dv">0</span>].real) <span class="op">*</span> (s1[<span class="dv">1</span>].real <span class="op">-</span> s2[<span class="dv">1</span>].real) <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">and</span> (</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>        s1[<span class="dv">0</span>].imag <span class="op">-</span> s2[<span class="dv">0</span>].imag</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">*</span> (s1[<span class="dv">1</span>].imag <span class="op">-</span> s2[<span class="dv">1</span>].imag) <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        intersection_point <span class="op">=</span> s1[<span class="dv">0</span>].real <span class="op">+</span> <span class="ot">1j</span> <span class="op">*</span> s2[<span class="dv">0</span>].imag</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        total_length <span class="op">=</span> (</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>            s1[<span class="dv">2</span>]</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> s2[<span class="dv">2</span>]</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> <span class="bu">abs</span>((s1[<span class="dv">0</span>] <span class="op">-</span> intersection_point).imag)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> <span class="bu">abs</span>((s2[<span class="dv">0</span>] <span class="op">-</span> intersection_point).real)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> intersection_point, total_length</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>l1 <span class="op">=</span> path_to_segments(lines[<span class="dv">0</span>])</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>l2 <span class="op">=</span> path_to_segments(lines[<span class="dv">1</span>])</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>intersections <span class="op">=</span> [</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    i <span class="cf">for</span> s1, s2 <span class="kw">in</span> itertools.product(l1, l2) <span class="cf">if</span> (i <span class="op">:=</span> intersection(s1, s2))</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="bu">int</span>(<span class="bu">min</span>(<span class="bu">abs</span>(x[<span class="dv">0</span>].real) <span class="op">+</span> <span class="bu">abs</span>(x[<span class="dv">0</span>].imag) <span class="cf">for</span> x <span class="kw">in</span> intersections))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-1" class="level2">
<h2 class="anchored" data-anchor-id="part-2-1">Part 2</h2>
<div class="cell" data-execution_count="7">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">min</span>(x[<span class="dv">1</span>] <span class="cf">for</span> x <span class="kw">in</span> intersections)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="bonus" class="level2">
<h2 class="anchored" data-anchor-id="bonus">Bonus</h2>
<p>As a bonus, we can visualize the walk through space</p>
<div class="cell" data-execution_count="8">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>sns.set_theme()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_path(segments, <span class="op">**</span>kwargs):</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> segments[:, <span class="dv">0</span>].real</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> segments[:, <span class="dv">0</span>].imag</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    plt.plot(x, y, <span class="op">**</span>kwargs)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>plot_path(l1)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>plot_path(l2)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.gca()</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig("../graphs/2019-3.png", bbox_inches="tight")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2019_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">How the two wires are arranged in space</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="day-4-secure-container" class="level1">
<h1><a href="https://adventofcode.com/2019/day/4">Day 4: Secure Container</a></h1>
<section id="part-1-3" class="level2">
<h2 class="anchored" data-anchor-id="part-1-3">Part 1</h2>
<div class="cell" data-execution_count="9">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>low <span class="op">=</span> <span class="dv">231832</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>high <span class="op">=</span> <span class="dv">767346</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(low, high <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="bu">str</span>(i)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">list</span>(s) <span class="op">==</span> <span class="bu">sorted</span>(s):</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> digit <span class="kw">in</span> <span class="st">"0123456789"</span>:</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> s.count(digit) <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                total <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-2" class="level2">
<h2 class="anchored" data-anchor-id="part-2-2">Part 2</h2>
<div class="cell" data-execution_count="10">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(low, high <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="bu">str</span>(i)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">list</span>(s) <span class="op">==</span> <span class="bu">sorted</span>(s):</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (s[<span class="dv">0</span>] <span class="op">==</span> s[<span class="dv">1</span>] <span class="op">!=</span> s[<span class="dv">2</span>]) <span class="kw">or</span> (s[<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> s[<span class="op">-</span><span class="dv">2</span>] <span class="op">!=</span> s[<span class="op">-</span><span class="dv">3</span>]):</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>            total <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(s) <span class="op">-</span> <span class="dv">2</span>):</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> s[idx <span class="op">-</span> <span class="dv">1</span>] <span class="op">!=</span> s[idx] <span class="op">==</span> s[idx <span class="op">+</span> <span class="dv">1</span>] <span class="op">!=</span> s[idx <span class="op">+</span> <span class="dv">2</span>]:</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                total <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-5-sunny-with-a-chance-of-asteroids" class="level1">
<h1><a href="https://adventofcode.com/2019/day/5">Day 5: Sunny with a Chance of Asteroids</a></h1>
<section id="part-1-4" class="level2">
<h2 class="anchored" data-anchor-id="part-1-4">Part 1</h2>
<div class="cell" data-execution_count="11">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(load(<span class="dv">5</span>, <span class="st">"np"</span>), inputs<span class="op">=</span>[<span class="dv">1</span>])</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(program.run())[<span class="op">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-3" class="level2">
<h2 class="anchored" data-anchor-id="part-2-3">Part 2</h2>
<div class="cell" data-execution_count="12">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>program.reset()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>program.inputs <span class="op">=</span> [<span class="dv">5</span>]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="bu">next</span>(program.run())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-6-universal-orbit-map" class="level1">
<h1><a href="https://adventofcode.com/2019/day/6">Day 6: Universal Orbit Map</a></h1>
<section id="part-1-5" class="level2">
<h2 class="anchored" data-anchor-id="part-1-5">Part 1</h2>
<p>We construct the DAG as a dictionary, where graph[node] corresponds to node.parent.</p>
<div class="cell" data-execution_count="13">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">6</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>graph <span class="op">=</span> {child: parent <span class="cf">for</span> parent, child <span class="kw">in</span> <span class="bu">map</span>(<span class="kw">lambda</span> x: x.split(<span class="st">")"</span>), data)}</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="at">@functools.cache</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_orbits(node):</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node <span class="op">==</span> <span class="st">"COM"</span>:</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span>, ()</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    previous <span class="op">=</span> count_orbits(graph[node])</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> previous[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span>, (graph[node],) <span class="op">+</span> previous[<span class="dv">1</span>]</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(count_orbits(x)[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> graph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-4" class="level2">
<h2 class="anchored" data-anchor-id="part-2-4">Part 2</h2>
<p>Moving from orbit A to orbit B can be accomplished by moving to the last common ancestor of each node, and then switching branches. And thats the same as getting the full ancestry of both nodes, minus anything they might have in common.</p>
<div class="cell" data-execution_count="14">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>_, p1 <span class="op">=</span> count_orbits(<span class="st">"YOU"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>_, p2 <span class="op">=</span> count_orbits(<span class="st">"SAN"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="bu">set</span>(p1) <span class="op">^</span> <span class="bu">set</span>(p2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-7-amplification-circuit" class="level1">
<h1><a href="https://adventofcode.com/2019/day/7">Day 7: Amplification Circuit</a></h1>
<section id="part-1-6" class="level2">
<h2 class="anchored" data-anchor-id="part-1-6">Part 1</h2>
<div class="cell" data-execution_count="15">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>opcodes <span class="op">=</span> load(<span class="dv">7</span>, <span class="st">"np"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(opcodes)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> input_sequence <span class="kw">in</span> itertools.permutations(<span class="bu">range</span>(<span class="dv">5</span>)):</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item <span class="kw">in</span> input_sequence:</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        program.reset()</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        program.inputs <span class="op">=</span> [item, val]</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        val <span class="op">=</span> <span class="bu">next</span>(program.run())</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    results.append(val)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-5" class="level2">
<h2 class="anchored" data-anchor-id="part-2-5">Part 2</h2>
<div class="cell" data-execution_count="16">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> seq <span class="kw">in</span> itertools.permutations(<span class="bu">range</span>(<span class="dv">5</span>, <span class="dv">10</span>)):</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    inputs <span class="op">=</span> [[x] <span class="cf">for</span> x <span class="kw">in</span> seq]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    inputs[<span class="dv">0</span>].append(<span class="dv">0</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    iterators <span class="op">=</span> [IntCodeProgram(opcodes, inputs<span class="op">=</span>inputs[i]).run() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>            val <span class="op">=</span> <span class="bu">next</span>(iterators[i <span class="op">%</span> <span class="dv">5</span>])</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>            inputs[(i <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">5</span>].append(val)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>            i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">StopIteration</span>:</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    results.append(val)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-8-space-image-format" class="level1">
<h1><a href="https://adventofcode.com/2019/day/8">Day 8: Space Image Format</a></h1>
<section id="part-1-7" class="level2">
<h2 class="anchored" data-anchor-id="part-1-7">Part 1</h2>
<div class="cell" data-execution_count="17">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">8</span>)[<span class="dv">0</span>]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> []</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data) <span class="op">//</span> (<span class="dv">25</span> <span class="op">*</span> <span class="dv">6</span>))[::<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    substring <span class="op">=</span> data[<span class="dv">25</span> <span class="op">*</span> <span class="dv">6</span> <span class="op">*</span> i : <span class="dv">25</span> <span class="op">*</span> <span class="dv">6</span> <span class="op">*</span> (i <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    result.append((substring.count(<span class="st">"0"</span>), substring.count(<span class="st">"1"</span>) <span class="op">*</span> substring.count(<span class="st">"2"</span>)))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="bu">min</span>(result)[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-6" class="level2">
<h2 class="anchored" data-anchor-id="part-2-6">Part 2</h2>
<div class="cell" data-execution_count="18">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="bu">list</span>(<span class="st">"1"</span> <span class="op">*</span> <span class="dv">25</span> <span class="op">*</span> <span class="dv">6</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data) <span class="op">//</span> (<span class="dv">25</span> <span class="op">*</span> <span class="dv">6</span>))[::<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    substring <span class="op">=</span> data[<span class="dv">25</span> <span class="op">*</span> <span class="dv">6</span> <span class="op">*</span> i : <span class="dv">25</span> <span class="op">*</span> <span class="dv">6</span> <span class="op">*</span> (i <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> [bottom <span class="cf">if</span> top <span class="op">==</span> <span class="st">"2"</span> <span class="cf">else</span> top <span class="cf">for</span> top, bottom <span class="kw">in</span> <span class="bu">zip</span>(substring, result)]</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">""</span>.join([<span class="st">""</span> <span class="cf">if</span> char <span class="op">!=</span> <span class="st">"0"</span> <span class="cf">else</span> <span class="st">" "</span> <span class="cf">for</span> char <span class="kw">in</span> line])</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> line <span class="kw">in</span> np.array(result).reshape(<span class="dv">6</span>, <span class="dv">25</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-9-sensor-boost" class="level1">
<h1><a href="https://adventofcode.com/2019/day/9">Day 9: Sensor Boost</a></h1>
<section id="part-1-8" class="level2">
<h2 class="anchored" data-anchor-id="part-1-8">Part 1</h2>
<p>Adding the required functionality to the intcode compiler wasnt too tricky. Opcodes which set values had to be modified a bit to account for the offset, but that was more or less it.</p>
<p>Allowing arbitrary final addresses was accomplished by the very dirty hack of changing the program type in this problem from a list to defaultdict(int). If it works, it works.</p>
<div class="cell" data-execution_count="19">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(load(<span class="dv">9</span>, <span class="st">"np"</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>program.inputs <span class="op">=</span> [<span class="dv">1</span>]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="bu">next</span>(program.run())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-7" class="level2">
<h2 class="anchored" data-anchor-id="part-2-7">Part 2</h2>
<div class="cell" data-execution_count="20">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>program.reset()</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>program.inputs <span class="op">=</span> [<span class="dv">2</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="bu">next</span>(program.run())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-10-monitoring-station" class="level1">
<h1><a href="https://adventofcode.com/2019/day/10">Day 10: Monitoring Station</a></h1>
<section id="part-1-9" class="level2">
<h2 class="anchored" data-anchor-id="part-1-9">Part 1</h2>
<div class="cell" data-execution_count="21">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> gcd</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simplify(x, y):</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (x, y) <span class="op">==</span> (<span class="dv">0</span>, <span class="dv">0</span>):</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span>, <span class="dv">0</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    factor <span class="op">=</span> gcd(x, y)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">int</span>(x <span class="op">/</span> factor), <span class="bu">int</span>(y <span class="op">/</span> factor)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.array(</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    [[<span class="dv">0</span> <span class="cf">if</span> char <span class="op">==</span> <span class="st">"."</span> <span class="cf">else</span> <span class="dv">1</span> <span class="cf">for</span> char <span class="kw">in</span> line] <span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">10</span>)]</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>).T</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>ones <span class="op">=</span> np.array(np.where(data)).T</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> [</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">len</span>(<span class="bu">set</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: simplify(<span class="op">*</span>x), ones <span class="op">-</span> ones[i]))) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(ones))</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>position <span class="op">=</span> ones[np.argmax(scores)]</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">max</span>(scores) <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(position)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-8" class="level2">
<h2 class="anchored" data-anchor-id="part-2-8">Part 2</h2>
<p>There are more than 200 visible asteroids, so we only need to worry about the ones we meet on the first round - but thats exactly the simplified asteroids, as seen from our position. We take these, and sort them according to the angle they make with the negative y axis (negative because we have y increasing as it goes down in this coordinate system). The one were interested in is the 201st asteroid according to this order (201st because the one were measuring from will automatically have an angle of zero and should not be counted)</p>
<div class="cell" data-execution_count="22">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    np.array(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">sorted</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>            <span class="bu">set</span>([simplify(<span class="op">*</span>x) <span class="cf">for</span> x <span class="kw">in</span> ones <span class="op">-</span> position]),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>            key<span class="op">=</span><span class="kw">lambda</span> x: (np.arctan2(x[<span class="dv">0</span>], <span class="op">-</span>x[<span class="dv">1</span>])) <span class="op">%</span> (<span class="dv">2</span> <span class="op">*</span> np.pi),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        )[<span class="dv">200</span>]</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> position</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-11-space-police" class="level1">
<h1><a href="https://adventofcode.com/2019/day/11">Day 11: Space Police</a></h1>
<section id="part-1-10" class="level2">
<h2 class="anchored" data-anchor-id="part-1-10">Part 1</h2>
<div class="cell" data-execution_count="23">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(load(<span class="dv">11</span>, <span class="st">"np"</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> solve(startval):</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    position, direction <span class="op">=</span> <span class="dv">0</span> <span class="op">+</span> <span class="ot">0j</span>, <span class="ot">1j</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    program.reset()</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    field <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    program.inputs <span class="op">=</span> [startval]</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    painted <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> colour, turn <span class="kw">in</span> more_itertools.chunked(program.run(), <span class="dv">2</span>):</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>        field[position] <span class="op">=</span> colour</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        painted.add(position)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>        direction <span class="op">=</span> direction <span class="op">*</span> (<span class="ot">1j</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> turn))</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        position <span class="op">+=</span> direction</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        program.inputs.append(field[position])</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> painted, field</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(solve(<span class="dv">0</span>)[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-9" class="level2">
<h2 class="anchored" data-anchor-id="part-2-9">Part 2</h2>
<div class="cell" data-execution_count="24">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>_, field <span class="op">=</span> solve(<span class="dv">1</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>ones <span class="op">=</span> np.array([x <span class="cf">for</span> x <span class="kw">in</span> field.keys() <span class="cf">if</span> field[x]])</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>offset <span class="op">=</span> ones.real.<span class="bu">min</span>() <span class="op">+</span> <span class="ot">1j</span> <span class="op">*</span> ones.imag.<span class="bu">min</span>()</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>ones <span class="op">=</span> ones <span class="op">-</span> offset</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>field <span class="op">=</span> np.zeros((<span class="bu">int</span>(ones.real.<span class="bu">max</span>()) <span class="op">+</span> <span class="dv">1</span>, <span class="bu">int</span>(ones.imag.<span class="bu">max</span>()) <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> value <span class="kw">in</span> ones:</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    field[<span class="bu">int</span>(value.real), <span class="bu">int</span>(value.imag)] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        [<span class="st">""</span>.join([<span class="st">""</span> <span class="cf">if</span> char <span class="cf">else</span> <span class="st">" "</span> <span class="cf">for</span> char <span class="kw">in</span> line]) <span class="cf">for</span> line <span class="kw">in</span> np.rot90(field)]</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-12-the-n-body-problem" class="level1">
<h1><a href="https://adventofcode.com/2019/day/12">Day 12: The N-Body Problem</a></h1>
<section id="part-1-11" class="level2">
<h2 class="anchored" data-anchor-id="part-1-11">Part 1</h2>
<div class="cell" data-execution_count="25">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">12</span>, <span class="st">"int"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>positions <span class="op">=</span> np.array(data, dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>velocities <span class="op">=</span> np.zeros(positions.shape, dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m1, m2 <span class="kw">in</span> itertools.combinations([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], <span class="dv">2</span>):</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        dv <span class="op">=</span> <span class="dv">1</span> <span class="op">*</span> (positions[m2] <span class="op">&gt;</span> positions[m1]) <span class="op">-</span> <span class="dv">1</span> <span class="op">*</span> (positions[m2] <span class="op">&lt;</span> positions[m1])</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        velocities[m1] <span class="op">+=</span> dv</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        velocities[m2] <span class="op">-=</span> dv</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    positions <span class="op">+=</span> velocities</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>(np.<span class="bu">abs</span>(positions).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>) <span class="op">*</span> np.<span class="bu">abs</span>(velocities).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-10" class="level2">
<h2 class="anchored" data-anchor-id="part-2-10">Part 2</h2>
<p>I dont know what optimizations are possible here, but an obvious one is to realise that the three different directions (x,y and z) are completely independent, and that instead of searching for one global cycle, we can ask if there are shorter cycles for the coordinates separately. The global cycle length is then the lcm of the individual cycle lengths, as long as each cycle starts at the initial state.</p>
<div class="cell" data-execution_count="26">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">12</span>, <span class="st">"int"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>positions <span class="op">=</span> np.array(data, dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>velocities <span class="op">=</span> np.zeros(positions.shape, dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>seen_x <span class="op">=</span> {}</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>seen_y <span class="op">=</span> {}</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>seen_z <span class="op">=</span> {}</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> axis, seen <span class="kw">in</span> <span class="bu">zip</span>([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>], [seen_x, seen_y, seen_z]):</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    seen[<span class="bu">tuple</span>(np.hstack([positions[:, axis], velocities[:, axis]]))] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>cycles <span class="op">=</span> [<span class="va">False</span>, <span class="va">False</span>, <span class="va">False</span>]</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1_000_000</span>):</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m1, m2 <span class="kw">in</span> itertools.combinations([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], <span class="dv">2</span>):</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        dv <span class="op">=</span> <span class="dv">1</span> <span class="op">*</span> (positions[m2] <span class="op">&gt;</span> positions[m1]) <span class="op">-</span> <span class="dv">1</span> <span class="op">*</span> (positions[m2] <span class="op">&lt;</span> positions[m1])</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>        velocities[m1] <span class="op">+=</span> dv</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>        velocities[m2] <span class="op">-=</span> dv</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    positions <span class="op">+=</span> velocities</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> axis, seen <span class="kw">in</span> <span class="bu">zip</span>([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>], [seen_x, seen_y, seen_z]):</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cycles[axis]:</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> <span class="bu">tuple</span>(np.hstack([positions[:, axis], velocities[:, axis]]))</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> state <span class="kw">in</span> seen:</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>            cycles[axis] <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">all</span>(cycles):</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>math.lcm(<span class="op">*</span>cycles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-13-care-package" class="level1">
<h1><a href="https://adventofcode.com/2019/day/13">Day 13: Care Package</a></h1>
<section id="part-1-12" class="level2">
<h2 class="anchored" data-anchor-id="part-1-12">Part 1</h2>
<div class="cell" data-execution_count="27">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(load(<span class="dv">13</span>, <span class="st">"np"</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>tiles <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, y, kind <span class="kw">in</span> more_itertools.chunked(program.run(), <span class="dv">3</span>):</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> kind <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        tiles.add((x, y))</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-11" class="level2">
<h2 class="anchored" data-anchor-id="part-2-11">Part 2</h2>
<div class="cell" data-execution_count="28">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>program.<span class="bu">set</span>(<span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>ball, paddle <span class="op">=</span> <span class="dv">0</span>, <span class="dv">0</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ai():</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> ball</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> paddle</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (ball <span class="op">&gt;</span> paddle) <span class="op">-</span> (ball <span class="op">&lt;</span> paddle)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>program.set_input(ai)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> more_itertools.chunked(program.run(), <span class="dv">3</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, y, kind <span class="kw">in</span> values:</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> result <span class="cf">if</span> (x <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>) <span class="cf">else</span> kind</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    paddle <span class="op">=</span> paddle <span class="cf">if</span> (kind <span class="op">!=</span> <span class="dv">3</span>) <span class="cf">else</span> x</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    ball <span class="op">=</span> ball <span class="cf">if</span> (kind <span class="op">!=</span> <span class="dv">4</span>) <span class="cf">else</span> x</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-14-space-stoichiometry" class="level1">
<h1><a href="https://adventofcode.com/2019/day/14">Day 14: Space Stoichiometry</a></h1>
<section id="part-1-13" class="level2">
<h2 class="anchored" data-anchor-id="part-1-13">Part 1</h2>
<div class="cell" data-execution_count="29">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>graph <span class="op">=</span> {}</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">14</span>):</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    inputs, output <span class="op">=</span> line.split(<span class="st">" =&gt; "</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    output_amount, output_resource <span class="op">=</span> output.split()</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    output_amount <span class="op">=</span> <span class="bu">int</span>(output_amount)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    inputs <span class="op">=</span> [pair.split() <span class="cf">for</span> pair <span class="kw">in</span> inputs.split(<span class="st">", "</span>)]</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    graph[output_resource] <span class="op">=</span> (</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        output_amount,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        [x[<span class="dv">1</span>] <span class="cf">for</span> x <span class="kw">in</span> inputs],</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        [<span class="bu">int</span>(x[<span class="dv">0</span>]) <span class="cf">for</span> x <span class="kw">in</span> inputs],</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> topological_sort(graph):</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> graph:</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    dependencies <span class="op">=</span> functools.<span class="bu">reduce</span>(<span class="kw">lambda</span> x, y: x <span class="op">|</span> <span class="bu">set</span>(y[<span class="dv">1</span>]), graph.values(), <span class="bu">set</span>())</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    ready <span class="op">=</span> []</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key <span class="kw">in</span> graph:</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> key <span class="kw">not</span> <span class="kw">in</span> dependencies:</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>            ready.append(key)</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> ready</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    new_graph <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> graph.items() <span class="cf">if</span> k <span class="kw">not</span> <span class="kw">in</span> ready}</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ready <span class="op">+</span> topological_sort(new_graph)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> part1(n):</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    order <span class="op">=</span> topological_sort(graph)</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    requirements <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    requirements[<span class="st">"FUEL"</span>] <span class="op">=</span> n</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> resource <span class="kw">in</span> order:</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>        production, kinds, amounts <span class="op">=</span> graph[resource]</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> resource <span class="kw">in</span> requirements:</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>            n <span class="op">=</span> <span class="bu">int</span>(np.ceil(requirements[resource] <span class="op">/</span> production))</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> kind, amount <span class="kw">in</span> <span class="bu">zip</span>(kinds, amounts):</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>                requirements[kind] <span class="op">+=</span> n <span class="op">*</span> amount</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> requirements[resource]</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> requirements[<span class="st">"ORE"</span>]</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>part1(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-12" class="level2">
<h2 class="anchored" data-anchor-id="part-2-12">Part 2</h2>
<p>We need to somehow reverse the relationship we found above. There are probably smarter ways of doing things, but a binary search works fine:</p>
<div class="cell" data-execution_count="30">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> <span class="dv">1_000_000_000_000</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>lower_limit <span class="op">=</span> target <span class="op">//</span> part1(<span class="dv">1</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>upper_limit <span class="op">=</span> lower_limit <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> part1(upper_limit) <span class="op">&lt;</span> target:</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    lower_limit <span class="op">*=</span> <span class="dv">2</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    upper_limit <span class="op">*=</span> <span class="dv">2</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (upper_limit <span class="op">-</span> lower_limit) <span class="op">!=</span> <span class="dv">1</span>:</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    midpoint <span class="op">=</span> <span class="bu">int</span>((upper_limit <span class="op">+</span> lower_limit) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> part1(midpoint) <span class="op">&gt;</span> target:</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        upper_limit <span class="op">=</span> midpoint</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>        lower_limit <span class="op">=</span> midpoint</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>lower_limit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-15-oxygen-system" class="level1">
<h1><a href="https://adventofcode.com/2019/day/15">Day 15: Oxygen System</a></h1>
<section id="part-1-14" class="level2">
<h2 class="anchored" data-anchor-id="part-1-14">Part 1</h2>
<p>I really liked this puzzle! The approach I took is to first map out the entire area by giving the droid the necessary instructions, and then using a path finding algorithm to get from start to finish.</p>
<div class="cell" data-execution_count="31">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(load(<span class="dv">15</span>, <span class="st">"np"</span>))</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> program.run()</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>directions <span class="op">=</span> {<span class="dv">1</span>: <span class="ot">1j</span>, <span class="dv">2</span>: <span class="op">-</span><span class="ot">1j</span>, <span class="dv">3</span>: <span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>: <span class="dv">1</span>}</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>reverse_directions <span class="op">=</span> {v: k <span class="cf">for</span> k, v <span class="kw">in</span> directions.items()}</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> neighbors(state, edges<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> edges <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [state <span class="op">+</span> directions[neighbor] <span class="cf">for</span> neighbor <span class="kw">in</span> edges[state]]</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update(steps, state, neighbor):</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> steps <span class="op">+</span> [reverse_directions[neighbor <span class="op">-</span> state]]</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>queue <span class="op">=</span> deque([(<span class="dv">0</span>, <span class="dv">0</span>)])</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>old_position <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>visited <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>edges <span class="op">=</span> defaultdict(<span class="bu">set</span>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> queue:</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    steps, position <span class="op">=</span> queue.popleft()</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    visited.add(position)</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>    instructions <span class="op">=</span> utils.bfs(old_position, position, neighbors, [], update, edges<span class="op">=</span>edges)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>    program.set_input(instructions)</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> program.state <span class="op">!=</span> <span class="dv">1</span>:</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=</span> <span class="bu">next</span>(f)</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> direction <span class="kw">in</span> directions:</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>        new_position <span class="op">=</span> position <span class="op">+</span> directions[direction]</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>        opposite_direction <span class="op">=</span> direction <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> (direction <span class="op">%</span> <span class="dv">2</span>) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>        program.set_input([direction])</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>        val <span class="op">=</span> <span class="bu">next</span>(f)</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> val <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>        program.set_input([opposite_direction])</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=</span> <span class="bu">next</span>(f)</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>        edges[position].add(direction)</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>        edges[new_position].add(opposite_direction)</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> val <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>            target <span class="op">=</span> new_position</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> new_position <span class="kw">not</span> <span class="kw">in</span> visited:</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>            <span class="co"># append left to make it a dfs, so that the droid doesn't have to</span></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>            <span class="co"># run from one side of the board to the other all the time</span></span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>            queue.appendleft((steps <span class="op">+</span> <span class="dv">1</span>, new_position))</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>    old_position <span class="op">=</span> position</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>utils.bfs(<span class="dv">0</span>, target, neighbors, edges<span class="op">=</span>edges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-13" class="level2">
<h2 class="anchored" data-anchor-id="part-2-13">Part 2</h2>
<p>We mapped out the whole area for part 1, so part 2 is just a bfs with no stopping condition</p>
<div class="cell" data-execution_count="32">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>utils.bfs(target, <span class="va">None</span>, neighbors, edges<span class="op">=</span>edges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-16-flawed-frequency-transmission" class="level1">
<h1><a href="https://adventofcode.com/2019/day/16">Day 16: Flawed Frequency Transmission</a></h1>
<section id="part-1-15" class="level2">
<h2 class="anchored" data-anchor-id="part-1-15">Part 1</h2>
<p>For the first part all the numbers are small, so we dont need to be particularly clever</p>
<div class="cell" data-execution_count="33">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>initial_data <span class="op">=</span> [<span class="bu">int</span>(x) <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">16</span>)[<span class="dv">0</span>]]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> initial_data.copy()</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>base_pattern <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>factors <span class="op">=</span> []</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(data) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    pattern <span class="op">=</span> base_pattern.repeat(i)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    repeats <span class="op">=</span> <span class="bu">int</span>(np.ceil((<span class="bu">len</span>(data) <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> <span class="bu">len</span>(pattern)))</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    factors.append(np.tile(pattern, repeats)[<span class="dv">1</span> : <span class="bu">len</span>(data) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>factors <span class="op">=</span> np.array(factors)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> <span class="bu">abs</span>(factors <span class="op">@</span> data) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>data[:<span class="dv">8</span>], sep<span class="op">=</span><span class="st">""</span>, end<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-14" class="level2">
<h2 class="anchored" data-anchor-id="part-2-14">Part 2</h2>
<p>For part 2, the numbers get so big that this approach is impossible (just the transition matrix has <span class="math inline">\(\textrm{len(data)}^2 \times10^8\)</span> elements, so thats not going to work).</p>
<p>The first optimization we can make is to realise that calculating the <span class="math inline">\(k\)</span>-th from last digit of the output only requires knowledge of the last <span class="math inline">\(k\)</span> digits of the input. So the last digit is always unchanged, the last-but-one digit is always the sum of the previous last two digits etc.</p>
<p>In fact, we can explicitly solve this reccurrence for the second half of the input data, and looking at the data provided, thats where the relevant digits are located! Denoting the <span class="math inline">\(k\)</span>-th digit from the end after the <span class="math inline">\(n\)</span>-th iteration as <span class="math inline">\(d_k^n\)</span>, we can verify that</p>
<span class="math display">\[\begin{align*}
d^n_0 &amp;= d^{n-1}_0 = \ldots = d^0_0 \\
d^n_1 &amp;= d^{n-1}_1 + (d^{n-1}_0) = d^0_1 + nd^0_0 \\
d^n_2 &amp;= d^{n-1}_2 + (d^{n-1}_1 + d^{n-1}_0) = d^0_2 + nd^0_1 + \frac12n(n+1)d^0_0 \\
\end{align*}\]</span>
<p>Explicitly solving the recurrences for all the digits in the second half is certainly possible, but its going to be very tedious. Instead, we can notice that the middle expression is always <span class="math inline">\(d^{n-1}_k + d^n_{k -1}\)</span> . That means that to calculate <span class="math inline">\(d^{100}_k\)</span> we only need to know <span class="math inline">\(d^0_k\)</span> and <span class="math inline">\(d^1_{k-1}, d^2_{k-1}, \ldots, d^{100}_{k-1}\)</span>, which translates to the following short routine:</p>
<div class="cell" data-execution_count="34">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>active <span class="op">=</span> <span class="dv">101</span> <span class="op">*</span> [<span class="dv">0</span>]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> functools.<span class="bu">reduce</span>(<span class="kw">lambda</span> x, y: <span class="dv">10</span> <span class="op">*</span> x <span class="op">+</span> y, initial_data[:<span class="dv">7</span>])</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.tile(initial_data, <span class="dv">10_000</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>counter_index <span class="op">=</span> <span class="bu">len</span>(data) <span class="op">-</span> index</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(counter_index):</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    active[<span class="dv">0</span>] <span class="op">=</span> data[<span class="op">-</span><span class="dv">1</span> <span class="op">-</span> i]</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    active <span class="op">=</span> np.cumsum(active) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    results.append(active[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>functools.<span class="bu">reduce</span>(<span class="kw">lambda</span> x, y: <span class="dv">10</span> <span class="op">*</span> x <span class="op">+</span> y, results[::<span class="op">-</span><span class="dv">1</span>][:<span class="dv">8</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-17-set-and-forget" class="level1">
<h1><a href="https://adventofcode.com/2019/day/17">Day 17: Set and Forget</a></h1>
<section id="part-1-16" class="level2">
<h2 class="anchored" data-anchor-id="part-1-16">Part 1</h2>
<div class="cell" data-execution_count="35">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>opcodes <span class="op">=</span> load(<span class="dv">17</span>, <span class="st">"np"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(opcodes)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="st">""</span>.join(<span class="bu">chr</span>(val) <span class="cf">for</span> val <span class="kw">in</span> program.run()).split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)[:<span class="op">-</span><span class="dv">2</span>]</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>board <span class="op">=</span> np.array([[<span class="dv">1</span> <span class="cf">if</span> char <span class="op">==</span> <span class="st">"#"</span> <span class="cf">else</span> <span class="dv">0</span> <span class="cf">for</span> char <span class="kw">in</span> line] <span class="cf">for</span> line <span class="kw">in</span> data])</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>neighbors <span class="op">=</span> [[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>]]</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>intersections <span class="op">=</span> np.where(</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    (scipy.ndimage.convolve(board, neighbors, mode<span class="op">=</span><span class="st">"constant"</span>) <span class="op">&gt;</span> <span class="dv">2</span>) <span class="op">&amp;</span> board</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>np.product(intersections, axis<span class="op">=</span><span class="dv">0</span>).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-15" class="level2">
<h2 class="anchored" data-anchor-id="part-2-15">Part 2</h2>
<p>For this one I solved the path by hand, and then ran the input through the black box program to get the actual output.</p>
<div class="cell" data-execution_count="36">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> <span class="st">"R,6,L,12,R,6"</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> <span class="st">"L,12,R,6,L,8,L,12"</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>C <span class="op">=</span> <span class="st">"R,12,L,10,L,10"</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>main <span class="op">=</span> <span class="st">"A,A,B,C,B,C,B,C,B,A"</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>show_output <span class="op">=</span> <span class="st">"n</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>program_input <span class="op">=</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(x <span class="cf">for</span> x <span class="kw">in</span> [main, A, B, C, show_output])</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>encoded_input <span class="op">=</span> [<span class="bu">ord</span>(x) <span class="cf">for</span> x <span class="kw">in</span> program_input]</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>program.<span class="bu">set</span>(<span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>program.set_input(encoded_input)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>[x <span class="cf">for</span> x <span class="kw">in</span> program.run()][<span class="op">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-18-many-worlds-interpretation" class="level1">
<h1><a href="https://adventofcode.com/2019/day/18">Day 18: Many-Worlds Interpretation</a></h1>
<section id="part-1-17" class="level2">
<h2 class="anchored" data-anchor-id="part-1-17">Part 1</h2>
<p>The maze we are looking at is fairly large, but it only has a few interesting points. Most of the maze is corridors of width 1; and on these stretches there are no choices about where to go, since backtracking is not an option. Instead of working with the grid we are given, we can extract the points of interest, and store the distance from each point to its neighbors.</p>
<p>The points of interest are:</p>
<ul>
<li>Keys</li>
<li>Doors</li>
<li>Junctions</li>
</ul>
<p>The numbers here are barely small enough that the straightforward approach works: A BFS with a different visited list for each possible set of collected keys. To slightly improve the runtime, well start by eliminating dead ends so the BFS never has to consider them.</p>
<div class="cell" data-execution_count="37">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.array([[<span class="bu">ord</span>(c) <span class="cf">for</span> c <span class="kw">in</span> line] <span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">18</span>)])</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> np.where(data <span class="op">==</span> <span class="bu">ord</span>(<span class="st">"@"</span>))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(<span class="op">*</span>indices))[<span class="dv">0</span>]</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>wall <span class="op">=</span> <span class="bu">ord</span>(<span class="st">"#"</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>free <span class="op">=</span> <span class="bu">ord</span>(<span class="st">"."</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>data[indices] <span class="op">=</span> free</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>window <span class="op">=</span> [[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>]]</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>walls <span class="op">=</span> (data <span class="op">==</span> wall) <span class="op">*</span> <span class="dv">1</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>walls</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> s <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    walls <span class="op">=</span> (data <span class="op">==</span> wall) <span class="op">*</span> <span class="dv">1</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    dead_ends <span class="op">=</span> (scipy.ndimage.convolve(walls, window, mode<span class="op">=</span><span class="st">"constant"</span>) <span class="op">&gt;</span> <span class="dv">2</span>) <span class="op">&amp;</span> (</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>        (data <span class="op">==</span> free) <span class="op">|</span> ((data <span class="op">&gt;=</span> <span class="bu">ord</span>(<span class="st">"A"</span>)) <span class="op">&amp;</span> (data <span class="op">&lt;=</span> <span class="bu">ord</span>(<span class="st">"Z"</span>)))</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> dead_ends.<span class="bu">sum</span>()</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    data[dead_ends] <span class="op">=</span> wall</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>nw <span class="op">=</span> <span class="dv">1</span> <span class="op">*</span> (data <span class="op">!=</span> wall)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>junctions <span class="op">=</span> (scipy.ndimage.convolve(nw, window, mode<span class="op">=</span><span class="st">"constant"</span>) <span class="op">&gt;</span> <span class="dv">2</span>) <span class="op">&amp;</span> nw</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>data[np.where(junctions)] <span class="op">=</span> <span class="bu">ord</span>(<span class="st">"9"</span>)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>queue <span class="op">=</span> deque()</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>connections <span class="op">=</span> defaultdict(<span class="bu">dict</span>)</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>painted <span class="op">=</span> {}</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> data.shape[<span class="dv">1</span>]</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> label(position):</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data[position] <span class="op">==</span> <span class="bu">ord</span>(<span class="st">"9"</span>):</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">str</span>(position[<span class="dv">0</span>] <span class="op">*</span> width <span class="op">+</span> position[<span class="dv">1</span>])</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">chr</span>(data[position])</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="co"># print(*["".join(chr(x) for x in line) for line in data], sep="\n")</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> start <span class="kw">in</span> <span class="bu">list</span>(<span class="bu">zip</span>(<span class="op">*</span>np.where(data <span class="op">&gt;</span> <span class="bu">max</span>(free, wall)))):</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>    queue.append((<span class="dv">0</span>, start, start))</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> queue:</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>    steps, position, origin <span class="op">=</span> queue.popleft()</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> position <span class="kw">in</span> painted:</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>        other, other_steps <span class="op">=</span> painted[position]</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> other <span class="op">!=</span> origin:</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>            s <span class="op">=</span> steps <span class="op">+</span> other_steps</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>            connections[label(other)][label(origin)] <span class="op">=</span> s</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>            connections[label(origin)][label(other)] <span class="op">=</span> s</span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>    painted[position] <span class="op">=</span> origin, steps</span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>    y, x <span class="op">=</span> position</span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> neighbor <span class="kw">in</span> [(y <span class="op">-</span> <span class="dv">1</span>, x), (y, x <span class="op">-</span> <span class="dv">1</span>), (y, x <span class="op">+</span> <span class="dv">1</span>), (y <span class="op">+</span> <span class="dv">1</span>, x)]:</span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> data[neighbor] <span class="op">==</span> wall:</span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a>        queue.append((steps <span class="op">+</span> <span class="dv">1</span>, neighbor, origin))</span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="bu">frozenset</span>()</span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> <span class="dv">0</span>, label((<span class="dv">40</span>, <span class="dv">40</span>)), state</span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> PriorityQueue()</span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a>q.put(start)</span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a>visited <span class="op">=</span> defaultdict(<span class="bu">set</span>)</span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> q.qsize() <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a>    steps, l, state <span class="op">=</span> q.get()</span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(state) <span class="op">==</span> <span class="dv">26</span>:</span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> l <span class="kw">in</span> visited[state]:</span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a>    visited[state].add(l)</span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> neighbor <span class="kw">in</span> connections[l]:</span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a>        new_state <span class="op">=</span> state.copy()</span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> neighbor <span class="kw">in</span> visited[state]:</span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">"A"</span> <span class="op">&lt;=</span> neighbor <span class="op">&lt;=</span> <span class="st">"Z"</span> <span class="kw">and</span> neighbor.lower() <span class="kw">not</span> <span class="kw">in</span> state:</span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">"a"</span> <span class="op">&lt;=</span> neighbor <span class="op">&lt;=</span> <span class="st">"z"</span>:</span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a>            new_state <span class="op">=</span> state <span class="op">|</span> <span class="bu">frozenset</span>(neighbor)</span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> steps <span class="op">+</span> connections[l][neighbor]</span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a>        q.put((s, neighbor, new_state))</span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a>steps</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-16" class="level2">
<h2 class="anchored" data-anchor-id="part-2-16">Part 2</h2>
<p>For part 2 we need to keep track of four different robots, which increases the number of neighbors available at each stage. However, direct inspection of the graph of the problem for this specific input reveals that the robots are never waiting for each other, so the shortest amount of steps is just the sum of the individual shortest steps to clear each subgraph. It feels a bit cheesy to completely ignore the doors in the puzzle, but it works here.</p>
<div class="cell" data-execution_count="38">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">40</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>starts <span class="op">=</span> [(x <span class="op">-</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span>), (x <span class="op">-</span> <span class="dv">1</span>, x <span class="op">+</span> <span class="dv">1</span>), (x <span class="op">+</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span>), (x <span class="op">+</span> <span class="dv">1</span>, x <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>dead_positions <span class="op">=</span> [(x <span class="op">-</span> <span class="dv">1</span>, x), (x, x <span class="op">-</span> <span class="dv">1</span>), (x, x), (x, x <span class="op">+</span> <span class="dv">1</span>), (x <span class="op">+</span> <span class="dv">1</span>, x)]</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>dead_labels <span class="op">=</span> [label(_) <span class="cf">for</span> _ <span class="kw">in</span> dead_positions]</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>part2 <span class="op">=</span> {</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    k: {p: q <span class="cf">for</span> p, q <span class="kw">in</span> v.items() <span class="cf">if</span> p <span class="kw">not</span> <span class="kw">in</span> dead_labels}</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k, v <span class="kw">in</span> connections.items()</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> k <span class="kw">not</span> <span class="kw">in</span> dead_labels</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> start <span class="kw">in</span> <span class="bu">map</span>(label, starts):</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    nodes <span class="op">=</span> deque([start])</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    seen <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> nodes:</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>        current <span class="op">=</span> nodes.popleft()</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> current <span class="kw">in</span> seen:</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>        seen.add(current)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> neighbor <span class="kw">in</span> part2[current]:</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> neighbor <span class="kw">not</span> <span class="kw">in</span> seen:</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>                nodes.append(neighbor)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    targets <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> seen <span class="cf">if</span> <span class="st">"a"</span> <span class="op">&lt;=</span> x <span class="op">&lt;=</span> <span class="st">"z"</span>]</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> <span class="bu">frozenset</span>()</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    q <span class="op">=</span> PriorityQueue()</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>    q.put((<span class="dv">0</span>, start, state))</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>    visited <span class="op">=</span> defaultdict(<span class="bu">set</span>)</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> q.qsize() <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>        steps, position, state <span class="op">=</span> q.get()</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(state) <span class="op">==</span> <span class="bu">len</span>(targets):</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> position <span class="kw">in</span> visited[state]:</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>        visited[state].add(position)</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> neighbor <span class="kw">in</span> part2[position]:</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>            new_state <span class="op">=</span> state.copy()</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> neighbor <span class="kw">in</span> visited[state]:</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> neighbor <span class="kw">in</span> targets:</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>                new_state <span class="op">=</span> state <span class="op">|</span> <span class="bu">frozenset</span>(neighbor)</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>            q.put((steps <span class="op">+</span> part2[position][neighbor], neighbor, new_state))</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> steps</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-19-tractor-beam" class="level1">
<h1><a href="https://adventofcode.com/2019/day/19">Day 19: Tractor Beam</a></h1>
<section id="part-1-18" class="level2">
<h2 class="anchored" data-anchor-id="part-1-18">Part 1</h2>
<div class="cell" data-execution_count="39">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>opcodes <span class="op">=</span> load(<span class="dv">19</span>, <span class="st">"np"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(opcodes)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>inputs <span class="op">=</span> []</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>program.set_input(inputs)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>size <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>board <span class="op">=</span> np.zeros((size, size), dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(size):</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(size):</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>        program.reset()</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>        inputs <span class="op">+=</span> [j, i]</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>        board[i, j] <span class="op">=</span> <span class="bu">next</span>(program.run())</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>board.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-17" class="level2">
<h2 class="anchored" data-anchor-id="part-2-17">Part 2</h2>
<div class="cell" data-execution_count="40">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>top_edge <span class="op">=</span> []</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>bottom_edge <span class="op">=</span> []</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>current_top <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>current_bottom <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    bottom_val <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    top_val <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    current_top <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> top_val <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> current_top <span class="op">&lt;=</span> <span class="dv">2</span> <span class="op">*</span> j:</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>        current_top <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>        program.reset()</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>        program.set_input([j, current_top])</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>        top_val <span class="op">=</span> <span class="bu">next</span>(program.run())</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> top_val:</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>        current_top <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> current_bottom:</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>        current_bottom <span class="op">=</span> current_top</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> bottom_val <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>        current_bottom <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>        program.reset()</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>        program.set_input([j, current_bottom])</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>        bottom_val <span class="op">=</span> <span class="bu">next</span>(program.run())</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    top_edge.append(current_top)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    bottom_edge.append(current_bottom <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>axis <span class="op">=</span> np.arange(<span class="bu">len</span>(bottom_edge))</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>top_slope <span class="op">=</span> np.polyfit(axis, top_edge, <span class="dv">1</span>)[<span class="dv">0</span>]</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> <span class="dv">99</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>dy <span class="op">=</span> (top_slope <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> w</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> (np.array(bottom_edge) <span class="op">-</span> np.array(top_edge) <span class="op">&gt;=</span> dy).argmax()</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> bottom_edge[x] <span class="op">-</span> w</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> top_edge[x <span class="op">+</span> w] <span class="op">&lt;=</span> (bottom_edge[x] <span class="op">-</span> w):</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>    x <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> bottom_edge[x] <span class="op">-</span> w</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>x <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> bottom_edge[x] <span class="op">-</span> w</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a><span class="dv">10000</span> <span class="op">*</span> x <span class="op">+</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-20-donut-maze" class="level1">
<h1><a href="https://adventofcode.com/2019/day/20">Day 20: Donut Maze</a></h1>
<section id="part-1-19" class="level2">
<h2 class="anchored" data-anchor-id="part-1-19">Part 1</h2>
<p>This can be done with a fairly simple BFS. The only added difficulty is that we need some way of specifying that two portals of the same letter neighbor each other.</p>
<p>In terms of the number of lines, thats what most of the following code is doing.</p>
<div class="cell" data-execution_count="41">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.array([[<span class="bu">ord</span>(char) <span class="cf">for</span> char <span class="kw">in</span> line[:<span class="op">-</span><span class="dv">1</span>]] <span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">20</span>)], dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>portals <span class="op">=</span> ((<span class="bu">ord</span>(<span class="st">"A"</span>) <span class="op">&lt;=</span> data) <span class="op">&amp;</span> (data <span class="op">&lt;=</span> <span class="bu">ord</span>(<span class="st">"Z"</span>))) <span class="op">*</span> <span class="dv">1</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> label(item):</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(item, <span class="bu">str</span>):</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>        item <span class="op">=</span> np.array([<span class="bu">ord</span>(x) <span class="cf">for</span> x <span class="kw">in</span> item])</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> functools.<span class="bu">reduce</span>(<span class="kw">lambda</span> x, y: <span class="op">-</span>(<span class="dv">26</span> <span class="op">*</span> x <span class="op">+</span> y), item <span class="op">-</span> <span class="bu">ord</span>(<span class="st">"A"</span>) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>ymax, xmax <span class="op">=</span> data.shape</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>verticals <span class="op">=</span> np.where(scipy.ndimage.correlate(portals, [[<span class="dv">1</span>], [<span class="dv">1</span>]], mode<span class="op">=</span><span class="st">"constant"</span>) <span class="op">==</span> <span class="dv">2</span>)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>horizontals <span class="op">=</span> np.where(scipy.ndimage.correlate(portals, [[<span class="dv">1</span>, <span class="dv">1</span>]], mode<span class="op">=</span><span class="st">"constant"</span>) <span class="op">==</span> <span class="dv">2</span>)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> vertical_neighbors(y, x):</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>        [y <span class="op">-</span> <span class="dv">2</span>, x],</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>        [y <span class="op">-</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span>],</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>        [y <span class="op">-</span> <span class="dv">1</span>, x <span class="op">+</span> <span class="dv">1</span>],</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>        [y, x <span class="op">-</span> <span class="dv">1</span>],</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>        [y, x <span class="op">+</span> <span class="dv">1</span>],</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>        [y <span class="op">+</span> <span class="dv">1</span>, x],</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> horizontal_neighbors(y, x):</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>        [y, x <span class="op">-</span> <span class="dv">2</span>],</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>        [y <span class="op">-</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span>],</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>        [y <span class="op">+</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span>],</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>        [y <span class="op">-</span> <span class="dv">1</span>, x],</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>        [y <span class="op">+</span> <span class="dv">1</span>, x],</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>        [y, x <span class="op">+</span> <span class="dv">1</span>],</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> horizontal_window(y, x):</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array((y, y)), np.array((x <span class="op">-</span> <span class="dv">1</span>, x))</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> vertical_window(y, x):</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array((y <span class="op">-</span> <span class="dv">1</span>, y)), np.array((x, x))</span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> portals, neighbors, window <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>    [verticals, horizontals],</span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>    [vertical_neighbors, horizontal_neighbors],</span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>    [vertical_window, horizontal_window],</span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> portal <span class="kw">in</span> <span class="bu">sorted</span>(<span class="bu">zip</span>(<span class="op">*</span>portals)):</span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>        w <span class="op">=</span> window(<span class="op">*</span>portal)</span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> [</span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>            i <span class="cf">for</span> i <span class="kw">in</span> neighbors(<span class="op">*</span>portal) <span class="cf">if</span> data[i[<span class="dv">0</span>] <span class="op">%</span> ymax, i[<span class="dv">1</span>] <span class="op">%</span> xmax] <span class="op">==</span> <span class="bu">ord</span>(<span class="st">"."</span>)</span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>        ][<span class="dv">0</span>]</span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>        data[<span class="bu">tuple</span>(n)] <span class="op">=</span> label(data[w])</span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>        data[w] <span class="op">=</span> <span class="bu">ord</span>(<span class="st">"#"</span>)</span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> <span class="bu">next</span>(<span class="bu">zip</span>(<span class="op">*</span>np.where(data <span class="op">==</span> label(<span class="st">"AA"</span>))))</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a>destination <span class="op">=</span> <span class="bu">next</span>(<span class="bu">zip</span>(<span class="op">*</span>np.where(data <span class="op">==</span> label(<span class="st">"ZZ"</span>))))</span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>paths <span class="op">=</span> deque([(start, <span class="dv">0</span>)])</span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a>seen <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> paths:</span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>    (y, x), distance <span class="op">=</span> paths.popleft()</span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (y, x) <span class="kw">in</span> seen:</span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (y, x) <span class="op">==</span> destination:</span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a>    seen.add((y, x))</span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> [</span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a>        c</span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> c <span class="kw">in</span> [(y <span class="op">-</span> <span class="dv">1</span>, x), (y, x <span class="op">-</span> <span class="dv">1</span>), (y, x <span class="op">+</span> <span class="dv">1</span>), (y <span class="op">+</span> <span class="dv">1</span>, x)]</span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (data[c] <span class="op">==</span> <span class="bu">ord</span>(<span class="st">"."</span>)) <span class="kw">or</span> data[c] <span class="op">&lt;</span> <span class="dv">0</span></span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data[y, x] <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a>        neighbors <span class="op">+=</span> <span class="bu">sorted</span>(<span class="bu">zip</span>(<span class="op">*</span>np.where(data <span class="op">==</span> data[y, x])))</span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> neighbor <span class="kw">in</span> neighbors:</span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> neighbor <span class="kw">in</span> seen:</span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a>        paths.append((neighbor, distance <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a>distance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-18" class="level2">
<h2 class="anchored" data-anchor-id="part-2-18">Part 2</h2>
<p>For part 2, we basically just need to add a level coordinate to our state, and change the way we enumerate neighbors to account for the fact that moving through a portal changes the levels</p>
<div class="cell" data-execution_count="42">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>level_change <span class="op">=</span> defaultdict(<span class="kw">lambda</span>: <span class="dv">1</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>portals <span class="op">=</span> np.where(data <span class="op">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> y, x <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>portals):</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">==</span> <span class="dv">2</span> <span class="kw">or</span> y <span class="op">==</span> <span class="dv">2</span> <span class="kw">or</span> x <span class="op">==</span> xmax <span class="op">-</span> <span class="dv">3</span> <span class="kw">or</span> y <span class="op">==</span> ymax <span class="op">-</span> <span class="dv">3</span>:</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>        level_change[y, x] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> <span class="bu">next</span>(<span class="bu">zip</span>(<span class="op">*</span>np.where(data <span class="op">==</span> label(<span class="st">"AA"</span>)))) <span class="op">+</span> (<span class="dv">0</span>,)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>destination <span class="op">=</span> <span class="bu">next</span>(<span class="bu">zip</span>(<span class="op">*</span>np.where(data <span class="op">==</span> label(<span class="st">"ZZ"</span>)))) <span class="op">+</span> (<span class="dv">0</span>,)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>paths <span class="op">=</span> deque([(start, <span class="dv">0</span>)])</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>seen <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> paths:</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    (y, x, level), distance <span class="op">=</span> paths.popleft()</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (y, x, level) <span class="kw">in</span> seen:</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (y, x, level) <span class="op">==</span> destination:</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    seen.add((y, x, level))</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> [</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>        c <span class="op">+</span> (level,)</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> c <span class="kw">in</span> [(y <span class="op">-</span> <span class="dv">1</span>, x), (y, x <span class="op">-</span> <span class="dv">1</span>), (y, x <span class="op">+</span> <span class="dv">1</span>), (y <span class="op">+</span> <span class="dv">1</span>, x)]</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (data[c] <span class="op">==</span> <span class="bu">ord</span>(<span class="st">"."</span>)) <span class="kw">or</span> data[c] <span class="op">&lt;</span> <span class="dv">0</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data[y, x] <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>        new_level <span class="op">=</span> level <span class="op">+</span> level_change[y, x]</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> new_level <span class="op">&gt;=</span> <span class="dv">0</span>:</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>            other_neighbors <span class="op">=</span> <span class="bu">set</span>(<span class="bu">zip</span>(<span class="op">*</span>np.where(data <span class="op">==</span> data[y, x]))) <span class="op">-</span> <span class="bu">set</span>([(y, x)])</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> neighbor <span class="kw">in</span> other_neighbors:</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>                neighbors <span class="op">+=</span> [neighbor <span class="op">+</span> (new_level,)]</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> neighbor <span class="kw">in</span> neighbors:</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> neighbor <span class="kw">in</span> seen:</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>        paths.append((neighbor, distance <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>distance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-21-springdroid-adventure" class="level1">
<h1><a href="https://adventofcode.com/2019/day/21">Day 21: Springdroid Adventure</a></h1>
<section id="part-1-20" class="level2">
<h2 class="anchored" data-anchor-id="part-1-20">Part 1</h2>
<p>Part 1 is possible to brute force, even if a bit of thought is needed to do it. With 3 different commands available, with six options for their first argument and 2 for their second, there are are 36 possible SPRINGSCRIPT instructions; each program is a max of 15 instructions, so there are more than <span class="math inline">\(2\times10^{23}\)</span> possible programs. Thats not the right way to go.</p>
<p>On the other hand, there are only four inputs at any given stage, so there are only 16 distinct inputs to our assignments. The program we have to supply is just a way of mapping each input to either 0 or 1, and there are only <span class="math inline">\(2^{16}\)</span> of those.</p>
<p>Additionally, we are told that jumping when there is a hole 4 tiles away will result in automatic loss, since thats how far we jump. Similarly, not jumping when there is a hole right in front of us will result in a loss. So any valid rule has to have the following structure (0 as input is hole, 1 is ground; 0 as output is dont jump, 1 is jump)</p>
<ul>
<li>0BCD -&gt; 1</li>
<li>ABC0 -&gt; 0</li>
</ul>
<p>(this reveals that the input 0BC0 is an automatic loss)</p>
<p>That also means that for anything else we can assume A = 1 and D = 1, since otherwise the output is fixed. So really we just have to map the four BC states. That means there are only 16 possible programs, so we can enumerate them all. Especially since 8 of them are mirrors of the other 8.</p>
<div class="cell" data-execution_count="43">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>springscript_programs <span class="op">=</span> [</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    [],</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"NOT B T"</span>, <span class="st">"NOT C J"</span>, <span class="st">"OR T J"</span>, <span class="st">"NOT J J"</span>],</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"NOT C J"</span>, <span class="st">"AND B J"</span>],</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"NOT B J"</span>, <span class="st">"NOT J J"</span>],</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"NOT B J"</span>, <span class="st">"AND C J"</span>],</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"NOT C J"</span>, <span class="st">"NOT J J"</span>],</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"NOT B J"</span>, <span class="st">"AND C J"</span>, <span class="st">"NOT C T"</span>, <span class="st">"AND B T"</span>, <span class="st">"OR T J"</span>],</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"NOT B T"</span>, <span class="st">"NOT C J"</span>, <span class="st">"AND T J"</span>, <span class="st">"NOT J J"</span>],</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> invert(program):</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> program[<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="st">"NOT J J"</span>:</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> program[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> program <span class="op">+</span> [<span class="st">"NOT J J"</span>]</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>footer <span class="op">=</span> [<span class="st">"NOT A T"</span>, <span class="st">"OR T J"</span>, <span class="st">"AND D J"</span>, <span class="st">"WALK"</span>]</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>springscript_programs <span class="op">+=</span> [invert(p) <span class="cf">for</span> p <span class="kw">in</span> springscript_programs]</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>springscript_programs <span class="op">=</span> [p <span class="op">+</span> footer <span class="cf">for</span> p <span class="kw">in</span> springscript_programs]</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>encoded <span class="op">=</span> [</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>    [<span class="bu">ord</span>(char) <span class="cf">for</span> char <span class="kw">in</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(program) <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>]</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> program <span class="kw">in</span> springscript_programs</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(load(<span class="dv">21</span>, <span class="st">"np"</span>))</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> springscript_programs:</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>    encoded_program <span class="op">=</span> [<span class="bu">ord</span>(char) <span class="cf">for</span> char <span class="kw">in</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(p) <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>]</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>    program.reset()</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>    program.set_input(encoded_program)</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> value <span class="kw">in</span> program.run():</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> value <span class="op">&gt;</span> <span class="dv">255</span>:</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>value</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-19" class="level2">
<h2 class="anchored" data-anchor-id="part-2-19">Part 2</h2>
<p>Well.</p>
<p>For part 2 we get five more registers, for a total of 7 that are allowed to vary state. That makes 128 possible inputs, and <span class="math inline">\(\approx10^{38}\)</span> possible mappings. The total number of 15-line springscript programs is only <span class="math inline">\(\left(3\times11\times2\right)^{15} \approx 2\times10^{27}\)</span>, so a different approach is going to be needed</p>
<p>Some thoughts:</p>
<ul>
<li>If all of ABCD are ground there is no reason to jump, since we can just move forward. If A is a hole we have to jump, and if D is a hole we cannot jump. In general, if the landing is safe, we should try and jump early, since thatll give us more time to think on the other side. So if either B or C is a hole and D is safe we should jump. The exception is when H is a hole since then we cannot jump from D, and would be better off waiting to see what happens</li>
</ul>
<div class="cell" data-execution_count="44">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>springscript_program <span class="op">=</span> [</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NOT B J"</span>,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NOT C T"</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OR T J"</span>,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AND D J"</span>,  <span class="co"># if d is ground and there's a hole at B or C, we can jump to D</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AND H J"</span>,  <span class="co"># but only if H is also ground</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NOT A T"</span>,  <span class="co"># if next tile is a hole we have to jump</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OR T J"</span>,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"RUN"</span>,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>encoded_program <span class="op">=</span> [<span class="bu">ord</span>(char) <span class="cf">for</span> char <span class="kw">in</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(springscript_program) <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>]</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>program.reset()</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>program.set_input(encoded_program)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> value <span class="kw">in</span> program.run():</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> value <span class="op">&gt;</span> <span class="dv">255</span>:</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">chr</span>(value), end<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>value</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-22-slam-shuffle" class="level1">
<h1><a href="https://adventofcode.com/2019/day/22">Day 22: Slam Shuffle</a></h1>
<section id="part-1-21" class="level2">
<h2 class="anchored" data-anchor-id="part-1-21">Part 1</h2>
<p>We are asked to follow how a single number moves - the one initally at position 2019. So if we build the operations so that they take an old position and return the new position, we can completely avoid dealing with the rest of the array.</p>
<div class="cell" data-execution_count="45">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>instructions <span class="op">=</span> [<span class="bu">str</span>.split(x) <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">22</span>)]</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>lookup <span class="op">=</span> {<span class="st">"cut"</span>: <span class="dv">1</span>, <span class="st">"deal"</span>: <span class="dv">2</span>}</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>instructions <span class="op">=</span> [</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">0</span>,)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> instruction[<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="st">"stack"</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> (lookup[instruction[<span class="dv">0</span>]], <span class="bu">int</span>(instruction[<span class="op">-</span><span class="dv">1</span>]))</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> instruction <span class="kw">in</span> instructions</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>l <span class="op">=</span> <span class="dv">10007</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="dv">2019</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> instruction <span class="kw">in</span> instructions:</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> instruction[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> (l <span class="op">-</span> p <span class="op">-</span> <span class="dv">1</span>) <span class="op">%</span> l</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> instruction[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> (p <span class="op">-</span> instruction[<span class="dv">1</span>]) <span class="op">%</span> l</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> (p <span class="op">*</span> instruction[<span class="dv">1</span>]) <span class="op">%</span> l</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-20" class="level2">
<h2 class="anchored" data-anchor-id="part-2-20">Part 2</h2>
<p>To nobodys great surprise, part 2 ups the difficulty significantly, with the usual trick of increasing the numbers of cards and rounds significantly.</p>
<p>Additionally, since were tracking what card ends up at a given spot rather than what spot a given card ends up at, well need to reverse the operations defined above, and apply them in reverse order. For the first two thats not a big issue, since the reversal is trivial. For the last one, well need a way to find multiplicative inverses in the modular group. Well use the extended euclidean algorithm for that; its already implemented in the utils file.</p>
<p>Even with those optimizations, doing as many rounds as required isnt possible. Instead, we can realise that each of the three operations on the position is linear, and therefore so is their composition. That means that we can model the result of each round as</p>
<p><span class="math inline">\(p \rightarrow ap + b \qquad \mod l\)</span></p>
<p>for some constants a and b. We can find these constants, and thus reduce the work needed for each round to calculating a multiplication, an addition and a remainder; making each round much faster.</p>
<p>The number of rounds is still prohibitive if were stuck doing them one at a time, but once we know the coefficients for doing one round, we can easily find the coefficients for doing 2 rounds. That lets us use a multiplication by squaring approach to getting the answer.</p>
<div class="cell" data-execution_count="46">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>l <span class="op">=</span> <span class="dv">119315717514047</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> (<span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> instruction <span class="kw">in</span> instructions[::<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> instruction[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> <span class="op">-</span>state[<span class="dv">0</span>], l <span class="op">-</span> state[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> instruction[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> state[<span class="dv">0</span>], state[<span class="dv">1</span>] <span class="op">+</span> instruction[<span class="dv">1</span>]</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> [x <span class="op">*</span> inverses[instruction[<span class="dv">1</span>]] <span class="cf">for</span> x <span class="kw">in</span> state]</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> [x <span class="op">%</span> l <span class="cf">for</span> x <span class="kw">in</span> state]</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compose(c1, c2):</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (c1[<span class="dv">0</span>] <span class="op">*</span> c2[<span class="dv">0</span>]) <span class="op">%</span> l, (c2[<span class="dv">0</span>] <span class="op">*</span> c1[<span class="dv">1</span>] <span class="op">+</span> c2[<span class="dv">1</span>]) <span class="op">%</span> l</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="dv">2020</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">101741582076661</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> i:</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">2</span>:</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> (p <span class="op">*</span> state[<span class="dv">0</span>] <span class="op">+</span> state[<span class="dv">1</span>]) <span class="op">%</span> l</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>        i <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> compose(state, state)</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> i <span class="op">&gt;&gt;</span> <span class="dv">1</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-23-category-six" class="level1">
<h1><a href="https://adventofcode.com/2019/day/23">Day 23: Category Six</a></h1>
<section id="part-1-22" class="level2">
<h2 class="anchored" data-anchor-id="part-1-22">Part 1</h2>
<div class="cell" data-execution_count="47">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">23</span>, <span class="st">"np"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>bus <span class="op">=</span> [[x] <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">50</span>))]</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>programs <span class="op">=</span> []</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">50</span>):</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    program <span class="op">=</span> IntCodeProgram(data, inputs<span class="op">=</span>bus[i])</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    programs.append(program)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>done <span class="op">=</span> <span class="va">False</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    program <span class="op">=</span> programs[idx]</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> program.run()</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> []</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> value <span class="kw">in</span> values:</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> value <span class="op">==</span> <span class="dv">255</span> <span class="kw">and</span> (count <span class="op">%</span> <span class="dv">3</span>) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>            done <span class="op">=</span> <span class="va">True</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> program.state <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>            bus[idx].append(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">+=</span> [value]</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> done:</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="bu">next</span>(values)</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> <span class="bu">next</span>(values)</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> destination, x, y <span class="kw">in</span> more_itertools.chunked(outputs, <span class="dv">3</span>):</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>        bus[destination] <span class="op">+=</span> [x, y]</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> (idx <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">50</span> <span class="cf">if</span> <span class="kw">not</span> outputs <span class="cf">else</span> destination</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-21" class="level2">
<h2 class="anchored" data-anchor-id="part-2-21">Part 2</h2>
<div class="cell" data-execution_count="48">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">23</span>, <span class="st">"np"</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>bus <span class="op">=</span> [[x] <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">50</span>))]</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>programs <span class="op">=</span> []</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">50</span>):</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    program <span class="op">=</span> IntCodeProgram(data, inputs<span class="op">=</span>bus[i])</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    programs.append(program)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>done <span class="op">=</span> <span class="va">False</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_idle(bus):</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">all</span>(i <span class="op">==</span> [<span class="op">-</span><span class="dv">1</span>] <span class="cf">for</span> i <span class="kw">in</span> bus)</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>nat <span class="op">=</span> [x, y]</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>old_y <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> is_idle(bus):</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> nat[<span class="dv">1</span>] <span class="op">==</span> old_y:</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>        new_input <span class="op">=</span> nat.copy()</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>        bus[<span class="dv">0</span>] <span class="op">=</span> new_input</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>        programs[<span class="dv">0</span>].set_input(new_input)</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>        old_y <span class="op">=</span> nat[<span class="dv">1</span>]</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>    program <span class="op">=</span> programs[idx]</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> program.run()</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> []</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> value <span class="kw">in</span> values:</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> program.state <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>            bus[idx].append(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">+=</span> [value]</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> destination, x, y <span class="kw">in</span> more_itertools.chunked(outputs, <span class="dv">3</span>):</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> destination <span class="op">==</span> <span class="dv">255</span>:</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>            nat <span class="op">=</span> [x, y]</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>            bus[destination] <span class="op">+=</span> [x, y]</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> (idx <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">50</span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>old_y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-24-planet-of-discord" class="level1">
<h1><a href="https://adventofcode.com/2019/day/24">Day 24: Planet of Discord</a></h1>
<section id="part-1-23" class="level2">
<h2 class="anchored" data-anchor-id="part-1-23">Part 1</h2>
<div class="cell" data-execution_count="49">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>initial_state <span class="op">=</span> np.array(</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    [[<span class="dv">0</span> <span class="cf">if</span> char <span class="op">==</span> <span class="st">"."</span> <span class="cf">else</span> <span class="dv">1</span> <span class="cf">for</span> char <span class="kw">in</span> line] <span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">24</span>)]</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> initial_state.copy()</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> [[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>]]</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>seen <span class="op">=</span> {}</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">tuple</span>(state.ravel()) <span class="kw">not</span> <span class="kw">in</span> seen:</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    seen[<span class="bu">tuple</span>(state.ravel())] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    bugs <span class="op">=</span> scipy.ndimage.convolve(state, weights, mode<span class="op">=</span><span class="st">"constant"</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    changes <span class="op">=</span> bugs <span class="op">!=</span> <span class="dv">1</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    empty <span class="op">=</span> np.where(state <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    changes[empty] <span class="op">=</span> ((bugs <span class="op">==</span> <span class="dv">1</span>) <span class="op">|</span> (bugs <span class="op">==</span> <span class="dv">2</span>))[empty]</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> (state <span class="op">+</span> changes) <span class="op">%</span> <span class="dv">2</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> state.ravel()</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>(x <span class="op">*</span> (<span class="dv">2</span> <span class="op">**</span> np.arange(<span class="bu">len</span>(x)))).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-22" class="level2">
<h2 class="anchored" data-anchor-id="part-2-22">Part 2</h2>
<p>For part 2, we need to figure out how to account for the different levels and how to account for the new neighbors.</p>
<p>Well add the different recursion levels as a new first axis in our array, and we know that it takes at least two steps before an initially empty layer can affect its neighbor: one to reach the layer, and one to spread to the edge/centre of the layer. That means that instead of expanding the first axis at every step, we can precompute how many well need and fill with zeros.</p>
<p>We can get the in-plane neighbors exactly as before, and after far too much thought, we can get the new neighbors with some clever numpy indexing. This could possibly be shortened even further, but tbh its concise enough as it is.</p>
<div class="cell" data-execution_count="50">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>length <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> np.zeros((length <span class="op">+</span> <span class="dv">3</span>, <span class="op">*</span>initial_state.shape), dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>state[<span class="bu">int</span>(length <span class="op">//</span> <span class="dv">2</span>) <span class="op">+</span> <span class="dv">1</span>] <span class="op">=</span> initial_state</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(length):</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> scipy.ndimage.convolve(state, [weights], mode<span class="op">=</span><span class="st">"constant"</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    neighbors[:, (<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>), :] <span class="op">+=</span> np.roll(state[:, (<span class="dv">1</span>, <span class="dv">3</span>), <span class="dv">2</span>], <span class="dv">1</span>, axis<span class="op">=</span><span class="dv">0</span>)[:, :, <span class="va">None</span>]</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    neighbors[:, :, (<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>)] <span class="op">+=</span> np.roll(state[:, <span class="dv">2</span>, (<span class="dv">1</span>, <span class="dv">3</span>)], <span class="dv">1</span>, axis<span class="op">=</span><span class="dv">0</span>)[:, <span class="va">None</span>, :]</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    neighbors[:, (<span class="dv">1</span>, <span class="dv">3</span>), <span class="dv">2</span>] <span class="op">+=</span> np.roll(state[:, (<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>), :], <span class="op">-</span><span class="dv">1</span>, axis<span class="op">=</span><span class="dv">0</span>).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    neighbors[:, <span class="dv">2</span>, (<span class="dv">1</span>, <span class="dv">3</span>)] <span class="op">+=</span> np.roll(state[:, :, (<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>)], <span class="op">-</span><span class="dv">1</span>, axis<span class="op">=</span><span class="dv">0</span>).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    changes <span class="op">=</span> neighbors <span class="op">!=</span> <span class="dv">1</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    empty <span class="op">=</span> np.where(state <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    changes[empty] <span class="op">=</span> ((neighbors <span class="op">==</span> <span class="dv">1</span>) <span class="op">|</span> (neighbors <span class="op">==</span> <span class="dv">2</span>))[empty]</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> (state <span class="op">+</span> changes) <span class="op">%</span> <span class="dv">2</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    state[:, <span class="dv">2</span>, <span class="dv">2</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>state.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-25-cryostasis" class="level1">
<h1><a href="https://adventofcode.com/2019/day/25">Day 25: Cryostasis</a></h1>
<section id="part-1-24" class="level2">
<h2 class="anchored" data-anchor-id="part-1-24">Part 1</h2>
<div class="cell" data-execution_count="51">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(load(<span class="dv">25</span>, <span class="st">"np"</span>), inputs<span class="op">=</span>[])</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run():</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> char <span class="kw">in</span> program.run():</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> program.state <span class="op">!=</span> <span class="dv">1</span>:</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="bu">chr</span>(char), end<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>            s <span class="op">=</span> <span class="bu">input</span>().strip()</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>            program.inputs <span class="op">+=</span> [<span class="bu">ord</span>(x) <span class="cf">for</span> x <span class="kw">in</span> s <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb52" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> 2019 Solutions</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="fu"># Imports</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: false</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> collections</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> functools</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict, deque</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> queue <span class="im">import</span> PriorityQueue</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> more_itertools</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">1</span>, os.path.join(sys.path[<span class="dv">0</span>], <span class="st">".."</span>))</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> utils</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> intcode <span class="im">import</span> IntCodeProgram</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>load <span class="op">=</span> utils.year_load(<span class="dv">2019</span>)</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 1: The Tyranny of the Rocket Equation](https://adventofcode.com/2019/day/1)</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">1</span>, <span class="st">"np"</span>)</span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>(data <span class="op">//</span> <span class="dv">3</span> <span class="op">-</span> <span class="dv">2</span>).<span class="bu">sum</span>()</span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="bu">list</span>(data)</span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> val <span class="kw">in</span> data:</span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>    fuel <span class="op">=</span> <span class="bu">max</span>(val <span class="op">//</span> <span class="dv">3</span> <span class="op">-</span> <span class="dv">2</span>, <span class="dv">0</span>)</span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> fuel</span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> fuel:</span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a>        data.append(fuel)</span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a>total</span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 2: 1202 Program Alarm](https://adventofcode.com/2019/day/2)</span></span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-68"><a href="#cb52-68" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-69"><a href="#cb52-69" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram([<span class="bu">int</span>(x) <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">2</span>)[<span class="dv">0</span>].split(<span class="st">","</span>)])</span>
<span id="cb52-70"><a href="#cb52-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-71"><a href="#cb52-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-72"><a href="#cb52-72" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> solve(program, noun<span class="op">=</span><span class="dv">12</span>, verb<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb52-73"><a href="#cb52-73" aria-hidden="true" tabindex="-1"></a>    program.reset()</span>
<span id="cb52-74"><a href="#cb52-74" aria-hidden="true" tabindex="-1"></a>    program.program[<span class="dv">1</span>] <span class="op">=</span> noun</span>
<span id="cb52-75"><a href="#cb52-75" aria-hidden="true" tabindex="-1"></a>    program.program[<span class="dv">2</span>] <span class="op">=</span> verb</span>
<span id="cb52-76"><a href="#cb52-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb52-77"><a href="#cb52-77" aria-hidden="true" tabindex="-1"></a>        val <span class="op">=</span> <span class="bu">next</span>(program.run())</span>
<span id="cb52-78"><a href="#cb52-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">StopIteration</span>:</span>
<span id="cb52-79"><a href="#cb52-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> program.program[<span class="dv">0</span>]</span>
<span id="cb52-80"><a href="#cb52-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-81"><a href="#cb52-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-82"><a href="#cb52-82" aria-hidden="true" tabindex="-1"></a>solve(program)</span>
<span id="cb52-83"><a href="#cb52-83" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-84"><a href="#cb52-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-87"><a href="#cb52-87" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-88"><a href="#cb52-88" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> noun, verb <span class="kw">in</span> itertools.product(<span class="bu">range</span>(<span class="dv">100</span>), <span class="bu">range</span>(<span class="dv">100</span>)):</span>
<span id="cb52-89"><a href="#cb52-89" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> solve(program, noun, verb)</span>
<span id="cb52-90"><a href="#cb52-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> result <span class="op">==</span> <span class="dv">19690720</span>:</span>
<span id="cb52-91"><a href="#cb52-91" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> noun <span class="op">+</span> verb</span>
<span id="cb52-92"><a href="#cb52-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb52-93"><a href="#cb52-93" aria-hidden="true" tabindex="-1"></a>result</span>
<span id="cb52-94"><a href="#cb52-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-95"><a href="#cb52-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-96"><a href="#cb52-96" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 3: Crossed Wires](https://adventofcode.com/2019/day/3)</span></span>
<span id="cb52-97"><a href="#cb52-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-98"><a href="#cb52-98" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-99"><a href="#cb52-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-102"><a href="#cb52-102" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-103"><a href="#cb52-103" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb52-104"><a href="#cb52-104" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: false</span></span>
<span id="cb52-105"><a href="#cb52-105" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> [x.split(<span class="st">","</span>) <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">3</span>)]</span>
<span id="cb52-106"><a href="#cb52-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-107"><a href="#cb52-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-108"><a href="#cb52-108" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> path_to_segments(path):</span>
<span id="cb52-109"><a href="#cb52-109" aria-hidden="true" tabindex="-1"></a>    directions <span class="op">=</span> {<span class="st">"U"</span>: <span class="ot">1j</span>, <span class="st">"D"</span>: <span class="op">-</span><span class="ot">1j</span>, <span class="st">"R"</span>: <span class="dv">1</span>, <span class="st">"L"</span>: <span class="op">-</span><span class="dv">1</span>}</span>
<span id="cb52-110"><a href="#cb52-110" aria-hidden="true" tabindex="-1"></a>    deltas <span class="op">=</span> [<span class="bu">int</span>(p[<span class="dv">1</span>:]) <span class="op">*</span> directions[p[<span class="dv">0</span>]] <span class="cf">for</span> p <span class="kw">in</span> path]</span>
<span id="cb52-111"><a href="#cb52-111" aria-hidden="true" tabindex="-1"></a>    ends <span class="op">=</span> np.cumsum(deltas)</span>
<span id="cb52-112"><a href="#cb52-112" aria-hidden="true" tabindex="-1"></a>    lengths <span class="op">=</span> np.cumsum(np.<span class="bu">abs</span>(deltas))</span>
<span id="cb52-113"><a href="#cb52-113" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> np.vstack([np.roll(ends, <span class="dv">1</span>), ends, np.roll(lengths, <span class="dv">1</span>)]).T</span>
<span id="cb52-114"><a href="#cb52-114" aria-hidden="true" tabindex="-1"></a>    result[<span class="dv">0</span>, <span class="dv">0</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-115"><a href="#cb52-115" aria-hidden="true" tabindex="-1"></a>    result[<span class="dv">0</span>, <span class="dv">2</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-116"><a href="#cb52-116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb52-117"><a href="#cb52-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-118"><a href="#cb52-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-119"><a href="#cb52-119" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> intersection(s1, s2):</span>
<span id="cb52-120"><a href="#cb52-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((s1[<span class="dv">1</span>] <span class="op">-</span> s1[<span class="dv">0</span>]) <span class="op">*</span> (s2[<span class="dv">1</span>] <span class="op">-</span> s2[<span class="dv">0</span>])).imag <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb52-121"><a href="#cb52-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb52-122"><a href="#cb52-122" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (s1[<span class="dv">0</span>] <span class="op">-</span> s1[<span class="dv">1</span>]).imag <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb52-123"><a href="#cb52-123" aria-hidden="true" tabindex="-1"></a>        s2, s1 <span class="op">=</span> s1, s2</span>
<span id="cb52-124"><a href="#cb52-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (s1[<span class="dv">0</span>].real <span class="op">-</span> s2[<span class="dv">0</span>].real) <span class="op">*</span> (s1[<span class="dv">1</span>].real <span class="op">-</span> s2[<span class="dv">1</span>].real) <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">and</span> (</span>
<span id="cb52-125"><a href="#cb52-125" aria-hidden="true" tabindex="-1"></a>        s1[<span class="dv">0</span>].imag <span class="op">-</span> s2[<span class="dv">0</span>].imag</span>
<span id="cb52-126"><a href="#cb52-126" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">*</span> (s1[<span class="dv">1</span>].imag <span class="op">-</span> s2[<span class="dv">1</span>].imag) <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb52-127"><a href="#cb52-127" aria-hidden="true" tabindex="-1"></a>        intersection_point <span class="op">=</span> s1[<span class="dv">0</span>].real <span class="op">+</span> <span class="ot">1j</span> <span class="op">*</span> s2[<span class="dv">0</span>].imag</span>
<span id="cb52-128"><a href="#cb52-128" aria-hidden="true" tabindex="-1"></a>        total_length <span class="op">=</span> (</span>
<span id="cb52-129"><a href="#cb52-129" aria-hidden="true" tabindex="-1"></a>            s1[<span class="dv">2</span>]</span>
<span id="cb52-130"><a href="#cb52-130" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> s2[<span class="dv">2</span>]</span>
<span id="cb52-131"><a href="#cb52-131" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> <span class="bu">abs</span>((s1[<span class="dv">0</span>] <span class="op">-</span> intersection_point).imag)</span>
<span id="cb52-132"><a href="#cb52-132" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> <span class="bu">abs</span>((s2[<span class="dv">0</span>] <span class="op">-</span> intersection_point).real)</span>
<span id="cb52-133"><a href="#cb52-133" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb52-134"><a href="#cb52-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> intersection_point, total_length</span>
<span id="cb52-135"><a href="#cb52-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb52-136"><a href="#cb52-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-137"><a href="#cb52-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-138"><a href="#cb52-138" aria-hidden="true" tabindex="-1"></a>l1 <span class="op">=</span> path_to_segments(lines[<span class="dv">0</span>])</span>
<span id="cb52-139"><a href="#cb52-139" aria-hidden="true" tabindex="-1"></a>l2 <span class="op">=</span> path_to_segments(lines[<span class="dv">1</span>])</span>
<span id="cb52-140"><a href="#cb52-140" aria-hidden="true" tabindex="-1"></a>intersections <span class="op">=</span> [</span>
<span id="cb52-141"><a href="#cb52-141" aria-hidden="true" tabindex="-1"></a>    i <span class="cf">for</span> s1, s2 <span class="kw">in</span> itertools.product(l1, l2) <span class="cf">if</span> (i <span class="op">:=</span> intersection(s1, s2))</span>
<span id="cb52-142"><a href="#cb52-142" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb52-143"><a href="#cb52-143" aria-hidden="true" tabindex="-1"></a><span class="bu">int</span>(<span class="bu">min</span>(<span class="bu">abs</span>(x[<span class="dv">0</span>].real) <span class="op">+</span> <span class="bu">abs</span>(x[<span class="dv">0</span>].imag) <span class="cf">for</span> x <span class="kw">in</span> intersections))</span>
<span id="cb52-144"><a href="#cb52-144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-145"><a href="#cb52-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-146"><a href="#cb52-146" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-147"><a href="#cb52-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-150"><a href="#cb52-150" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-151"><a href="#cb52-151" aria-hidden="true" tabindex="-1"></a><span class="bu">min</span>(x[<span class="dv">1</span>] <span class="cf">for</span> x <span class="kw">in</span> intersections)</span>
<span id="cb52-152"><a href="#cb52-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-153"><a href="#cb52-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-154"><a href="#cb52-154" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bonus</span></span>
<span id="cb52-155"><a href="#cb52-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-156"><a href="#cb52-156" aria-hidden="true" tabindex="-1"></a>As a bonus, we can visualize the walk through space</span>
<span id="cb52-157"><a href="#cb52-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-160"><a href="#cb52-160" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-161"><a href="#cb52-161" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb52-162"><a href="#cb52-162" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-cap: How the two wires are arranged in space</span></span>
<span id="cb52-163"><a href="#cb52-163" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb52-164"><a href="#cb52-164" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb52-165"><a href="#cb52-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-166"><a href="#cb52-166" aria-hidden="true" tabindex="-1"></a>sns.set_theme()</span>
<span id="cb52-167"><a href="#cb52-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-168"><a href="#cb52-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-169"><a href="#cb52-169" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_path(segments, <span class="op">**</span>kwargs):</span>
<span id="cb52-170"><a href="#cb52-170" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> segments[:, <span class="dv">0</span>].real</span>
<span id="cb52-171"><a href="#cb52-171" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> segments[:, <span class="dv">0</span>].imag</span>
<span id="cb52-172"><a href="#cb52-172" aria-hidden="true" tabindex="-1"></a>    plt.plot(x, y, <span class="op">**</span>kwargs)</span>
<span id="cb52-173"><a href="#cb52-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-174"><a href="#cb52-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-175"><a href="#cb52-175" aria-hidden="true" tabindex="-1"></a>plot_path(l1)</span>
<span id="cb52-176"><a href="#cb52-176" aria-hidden="true" tabindex="-1"></a>plot_path(l2)</span>
<span id="cb52-177"><a href="#cb52-177" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.gca()</span>
<span id="cb52-178"><a href="#cb52-178" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig("../graphs/2019-3.png", bbox_inches="tight")</span></span>
<span id="cb52-179"><a href="#cb52-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-180"><a href="#cb52-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-181"><a href="#cb52-181" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 4: Secure Container](https://adventofcode.com/2019/day/4)</span></span>
<span id="cb52-182"><a href="#cb52-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-183"><a href="#cb52-183" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-184"><a href="#cb52-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-187"><a href="#cb52-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-188"><a href="#cb52-188" aria-hidden="true" tabindex="-1"></a>low <span class="op">=</span> <span class="dv">231832</span></span>
<span id="cb52-189"><a href="#cb52-189" aria-hidden="true" tabindex="-1"></a>high <span class="op">=</span> <span class="dv">767346</span></span>
<span id="cb52-190"><a href="#cb52-190" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-191"><a href="#cb52-191" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(low, high <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb52-192"><a href="#cb52-192" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="bu">str</span>(i)</span>
<span id="cb52-193"><a href="#cb52-193" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">list</span>(s) <span class="op">==</span> <span class="bu">sorted</span>(s):</span>
<span id="cb52-194"><a href="#cb52-194" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> digit <span class="kw">in</span> <span class="st">"0123456789"</span>:</span>
<span id="cb52-195"><a href="#cb52-195" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> s.count(digit) <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb52-196"><a href="#cb52-196" aria-hidden="true" tabindex="-1"></a>                total <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb52-197"><a href="#cb52-197" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb52-198"><a href="#cb52-198" aria-hidden="true" tabindex="-1"></a>total</span>
<span id="cb52-199"><a href="#cb52-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-200"><a href="#cb52-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-201"><a href="#cb52-201" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-202"><a href="#cb52-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-205"><a href="#cb52-205" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-206"><a href="#cb52-206" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-207"><a href="#cb52-207" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(low, high <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb52-208"><a href="#cb52-208" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="bu">str</span>(i)</span>
<span id="cb52-209"><a href="#cb52-209" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">list</span>(s) <span class="op">==</span> <span class="bu">sorted</span>(s):</span>
<span id="cb52-210"><a href="#cb52-210" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (s[<span class="dv">0</span>] <span class="op">==</span> s[<span class="dv">1</span>] <span class="op">!=</span> s[<span class="dv">2</span>]) <span class="kw">or</span> (s[<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> s[<span class="op">-</span><span class="dv">2</span>] <span class="op">!=</span> s[<span class="op">-</span><span class="dv">3</span>]):</span>
<span id="cb52-211"><a href="#cb52-211" aria-hidden="true" tabindex="-1"></a>            total <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb52-212"><a href="#cb52-212" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb52-213"><a href="#cb52-213" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(s) <span class="op">-</span> <span class="dv">2</span>):</span>
<span id="cb52-214"><a href="#cb52-214" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> s[idx <span class="op">-</span> <span class="dv">1</span>] <span class="op">!=</span> s[idx] <span class="op">==</span> s[idx <span class="op">+</span> <span class="dv">1</span>] <span class="op">!=</span> s[idx <span class="op">+</span> <span class="dv">2</span>]:</span>
<span id="cb52-215"><a href="#cb52-215" aria-hidden="true" tabindex="-1"></a>                total <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb52-216"><a href="#cb52-216" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb52-217"><a href="#cb52-217" aria-hidden="true" tabindex="-1"></a>total</span>
<span id="cb52-218"><a href="#cb52-218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-219"><a href="#cb52-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-220"><a href="#cb52-220" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 5: Sunny with a Chance of Asteroids](https://adventofcode.com/2019/day/5)</span></span>
<span id="cb52-221"><a href="#cb52-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-222"><a href="#cb52-222" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-223"><a href="#cb52-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-226"><a href="#cb52-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-227"><a href="#cb52-227" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(load(<span class="dv">5</span>, <span class="st">"np"</span>), inputs<span class="op">=</span>[<span class="dv">1</span>])</span>
<span id="cb52-228"><a href="#cb52-228" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(program.run())[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb52-229"><a href="#cb52-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-230"><a href="#cb52-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-231"><a href="#cb52-231" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-232"><a href="#cb52-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-235"><a href="#cb52-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-236"><a href="#cb52-236" aria-hidden="true" tabindex="-1"></a>program.reset()</span>
<span id="cb52-237"><a href="#cb52-237" aria-hidden="true" tabindex="-1"></a>program.inputs <span class="op">=</span> [<span class="dv">5</span>]</span>
<span id="cb52-238"><a href="#cb52-238" aria-hidden="true" tabindex="-1"></a><span class="bu">next</span>(program.run())</span>
<span id="cb52-239"><a href="#cb52-239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-240"><a href="#cb52-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-241"><a href="#cb52-241" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 6: Universal Orbit Map](https://adventofcode.com/2019/day/6)</span></span>
<span id="cb52-242"><a href="#cb52-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-243"><a href="#cb52-243" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-244"><a href="#cb52-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-245"><a href="#cb52-245" aria-hidden="true" tabindex="-1"></a>We construct the DAG as a dictionary, where graph<span class="sc">\[</span>node<span class="sc">\]</span> corresponds to node.parent.</span>
<span id="cb52-246"><a href="#cb52-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-249"><a href="#cb52-249" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-250"><a href="#cb52-250" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">6</span>)</span>
<span id="cb52-251"><a href="#cb52-251" aria-hidden="true" tabindex="-1"></a>graph <span class="op">=</span> {child: parent <span class="cf">for</span> parent, child <span class="kw">in</span> <span class="bu">map</span>(<span class="kw">lambda</span> x: x.split(<span class="st">")"</span>), data)}</span>
<span id="cb52-252"><a href="#cb52-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-253"><a href="#cb52-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-254"><a href="#cb52-254" aria-hidden="true" tabindex="-1"></a><span class="at">@functools.cache</span></span>
<span id="cb52-255"><a href="#cb52-255" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_orbits(node):</span>
<span id="cb52-256"><a href="#cb52-256" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node <span class="op">==</span> <span class="st">"COM"</span>:</span>
<span id="cb52-257"><a href="#cb52-257" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span>, ()</span>
<span id="cb52-258"><a href="#cb52-258" aria-hidden="true" tabindex="-1"></a>    previous <span class="op">=</span> count_orbits(graph[node])</span>
<span id="cb52-259"><a href="#cb52-259" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> previous[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span>, (graph[node],) <span class="op">+</span> previous[<span class="dv">1</span>]</span>
<span id="cb52-260"><a href="#cb52-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-261"><a href="#cb52-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-262"><a href="#cb52-262" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(count_orbits(x)[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> graph)</span>
<span id="cb52-263"><a href="#cb52-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-264"><a href="#cb52-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-265"><a href="#cb52-265" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-266"><a href="#cb52-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-267"><a href="#cb52-267" aria-hidden="true" tabindex="-1"></a>Moving from orbit A to orbit B can be accomplished by moving to the last common ancestor of each node, and then switching branches. And that's the same as getting the full ancestry of both nodes, minus anything they might have in common.</span>
<span id="cb52-268"><a href="#cb52-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-271"><a href="#cb52-271" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-272"><a href="#cb52-272" aria-hidden="true" tabindex="-1"></a>_, p1 <span class="op">=</span> count_orbits(<span class="st">"YOU"</span>)</span>
<span id="cb52-273"><a href="#cb52-273" aria-hidden="true" tabindex="-1"></a>_, p2 <span class="op">=</span> count_orbits(<span class="st">"SAN"</span>)</span>
<span id="cb52-274"><a href="#cb52-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-275"><a href="#cb52-275" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="bu">set</span>(p1) <span class="op">^</span> <span class="bu">set</span>(p2))</span>
<span id="cb52-276"><a href="#cb52-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-277"><a href="#cb52-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-278"><a href="#cb52-278" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 7: Amplification Circuit](https://adventofcode.com/2019/day/7)</span></span>
<span id="cb52-279"><a href="#cb52-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-280"><a href="#cb52-280" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-281"><a href="#cb52-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-284"><a href="#cb52-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-285"><a href="#cb52-285" aria-hidden="true" tabindex="-1"></a>opcodes <span class="op">=</span> load(<span class="dv">7</span>, <span class="st">"np"</span>)</span>
<span id="cb52-286"><a href="#cb52-286" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(opcodes)</span>
<span id="cb52-287"><a href="#cb52-287" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb52-288"><a href="#cb52-288" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> input_sequence <span class="kw">in</span> itertools.permutations(<span class="bu">range</span>(<span class="dv">5</span>)):</span>
<span id="cb52-289"><a href="#cb52-289" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-290"><a href="#cb52-290" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item <span class="kw">in</span> input_sequence:</span>
<span id="cb52-291"><a href="#cb52-291" aria-hidden="true" tabindex="-1"></a>        program.reset()</span>
<span id="cb52-292"><a href="#cb52-292" aria-hidden="true" tabindex="-1"></a>        program.inputs <span class="op">=</span> [item, val]</span>
<span id="cb52-293"><a href="#cb52-293" aria-hidden="true" tabindex="-1"></a>        val <span class="op">=</span> <span class="bu">next</span>(program.run())</span>
<span id="cb52-294"><a href="#cb52-294" aria-hidden="true" tabindex="-1"></a>    results.append(val)</span>
<span id="cb52-295"><a href="#cb52-295" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>(results)</span>
<span id="cb52-296"><a href="#cb52-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-297"><a href="#cb52-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-298"><a href="#cb52-298" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-299"><a href="#cb52-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-302"><a href="#cb52-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-303"><a href="#cb52-303" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb52-304"><a href="#cb52-304" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> seq <span class="kw">in</span> itertools.permutations(<span class="bu">range</span>(<span class="dv">5</span>, <span class="dv">10</span>)):</span>
<span id="cb52-305"><a href="#cb52-305" aria-hidden="true" tabindex="-1"></a>    inputs <span class="op">=</span> [[x] <span class="cf">for</span> x <span class="kw">in</span> seq]</span>
<span id="cb52-306"><a href="#cb52-306" aria-hidden="true" tabindex="-1"></a>    inputs[<span class="dv">0</span>].append(<span class="dv">0</span>)</span>
<span id="cb52-307"><a href="#cb52-307" aria-hidden="true" tabindex="-1"></a>    iterators <span class="op">=</span> [IntCodeProgram(opcodes, inputs<span class="op">=</span>inputs[i]).run() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span>
<span id="cb52-308"><a href="#cb52-308" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-309"><a href="#cb52-309" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb52-310"><a href="#cb52-310" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb52-311"><a href="#cb52-311" aria-hidden="true" tabindex="-1"></a>            val <span class="op">=</span> <span class="bu">next</span>(iterators[i <span class="op">%</span> <span class="dv">5</span>])</span>
<span id="cb52-312"><a href="#cb52-312" aria-hidden="true" tabindex="-1"></a>            inputs[(i <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">5</span>].append(val)</span>
<span id="cb52-313"><a href="#cb52-313" aria-hidden="true" tabindex="-1"></a>            i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb52-314"><a href="#cb52-314" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">StopIteration</span>:</span>
<span id="cb52-315"><a href="#cb52-315" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb52-316"><a href="#cb52-316" aria-hidden="true" tabindex="-1"></a>    results.append(val)</span>
<span id="cb52-317"><a href="#cb52-317" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>(results)</span>
<span id="cb52-318"><a href="#cb52-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-319"><a href="#cb52-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-320"><a href="#cb52-320" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 8: Space Image Format](https://adventofcode.com/2019/day/8)</span></span>
<span id="cb52-321"><a href="#cb52-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-322"><a href="#cb52-322" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-323"><a href="#cb52-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-326"><a href="#cb52-326" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-327"><a href="#cb52-327" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">8</span>)[<span class="dv">0</span>]</span>
<span id="cb52-328"><a href="#cb52-328" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> []</span>
<span id="cb52-329"><a href="#cb52-329" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data) <span class="op">//</span> (<span class="dv">25</span> <span class="op">*</span> <span class="dv">6</span>))[::<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb52-330"><a href="#cb52-330" aria-hidden="true" tabindex="-1"></a>    substring <span class="op">=</span> data[<span class="dv">25</span> <span class="op">*</span> <span class="dv">6</span> <span class="op">*</span> i : <span class="dv">25</span> <span class="op">*</span> <span class="dv">6</span> <span class="op">*</span> (i <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb52-331"><a href="#cb52-331" aria-hidden="true" tabindex="-1"></a>    result.append((substring.count(<span class="st">"0"</span>), substring.count(<span class="st">"1"</span>) <span class="op">*</span> substring.count(<span class="st">"2"</span>)))</span>
<span id="cb52-332"><a href="#cb52-332" aria-hidden="true" tabindex="-1"></a><span class="bu">min</span>(result)[<span class="dv">1</span>]</span>
<span id="cb52-333"><a href="#cb52-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-334"><a href="#cb52-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-335"><a href="#cb52-335" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-336"><a href="#cb52-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-339"><a href="#cb52-339" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-340"><a href="#cb52-340" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="bu">list</span>(<span class="st">"1"</span> <span class="op">*</span> <span class="dv">25</span> <span class="op">*</span> <span class="dv">6</span>)</span>
<span id="cb52-341"><a href="#cb52-341" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data) <span class="op">//</span> (<span class="dv">25</span> <span class="op">*</span> <span class="dv">6</span>))[::<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb52-342"><a href="#cb52-342" aria-hidden="true" tabindex="-1"></a>    substring <span class="op">=</span> data[<span class="dv">25</span> <span class="op">*</span> <span class="dv">6</span> <span class="op">*</span> i : <span class="dv">25</span> <span class="op">*</span> <span class="dv">6</span> <span class="op">*</span> (i <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb52-343"><a href="#cb52-343" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> [bottom <span class="cf">if</span> top <span class="op">==</span> <span class="st">"2"</span> <span class="cf">else</span> top <span class="cf">for</span> top, bottom <span class="kw">in</span> <span class="bu">zip</span>(substring, result)]</span>
<span id="cb52-344"><a href="#cb52-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-345"><a href="#cb52-345" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb52-346"><a href="#cb52-346" aria-hidden="true" tabindex="-1"></a>    <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(</span>
<span id="cb52-347"><a href="#cb52-347" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="cb52-348"><a href="#cb52-348" aria-hidden="true" tabindex="-1"></a>            <span class="st">""</span>.join([<span class="st">""</span> <span class="cf">if</span> char <span class="op">!=</span> <span class="st">"0"</span> <span class="cf">else</span> <span class="st">" "</span> <span class="cf">for</span> char <span class="kw">in</span> line])</span>
<span id="cb52-349"><a href="#cb52-349" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> line <span class="kw">in</span> np.array(result).reshape(<span class="dv">6</span>, <span class="dv">25</span>)</span>
<span id="cb52-350"><a href="#cb52-350" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb52-351"><a href="#cb52-351" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-352"><a href="#cb52-352" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-353"><a href="#cb52-353" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-354"><a href="#cb52-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-355"><a href="#cb52-355" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 9: Sensor Boost](https://adventofcode.com/2019/day/9)</span></span>
<span id="cb52-356"><a href="#cb52-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-357"><a href="#cb52-357" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-358"><a href="#cb52-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-359"><a href="#cb52-359" aria-hidden="true" tabindex="-1"></a>Adding the required functionality to the intcode compiler wasn't too tricky. Opcodes which set values had to be modified a bit to account for the offset, but that was more or less it.</span>
<span id="cb52-360"><a href="#cb52-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-361"><a href="#cb52-361" aria-hidden="true" tabindex="-1"></a>Allowing arbitrary final addresses was accomplished by the very dirty hack of changing the program type in this problem from a list to defaultdict(int). If it works, it works.</span>
<span id="cb52-362"><a href="#cb52-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-365"><a href="#cb52-365" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-366"><a href="#cb52-366" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(load(<span class="dv">9</span>, <span class="st">"np"</span>))</span>
<span id="cb52-367"><a href="#cb52-367" aria-hidden="true" tabindex="-1"></a>program.inputs <span class="op">=</span> [<span class="dv">1</span>]</span>
<span id="cb52-368"><a href="#cb52-368" aria-hidden="true" tabindex="-1"></a><span class="bu">next</span>(program.run())</span>
<span id="cb52-369"><a href="#cb52-369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-370"><a href="#cb52-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-371"><a href="#cb52-371" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-372"><a href="#cb52-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-375"><a href="#cb52-375" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-376"><a href="#cb52-376" aria-hidden="true" tabindex="-1"></a>program.reset()</span>
<span id="cb52-377"><a href="#cb52-377" aria-hidden="true" tabindex="-1"></a>program.inputs <span class="op">=</span> [<span class="dv">2</span>]</span>
<span id="cb52-378"><a href="#cb52-378" aria-hidden="true" tabindex="-1"></a><span class="bu">next</span>(program.run())</span>
<span id="cb52-379"><a href="#cb52-379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-380"><a href="#cb52-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-381"><a href="#cb52-381" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 10: Monitoring Station](https://adventofcode.com/2019/day/10)</span></span>
<span id="cb52-382"><a href="#cb52-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-383"><a href="#cb52-383" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-384"><a href="#cb52-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-387"><a href="#cb52-387" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-388"><a href="#cb52-388" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> gcd</span>
<span id="cb52-389"><a href="#cb52-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-390"><a href="#cb52-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-391"><a href="#cb52-391" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simplify(x, y):</span>
<span id="cb52-392"><a href="#cb52-392" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (x, y) <span class="op">==</span> (<span class="dv">0</span>, <span class="dv">0</span>):</span>
<span id="cb52-393"><a href="#cb52-393" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span>, <span class="dv">0</span></span>
<span id="cb52-394"><a href="#cb52-394" aria-hidden="true" tabindex="-1"></a>    factor <span class="op">=</span> gcd(x, y)</span>
<span id="cb52-395"><a href="#cb52-395" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">int</span>(x <span class="op">/</span> factor), <span class="bu">int</span>(y <span class="op">/</span> factor)</span>
<span id="cb52-396"><a href="#cb52-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-397"><a href="#cb52-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-398"><a href="#cb52-398" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.array(</span>
<span id="cb52-399"><a href="#cb52-399" aria-hidden="true" tabindex="-1"></a>    [[<span class="dv">0</span> <span class="cf">if</span> char <span class="op">==</span> <span class="st">"."</span> <span class="cf">else</span> <span class="dv">1</span> <span class="cf">for</span> char <span class="kw">in</span> line] <span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">10</span>)]</span>
<span id="cb52-400"><a href="#cb52-400" aria-hidden="true" tabindex="-1"></a>).T</span>
<span id="cb52-401"><a href="#cb52-401" aria-hidden="true" tabindex="-1"></a>ones <span class="op">=</span> np.array(np.where(data)).T</span>
<span id="cb52-402"><a href="#cb52-402" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> [</span>
<span id="cb52-403"><a href="#cb52-403" aria-hidden="true" tabindex="-1"></a>    <span class="bu">len</span>(<span class="bu">set</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: simplify(<span class="op">*</span>x), ones <span class="op">-</span> ones[i]))) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(ones))</span>
<span id="cb52-404"><a href="#cb52-404" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb52-405"><a href="#cb52-405" aria-hidden="true" tabindex="-1"></a>position <span class="op">=</span> ones[np.argmax(scores)]</span>
<span id="cb52-406"><a href="#cb52-406" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">max</span>(scores) <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb52-407"><a href="#cb52-407" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(position)</span>
<span id="cb52-408"><a href="#cb52-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-409"><a href="#cb52-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-410"><a href="#cb52-410" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-411"><a href="#cb52-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-412"><a href="#cb52-412" aria-hidden="true" tabindex="-1"></a>There are more than 200 visible asteroids, so we only need to worry about the ones we meet on the first round - but that's exactly the simplified asteroids, as seen from our position. We take these, and sort them according to the angle they make with the negative y axis (negative because we have y increasing as it goes down in this coordinate system). The one we're interested in is the 201st asteroid according to this order (201st because the one we're measuring from will automatically have an angle of zero and should not be counted)</span>
<span id="cb52-413"><a href="#cb52-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-416"><a href="#cb52-416" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-417"><a href="#cb52-417" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb52-418"><a href="#cb52-418" aria-hidden="true" tabindex="-1"></a>    np.array(</span>
<span id="cb52-419"><a href="#cb52-419" aria-hidden="true" tabindex="-1"></a>        <span class="bu">sorted</span>(</span>
<span id="cb52-420"><a href="#cb52-420" aria-hidden="true" tabindex="-1"></a>            <span class="bu">set</span>([simplify(<span class="op">*</span>x) <span class="cf">for</span> x <span class="kw">in</span> ones <span class="op">-</span> position]),</span>
<span id="cb52-421"><a href="#cb52-421" aria-hidden="true" tabindex="-1"></a>            key<span class="op">=</span><span class="kw">lambda</span> x: (np.arctan2(x[<span class="dv">0</span>], <span class="op">-</span>x[<span class="dv">1</span>])) <span class="op">%</span> (<span class="dv">2</span> <span class="op">*</span> np.pi),</span>
<span id="cb52-422"><a href="#cb52-422" aria-hidden="true" tabindex="-1"></a>        )[<span class="dv">200</span>]</span>
<span id="cb52-423"><a href="#cb52-423" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-424"><a href="#cb52-424" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> position</span>
<span id="cb52-425"><a href="#cb52-425" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-426"><a href="#cb52-426" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-427"><a href="#cb52-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-428"><a href="#cb52-428" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 11: Space Police](https://adventofcode.com/2019/day/11)</span></span>
<span id="cb52-429"><a href="#cb52-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-430"><a href="#cb52-430" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-431"><a href="#cb52-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-434"><a href="#cb52-434" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-435"><a href="#cb52-435" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(load(<span class="dv">11</span>, <span class="st">"np"</span>))</span>
<span id="cb52-436"><a href="#cb52-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-437"><a href="#cb52-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-438"><a href="#cb52-438" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> solve(startval):</span>
<span id="cb52-439"><a href="#cb52-439" aria-hidden="true" tabindex="-1"></a>    position, direction <span class="op">=</span> <span class="dv">0</span> <span class="op">+</span> <span class="ot">0j</span>, <span class="ot">1j</span></span>
<span id="cb52-440"><a href="#cb52-440" aria-hidden="true" tabindex="-1"></a>    program.reset()</span>
<span id="cb52-441"><a href="#cb52-441" aria-hidden="true" tabindex="-1"></a>    field <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb52-442"><a href="#cb52-442" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-443"><a href="#cb52-443" aria-hidden="true" tabindex="-1"></a>    program.inputs <span class="op">=</span> [startval]</span>
<span id="cb52-444"><a href="#cb52-444" aria-hidden="true" tabindex="-1"></a>    painted <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb52-445"><a href="#cb52-445" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> colour, turn <span class="kw">in</span> more_itertools.chunked(program.run(), <span class="dv">2</span>):</span>
<span id="cb52-446"><a href="#cb52-446" aria-hidden="true" tabindex="-1"></a>        field[position] <span class="op">=</span> colour</span>
<span id="cb52-447"><a href="#cb52-447" aria-hidden="true" tabindex="-1"></a>        painted.add(position)</span>
<span id="cb52-448"><a href="#cb52-448" aria-hidden="true" tabindex="-1"></a>        direction <span class="op">=</span> direction <span class="op">*</span> (<span class="ot">1j</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> turn))</span>
<span id="cb52-449"><a href="#cb52-449" aria-hidden="true" tabindex="-1"></a>        position <span class="op">+=</span> direction</span>
<span id="cb52-450"><a href="#cb52-450" aria-hidden="true" tabindex="-1"></a>        program.inputs.append(field[position])</span>
<span id="cb52-451"><a href="#cb52-451" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> painted, field</span>
<span id="cb52-452"><a href="#cb52-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-453"><a href="#cb52-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-454"><a href="#cb52-454" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(solve(<span class="dv">0</span>)[<span class="dv">0</span>])</span>
<span id="cb52-455"><a href="#cb52-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-456"><a href="#cb52-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-457"><a href="#cb52-457" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-458"><a href="#cb52-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-461"><a href="#cb52-461" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-462"><a href="#cb52-462" aria-hidden="true" tabindex="-1"></a>_, field <span class="op">=</span> solve(<span class="dv">1</span>)</span>
<span id="cb52-463"><a href="#cb52-463" aria-hidden="true" tabindex="-1"></a>ones <span class="op">=</span> np.array([x <span class="cf">for</span> x <span class="kw">in</span> field.keys() <span class="cf">if</span> field[x]])</span>
<span id="cb52-464"><a href="#cb52-464" aria-hidden="true" tabindex="-1"></a>offset <span class="op">=</span> ones.real.<span class="bu">min</span>() <span class="op">+</span> <span class="ot">1j</span> <span class="op">*</span> ones.imag.<span class="bu">min</span>()</span>
<span id="cb52-465"><a href="#cb52-465" aria-hidden="true" tabindex="-1"></a>ones <span class="op">=</span> ones <span class="op">-</span> offset</span>
<span id="cb52-466"><a href="#cb52-466" aria-hidden="true" tabindex="-1"></a>field <span class="op">=</span> np.zeros((<span class="bu">int</span>(ones.real.<span class="bu">max</span>()) <span class="op">+</span> <span class="dv">1</span>, <span class="bu">int</span>(ones.imag.<span class="bu">max</span>()) <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb52-467"><a href="#cb52-467" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> value <span class="kw">in</span> ones:</span>
<span id="cb52-468"><a href="#cb52-468" aria-hidden="true" tabindex="-1"></a>    field[<span class="bu">int</span>(value.real), <span class="bu">int</span>(value.imag)] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb52-469"><a href="#cb52-469" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb52-470"><a href="#cb52-470" aria-hidden="true" tabindex="-1"></a>    <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(</span>
<span id="cb52-471"><a href="#cb52-471" aria-hidden="true" tabindex="-1"></a>        [<span class="st">""</span>.join([<span class="st">""</span> <span class="cf">if</span> char <span class="cf">else</span> <span class="st">" "</span> <span class="cf">for</span> char <span class="kw">in</span> line]) <span class="cf">for</span> line <span class="kw">in</span> np.rot90(field)]</span>
<span id="cb52-472"><a href="#cb52-472" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-473"><a href="#cb52-473" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-474"><a href="#cb52-474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-475"><a href="#cb52-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-476"><a href="#cb52-476" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 12: The N-Body Problem](https://adventofcode.com/2019/day/12)</span></span>
<span id="cb52-477"><a href="#cb52-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-478"><a href="#cb52-478" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-479"><a href="#cb52-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-482"><a href="#cb52-482" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-483"><a href="#cb52-483" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">12</span>, <span class="st">"int"</span>)</span>
<span id="cb52-484"><a href="#cb52-484" aria-hidden="true" tabindex="-1"></a>positions <span class="op">=</span> np.array(data, dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb52-485"><a href="#cb52-485" aria-hidden="true" tabindex="-1"></a>velocities <span class="op">=</span> np.zeros(positions.shape, dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb52-486"><a href="#cb52-486" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb52-487"><a href="#cb52-487" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb52-488"><a href="#cb52-488" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m1, m2 <span class="kw">in</span> itertools.combinations([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], <span class="dv">2</span>):</span>
<span id="cb52-489"><a href="#cb52-489" aria-hidden="true" tabindex="-1"></a>        dv <span class="op">=</span> <span class="dv">1</span> <span class="op">*</span> (positions[m2] <span class="op">&gt;</span> positions[m1]) <span class="op">-</span> <span class="dv">1</span> <span class="op">*</span> (positions[m2] <span class="op">&lt;</span> positions[m1])</span>
<span id="cb52-490"><a href="#cb52-490" aria-hidden="true" tabindex="-1"></a>        velocities[m1] <span class="op">+=</span> dv</span>
<span id="cb52-491"><a href="#cb52-491" aria-hidden="true" tabindex="-1"></a>        velocities[m2] <span class="op">-=</span> dv</span>
<span id="cb52-492"><a href="#cb52-492" aria-hidden="true" tabindex="-1"></a>    positions <span class="op">+=</span> velocities</span>
<span id="cb52-493"><a href="#cb52-493" aria-hidden="true" tabindex="-1"></a>(np.<span class="bu">abs</span>(positions).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>) <span class="op">*</span> np.<span class="bu">abs</span>(velocities).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)).<span class="bu">sum</span>()</span>
<span id="cb52-494"><a href="#cb52-494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-495"><a href="#cb52-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-496"><a href="#cb52-496" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-497"><a href="#cb52-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-498"><a href="#cb52-498" aria-hidden="true" tabindex="-1"></a>I don't know what optimizations are possible here, but an obvious one is to realise that the three different directions (x,y and z) are completely independent, and that instead of searching for one global cycle, we can ask if there are shorter cycles for the coordinates separately. The global cycle length is then the lcm of the individual cycle lengths, as long as each cycle starts at the initial state.</span>
<span id="cb52-499"><a href="#cb52-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-502"><a href="#cb52-502" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-503"><a href="#cb52-503" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">12</span>, <span class="st">"int"</span>)</span>
<span id="cb52-504"><a href="#cb52-504" aria-hidden="true" tabindex="-1"></a>positions <span class="op">=</span> np.array(data, dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb52-505"><a href="#cb52-505" aria-hidden="true" tabindex="-1"></a>velocities <span class="op">=</span> np.zeros(positions.shape, dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb52-506"><a href="#cb52-506" aria-hidden="true" tabindex="-1"></a>seen_x <span class="op">=</span> {}</span>
<span id="cb52-507"><a href="#cb52-507" aria-hidden="true" tabindex="-1"></a>seen_y <span class="op">=</span> {}</span>
<span id="cb52-508"><a href="#cb52-508" aria-hidden="true" tabindex="-1"></a>seen_z <span class="op">=</span> {}</span>
<span id="cb52-509"><a href="#cb52-509" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> axis, seen <span class="kw">in</span> <span class="bu">zip</span>([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>], [seen_x, seen_y, seen_z]):</span>
<span id="cb52-510"><a href="#cb52-510" aria-hidden="true" tabindex="-1"></a>    seen[<span class="bu">tuple</span>(np.hstack([positions[:, axis], velocities[:, axis]]))] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-511"><a href="#cb52-511" aria-hidden="true" tabindex="-1"></a>cycles <span class="op">=</span> [<span class="va">False</span>, <span class="va">False</span>, <span class="va">False</span>]</span>
<span id="cb52-512"><a href="#cb52-512" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1_000_000</span>):</span>
<span id="cb52-513"><a href="#cb52-513" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m1, m2 <span class="kw">in</span> itertools.combinations([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], <span class="dv">2</span>):</span>
<span id="cb52-514"><a href="#cb52-514" aria-hidden="true" tabindex="-1"></a>        dv <span class="op">=</span> <span class="dv">1</span> <span class="op">*</span> (positions[m2] <span class="op">&gt;</span> positions[m1]) <span class="op">-</span> <span class="dv">1</span> <span class="op">*</span> (positions[m2] <span class="op">&lt;</span> positions[m1])</span>
<span id="cb52-515"><a href="#cb52-515" aria-hidden="true" tabindex="-1"></a>        velocities[m1] <span class="op">+=</span> dv</span>
<span id="cb52-516"><a href="#cb52-516" aria-hidden="true" tabindex="-1"></a>        velocities[m2] <span class="op">-=</span> dv</span>
<span id="cb52-517"><a href="#cb52-517" aria-hidden="true" tabindex="-1"></a>    positions <span class="op">+=</span> velocities</span>
<span id="cb52-518"><a href="#cb52-518" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> axis, seen <span class="kw">in</span> <span class="bu">zip</span>([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>], [seen_x, seen_y, seen_z]):</span>
<span id="cb52-519"><a href="#cb52-519" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cycles[axis]:</span>
<span id="cb52-520"><a href="#cb52-520" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb52-521"><a href="#cb52-521" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> <span class="bu">tuple</span>(np.hstack([positions[:, axis], velocities[:, axis]]))</span>
<span id="cb52-522"><a href="#cb52-522" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> state <span class="kw">in</span> seen:</span>
<span id="cb52-523"><a href="#cb52-523" aria-hidden="true" tabindex="-1"></a>            cycles[axis] <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb52-524"><a href="#cb52-524" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">all</span>(cycles):</span>
<span id="cb52-525"><a href="#cb52-525" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb52-526"><a href="#cb52-526" aria-hidden="true" tabindex="-1"></a>math.lcm(<span class="op">*</span>cycles)</span>
<span id="cb52-527"><a href="#cb52-527" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-528"><a href="#cb52-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-529"><a href="#cb52-529" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 13: Care Package](https://adventofcode.com/2019/day/13)</span></span>
<span id="cb52-530"><a href="#cb52-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-531"><a href="#cb52-531" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-532"><a href="#cb52-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-535"><a href="#cb52-535" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-536"><a href="#cb52-536" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(load(<span class="dv">13</span>, <span class="st">"np"</span>))</span>
<span id="cb52-537"><a href="#cb52-537" aria-hidden="true" tabindex="-1"></a>tiles <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb52-538"><a href="#cb52-538" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, y, kind <span class="kw">in</span> more_itertools.chunked(program.run(), <span class="dv">3</span>):</span>
<span id="cb52-539"><a href="#cb52-539" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> kind <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb52-540"><a href="#cb52-540" aria-hidden="true" tabindex="-1"></a>        tiles.add((x, y))</span>
<span id="cb52-541"><a href="#cb52-541" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tiles)</span>
<span id="cb52-542"><a href="#cb52-542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-543"><a href="#cb52-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-544"><a href="#cb52-544" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-545"><a href="#cb52-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-548"><a href="#cb52-548" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-549"><a href="#cb52-549" aria-hidden="true" tabindex="-1"></a>program.<span class="bu">set</span>(<span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb52-550"><a href="#cb52-550" aria-hidden="true" tabindex="-1"></a>ball, paddle <span class="op">=</span> <span class="dv">0</span>, <span class="dv">0</span></span>
<span id="cb52-551"><a href="#cb52-551" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-552"><a href="#cb52-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-553"><a href="#cb52-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-554"><a href="#cb52-554" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ai():</span>
<span id="cb52-555"><a href="#cb52-555" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> ball</span>
<span id="cb52-556"><a href="#cb52-556" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> paddle</span>
<span id="cb52-557"><a href="#cb52-557" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (ball <span class="op">&gt;</span> paddle) <span class="op">-</span> (ball <span class="op">&lt;</span> paddle)</span>
<span id="cb52-558"><a href="#cb52-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-559"><a href="#cb52-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-560"><a href="#cb52-560" aria-hidden="true" tabindex="-1"></a>program.set_input(ai)</span>
<span id="cb52-561"><a href="#cb52-561" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> more_itertools.chunked(program.run(), <span class="dv">3</span>)</span>
<span id="cb52-562"><a href="#cb52-562" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, y, kind <span class="kw">in</span> values:</span>
<span id="cb52-563"><a href="#cb52-563" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> result <span class="cf">if</span> (x <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>) <span class="cf">else</span> kind</span>
<span id="cb52-564"><a href="#cb52-564" aria-hidden="true" tabindex="-1"></a>    paddle <span class="op">=</span> paddle <span class="cf">if</span> (kind <span class="op">!=</span> <span class="dv">3</span>) <span class="cf">else</span> x</span>
<span id="cb52-565"><a href="#cb52-565" aria-hidden="true" tabindex="-1"></a>    ball <span class="op">=</span> ball <span class="cf">if</span> (kind <span class="op">!=</span> <span class="dv">4</span>) <span class="cf">else</span> x</span>
<span id="cb52-566"><a href="#cb52-566" aria-hidden="true" tabindex="-1"></a>result</span>
<span id="cb52-567"><a href="#cb52-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-568"><a href="#cb52-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-569"><a href="#cb52-569" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 14: Space Stoichiometry](https://adventofcode.com/2019/day/14)</span></span>
<span id="cb52-570"><a href="#cb52-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-571"><a href="#cb52-571" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-572"><a href="#cb52-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-575"><a href="#cb52-575" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-576"><a href="#cb52-576" aria-hidden="true" tabindex="-1"></a>graph <span class="op">=</span> {}</span>
<span id="cb52-577"><a href="#cb52-577" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">14</span>):</span>
<span id="cb52-578"><a href="#cb52-578" aria-hidden="true" tabindex="-1"></a>    inputs, output <span class="op">=</span> line.split(<span class="st">" =&gt; "</span>)</span>
<span id="cb52-579"><a href="#cb52-579" aria-hidden="true" tabindex="-1"></a>    output_amount, output_resource <span class="op">=</span> output.split()</span>
<span id="cb52-580"><a href="#cb52-580" aria-hidden="true" tabindex="-1"></a>    output_amount <span class="op">=</span> <span class="bu">int</span>(output_amount)</span>
<span id="cb52-581"><a href="#cb52-581" aria-hidden="true" tabindex="-1"></a>    inputs <span class="op">=</span> [pair.split() <span class="cf">for</span> pair <span class="kw">in</span> inputs.split(<span class="st">", "</span>)]</span>
<span id="cb52-582"><a href="#cb52-582" aria-hidden="true" tabindex="-1"></a>    graph[output_resource] <span class="op">=</span> (</span>
<span id="cb52-583"><a href="#cb52-583" aria-hidden="true" tabindex="-1"></a>        output_amount,</span>
<span id="cb52-584"><a href="#cb52-584" aria-hidden="true" tabindex="-1"></a>        [x[<span class="dv">1</span>] <span class="cf">for</span> x <span class="kw">in</span> inputs],</span>
<span id="cb52-585"><a href="#cb52-585" aria-hidden="true" tabindex="-1"></a>        [<span class="bu">int</span>(x[<span class="dv">0</span>]) <span class="cf">for</span> x <span class="kw">in</span> inputs],</span>
<span id="cb52-586"><a href="#cb52-586" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-587"><a href="#cb52-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-588"><a href="#cb52-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-589"><a href="#cb52-589" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> topological_sort(graph):</span>
<span id="cb52-590"><a href="#cb52-590" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> graph:</span>
<span id="cb52-591"><a href="#cb52-591" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb52-592"><a href="#cb52-592" aria-hidden="true" tabindex="-1"></a>    dependencies <span class="op">=</span> functools.<span class="bu">reduce</span>(<span class="kw">lambda</span> x, y: x <span class="op">|</span> <span class="bu">set</span>(y[<span class="dv">1</span>]), graph.values(), <span class="bu">set</span>())</span>
<span id="cb52-593"><a href="#cb52-593" aria-hidden="true" tabindex="-1"></a>    ready <span class="op">=</span> []</span>
<span id="cb52-594"><a href="#cb52-594" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key <span class="kw">in</span> graph:</span>
<span id="cb52-595"><a href="#cb52-595" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> key <span class="kw">not</span> <span class="kw">in</span> dependencies:</span>
<span id="cb52-596"><a href="#cb52-596" aria-hidden="true" tabindex="-1"></a>            ready.append(key)</span>
<span id="cb52-597"><a href="#cb52-597" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> ready</span>
<span id="cb52-598"><a href="#cb52-598" aria-hidden="true" tabindex="-1"></a>    new_graph <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> graph.items() <span class="cf">if</span> k <span class="kw">not</span> <span class="kw">in</span> ready}</span>
<span id="cb52-599"><a href="#cb52-599" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ready <span class="op">+</span> topological_sort(new_graph)</span>
<span id="cb52-600"><a href="#cb52-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-601"><a href="#cb52-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-602"><a href="#cb52-602" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> part1(n):</span>
<span id="cb52-603"><a href="#cb52-603" aria-hidden="true" tabindex="-1"></a>    order <span class="op">=</span> topological_sort(graph)</span>
<span id="cb52-604"><a href="#cb52-604" aria-hidden="true" tabindex="-1"></a>    requirements <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb52-605"><a href="#cb52-605" aria-hidden="true" tabindex="-1"></a>    requirements[<span class="st">"FUEL"</span>] <span class="op">=</span> n</span>
<span id="cb52-606"><a href="#cb52-606" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> resource <span class="kw">in</span> order:</span>
<span id="cb52-607"><a href="#cb52-607" aria-hidden="true" tabindex="-1"></a>        production, kinds, amounts <span class="op">=</span> graph[resource]</span>
<span id="cb52-608"><a href="#cb52-608" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> resource <span class="kw">in</span> requirements:</span>
<span id="cb52-609"><a href="#cb52-609" aria-hidden="true" tabindex="-1"></a>            n <span class="op">=</span> <span class="bu">int</span>(np.ceil(requirements[resource] <span class="op">/</span> production))</span>
<span id="cb52-610"><a href="#cb52-610" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> kind, amount <span class="kw">in</span> <span class="bu">zip</span>(kinds, amounts):</span>
<span id="cb52-611"><a href="#cb52-611" aria-hidden="true" tabindex="-1"></a>                requirements[kind] <span class="op">+=</span> n <span class="op">*</span> amount</span>
<span id="cb52-612"><a href="#cb52-612" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> requirements[resource]</span>
<span id="cb52-613"><a href="#cb52-613" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> requirements[<span class="st">"ORE"</span>]</span>
<span id="cb52-614"><a href="#cb52-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-615"><a href="#cb52-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-616"><a href="#cb52-616" aria-hidden="true" tabindex="-1"></a>part1(<span class="dv">1</span>)</span>
<span id="cb52-617"><a href="#cb52-617" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-618"><a href="#cb52-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-619"><a href="#cb52-619" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-620"><a href="#cb52-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-621"><a href="#cb52-621" aria-hidden="true" tabindex="-1"></a>We need to somehow reverse the relationship we found above. There are probably smarter ways of doing things, but a binary search works fine:</span>
<span id="cb52-622"><a href="#cb52-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-625"><a href="#cb52-625" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-626"><a href="#cb52-626" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> <span class="dv">1_000_000_000_000</span></span>
<span id="cb52-627"><a href="#cb52-627" aria-hidden="true" tabindex="-1"></a>lower_limit <span class="op">=</span> target <span class="op">//</span> part1(<span class="dv">1</span>)</span>
<span id="cb52-628"><a href="#cb52-628" aria-hidden="true" tabindex="-1"></a>upper_limit <span class="op">=</span> lower_limit <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb52-629"><a href="#cb52-629" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> part1(upper_limit) <span class="op">&lt;</span> target:</span>
<span id="cb52-630"><a href="#cb52-630" aria-hidden="true" tabindex="-1"></a>    lower_limit <span class="op">*=</span> <span class="dv">2</span></span>
<span id="cb52-631"><a href="#cb52-631" aria-hidden="true" tabindex="-1"></a>    upper_limit <span class="op">*=</span> <span class="dv">2</span></span>
<span id="cb52-632"><a href="#cb52-632" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (upper_limit <span class="op">-</span> lower_limit) <span class="op">!=</span> <span class="dv">1</span>:</span>
<span id="cb52-633"><a href="#cb52-633" aria-hidden="true" tabindex="-1"></a>    midpoint <span class="op">=</span> <span class="bu">int</span>((upper_limit <span class="op">+</span> lower_limit) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb52-634"><a href="#cb52-634" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> part1(midpoint) <span class="op">&gt;</span> target:</span>
<span id="cb52-635"><a href="#cb52-635" aria-hidden="true" tabindex="-1"></a>        upper_limit <span class="op">=</span> midpoint</span>
<span id="cb52-636"><a href="#cb52-636" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb52-637"><a href="#cb52-637" aria-hidden="true" tabindex="-1"></a>        lower_limit <span class="op">=</span> midpoint</span>
<span id="cb52-638"><a href="#cb52-638" aria-hidden="true" tabindex="-1"></a>lower_limit</span>
<span id="cb52-639"><a href="#cb52-639" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-640"><a href="#cb52-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-641"><a href="#cb52-641" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 15: Oxygen System](https://adventofcode.com/2019/day/15)</span></span>
<span id="cb52-642"><a href="#cb52-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-643"><a href="#cb52-643" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-644"><a href="#cb52-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-645"><a href="#cb52-645" aria-hidden="true" tabindex="-1"></a>I really liked this puzzle! The approach I took is to first map out the entire area by giving the droid the necessary instructions, and then using a path finding algorithm to get from start to finish.</span>
<span id="cb52-646"><a href="#cb52-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-649"><a href="#cb52-649" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-650"><a href="#cb52-650" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(load(<span class="dv">15</span>, <span class="st">"np"</span>))</span>
<span id="cb52-651"><a href="#cb52-651" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> program.run()</span>
<span id="cb52-652"><a href="#cb52-652" aria-hidden="true" tabindex="-1"></a>directions <span class="op">=</span> {<span class="dv">1</span>: <span class="ot">1j</span>, <span class="dv">2</span>: <span class="op">-</span><span class="ot">1j</span>, <span class="dv">3</span>: <span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>: <span class="dv">1</span>}</span>
<span id="cb52-653"><a href="#cb52-653" aria-hidden="true" tabindex="-1"></a>reverse_directions <span class="op">=</span> {v: k <span class="cf">for</span> k, v <span class="kw">in</span> directions.items()}</span>
<span id="cb52-654"><a href="#cb52-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-655"><a href="#cb52-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-656"><a href="#cb52-656" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> neighbors(state, edges<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb52-657"><a href="#cb52-657" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> edges <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb52-658"><a href="#cb52-658" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb52-659"><a href="#cb52-659" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [state <span class="op">+</span> directions[neighbor] <span class="cf">for</span> neighbor <span class="kw">in</span> edges[state]]</span>
<span id="cb52-660"><a href="#cb52-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-661"><a href="#cb52-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-662"><a href="#cb52-662" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update(steps, state, neighbor):</span>
<span id="cb52-663"><a href="#cb52-663" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> steps <span class="op">+</span> [reverse_directions[neighbor <span class="op">-</span> state]]</span>
<span id="cb52-664"><a href="#cb52-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-665"><a href="#cb52-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-666"><a href="#cb52-666" aria-hidden="true" tabindex="-1"></a>queue <span class="op">=</span> deque([(<span class="dv">0</span>, <span class="dv">0</span>)])</span>
<span id="cb52-667"><a href="#cb52-667" aria-hidden="true" tabindex="-1"></a>old_position <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-668"><a href="#cb52-668" aria-hidden="true" tabindex="-1"></a>visited <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb52-669"><a href="#cb52-669" aria-hidden="true" tabindex="-1"></a>edges <span class="op">=</span> defaultdict(<span class="bu">set</span>)</span>
<span id="cb52-670"><a href="#cb52-670" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-671"><a href="#cb52-671" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> queue:</span>
<span id="cb52-672"><a href="#cb52-672" aria-hidden="true" tabindex="-1"></a>    i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb52-673"><a href="#cb52-673" aria-hidden="true" tabindex="-1"></a>    steps, position <span class="op">=</span> queue.popleft()</span>
<span id="cb52-674"><a href="#cb52-674" aria-hidden="true" tabindex="-1"></a>    visited.add(position)</span>
<span id="cb52-675"><a href="#cb52-675" aria-hidden="true" tabindex="-1"></a>    instructions <span class="op">=</span> utils.bfs(old_position, position, neighbors, [], update, edges<span class="op">=</span>edges)</span>
<span id="cb52-676"><a href="#cb52-676" aria-hidden="true" tabindex="-1"></a>    program.set_input(instructions)</span>
<span id="cb52-677"><a href="#cb52-677" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> program.state <span class="op">!=</span> <span class="dv">1</span>:</span>
<span id="cb52-678"><a href="#cb52-678" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=</span> <span class="bu">next</span>(f)</span>
<span id="cb52-679"><a href="#cb52-679" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> direction <span class="kw">in</span> directions:</span>
<span id="cb52-680"><a href="#cb52-680" aria-hidden="true" tabindex="-1"></a>        new_position <span class="op">=</span> position <span class="op">+</span> directions[direction]</span>
<span id="cb52-681"><a href="#cb52-681" aria-hidden="true" tabindex="-1"></a>        opposite_direction <span class="op">=</span> direction <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> (direction <span class="op">%</span> <span class="dv">2</span>) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb52-682"><a href="#cb52-682" aria-hidden="true" tabindex="-1"></a>        program.set_input([direction])</span>
<span id="cb52-683"><a href="#cb52-683" aria-hidden="true" tabindex="-1"></a>        val <span class="op">=</span> <span class="bu">next</span>(f)</span>
<span id="cb52-684"><a href="#cb52-684" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> val <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb52-685"><a href="#cb52-685" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb52-686"><a href="#cb52-686" aria-hidden="true" tabindex="-1"></a>        program.set_input([opposite_direction])</span>
<span id="cb52-687"><a href="#cb52-687" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=</span> <span class="bu">next</span>(f)</span>
<span id="cb52-688"><a href="#cb52-688" aria-hidden="true" tabindex="-1"></a>        edges[position].add(direction)</span>
<span id="cb52-689"><a href="#cb52-689" aria-hidden="true" tabindex="-1"></a>        edges[new_position].add(opposite_direction)</span>
<span id="cb52-690"><a href="#cb52-690" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> val <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb52-691"><a href="#cb52-691" aria-hidden="true" tabindex="-1"></a>            target <span class="op">=</span> new_position</span>
<span id="cb52-692"><a href="#cb52-692" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> new_position <span class="kw">not</span> <span class="kw">in</span> visited:</span>
<span id="cb52-693"><a href="#cb52-693" aria-hidden="true" tabindex="-1"></a>            <span class="co"># append left to make it a dfs, so that the droid doesn't have to</span></span>
<span id="cb52-694"><a href="#cb52-694" aria-hidden="true" tabindex="-1"></a>            <span class="co"># run from one side of the board to the other all the time</span></span>
<span id="cb52-695"><a href="#cb52-695" aria-hidden="true" tabindex="-1"></a>            queue.appendleft((steps <span class="op">+</span> <span class="dv">1</span>, new_position))</span>
<span id="cb52-696"><a href="#cb52-696" aria-hidden="true" tabindex="-1"></a>    old_position <span class="op">=</span> position</span>
<span id="cb52-697"><a href="#cb52-697" aria-hidden="true" tabindex="-1"></a>utils.bfs(<span class="dv">0</span>, target, neighbors, edges<span class="op">=</span>edges)</span>
<span id="cb52-698"><a href="#cb52-698" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-699"><a href="#cb52-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-700"><a href="#cb52-700" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-701"><a href="#cb52-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-702"><a href="#cb52-702" aria-hidden="true" tabindex="-1"></a>We mapped out the whole area for part 1, so part 2 is just a bfs with no stopping condition</span>
<span id="cb52-703"><a href="#cb52-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-706"><a href="#cb52-706" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-707"><a href="#cb52-707" aria-hidden="true" tabindex="-1"></a>utils.bfs(target, <span class="va">None</span>, neighbors, edges<span class="op">=</span>edges)</span>
<span id="cb52-708"><a href="#cb52-708" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-709"><a href="#cb52-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-710"><a href="#cb52-710" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 16: Flawed Frequency Transmission](https://adventofcode.com/2019/day/16)</span></span>
<span id="cb52-711"><a href="#cb52-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-712"><a href="#cb52-712" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-713"><a href="#cb52-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-714"><a href="#cb52-714" aria-hidden="true" tabindex="-1"></a>For the first part all the numbers are small, so we don't need to be particularly clever</span>
<span id="cb52-715"><a href="#cb52-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-718"><a href="#cb52-718" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-719"><a href="#cb52-719" aria-hidden="true" tabindex="-1"></a>initial_data <span class="op">=</span> [<span class="bu">int</span>(x) <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">16</span>)[<span class="dv">0</span>]]</span>
<span id="cb52-720"><a href="#cb52-720" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> initial_data.copy()</span>
<span id="cb52-721"><a href="#cb52-721" aria-hidden="true" tabindex="-1"></a>base_pattern <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb52-722"><a href="#cb52-722" aria-hidden="true" tabindex="-1"></a>factors <span class="op">=</span> []</span>
<span id="cb52-723"><a href="#cb52-723" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(data) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb52-724"><a href="#cb52-724" aria-hidden="true" tabindex="-1"></a>    pattern <span class="op">=</span> base_pattern.repeat(i)</span>
<span id="cb52-725"><a href="#cb52-725" aria-hidden="true" tabindex="-1"></a>    repeats <span class="op">=</span> <span class="bu">int</span>(np.ceil((<span class="bu">len</span>(data) <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> <span class="bu">len</span>(pattern)))</span>
<span id="cb52-726"><a href="#cb52-726" aria-hidden="true" tabindex="-1"></a>    factors.append(np.tile(pattern, repeats)[<span class="dv">1</span> : <span class="bu">len</span>(data) <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb52-727"><a href="#cb52-727" aria-hidden="true" tabindex="-1"></a>factors <span class="op">=</span> np.array(factors)</span>
<span id="cb52-728"><a href="#cb52-728" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb52-729"><a href="#cb52-729" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> <span class="bu">abs</span>(factors <span class="op">@</span> data) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb52-730"><a href="#cb52-730" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>data[:<span class="dv">8</span>], sep<span class="op">=</span><span class="st">""</span>, end<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb52-731"><a href="#cb52-731" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-732"><a href="#cb52-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-733"><a href="#cb52-733" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-734"><a href="#cb52-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-735"><a href="#cb52-735" aria-hidden="true" tabindex="-1"></a>For part 2, the numbers get so big that this approach is impossible (just the transition matrix has $\textrm{len(data)}^2 \times10^8$ elements, so that's not going to work).</span>
<span id="cb52-736"><a href="#cb52-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-737"><a href="#cb52-737" aria-hidden="true" tabindex="-1"></a>The first optimization we can make is to realise that calculating the $k$-th from last digit of the output only requires knowledge of the last $k$ digits of the input. So the last digit is always unchanged, the last-but-one digit is always the sum of the previous last two digits etc.</span>
<span id="cb52-738"><a href="#cb52-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-739"><a href="#cb52-739" aria-hidden="true" tabindex="-1"></a>In fact, we can explicitly solve this reccurrence for the second half of the input data, and looking at the data provided, that's where the relevant digits are located! Denoting the $k$-th digit from the end after the $n$-th iteration as $d_k^n$, we can verify that</span>
<span id="cb52-740"><a href="#cb52-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-741"><a href="#cb52-741" aria-hidden="true" tabindex="-1"></a><span class="in">```{=latex}</span></span>
<span id="cb52-742"><a href="#cb52-742" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align*}</span></span>
<span id="cb52-743"><a href="#cb52-743" aria-hidden="true" tabindex="-1"></a><span class="in">d^n_0 &amp;= d^{n-1}_0 = \ldots = d^0_0 \\</span></span>
<span id="cb52-744"><a href="#cb52-744" aria-hidden="true" tabindex="-1"></a><span class="in">d^n_1 &amp;= d^{n-1}_1 + (d^{n-1}_0) = d^0_1 + nd^0_0 \\</span></span>
<span id="cb52-745"><a href="#cb52-745" aria-hidden="true" tabindex="-1"></a><span class="in">d^n_2 &amp;= d^{n-1}_2 + (d^{n-1}_1 + d^{n-1}_0) = d^0_2 + nd^0_1 + \frac12n(n+1)d^0_0 \\</span></span>
<span id="cb52-746"><a href="#cb52-746" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align*}</span></span>
<span id="cb52-747"><a href="#cb52-747" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-748"><a href="#cb52-748" aria-hidden="true" tabindex="-1"></a>Explicitly solving the recurrences for all the digits in the second half is certainly possible, but it's going to be very tedious. Instead, we can notice that the middle expression is always $d^{n-1}_k + d^n_{k -1}$ . That means that to calculate $d^{100}_k$ we only need to know $d^0_k$ and $d^1_{k-1},  d^2_{k-1}, \ldots, d^{100}_{k-1}$, which translates to the following short routine:</span>
<span id="cb52-749"><a href="#cb52-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-752"><a href="#cb52-752" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-753"><a href="#cb52-753" aria-hidden="true" tabindex="-1"></a>active <span class="op">=</span> <span class="dv">101</span> <span class="op">*</span> [<span class="dv">0</span>]</span>
<span id="cb52-754"><a href="#cb52-754" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb52-755"><a href="#cb52-755" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> functools.<span class="bu">reduce</span>(<span class="kw">lambda</span> x, y: <span class="dv">10</span> <span class="op">*</span> x <span class="op">+</span> y, initial_data[:<span class="dv">7</span>])</span>
<span id="cb52-756"><a href="#cb52-756" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.tile(initial_data, <span class="dv">10_000</span>)</span>
<span id="cb52-757"><a href="#cb52-757" aria-hidden="true" tabindex="-1"></a>counter_index <span class="op">=</span> <span class="bu">len</span>(data) <span class="op">-</span> index</span>
<span id="cb52-758"><a href="#cb52-758" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(counter_index):</span>
<span id="cb52-759"><a href="#cb52-759" aria-hidden="true" tabindex="-1"></a>    active[<span class="dv">0</span>] <span class="op">=</span> data[<span class="op">-</span><span class="dv">1</span> <span class="op">-</span> i]</span>
<span id="cb52-760"><a href="#cb52-760" aria-hidden="true" tabindex="-1"></a>    active <span class="op">=</span> np.cumsum(active) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb52-761"><a href="#cb52-761" aria-hidden="true" tabindex="-1"></a>    results.append(active[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb52-762"><a href="#cb52-762" aria-hidden="true" tabindex="-1"></a>functools.<span class="bu">reduce</span>(<span class="kw">lambda</span> x, y: <span class="dv">10</span> <span class="op">*</span> x <span class="op">+</span> y, results[::<span class="op">-</span><span class="dv">1</span>][:<span class="dv">8</span>])</span>
<span id="cb52-763"><a href="#cb52-763" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-764"><a href="#cb52-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-765"><a href="#cb52-765" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 17: Set and Forget](https://adventofcode.com/2019/day/17)</span></span>
<span id="cb52-766"><a href="#cb52-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-767"><a href="#cb52-767" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-768"><a href="#cb52-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-771"><a href="#cb52-771" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-772"><a href="#cb52-772" aria-hidden="true" tabindex="-1"></a>opcodes <span class="op">=</span> load(<span class="dv">17</span>, <span class="st">"np"</span>)</span>
<span id="cb52-773"><a href="#cb52-773" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(opcodes)</span>
<span id="cb52-774"><a href="#cb52-774" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="st">""</span>.join(<span class="bu">chr</span>(val) <span class="cf">for</span> val <span class="kw">in</span> program.run()).split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)[:<span class="op">-</span><span class="dv">2</span>]</span>
<span id="cb52-775"><a href="#cb52-775" aria-hidden="true" tabindex="-1"></a>board <span class="op">=</span> np.array([[<span class="dv">1</span> <span class="cf">if</span> char <span class="op">==</span> <span class="st">"#"</span> <span class="cf">else</span> <span class="dv">0</span> <span class="cf">for</span> char <span class="kw">in</span> line] <span class="cf">for</span> line <span class="kw">in</span> data])</span>
<span id="cb52-776"><a href="#cb52-776" aria-hidden="true" tabindex="-1"></a>neighbors <span class="op">=</span> [[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>]]</span>
<span id="cb52-777"><a href="#cb52-777" aria-hidden="true" tabindex="-1"></a>intersections <span class="op">=</span> np.where(</span>
<span id="cb52-778"><a href="#cb52-778" aria-hidden="true" tabindex="-1"></a>    (scipy.ndimage.convolve(board, neighbors, mode<span class="op">=</span><span class="st">"constant"</span>) <span class="op">&gt;</span> <span class="dv">2</span>) <span class="op">&amp;</span> board</span>
<span id="cb52-779"><a href="#cb52-779" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-780"><a href="#cb52-780" aria-hidden="true" tabindex="-1"></a>np.product(intersections, axis<span class="op">=</span><span class="dv">0</span>).<span class="bu">sum</span>()</span>
<span id="cb52-781"><a href="#cb52-781" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-782"><a href="#cb52-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-783"><a href="#cb52-783" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-784"><a href="#cb52-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-785"><a href="#cb52-785" aria-hidden="true" tabindex="-1"></a>For this one I solved the path by hand, and then ran the input through the black box program to get the actual output.</span>
<span id="cb52-786"><a href="#cb52-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-789"><a href="#cb52-789" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-790"><a href="#cb52-790" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> <span class="st">"R,6,L,12,R,6"</span></span>
<span id="cb52-791"><a href="#cb52-791" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> <span class="st">"L,12,R,6,L,8,L,12"</span></span>
<span id="cb52-792"><a href="#cb52-792" aria-hidden="true" tabindex="-1"></a>C <span class="op">=</span> <span class="st">"R,12,L,10,L,10"</span></span>
<span id="cb52-793"><a href="#cb52-793" aria-hidden="true" tabindex="-1"></a>main <span class="op">=</span> <span class="st">"A,A,B,C,B,C,B,C,B,A"</span></span>
<span id="cb52-794"><a href="#cb52-794" aria-hidden="true" tabindex="-1"></a>show_output <span class="op">=</span> <span class="st">"n</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb52-795"><a href="#cb52-795" aria-hidden="true" tabindex="-1"></a>program_input <span class="op">=</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(x <span class="cf">for</span> x <span class="kw">in</span> [main, A, B, C, show_output])</span>
<span id="cb52-796"><a href="#cb52-796" aria-hidden="true" tabindex="-1"></a>encoded_input <span class="op">=</span> [<span class="bu">ord</span>(x) <span class="cf">for</span> x <span class="kw">in</span> program_input]</span>
<span id="cb52-797"><a href="#cb52-797" aria-hidden="true" tabindex="-1"></a>program.<span class="bu">set</span>(<span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb52-798"><a href="#cb52-798" aria-hidden="true" tabindex="-1"></a>program.set_input(encoded_input)</span>
<span id="cb52-799"><a href="#cb52-799" aria-hidden="true" tabindex="-1"></a>[x <span class="cf">for</span> x <span class="kw">in</span> program.run()][<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb52-800"><a href="#cb52-800" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-801"><a href="#cb52-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-802"><a href="#cb52-802" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 18: Many-Worlds Interpretation](https://adventofcode.com/2019/day/18)</span></span>
<span id="cb52-803"><a href="#cb52-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-804"><a href="#cb52-804" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-805"><a href="#cb52-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-806"><a href="#cb52-806" aria-hidden="true" tabindex="-1"></a>The maze we are looking at is fairly large, but it only has a few interesting points. Most of the maze is corridors of width 1; and on these stretches there are no choices about where to go, since backtracking is not an option. Instead of working with the grid we are given, we can extract the points of interest, and store the distance from each point to its neighbors.</span>
<span id="cb52-807"><a href="#cb52-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-808"><a href="#cb52-808" aria-hidden="true" tabindex="-1"></a>The points of interest are:</span>
<span id="cb52-809"><a href="#cb52-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-810"><a href="#cb52-810" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Keys</span>
<span id="cb52-811"><a href="#cb52-811" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Doors</span>
<span id="cb52-812"><a href="#cb52-812" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Junctions</span>
<span id="cb52-813"><a href="#cb52-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-814"><a href="#cb52-814" aria-hidden="true" tabindex="-1"></a>The numbers here are barely small enough that the straightforward approach works: A BFS with a different visited list for each possible set of collected keys. To slightly improve the runtime, we'll start by eliminating dead ends so the BFS never has to consider them.</span>
<span id="cb52-815"><a href="#cb52-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-818"><a href="#cb52-818" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-819"><a href="#cb52-819" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.array([[<span class="bu">ord</span>(c) <span class="cf">for</span> c <span class="kw">in</span> line] <span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">18</span>)])</span>
<span id="cb52-820"><a href="#cb52-820" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> np.where(data <span class="op">==</span> <span class="bu">ord</span>(<span class="st">"@"</span>))</span>
<span id="cb52-821"><a href="#cb52-821" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(<span class="op">*</span>indices))[<span class="dv">0</span>]</span>
<span id="cb52-822"><a href="#cb52-822" aria-hidden="true" tabindex="-1"></a>wall <span class="op">=</span> <span class="bu">ord</span>(<span class="st">"#"</span>)</span>
<span id="cb52-823"><a href="#cb52-823" aria-hidden="true" tabindex="-1"></a>free <span class="op">=</span> <span class="bu">ord</span>(<span class="st">"."</span>)</span>
<span id="cb52-824"><a href="#cb52-824" aria-hidden="true" tabindex="-1"></a>data[indices] <span class="op">=</span> free</span>
<span id="cb52-825"><a href="#cb52-825" aria-hidden="true" tabindex="-1"></a>window <span class="op">=</span> [[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>]]</span>
<span id="cb52-826"><a href="#cb52-826" aria-hidden="true" tabindex="-1"></a>walls <span class="op">=</span> (data <span class="op">==</span> wall) <span class="op">*</span> <span class="dv">1</span></span>
<span id="cb52-827"><a href="#cb52-827" aria-hidden="true" tabindex="-1"></a>walls</span>
<span id="cb52-828"><a href="#cb52-828" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb52-829"><a href="#cb52-829" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> s <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb52-830"><a href="#cb52-830" aria-hidden="true" tabindex="-1"></a>    walls <span class="op">=</span> (data <span class="op">==</span> wall) <span class="op">*</span> <span class="dv">1</span></span>
<span id="cb52-831"><a href="#cb52-831" aria-hidden="true" tabindex="-1"></a>    dead_ends <span class="op">=</span> (scipy.ndimage.convolve(walls, window, mode<span class="op">=</span><span class="st">"constant"</span>) <span class="op">&gt;</span> <span class="dv">2</span>) <span class="op">&amp;</span> (</span>
<span id="cb52-832"><a href="#cb52-832" aria-hidden="true" tabindex="-1"></a>        (data <span class="op">==</span> free) <span class="op">|</span> ((data <span class="op">&gt;=</span> <span class="bu">ord</span>(<span class="st">"A"</span>)) <span class="op">&amp;</span> (data <span class="op">&lt;=</span> <span class="bu">ord</span>(<span class="st">"Z"</span>)))</span>
<span id="cb52-833"><a href="#cb52-833" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-834"><a href="#cb52-834" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> dead_ends.<span class="bu">sum</span>()</span>
<span id="cb52-835"><a href="#cb52-835" aria-hidden="true" tabindex="-1"></a>    data[dead_ends] <span class="op">=</span> wall</span>
<span id="cb52-836"><a href="#cb52-836" aria-hidden="true" tabindex="-1"></a>nw <span class="op">=</span> <span class="dv">1</span> <span class="op">*</span> (data <span class="op">!=</span> wall)</span>
<span id="cb52-837"><a href="#cb52-837" aria-hidden="true" tabindex="-1"></a>junctions <span class="op">=</span> (scipy.ndimage.convolve(nw, window, mode<span class="op">=</span><span class="st">"constant"</span>) <span class="op">&gt;</span> <span class="dv">2</span>) <span class="op">&amp;</span> nw</span>
<span id="cb52-838"><a href="#cb52-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-839"><a href="#cb52-839" aria-hidden="true" tabindex="-1"></a>data[np.where(junctions)] <span class="op">=</span> <span class="bu">ord</span>(<span class="st">"9"</span>)</span>
<span id="cb52-840"><a href="#cb52-840" aria-hidden="true" tabindex="-1"></a>queue <span class="op">=</span> deque()</span>
<span id="cb52-841"><a href="#cb52-841" aria-hidden="true" tabindex="-1"></a>connections <span class="op">=</span> defaultdict(<span class="bu">dict</span>)</span>
<span id="cb52-842"><a href="#cb52-842" aria-hidden="true" tabindex="-1"></a>painted <span class="op">=</span> {}</span>
<span id="cb52-843"><a href="#cb52-843" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> data.shape[<span class="dv">1</span>]</span>
<span id="cb52-844"><a href="#cb52-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-845"><a href="#cb52-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-846"><a href="#cb52-846" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> label(position):</span>
<span id="cb52-847"><a href="#cb52-847" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data[position] <span class="op">==</span> <span class="bu">ord</span>(<span class="st">"9"</span>):</span>
<span id="cb52-848"><a href="#cb52-848" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">str</span>(position[<span class="dv">0</span>] <span class="op">*</span> width <span class="op">+</span> position[<span class="dv">1</span>])</span>
<span id="cb52-849"><a href="#cb52-849" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb52-850"><a href="#cb52-850" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">chr</span>(data[position])</span>
<span id="cb52-851"><a href="#cb52-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-852"><a href="#cb52-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-853"><a href="#cb52-853" aria-hidden="true" tabindex="-1"></a><span class="co"># print(*["".join(chr(x) for x in line) for line in data], sep="\n")</span></span>
<span id="cb52-854"><a href="#cb52-854" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> start <span class="kw">in</span> <span class="bu">list</span>(<span class="bu">zip</span>(<span class="op">*</span>np.where(data <span class="op">&gt;</span> <span class="bu">max</span>(free, wall)))):</span>
<span id="cb52-855"><a href="#cb52-855" aria-hidden="true" tabindex="-1"></a>    queue.append((<span class="dv">0</span>, start, start))</span>
<span id="cb52-856"><a href="#cb52-856" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> queue:</span>
<span id="cb52-857"><a href="#cb52-857" aria-hidden="true" tabindex="-1"></a>    steps, position, origin <span class="op">=</span> queue.popleft()</span>
<span id="cb52-858"><a href="#cb52-858" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> position <span class="kw">in</span> painted:</span>
<span id="cb52-859"><a href="#cb52-859" aria-hidden="true" tabindex="-1"></a>        other, other_steps <span class="op">=</span> painted[position]</span>
<span id="cb52-860"><a href="#cb52-860" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> other <span class="op">!=</span> origin:</span>
<span id="cb52-861"><a href="#cb52-861" aria-hidden="true" tabindex="-1"></a>            s <span class="op">=</span> steps <span class="op">+</span> other_steps</span>
<span id="cb52-862"><a href="#cb52-862" aria-hidden="true" tabindex="-1"></a>            connections[label(other)][label(origin)] <span class="op">=</span> s</span>
<span id="cb52-863"><a href="#cb52-863" aria-hidden="true" tabindex="-1"></a>            connections[label(origin)][label(other)] <span class="op">=</span> s</span>
<span id="cb52-864"><a href="#cb52-864" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb52-865"><a href="#cb52-865" aria-hidden="true" tabindex="-1"></a>    painted[position] <span class="op">=</span> origin, steps</span>
<span id="cb52-866"><a href="#cb52-866" aria-hidden="true" tabindex="-1"></a>    y, x <span class="op">=</span> position</span>
<span id="cb52-867"><a href="#cb52-867" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> neighbor <span class="kw">in</span> [(y <span class="op">-</span> <span class="dv">1</span>, x), (y, x <span class="op">-</span> <span class="dv">1</span>), (y, x <span class="op">+</span> <span class="dv">1</span>), (y <span class="op">+</span> <span class="dv">1</span>, x)]:</span>
<span id="cb52-868"><a href="#cb52-868" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> data[neighbor] <span class="op">==</span> wall:</span>
<span id="cb52-869"><a href="#cb52-869" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb52-870"><a href="#cb52-870" aria-hidden="true" tabindex="-1"></a>        queue.append((steps <span class="op">+</span> <span class="dv">1</span>, neighbor, origin))</span>
<span id="cb52-871"><a href="#cb52-871" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="bu">frozenset</span>()</span>
<span id="cb52-872"><a href="#cb52-872" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> <span class="dv">0</span>, label((<span class="dv">40</span>, <span class="dv">40</span>)), state</span>
<span id="cb52-873"><a href="#cb52-873" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> PriorityQueue()</span>
<span id="cb52-874"><a href="#cb52-874" aria-hidden="true" tabindex="-1"></a>q.put(start)</span>
<span id="cb52-875"><a href="#cb52-875" aria-hidden="true" tabindex="-1"></a>visited <span class="op">=</span> defaultdict(<span class="bu">set</span>)</span>
<span id="cb52-876"><a href="#cb52-876" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> q.qsize() <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb52-877"><a href="#cb52-877" aria-hidden="true" tabindex="-1"></a>    steps, l, state <span class="op">=</span> q.get()</span>
<span id="cb52-878"><a href="#cb52-878" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(state) <span class="op">==</span> <span class="dv">26</span>:</span>
<span id="cb52-879"><a href="#cb52-879" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb52-880"><a href="#cb52-880" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> l <span class="kw">in</span> visited[state]:</span>
<span id="cb52-881"><a href="#cb52-881" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb52-882"><a href="#cb52-882" aria-hidden="true" tabindex="-1"></a>    visited[state].add(l)</span>
<span id="cb52-883"><a href="#cb52-883" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> neighbor <span class="kw">in</span> connections[l]:</span>
<span id="cb52-884"><a href="#cb52-884" aria-hidden="true" tabindex="-1"></a>        new_state <span class="op">=</span> state.copy()</span>
<span id="cb52-885"><a href="#cb52-885" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> neighbor <span class="kw">in</span> visited[state]:</span>
<span id="cb52-886"><a href="#cb52-886" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb52-887"><a href="#cb52-887" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">"A"</span> <span class="op">&lt;=</span> neighbor <span class="op">&lt;=</span> <span class="st">"Z"</span> <span class="kw">and</span> neighbor.lower() <span class="kw">not</span> <span class="kw">in</span> state:</span>
<span id="cb52-888"><a href="#cb52-888" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb52-889"><a href="#cb52-889" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">"a"</span> <span class="op">&lt;=</span> neighbor <span class="op">&lt;=</span> <span class="st">"z"</span>:</span>
<span id="cb52-890"><a href="#cb52-890" aria-hidden="true" tabindex="-1"></a>            new_state <span class="op">=</span> state <span class="op">|</span> <span class="bu">frozenset</span>(neighbor)</span>
<span id="cb52-891"><a href="#cb52-891" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> steps <span class="op">+</span> connections[l][neighbor]</span>
<span id="cb52-892"><a href="#cb52-892" aria-hidden="true" tabindex="-1"></a>        q.put((s, neighbor, new_state))</span>
<span id="cb52-893"><a href="#cb52-893" aria-hidden="true" tabindex="-1"></a>steps</span>
<span id="cb52-894"><a href="#cb52-894" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-895"><a href="#cb52-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-896"><a href="#cb52-896" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-897"><a href="#cb52-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-898"><a href="#cb52-898" aria-hidden="true" tabindex="-1"></a>For part 2 we need to keep track of four different robots, which increases the number of neighbors available at each stage. However, direct inspection of the graph of the problem for this specific input reveals that the robots are never waiting for each other, so the shortest amount of steps is just the sum of the individual shortest steps to clear each subgraph. It feels a bit cheesy to completely ignore the doors in the puzzle, but it works here.</span>
<span id="cb52-899"><a href="#cb52-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-902"><a href="#cb52-902" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-903"><a href="#cb52-903" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">40</span></span>
<span id="cb52-904"><a href="#cb52-904" aria-hidden="true" tabindex="-1"></a>starts <span class="op">=</span> [(x <span class="op">-</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span>), (x <span class="op">-</span> <span class="dv">1</span>, x <span class="op">+</span> <span class="dv">1</span>), (x <span class="op">+</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span>), (x <span class="op">+</span> <span class="dv">1</span>, x <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb52-905"><a href="#cb52-905" aria-hidden="true" tabindex="-1"></a>dead_positions <span class="op">=</span> [(x <span class="op">-</span> <span class="dv">1</span>, x), (x, x <span class="op">-</span> <span class="dv">1</span>), (x, x), (x, x <span class="op">+</span> <span class="dv">1</span>), (x <span class="op">+</span> <span class="dv">1</span>, x)]</span>
<span id="cb52-906"><a href="#cb52-906" aria-hidden="true" tabindex="-1"></a>dead_labels <span class="op">=</span> [label(_) <span class="cf">for</span> _ <span class="kw">in</span> dead_positions]</span>
<span id="cb52-907"><a href="#cb52-907" aria-hidden="true" tabindex="-1"></a>part2 <span class="op">=</span> {</span>
<span id="cb52-908"><a href="#cb52-908" aria-hidden="true" tabindex="-1"></a>    k: {p: q <span class="cf">for</span> p, q <span class="kw">in</span> v.items() <span class="cf">if</span> p <span class="kw">not</span> <span class="kw">in</span> dead_labels}</span>
<span id="cb52-909"><a href="#cb52-909" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k, v <span class="kw">in</span> connections.items()</span>
<span id="cb52-910"><a href="#cb52-910" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> k <span class="kw">not</span> <span class="kw">in</span> dead_labels</span>
<span id="cb52-911"><a href="#cb52-911" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-912"><a href="#cb52-912" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-913"><a href="#cb52-913" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> start <span class="kw">in</span> <span class="bu">map</span>(label, starts):</span>
<span id="cb52-914"><a href="#cb52-914" aria-hidden="true" tabindex="-1"></a>    nodes <span class="op">=</span> deque([start])</span>
<span id="cb52-915"><a href="#cb52-915" aria-hidden="true" tabindex="-1"></a>    seen <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb52-916"><a href="#cb52-916" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> nodes:</span>
<span id="cb52-917"><a href="#cb52-917" aria-hidden="true" tabindex="-1"></a>        current <span class="op">=</span> nodes.popleft()</span>
<span id="cb52-918"><a href="#cb52-918" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> current <span class="kw">in</span> seen:</span>
<span id="cb52-919"><a href="#cb52-919" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb52-920"><a href="#cb52-920" aria-hidden="true" tabindex="-1"></a>        seen.add(current)</span>
<span id="cb52-921"><a href="#cb52-921" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> neighbor <span class="kw">in</span> part2[current]:</span>
<span id="cb52-922"><a href="#cb52-922" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> neighbor <span class="kw">not</span> <span class="kw">in</span> seen:</span>
<span id="cb52-923"><a href="#cb52-923" aria-hidden="true" tabindex="-1"></a>                nodes.append(neighbor)</span>
<span id="cb52-924"><a href="#cb52-924" aria-hidden="true" tabindex="-1"></a>    targets <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> seen <span class="cf">if</span> <span class="st">"a"</span> <span class="op">&lt;=</span> x <span class="op">&lt;=</span> <span class="st">"z"</span>]</span>
<span id="cb52-925"><a href="#cb52-925" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> <span class="bu">frozenset</span>()</span>
<span id="cb52-926"><a href="#cb52-926" aria-hidden="true" tabindex="-1"></a>    q <span class="op">=</span> PriorityQueue()</span>
<span id="cb52-927"><a href="#cb52-927" aria-hidden="true" tabindex="-1"></a>    q.put((<span class="dv">0</span>, start, state))</span>
<span id="cb52-928"><a href="#cb52-928" aria-hidden="true" tabindex="-1"></a>    visited <span class="op">=</span> defaultdict(<span class="bu">set</span>)</span>
<span id="cb52-929"><a href="#cb52-929" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> q.qsize() <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb52-930"><a href="#cb52-930" aria-hidden="true" tabindex="-1"></a>        steps, position, state <span class="op">=</span> q.get()</span>
<span id="cb52-931"><a href="#cb52-931" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(state) <span class="op">==</span> <span class="bu">len</span>(targets):</span>
<span id="cb52-932"><a href="#cb52-932" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb52-933"><a href="#cb52-933" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> position <span class="kw">in</span> visited[state]:</span>
<span id="cb52-934"><a href="#cb52-934" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb52-935"><a href="#cb52-935" aria-hidden="true" tabindex="-1"></a>        visited[state].add(position)</span>
<span id="cb52-936"><a href="#cb52-936" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> neighbor <span class="kw">in</span> part2[position]:</span>
<span id="cb52-937"><a href="#cb52-937" aria-hidden="true" tabindex="-1"></a>            new_state <span class="op">=</span> state.copy()</span>
<span id="cb52-938"><a href="#cb52-938" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> neighbor <span class="kw">in</span> visited[state]:</span>
<span id="cb52-939"><a href="#cb52-939" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb52-940"><a href="#cb52-940" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> neighbor <span class="kw">in</span> targets:</span>
<span id="cb52-941"><a href="#cb52-941" aria-hidden="true" tabindex="-1"></a>                new_state <span class="op">=</span> state <span class="op">|</span> <span class="bu">frozenset</span>(neighbor)</span>
<span id="cb52-942"><a href="#cb52-942" aria-hidden="true" tabindex="-1"></a>            q.put((steps <span class="op">+</span> part2[position][neighbor], neighbor, new_state))</span>
<span id="cb52-943"><a href="#cb52-943" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> steps</span>
<span id="cb52-944"><a href="#cb52-944" aria-hidden="true" tabindex="-1"></a>total</span>
<span id="cb52-945"><a href="#cb52-945" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-946"><a href="#cb52-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-947"><a href="#cb52-947" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 19: Tractor Beam](https://adventofcode.com/2019/day/19)</span></span>
<span id="cb52-948"><a href="#cb52-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-949"><a href="#cb52-949" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-950"><a href="#cb52-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-953"><a href="#cb52-953" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-954"><a href="#cb52-954" aria-hidden="true" tabindex="-1"></a>opcodes <span class="op">=</span> load(<span class="dv">19</span>, <span class="st">"np"</span>)</span>
<span id="cb52-955"><a href="#cb52-955" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(opcodes)</span>
<span id="cb52-956"><a href="#cb52-956" aria-hidden="true" tabindex="-1"></a>inputs <span class="op">=</span> []</span>
<span id="cb52-957"><a href="#cb52-957" aria-hidden="true" tabindex="-1"></a>program.set_input(inputs)</span>
<span id="cb52-958"><a href="#cb52-958" aria-hidden="true" tabindex="-1"></a>size <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb52-959"><a href="#cb52-959" aria-hidden="true" tabindex="-1"></a>board <span class="op">=</span> np.zeros((size, size), dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb52-960"><a href="#cb52-960" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(size):</span>
<span id="cb52-961"><a href="#cb52-961" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(size):</span>
<span id="cb52-962"><a href="#cb52-962" aria-hidden="true" tabindex="-1"></a>        program.reset()</span>
<span id="cb52-963"><a href="#cb52-963" aria-hidden="true" tabindex="-1"></a>        inputs <span class="op">+=</span> [j, i]</span>
<span id="cb52-964"><a href="#cb52-964" aria-hidden="true" tabindex="-1"></a>        board[i, j] <span class="op">=</span> <span class="bu">next</span>(program.run())</span>
<span id="cb52-965"><a href="#cb52-965" aria-hidden="true" tabindex="-1"></a>board.<span class="bu">sum</span>()</span>
<span id="cb52-966"><a href="#cb52-966" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-967"><a href="#cb52-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-968"><a href="#cb52-968" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-969"><a href="#cb52-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-972"><a href="#cb52-972" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-973"><a href="#cb52-973" aria-hidden="true" tabindex="-1"></a>top_edge <span class="op">=</span> []</span>
<span id="cb52-974"><a href="#cb52-974" aria-hidden="true" tabindex="-1"></a>bottom_edge <span class="op">=</span> []</span>
<span id="cb52-975"><a href="#cb52-975" aria-hidden="true" tabindex="-1"></a>current_top <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-976"><a href="#cb52-976" aria-hidden="true" tabindex="-1"></a>current_bottom <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-977"><a href="#cb52-977" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb52-978"><a href="#cb52-978" aria-hidden="true" tabindex="-1"></a>    bottom_val <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb52-979"><a href="#cb52-979" aria-hidden="true" tabindex="-1"></a>    top_val <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-980"><a href="#cb52-980" aria-hidden="true" tabindex="-1"></a>    current_top <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb52-981"><a href="#cb52-981" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> top_val <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> current_top <span class="op">&lt;=</span> <span class="dv">2</span> <span class="op">*</span> j:</span>
<span id="cb52-982"><a href="#cb52-982" aria-hidden="true" tabindex="-1"></a>        current_top <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb52-983"><a href="#cb52-983" aria-hidden="true" tabindex="-1"></a>        program.reset()</span>
<span id="cb52-984"><a href="#cb52-984" aria-hidden="true" tabindex="-1"></a>        program.set_input([j, current_top])</span>
<span id="cb52-985"><a href="#cb52-985" aria-hidden="true" tabindex="-1"></a>        top_val <span class="op">=</span> <span class="bu">next</span>(program.run())</span>
<span id="cb52-986"><a href="#cb52-986" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> top_val:</span>
<span id="cb52-987"><a href="#cb52-987" aria-hidden="true" tabindex="-1"></a>        current_top <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-988"><a href="#cb52-988" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> current_bottom:</span>
<span id="cb52-989"><a href="#cb52-989" aria-hidden="true" tabindex="-1"></a>        current_bottom <span class="op">=</span> current_top</span>
<span id="cb52-990"><a href="#cb52-990" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> bottom_val <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb52-991"><a href="#cb52-991" aria-hidden="true" tabindex="-1"></a>        current_bottom <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb52-992"><a href="#cb52-992" aria-hidden="true" tabindex="-1"></a>        program.reset()</span>
<span id="cb52-993"><a href="#cb52-993" aria-hidden="true" tabindex="-1"></a>        program.set_input([j, current_bottom])</span>
<span id="cb52-994"><a href="#cb52-994" aria-hidden="true" tabindex="-1"></a>        bottom_val <span class="op">=</span> <span class="bu">next</span>(program.run())</span>
<span id="cb52-995"><a href="#cb52-995" aria-hidden="true" tabindex="-1"></a>    top_edge.append(current_top)</span>
<span id="cb52-996"><a href="#cb52-996" aria-hidden="true" tabindex="-1"></a>    bottom_edge.append(current_bottom <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb52-997"><a href="#cb52-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-998"><a href="#cb52-998" aria-hidden="true" tabindex="-1"></a>axis <span class="op">=</span> np.arange(<span class="bu">len</span>(bottom_edge))</span>
<span id="cb52-999"><a href="#cb52-999" aria-hidden="true" tabindex="-1"></a>top_slope <span class="op">=</span> np.polyfit(axis, top_edge, <span class="dv">1</span>)[<span class="dv">0</span>]</span>
<span id="cb52-1000"><a href="#cb52-1000" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> <span class="dv">99</span></span>
<span id="cb52-1001"><a href="#cb52-1001" aria-hidden="true" tabindex="-1"></a>dy <span class="op">=</span> (top_slope <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> w</span>
<span id="cb52-1002"><a href="#cb52-1002" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> (np.array(bottom_edge) <span class="op">-</span> np.array(top_edge) <span class="op">&gt;=</span> dy).argmax()</span>
<span id="cb52-1003"><a href="#cb52-1003" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> bottom_edge[x] <span class="op">-</span> w</span>
<span id="cb52-1004"><a href="#cb52-1004" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> top_edge[x <span class="op">+</span> w] <span class="op">&lt;=</span> (bottom_edge[x] <span class="op">-</span> w):</span>
<span id="cb52-1005"><a href="#cb52-1005" aria-hidden="true" tabindex="-1"></a>    x <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb52-1006"><a href="#cb52-1006" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> bottom_edge[x] <span class="op">-</span> w</span>
<span id="cb52-1007"><a href="#cb52-1007" aria-hidden="true" tabindex="-1"></a>x <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb52-1008"><a href="#cb52-1008" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> bottom_edge[x] <span class="op">-</span> w</span>
<span id="cb52-1009"><a href="#cb52-1009" aria-hidden="true" tabindex="-1"></a><span class="dv">10000</span> <span class="op">*</span> x <span class="op">+</span> y</span>
<span id="cb52-1010"><a href="#cb52-1010" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-1011"><a href="#cb52-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1012"><a href="#cb52-1012" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 20: Donut Maze](https://adventofcode.com/2019/day/20)</span></span>
<span id="cb52-1013"><a href="#cb52-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1014"><a href="#cb52-1014" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-1015"><a href="#cb52-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1016"><a href="#cb52-1016" aria-hidden="true" tabindex="-1"></a>This can be done with a fairly simple BFS. The only added difficulty is that we need some way of specifying that two portals of the same letter neighbor each other.</span>
<span id="cb52-1017"><a href="#cb52-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1018"><a href="#cb52-1018" aria-hidden="true" tabindex="-1"></a>In terms of the number of lines, that's what most of the following code is doing.</span>
<span id="cb52-1019"><a href="#cb52-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1022"><a href="#cb52-1022" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-1023"><a href="#cb52-1023" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.array([[<span class="bu">ord</span>(char) <span class="cf">for</span> char <span class="kw">in</span> line[:<span class="op">-</span><span class="dv">1</span>]] <span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">20</span>)], dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb52-1024"><a href="#cb52-1024" aria-hidden="true" tabindex="-1"></a>portals <span class="op">=</span> ((<span class="bu">ord</span>(<span class="st">"A"</span>) <span class="op">&lt;=</span> data) <span class="op">&amp;</span> (data <span class="op">&lt;=</span> <span class="bu">ord</span>(<span class="st">"Z"</span>))) <span class="op">*</span> <span class="dv">1</span></span>
<span id="cb52-1025"><a href="#cb52-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1026"><a href="#cb52-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1027"><a href="#cb52-1027" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> label(item):</span>
<span id="cb52-1028"><a href="#cb52-1028" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(item, <span class="bu">str</span>):</span>
<span id="cb52-1029"><a href="#cb52-1029" aria-hidden="true" tabindex="-1"></a>        item <span class="op">=</span> np.array([<span class="bu">ord</span>(x) <span class="cf">for</span> x <span class="kw">in</span> item])</span>
<span id="cb52-1030"><a href="#cb52-1030" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> functools.<span class="bu">reduce</span>(<span class="kw">lambda</span> x, y: <span class="op">-</span>(<span class="dv">26</span> <span class="op">*</span> x <span class="op">+</span> y), item <span class="op">-</span> <span class="bu">ord</span>(<span class="st">"A"</span>) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb52-1031"><a href="#cb52-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1032"><a href="#cb52-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1033"><a href="#cb52-1033" aria-hidden="true" tabindex="-1"></a>ymax, xmax <span class="op">=</span> data.shape</span>
<span id="cb52-1034"><a href="#cb52-1034" aria-hidden="true" tabindex="-1"></a>verticals <span class="op">=</span> np.where(scipy.ndimage.correlate(portals, [[<span class="dv">1</span>], [<span class="dv">1</span>]], mode<span class="op">=</span><span class="st">"constant"</span>) <span class="op">==</span> <span class="dv">2</span>)</span>
<span id="cb52-1035"><a href="#cb52-1035" aria-hidden="true" tabindex="-1"></a>horizontals <span class="op">=</span> np.where(scipy.ndimage.correlate(portals, [[<span class="dv">1</span>, <span class="dv">1</span>]], mode<span class="op">=</span><span class="st">"constant"</span>) <span class="op">==</span> <span class="dv">2</span>)</span>
<span id="cb52-1036"><a href="#cb52-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1037"><a href="#cb52-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1038"><a href="#cb52-1038" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> vertical_neighbors(y, x):</span>
<span id="cb52-1039"><a href="#cb52-1039" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb52-1040"><a href="#cb52-1040" aria-hidden="true" tabindex="-1"></a>        [y <span class="op">-</span> <span class="dv">2</span>, x],</span>
<span id="cb52-1041"><a href="#cb52-1041" aria-hidden="true" tabindex="-1"></a>        [y <span class="op">-</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span>],</span>
<span id="cb52-1042"><a href="#cb52-1042" aria-hidden="true" tabindex="-1"></a>        [y <span class="op">-</span> <span class="dv">1</span>, x <span class="op">+</span> <span class="dv">1</span>],</span>
<span id="cb52-1043"><a href="#cb52-1043" aria-hidden="true" tabindex="-1"></a>        [y, x <span class="op">-</span> <span class="dv">1</span>],</span>
<span id="cb52-1044"><a href="#cb52-1044" aria-hidden="true" tabindex="-1"></a>        [y, x <span class="op">+</span> <span class="dv">1</span>],</span>
<span id="cb52-1045"><a href="#cb52-1045" aria-hidden="true" tabindex="-1"></a>        [y <span class="op">+</span> <span class="dv">1</span>, x],</span>
<span id="cb52-1046"><a href="#cb52-1046" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb52-1047"><a href="#cb52-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1048"><a href="#cb52-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1049"><a href="#cb52-1049" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> horizontal_neighbors(y, x):</span>
<span id="cb52-1050"><a href="#cb52-1050" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb52-1051"><a href="#cb52-1051" aria-hidden="true" tabindex="-1"></a>        [y, x <span class="op">-</span> <span class="dv">2</span>],</span>
<span id="cb52-1052"><a href="#cb52-1052" aria-hidden="true" tabindex="-1"></a>        [y <span class="op">-</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span>],</span>
<span id="cb52-1053"><a href="#cb52-1053" aria-hidden="true" tabindex="-1"></a>        [y <span class="op">+</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span>],</span>
<span id="cb52-1054"><a href="#cb52-1054" aria-hidden="true" tabindex="-1"></a>        [y <span class="op">-</span> <span class="dv">1</span>, x],</span>
<span id="cb52-1055"><a href="#cb52-1055" aria-hidden="true" tabindex="-1"></a>        [y <span class="op">+</span> <span class="dv">1</span>, x],</span>
<span id="cb52-1056"><a href="#cb52-1056" aria-hidden="true" tabindex="-1"></a>        [y, x <span class="op">+</span> <span class="dv">1</span>],</span>
<span id="cb52-1057"><a href="#cb52-1057" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb52-1058"><a href="#cb52-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1059"><a href="#cb52-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1060"><a href="#cb52-1060" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> horizontal_window(y, x):</span>
<span id="cb52-1061"><a href="#cb52-1061" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array((y, y)), np.array((x <span class="op">-</span> <span class="dv">1</span>, x))</span>
<span id="cb52-1062"><a href="#cb52-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1063"><a href="#cb52-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1064"><a href="#cb52-1064" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> vertical_window(y, x):</span>
<span id="cb52-1065"><a href="#cb52-1065" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array((y <span class="op">-</span> <span class="dv">1</span>, y)), np.array((x, x))</span>
<span id="cb52-1066"><a href="#cb52-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1067"><a href="#cb52-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1068"><a href="#cb52-1068" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> portals, neighbors, window <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb52-1069"><a href="#cb52-1069" aria-hidden="true" tabindex="-1"></a>    [verticals, horizontals],</span>
<span id="cb52-1070"><a href="#cb52-1070" aria-hidden="true" tabindex="-1"></a>    [vertical_neighbors, horizontal_neighbors],</span>
<span id="cb52-1071"><a href="#cb52-1071" aria-hidden="true" tabindex="-1"></a>    [vertical_window, horizontal_window],</span>
<span id="cb52-1072"><a href="#cb52-1072" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb52-1073"><a href="#cb52-1073" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> portal <span class="kw">in</span> <span class="bu">sorted</span>(<span class="bu">zip</span>(<span class="op">*</span>portals)):</span>
<span id="cb52-1074"><a href="#cb52-1074" aria-hidden="true" tabindex="-1"></a>        w <span class="op">=</span> window(<span class="op">*</span>portal)</span>
<span id="cb52-1075"><a href="#cb52-1075" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> [</span>
<span id="cb52-1076"><a href="#cb52-1076" aria-hidden="true" tabindex="-1"></a>            i <span class="cf">for</span> i <span class="kw">in</span> neighbors(<span class="op">*</span>portal) <span class="cf">if</span> data[i[<span class="dv">0</span>] <span class="op">%</span> ymax, i[<span class="dv">1</span>] <span class="op">%</span> xmax] <span class="op">==</span> <span class="bu">ord</span>(<span class="st">"."</span>)</span>
<span id="cb52-1077"><a href="#cb52-1077" aria-hidden="true" tabindex="-1"></a>        ][<span class="dv">0</span>]</span>
<span id="cb52-1078"><a href="#cb52-1078" aria-hidden="true" tabindex="-1"></a>        data[<span class="bu">tuple</span>(n)] <span class="op">=</span> label(data[w])</span>
<span id="cb52-1079"><a href="#cb52-1079" aria-hidden="true" tabindex="-1"></a>        data[w] <span class="op">=</span> <span class="bu">ord</span>(<span class="st">"#"</span>)</span>
<span id="cb52-1080"><a href="#cb52-1080" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> <span class="bu">next</span>(<span class="bu">zip</span>(<span class="op">*</span>np.where(data <span class="op">==</span> label(<span class="st">"AA"</span>))))</span>
<span id="cb52-1081"><a href="#cb52-1081" aria-hidden="true" tabindex="-1"></a>destination <span class="op">=</span> <span class="bu">next</span>(<span class="bu">zip</span>(<span class="op">*</span>np.where(data <span class="op">==</span> label(<span class="st">"ZZ"</span>))))</span>
<span id="cb52-1082"><a href="#cb52-1082" aria-hidden="true" tabindex="-1"></a>paths <span class="op">=</span> deque([(start, <span class="dv">0</span>)])</span>
<span id="cb52-1083"><a href="#cb52-1083" aria-hidden="true" tabindex="-1"></a>seen <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb52-1084"><a href="#cb52-1084" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> paths:</span>
<span id="cb52-1085"><a href="#cb52-1085" aria-hidden="true" tabindex="-1"></a>    (y, x), distance <span class="op">=</span> paths.popleft()</span>
<span id="cb52-1086"><a href="#cb52-1086" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (y, x) <span class="kw">in</span> seen:</span>
<span id="cb52-1087"><a href="#cb52-1087" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb52-1088"><a href="#cb52-1088" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (y, x) <span class="op">==</span> destination:</span>
<span id="cb52-1089"><a href="#cb52-1089" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb52-1090"><a href="#cb52-1090" aria-hidden="true" tabindex="-1"></a>    seen.add((y, x))</span>
<span id="cb52-1091"><a href="#cb52-1091" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> [</span>
<span id="cb52-1092"><a href="#cb52-1092" aria-hidden="true" tabindex="-1"></a>        c</span>
<span id="cb52-1093"><a href="#cb52-1093" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> c <span class="kw">in</span> [(y <span class="op">-</span> <span class="dv">1</span>, x), (y, x <span class="op">-</span> <span class="dv">1</span>), (y, x <span class="op">+</span> <span class="dv">1</span>), (y <span class="op">+</span> <span class="dv">1</span>, x)]</span>
<span id="cb52-1094"><a href="#cb52-1094" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (data[c] <span class="op">==</span> <span class="bu">ord</span>(<span class="st">"."</span>)) <span class="kw">or</span> data[c] <span class="op">&lt;</span> <span class="dv">0</span></span>
<span id="cb52-1095"><a href="#cb52-1095" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb52-1096"><a href="#cb52-1096" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data[y, x] <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb52-1097"><a href="#cb52-1097" aria-hidden="true" tabindex="-1"></a>        neighbors <span class="op">+=</span> <span class="bu">sorted</span>(<span class="bu">zip</span>(<span class="op">*</span>np.where(data <span class="op">==</span> data[y, x])))</span>
<span id="cb52-1098"><a href="#cb52-1098" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> neighbor <span class="kw">in</span> neighbors:</span>
<span id="cb52-1099"><a href="#cb52-1099" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> neighbor <span class="kw">in</span> seen:</span>
<span id="cb52-1100"><a href="#cb52-1100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb52-1101"><a href="#cb52-1101" aria-hidden="true" tabindex="-1"></a>        paths.append((neighbor, distance <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb52-1102"><a href="#cb52-1102" aria-hidden="true" tabindex="-1"></a>distance</span>
<span id="cb52-1103"><a href="#cb52-1103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-1104"><a href="#cb52-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1105"><a href="#cb52-1105" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-1106"><a href="#cb52-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1107"><a href="#cb52-1107" aria-hidden="true" tabindex="-1"></a>For part 2, we basically just need to add a level coordinate to our state, and change the way we enumerate neighbors to account for the fact that moving through a portal changes the levels</span>
<span id="cb52-1108"><a href="#cb52-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1111"><a href="#cb52-1111" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-1112"><a href="#cb52-1112" aria-hidden="true" tabindex="-1"></a>level_change <span class="op">=</span> defaultdict(<span class="kw">lambda</span>: <span class="dv">1</span>)</span>
<span id="cb52-1113"><a href="#cb52-1113" aria-hidden="true" tabindex="-1"></a>portals <span class="op">=</span> np.where(data <span class="op">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb52-1114"><a href="#cb52-1114" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> y, x <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>portals):</span>
<span id="cb52-1115"><a href="#cb52-1115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">==</span> <span class="dv">2</span> <span class="kw">or</span> y <span class="op">==</span> <span class="dv">2</span> <span class="kw">or</span> x <span class="op">==</span> xmax <span class="op">-</span> <span class="dv">3</span> <span class="kw">or</span> y <span class="op">==</span> ymax <span class="op">-</span> <span class="dv">3</span>:</span>
<span id="cb52-1116"><a href="#cb52-1116" aria-hidden="true" tabindex="-1"></a>        level_change[y, x] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb52-1117"><a href="#cb52-1117" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> <span class="bu">next</span>(<span class="bu">zip</span>(<span class="op">*</span>np.where(data <span class="op">==</span> label(<span class="st">"AA"</span>)))) <span class="op">+</span> (<span class="dv">0</span>,)</span>
<span id="cb52-1118"><a href="#cb52-1118" aria-hidden="true" tabindex="-1"></a>destination <span class="op">=</span> <span class="bu">next</span>(<span class="bu">zip</span>(<span class="op">*</span>np.where(data <span class="op">==</span> label(<span class="st">"ZZ"</span>)))) <span class="op">+</span> (<span class="dv">0</span>,)</span>
<span id="cb52-1119"><a href="#cb52-1119" aria-hidden="true" tabindex="-1"></a>paths <span class="op">=</span> deque([(start, <span class="dv">0</span>)])</span>
<span id="cb52-1120"><a href="#cb52-1120" aria-hidden="true" tabindex="-1"></a>seen <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb52-1121"><a href="#cb52-1121" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> paths:</span>
<span id="cb52-1122"><a href="#cb52-1122" aria-hidden="true" tabindex="-1"></a>    (y, x, level), distance <span class="op">=</span> paths.popleft()</span>
<span id="cb52-1123"><a href="#cb52-1123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (y, x, level) <span class="kw">in</span> seen:</span>
<span id="cb52-1124"><a href="#cb52-1124" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb52-1125"><a href="#cb52-1125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (y, x, level) <span class="op">==</span> destination:</span>
<span id="cb52-1126"><a href="#cb52-1126" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb52-1127"><a href="#cb52-1127" aria-hidden="true" tabindex="-1"></a>    seen.add((y, x, level))</span>
<span id="cb52-1128"><a href="#cb52-1128" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> [</span>
<span id="cb52-1129"><a href="#cb52-1129" aria-hidden="true" tabindex="-1"></a>        c <span class="op">+</span> (level,)</span>
<span id="cb52-1130"><a href="#cb52-1130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> c <span class="kw">in</span> [(y <span class="op">-</span> <span class="dv">1</span>, x), (y, x <span class="op">-</span> <span class="dv">1</span>), (y, x <span class="op">+</span> <span class="dv">1</span>), (y <span class="op">+</span> <span class="dv">1</span>, x)]</span>
<span id="cb52-1131"><a href="#cb52-1131" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (data[c] <span class="op">==</span> <span class="bu">ord</span>(<span class="st">"."</span>)) <span class="kw">or</span> data[c] <span class="op">&lt;</span> <span class="dv">0</span></span>
<span id="cb52-1132"><a href="#cb52-1132" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb52-1133"><a href="#cb52-1133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data[y, x] <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb52-1134"><a href="#cb52-1134" aria-hidden="true" tabindex="-1"></a>        new_level <span class="op">=</span> level <span class="op">+</span> level_change[y, x]</span>
<span id="cb52-1135"><a href="#cb52-1135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> new_level <span class="op">&gt;=</span> <span class="dv">0</span>:</span>
<span id="cb52-1136"><a href="#cb52-1136" aria-hidden="true" tabindex="-1"></a>            other_neighbors <span class="op">=</span> <span class="bu">set</span>(<span class="bu">zip</span>(<span class="op">*</span>np.where(data <span class="op">==</span> data[y, x]))) <span class="op">-</span> <span class="bu">set</span>([(y, x)])</span>
<span id="cb52-1137"><a href="#cb52-1137" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> neighbor <span class="kw">in</span> other_neighbors:</span>
<span id="cb52-1138"><a href="#cb52-1138" aria-hidden="true" tabindex="-1"></a>                neighbors <span class="op">+=</span> [neighbor <span class="op">+</span> (new_level,)]</span>
<span id="cb52-1139"><a href="#cb52-1139" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> neighbor <span class="kw">in</span> neighbors:</span>
<span id="cb52-1140"><a href="#cb52-1140" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> neighbor <span class="kw">in</span> seen:</span>
<span id="cb52-1141"><a href="#cb52-1141" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb52-1142"><a href="#cb52-1142" aria-hidden="true" tabindex="-1"></a>        paths.append((neighbor, distance <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb52-1143"><a href="#cb52-1143" aria-hidden="true" tabindex="-1"></a>distance</span>
<span id="cb52-1144"><a href="#cb52-1144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-1145"><a href="#cb52-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1146"><a href="#cb52-1146" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 21: Springdroid Adventure](https://adventofcode.com/2019/day/21)</span></span>
<span id="cb52-1147"><a href="#cb52-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1148"><a href="#cb52-1148" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-1149"><a href="#cb52-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1150"><a href="#cb52-1150" aria-hidden="true" tabindex="-1"></a>Part 1 is possible to brute force, even if a bit of thought is needed to do it. With 3 different commands available, with six options for their first argument and 2 for their second, there are are 36 possible SPRINGSCRIPT instructions; each program is a max of 15 instructions, so there are more than $2\times10^{23}$ possible programs. That's not the right way to go.</span>
<span id="cb52-1151"><a href="#cb52-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1152"><a href="#cb52-1152" aria-hidden="true" tabindex="-1"></a>On the other hand, there are only four inputs at any given stage, so there are only 16 distinct inputs to our assignments. The program we have to supply is just a way of mapping each input to either 0 or 1, and there are only $2^{16}$ of those.</span>
<span id="cb52-1153"><a href="#cb52-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1154"><a href="#cb52-1154" aria-hidden="true" tabindex="-1"></a>Additionally, we are told that jumping when there is a hole 4 tiles away will result in automatic loss, since that's how far we jump. Similarly, not jumping when there is a hole right in front of us will result in a loss. So any valid rule has to have the following structure (0 as input is hole, 1 is ground; 0 as output is don't jump, 1 is jump)</span>
<span id="cb52-1155"><a href="#cb52-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1156"><a href="#cb52-1156" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>0BCD -<span class="sc">\&gt;</span> 1</span>
<span id="cb52-1157"><a href="#cb52-1157" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>ABC0 -<span class="sc">\&gt;</span> 0</span>
<span id="cb52-1158"><a href="#cb52-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1159"><a href="#cb52-1159" aria-hidden="true" tabindex="-1"></a>(this reveals that the input 0BC0 is an automatic loss)</span>
<span id="cb52-1160"><a href="#cb52-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1161"><a href="#cb52-1161" aria-hidden="true" tabindex="-1"></a>That also means that for anything else we can assume A = 1 and D = 1, since otherwise the output is fixed. So really we just have to map the four BC states. That means there are only 16 possible programs, so we can enumerate them all. Especially since 8 of them are mirrors of the other 8.</span>
<span id="cb52-1162"><a href="#cb52-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1165"><a href="#cb52-1165" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-1166"><a href="#cb52-1166" aria-hidden="true" tabindex="-1"></a>springscript_programs <span class="op">=</span> [</span>
<span id="cb52-1167"><a href="#cb52-1167" aria-hidden="true" tabindex="-1"></a>    [],</span>
<span id="cb52-1168"><a href="#cb52-1168" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"NOT B T"</span>, <span class="st">"NOT C J"</span>, <span class="st">"OR T J"</span>, <span class="st">"NOT J J"</span>],</span>
<span id="cb52-1169"><a href="#cb52-1169" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"NOT C J"</span>, <span class="st">"AND B J"</span>],</span>
<span id="cb52-1170"><a href="#cb52-1170" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"NOT B J"</span>, <span class="st">"NOT J J"</span>],</span>
<span id="cb52-1171"><a href="#cb52-1171" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"NOT B J"</span>, <span class="st">"AND C J"</span>],</span>
<span id="cb52-1172"><a href="#cb52-1172" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"NOT C J"</span>, <span class="st">"NOT J J"</span>],</span>
<span id="cb52-1173"><a href="#cb52-1173" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"NOT B J"</span>, <span class="st">"AND C J"</span>, <span class="st">"NOT C T"</span>, <span class="st">"AND B T"</span>, <span class="st">"OR T J"</span>],</span>
<span id="cb52-1174"><a href="#cb52-1174" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"NOT B T"</span>, <span class="st">"NOT C J"</span>, <span class="st">"AND T J"</span>, <span class="st">"NOT J J"</span>],</span>
<span id="cb52-1175"><a href="#cb52-1175" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb52-1176"><a href="#cb52-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1177"><a href="#cb52-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1178"><a href="#cb52-1178" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> invert(program):</span>
<span id="cb52-1179"><a href="#cb52-1179" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb52-1180"><a href="#cb52-1180" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> program[<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="st">"NOT J J"</span>:</span>
<span id="cb52-1181"><a href="#cb52-1181" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> program[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb52-1182"><a href="#cb52-1182" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb52-1183"><a href="#cb52-1183" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb52-1184"><a href="#cb52-1184" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> program <span class="op">+</span> [<span class="st">"NOT J J"</span>]</span>
<span id="cb52-1185"><a href="#cb52-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1186"><a href="#cb52-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1187"><a href="#cb52-1187" aria-hidden="true" tabindex="-1"></a>footer <span class="op">=</span> [<span class="st">"NOT A T"</span>, <span class="st">"OR T J"</span>, <span class="st">"AND D J"</span>, <span class="st">"WALK"</span>]</span>
<span id="cb52-1188"><a href="#cb52-1188" aria-hidden="true" tabindex="-1"></a>springscript_programs <span class="op">+=</span> [invert(p) <span class="cf">for</span> p <span class="kw">in</span> springscript_programs]</span>
<span id="cb52-1189"><a href="#cb52-1189" aria-hidden="true" tabindex="-1"></a>springscript_programs <span class="op">=</span> [p <span class="op">+</span> footer <span class="cf">for</span> p <span class="kw">in</span> springscript_programs]</span>
<span id="cb52-1190"><a href="#cb52-1190" aria-hidden="true" tabindex="-1"></a>encoded <span class="op">=</span> [</span>
<span id="cb52-1191"><a href="#cb52-1191" aria-hidden="true" tabindex="-1"></a>    [<span class="bu">ord</span>(char) <span class="cf">for</span> char <span class="kw">in</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(program) <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>]</span>
<span id="cb52-1192"><a href="#cb52-1192" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> program <span class="kw">in</span> springscript_programs</span>
<span id="cb52-1193"><a href="#cb52-1193" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb52-1194"><a href="#cb52-1194" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(load(<span class="dv">21</span>, <span class="st">"np"</span>))</span>
<span id="cb52-1195"><a href="#cb52-1195" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> springscript_programs:</span>
<span id="cb52-1196"><a href="#cb52-1196" aria-hidden="true" tabindex="-1"></a>    encoded_program <span class="op">=</span> [<span class="bu">ord</span>(char) <span class="cf">for</span> char <span class="kw">in</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(p) <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>]</span>
<span id="cb52-1197"><a href="#cb52-1197" aria-hidden="true" tabindex="-1"></a>    program.reset()</span>
<span id="cb52-1198"><a href="#cb52-1198" aria-hidden="true" tabindex="-1"></a>    program.set_input(encoded_program)</span>
<span id="cb52-1199"><a href="#cb52-1199" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> value <span class="kw">in</span> program.run():</span>
<span id="cb52-1200"><a href="#cb52-1200" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> value <span class="op">&gt;</span> <span class="dv">255</span>:</span>
<span id="cb52-1201"><a href="#cb52-1201" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb52-1202"><a href="#cb52-1202" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb52-1203"><a href="#cb52-1203" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb52-1204"><a href="#cb52-1204" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb52-1205"><a href="#cb52-1205" aria-hidden="true" tabindex="-1"></a>value</span>
<span id="cb52-1206"><a href="#cb52-1206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-1207"><a href="#cb52-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1208"><a href="#cb52-1208" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-1209"><a href="#cb52-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1210"><a href="#cb52-1210" aria-hidden="true" tabindex="-1"></a>Well.</span>
<span id="cb52-1211"><a href="#cb52-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1212"><a href="#cb52-1212" aria-hidden="true" tabindex="-1"></a>For part 2 we get five more registers, for a total of 7 that are allowed to vary state. That makes 128 possible inputs, and $\approx10^{38}$ possible mappings. The total number of 15-line springscript programs is only $\left(3\times11\times2\right)^{15} \approx 2\times10^{27}$, so a different approach is going to be needed</span>
<span id="cb52-1213"><a href="#cb52-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1214"><a href="#cb52-1214" aria-hidden="true" tabindex="-1"></a>Some thoughts:</span>
<span id="cb52-1215"><a href="#cb52-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1216"><a href="#cb52-1216" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If all of ABCD are ground there is no reason to jump, since we can just move forward. If A is a hole we have to jump, and if D is a hole we cannot jump. In general, if the landing is safe, we should try and jump early, since that'll give us more time to think on the other side. So if either B or C is a hole and D is safe we should jump. The exception is when H is a hole since then we cannot jump from D, and would be better off waiting to see what happens</span>
<span id="cb52-1217"><a href="#cb52-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1220"><a href="#cb52-1220" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-1221"><a href="#cb52-1221" aria-hidden="true" tabindex="-1"></a>springscript_program <span class="op">=</span> [</span>
<span id="cb52-1222"><a href="#cb52-1222" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NOT B J"</span>,</span>
<span id="cb52-1223"><a href="#cb52-1223" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NOT C T"</span>,</span>
<span id="cb52-1224"><a href="#cb52-1224" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OR T J"</span>,</span>
<span id="cb52-1225"><a href="#cb52-1225" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AND D J"</span>,  <span class="co"># if d is ground and there's a hole at B or C, we can jump to D</span></span>
<span id="cb52-1226"><a href="#cb52-1226" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AND H J"</span>,  <span class="co"># but only if H is also ground</span></span>
<span id="cb52-1227"><a href="#cb52-1227" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NOT A T"</span>,  <span class="co"># if next tile is a hole we have to jump</span></span>
<span id="cb52-1228"><a href="#cb52-1228" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OR T J"</span>,</span>
<span id="cb52-1229"><a href="#cb52-1229" aria-hidden="true" tabindex="-1"></a>    <span class="st">"RUN"</span>,</span>
<span id="cb52-1230"><a href="#cb52-1230" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb52-1231"><a href="#cb52-1231" aria-hidden="true" tabindex="-1"></a>encoded_program <span class="op">=</span> [<span class="bu">ord</span>(char) <span class="cf">for</span> char <span class="kw">in</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(springscript_program) <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>]</span>
<span id="cb52-1232"><a href="#cb52-1232" aria-hidden="true" tabindex="-1"></a>program.reset()</span>
<span id="cb52-1233"><a href="#cb52-1233" aria-hidden="true" tabindex="-1"></a>program.set_input(encoded_program)</span>
<span id="cb52-1234"><a href="#cb52-1234" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> value <span class="kw">in</span> program.run():</span>
<span id="cb52-1235"><a href="#cb52-1235" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> value <span class="op">&gt;</span> <span class="dv">255</span>:</span>
<span id="cb52-1236"><a href="#cb52-1236" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb52-1237"><a href="#cb52-1237" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">chr</span>(value), end<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb52-1238"><a href="#cb52-1238" aria-hidden="true" tabindex="-1"></a>value</span>
<span id="cb52-1239"><a href="#cb52-1239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-1240"><a href="#cb52-1240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1241"><a href="#cb52-1241" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 22: Slam Shuffle](https://adventofcode.com/2019/day/22)</span></span>
<span id="cb52-1242"><a href="#cb52-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1243"><a href="#cb52-1243" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-1244"><a href="#cb52-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1245"><a href="#cb52-1245" aria-hidden="true" tabindex="-1"></a>We are asked to follow how a single number moves - the one initally at position 2019. So if we build the operations so that they take an old position and return the new position, we can completely avoid dealing with the rest of the array.</span>
<span id="cb52-1246"><a href="#cb52-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1249"><a href="#cb52-1249" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-1250"><a href="#cb52-1250" aria-hidden="true" tabindex="-1"></a>instructions <span class="op">=</span> [<span class="bu">str</span>.split(x) <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">22</span>)]</span>
<span id="cb52-1251"><a href="#cb52-1251" aria-hidden="true" tabindex="-1"></a>lookup <span class="op">=</span> {<span class="st">"cut"</span>: <span class="dv">1</span>, <span class="st">"deal"</span>: <span class="dv">2</span>}</span>
<span id="cb52-1252"><a href="#cb52-1252" aria-hidden="true" tabindex="-1"></a>instructions <span class="op">=</span> [</span>
<span id="cb52-1253"><a href="#cb52-1253" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">0</span>,)</span>
<span id="cb52-1254"><a href="#cb52-1254" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> instruction[<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="st">"stack"</span></span>
<span id="cb52-1255"><a href="#cb52-1255" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> (lookup[instruction[<span class="dv">0</span>]], <span class="bu">int</span>(instruction[<span class="op">-</span><span class="dv">1</span>]))</span>
<span id="cb52-1256"><a href="#cb52-1256" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> instruction <span class="kw">in</span> instructions</span>
<span id="cb52-1257"><a href="#cb52-1257" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb52-1258"><a href="#cb52-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1259"><a href="#cb52-1259" aria-hidden="true" tabindex="-1"></a>l <span class="op">=</span> <span class="dv">10007</span></span>
<span id="cb52-1260"><a href="#cb52-1260" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="dv">2019</span></span>
<span id="cb52-1261"><a href="#cb52-1261" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> instruction <span class="kw">in</span> instructions:</span>
<span id="cb52-1262"><a href="#cb52-1262" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> instruction[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb52-1263"><a href="#cb52-1263" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> (l <span class="op">-</span> p <span class="op">-</span> <span class="dv">1</span>) <span class="op">%</span> l</span>
<span id="cb52-1264"><a href="#cb52-1264" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> instruction[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb52-1265"><a href="#cb52-1265" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> (p <span class="op">-</span> instruction[<span class="dv">1</span>]) <span class="op">%</span> l</span>
<span id="cb52-1266"><a href="#cb52-1266" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb52-1267"><a href="#cb52-1267" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> (p <span class="op">*</span> instruction[<span class="dv">1</span>]) <span class="op">%</span> l</span>
<span id="cb52-1268"><a href="#cb52-1268" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb52-1269"><a href="#cb52-1269" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-1270"><a href="#cb52-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1271"><a href="#cb52-1271" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-1272"><a href="#cb52-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1273"><a href="#cb52-1273" aria-hidden="true" tabindex="-1"></a>To nobody's great surprise, part 2 ups the difficulty significantly, with the usual trick of increasing the numbers of cards and rounds significantly.</span>
<span id="cb52-1274"><a href="#cb52-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1275"><a href="#cb52-1275" aria-hidden="true" tabindex="-1"></a>Additionally, since we're tracking what card ends up at a given spot rather than what spot a given card ends up at, we'll need to reverse the operations defined above, and apply them in reverse order. For the first two that's not a big issue, since the reversal is trivial. For the last one, we'll need a way to find multiplicative inverses in the modular group. We'll use the extended euclidean algorithm for that; it's already implemented in the utils file.</span>
<span id="cb52-1276"><a href="#cb52-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1277"><a href="#cb52-1277" aria-hidden="true" tabindex="-1"></a>Even with those optimizations, doing as many rounds as required isn't possible. Instead, we can realise that each of the three operations on the position is linear, and therefore so is their composition. That means that we can model the result of each round as</span>
<span id="cb52-1278"><a href="#cb52-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1279"><a href="#cb52-1279" aria-hidden="true" tabindex="-1"></a>$p \rightarrow ap + b \qquad \mod l$</span>
<span id="cb52-1280"><a href="#cb52-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1281"><a href="#cb52-1281" aria-hidden="true" tabindex="-1"></a>for some constants a and b. We can find these constants, and thus reduce the work needed for each round to calculating a multiplication, an addition and a remainder; making each round much faster.</span>
<span id="cb52-1282"><a href="#cb52-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1283"><a href="#cb52-1283" aria-hidden="true" tabindex="-1"></a>The number of rounds is still prohibitive if we're stuck doing them one at a time, but once we know the coefficients for doing one round, we can easily find the coefficients for doing 2 rounds. That lets us use a multiplication by squaring approach to getting the answer.</span>
<span id="cb52-1284"><a href="#cb52-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1287"><a href="#cb52-1287" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-1288"><a href="#cb52-1288" aria-hidden="true" tabindex="-1"></a>l <span class="op">=</span> <span class="dv">119315717514047</span></span>
<span id="cb52-1289"><a href="#cb52-1289" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> (<span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb52-1290"><a href="#cb52-1290" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> instruction <span class="kw">in</span> instructions[::<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb52-1291"><a href="#cb52-1291" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> instruction[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb52-1292"><a href="#cb52-1292" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> <span class="op">-</span>state[<span class="dv">0</span>], l <span class="op">-</span> state[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb52-1293"><a href="#cb52-1293" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> instruction[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb52-1294"><a href="#cb52-1294" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> state[<span class="dv">0</span>], state[<span class="dv">1</span>] <span class="op">+</span> instruction[<span class="dv">1</span>]</span>
<span id="cb52-1295"><a href="#cb52-1295" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb52-1296"><a href="#cb52-1296" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> [x <span class="op">*</span> inverses[instruction[<span class="dv">1</span>]] <span class="cf">for</span> x <span class="kw">in</span> state]</span>
<span id="cb52-1297"><a href="#cb52-1297" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> [x <span class="op">%</span> l <span class="cf">for</span> x <span class="kw">in</span> state]</span>
<span id="cb52-1298"><a href="#cb52-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1299"><a href="#cb52-1299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1300"><a href="#cb52-1300" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compose(c1, c2):</span>
<span id="cb52-1301"><a href="#cb52-1301" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (c1[<span class="dv">0</span>] <span class="op">*</span> c2[<span class="dv">0</span>]) <span class="op">%</span> l, (c2[<span class="dv">0</span>] <span class="op">*</span> c1[<span class="dv">1</span>] <span class="op">+</span> c2[<span class="dv">1</span>]) <span class="op">%</span> l</span>
<span id="cb52-1302"><a href="#cb52-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1303"><a href="#cb52-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1304"><a href="#cb52-1304" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="dv">2020</span></span>
<span id="cb52-1305"><a href="#cb52-1305" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">101741582076661</span></span>
<span id="cb52-1306"><a href="#cb52-1306" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> i:</span>
<span id="cb52-1307"><a href="#cb52-1307" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">2</span>:</span>
<span id="cb52-1308"><a href="#cb52-1308" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> (p <span class="op">*</span> state[<span class="dv">0</span>] <span class="op">+</span> state[<span class="dv">1</span>]) <span class="op">%</span> l</span>
<span id="cb52-1309"><a href="#cb52-1309" aria-hidden="true" tabindex="-1"></a>        i <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb52-1310"><a href="#cb52-1310" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb52-1311"><a href="#cb52-1311" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> compose(state, state)</span>
<span id="cb52-1312"><a href="#cb52-1312" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> i <span class="op">&gt;&gt;</span> <span class="dv">1</span></span>
<span id="cb52-1313"><a href="#cb52-1313" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb52-1314"><a href="#cb52-1314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-1315"><a href="#cb52-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1316"><a href="#cb52-1316" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 23: Category Six](https://adventofcode.com/2019/day/23)</span></span>
<span id="cb52-1317"><a href="#cb52-1317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1318"><a href="#cb52-1318" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-1319"><a href="#cb52-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1322"><a href="#cb52-1322" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-1323"><a href="#cb52-1323" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">23</span>, <span class="st">"np"</span>)</span>
<span id="cb52-1324"><a href="#cb52-1324" aria-hidden="true" tabindex="-1"></a>bus <span class="op">=</span> [[x] <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">50</span>))]</span>
<span id="cb52-1325"><a href="#cb52-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1326"><a href="#cb52-1326" aria-hidden="true" tabindex="-1"></a>programs <span class="op">=</span> []</span>
<span id="cb52-1327"><a href="#cb52-1327" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">50</span>):</span>
<span id="cb52-1328"><a href="#cb52-1328" aria-hidden="true" tabindex="-1"></a>    program <span class="op">=</span> IntCodeProgram(data, inputs<span class="op">=</span>bus[i])</span>
<span id="cb52-1329"><a href="#cb52-1329" aria-hidden="true" tabindex="-1"></a>    programs.append(program)</span>
<span id="cb52-1330"><a href="#cb52-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1331"><a href="#cb52-1331" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-1332"><a href="#cb52-1332" aria-hidden="true" tabindex="-1"></a>done <span class="op">=</span> <span class="va">False</span></span>
<span id="cb52-1333"><a href="#cb52-1333" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb52-1334"><a href="#cb52-1334" aria-hidden="true" tabindex="-1"></a>    program <span class="op">=</span> programs[idx]</span>
<span id="cb52-1335"><a href="#cb52-1335" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> program.run()</span>
<span id="cb52-1336"><a href="#cb52-1336" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> []</span>
<span id="cb52-1337"><a href="#cb52-1337" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-1338"><a href="#cb52-1338" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> value <span class="kw">in</span> values:</span>
<span id="cb52-1339"><a href="#cb52-1339" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> value <span class="op">==</span> <span class="dv">255</span> <span class="kw">and</span> (count <span class="op">%</span> <span class="dv">3</span>) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb52-1340"><a href="#cb52-1340" aria-hidden="true" tabindex="-1"></a>            done <span class="op">=</span> <span class="va">True</span></span>
<span id="cb52-1341"><a href="#cb52-1341" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb52-1342"><a href="#cb52-1342" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> program.state <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb52-1343"><a href="#cb52-1343" aria-hidden="true" tabindex="-1"></a>            bus[idx].append(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb52-1344"><a href="#cb52-1344" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb52-1345"><a href="#cb52-1345" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">+=</span> [value]</span>
<span id="cb52-1346"><a href="#cb52-1346" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> done:</span>
<span id="cb52-1347"><a href="#cb52-1347" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="bu">next</span>(values)</span>
<span id="cb52-1348"><a href="#cb52-1348" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> <span class="bu">next</span>(values)</span>
<span id="cb52-1349"><a href="#cb52-1349" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb52-1350"><a href="#cb52-1350" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> destination, x, y <span class="kw">in</span> more_itertools.chunked(outputs, <span class="dv">3</span>):</span>
<span id="cb52-1351"><a href="#cb52-1351" aria-hidden="true" tabindex="-1"></a>        bus[destination] <span class="op">+=</span> [x, y]</span>
<span id="cb52-1352"><a href="#cb52-1352" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> (idx <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">50</span> <span class="cf">if</span> <span class="kw">not</span> outputs <span class="cf">else</span> destination</span>
<span id="cb52-1353"><a href="#cb52-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1354"><a href="#cb52-1354" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb52-1355"><a href="#cb52-1355" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-1356"><a href="#cb52-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1357"><a href="#cb52-1357" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-1358"><a href="#cb52-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1361"><a href="#cb52-1361" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-1362"><a href="#cb52-1362" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">23</span>, <span class="st">"np"</span>)</span>
<span id="cb52-1363"><a href="#cb52-1363" aria-hidden="true" tabindex="-1"></a>bus <span class="op">=</span> [[x] <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">50</span>))]</span>
<span id="cb52-1364"><a href="#cb52-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1365"><a href="#cb52-1365" aria-hidden="true" tabindex="-1"></a>programs <span class="op">=</span> []</span>
<span id="cb52-1366"><a href="#cb52-1366" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">50</span>):</span>
<span id="cb52-1367"><a href="#cb52-1367" aria-hidden="true" tabindex="-1"></a>    program <span class="op">=</span> IntCodeProgram(data, inputs<span class="op">=</span>bus[i])</span>
<span id="cb52-1368"><a href="#cb52-1368" aria-hidden="true" tabindex="-1"></a>    programs.append(program)</span>
<span id="cb52-1369"><a href="#cb52-1369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1370"><a href="#cb52-1370" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-1371"><a href="#cb52-1371" aria-hidden="true" tabindex="-1"></a>done <span class="op">=</span> <span class="va">False</span></span>
<span id="cb52-1372"><a href="#cb52-1372" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_idle(bus):</span>
<span id="cb52-1373"><a href="#cb52-1373" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">all</span>(i <span class="op">==</span> [<span class="op">-</span><span class="dv">1</span>] <span class="cf">for</span> i <span class="kw">in</span> bus)</span>
<span id="cb52-1374"><a href="#cb52-1374" aria-hidden="true" tabindex="-1"></a>nat <span class="op">=</span> [x, y]</span>
<span id="cb52-1375"><a href="#cb52-1375" aria-hidden="true" tabindex="-1"></a>old_y <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb52-1376"><a href="#cb52-1376" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb52-1377"><a href="#cb52-1377" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> is_idle(bus):</span>
<span id="cb52-1378"><a href="#cb52-1378" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> nat[<span class="dv">1</span>] <span class="op">==</span> old_y:</span>
<span id="cb52-1379"><a href="#cb52-1379" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb52-1380"><a href="#cb52-1380" aria-hidden="true" tabindex="-1"></a>        new_input <span class="op">=</span> nat.copy()</span>
<span id="cb52-1381"><a href="#cb52-1381" aria-hidden="true" tabindex="-1"></a>        bus[<span class="dv">0</span>] <span class="op">=</span> new_input</span>
<span id="cb52-1382"><a href="#cb52-1382" aria-hidden="true" tabindex="-1"></a>        programs[<span class="dv">0</span>].set_input(new_input)</span>
<span id="cb52-1383"><a href="#cb52-1383" aria-hidden="true" tabindex="-1"></a>        old_y <span class="op">=</span> nat[<span class="dv">1</span>]</span>
<span id="cb52-1384"><a href="#cb52-1384" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-1385"><a href="#cb52-1385" aria-hidden="true" tabindex="-1"></a>    program <span class="op">=</span> programs[idx]</span>
<span id="cb52-1386"><a href="#cb52-1386" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> program.run()</span>
<span id="cb52-1387"><a href="#cb52-1387" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> []</span>
<span id="cb52-1388"><a href="#cb52-1388" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> value <span class="kw">in</span> values:</span>
<span id="cb52-1389"><a href="#cb52-1389" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> program.state <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb52-1390"><a href="#cb52-1390" aria-hidden="true" tabindex="-1"></a>            bus[idx].append(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb52-1391"><a href="#cb52-1391" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb52-1392"><a href="#cb52-1392" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">+=</span> [value]</span>
<span id="cb52-1393"><a href="#cb52-1393" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> destination, x, y <span class="kw">in</span> more_itertools.chunked(outputs, <span class="dv">3</span>):</span>
<span id="cb52-1394"><a href="#cb52-1394" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> destination <span class="op">==</span> <span class="dv">255</span>:</span>
<span id="cb52-1395"><a href="#cb52-1395" aria-hidden="true" tabindex="-1"></a>            nat <span class="op">=</span> [x, y]</span>
<span id="cb52-1396"><a href="#cb52-1396" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb52-1397"><a href="#cb52-1397" aria-hidden="true" tabindex="-1"></a>            bus[destination] <span class="op">+=</span> [x, y]</span>
<span id="cb52-1398"><a href="#cb52-1398" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> (idx <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">50</span></span>
<span id="cb52-1399"><a href="#cb52-1399" aria-hidden="true" tabindex="-1"></a>old_y</span>
<span id="cb52-1400"><a href="#cb52-1400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-1401"><a href="#cb52-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1402"><a href="#cb52-1402" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 24: Planet of Discord](https://adventofcode.com/2019/day/24)</span></span>
<span id="cb52-1403"><a href="#cb52-1403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1404"><a href="#cb52-1404" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-1405"><a href="#cb52-1405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1408"><a href="#cb52-1408" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-1409"><a href="#cb52-1409" aria-hidden="true" tabindex="-1"></a>initial_state <span class="op">=</span> np.array(</span>
<span id="cb52-1410"><a href="#cb52-1410" aria-hidden="true" tabindex="-1"></a>    [[<span class="dv">0</span> <span class="cf">if</span> char <span class="op">==</span> <span class="st">"."</span> <span class="cf">else</span> <span class="dv">1</span> <span class="cf">for</span> char <span class="kw">in</span> line] <span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">24</span>)]</span>
<span id="cb52-1411"><a href="#cb52-1411" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-1412"><a href="#cb52-1412" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> initial_state.copy()</span>
<span id="cb52-1413"><a href="#cb52-1413" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> [[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>]]</span>
<span id="cb52-1414"><a href="#cb52-1414" aria-hidden="true" tabindex="-1"></a>seen <span class="op">=</span> {}</span>
<span id="cb52-1415"><a href="#cb52-1415" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">tuple</span>(state.ravel()) <span class="kw">not</span> <span class="kw">in</span> seen:</span>
<span id="cb52-1416"><a href="#cb52-1416" aria-hidden="true" tabindex="-1"></a>    seen[<span class="bu">tuple</span>(state.ravel())] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb52-1417"><a href="#cb52-1417" aria-hidden="true" tabindex="-1"></a>    bugs <span class="op">=</span> scipy.ndimage.convolve(state, weights, mode<span class="op">=</span><span class="st">"constant"</span>)</span>
<span id="cb52-1418"><a href="#cb52-1418" aria-hidden="true" tabindex="-1"></a>    changes <span class="op">=</span> bugs <span class="op">!=</span> <span class="dv">1</span></span>
<span id="cb52-1419"><a href="#cb52-1419" aria-hidden="true" tabindex="-1"></a>    empty <span class="op">=</span> np.where(state <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb52-1420"><a href="#cb52-1420" aria-hidden="true" tabindex="-1"></a>    changes[empty] <span class="op">=</span> ((bugs <span class="op">==</span> <span class="dv">1</span>) <span class="op">|</span> (bugs <span class="op">==</span> <span class="dv">2</span>))[empty]</span>
<span id="cb52-1421"><a href="#cb52-1421" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> (state <span class="op">+</span> changes) <span class="op">%</span> <span class="dv">2</span></span>
<span id="cb52-1422"><a href="#cb52-1422" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> state.ravel()</span>
<span id="cb52-1423"><a href="#cb52-1423" aria-hidden="true" tabindex="-1"></a>(x <span class="op">*</span> (<span class="dv">2</span> <span class="op">**</span> np.arange(<span class="bu">len</span>(x)))).<span class="bu">sum</span>()</span>
<span id="cb52-1424"><a href="#cb52-1424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-1425"><a href="#cb52-1425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1426"><a href="#cb52-1426" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb52-1427"><a href="#cb52-1427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1428"><a href="#cb52-1428" aria-hidden="true" tabindex="-1"></a>For part 2, we need to figure out how to account for the different levels and how to account for the new neighbors.</span>
<span id="cb52-1429"><a href="#cb52-1429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1430"><a href="#cb52-1430" aria-hidden="true" tabindex="-1"></a>We'll add the different recursion levels as a new first axis in our array, and we know that it takes at least two steps before an initially empty layer can affect it's neighbor: one to reach the layer, and one to spread to the edge/centre of the layer. That means that instead of expanding the first axis at every step, we can precompute how many we'll need and fill with zeros.</span>
<span id="cb52-1431"><a href="#cb52-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1432"><a href="#cb52-1432" aria-hidden="true" tabindex="-1"></a>We can get the in-plane neighbors exactly as before, and after far too much thought, we can get the new neighbors with some clever numpy indexing. This could possibly be shortened even further, but tbh it's concise enough as it is.</span>
<span id="cb52-1433"><a href="#cb52-1433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1436"><a href="#cb52-1436" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-1437"><a href="#cb52-1437" aria-hidden="true" tabindex="-1"></a>length <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb52-1438"><a href="#cb52-1438" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> np.zeros((length <span class="op">+</span> <span class="dv">3</span>, <span class="op">*</span>initial_state.shape), dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb52-1439"><a href="#cb52-1439" aria-hidden="true" tabindex="-1"></a>state[<span class="bu">int</span>(length <span class="op">//</span> <span class="dv">2</span>) <span class="op">+</span> <span class="dv">1</span>] <span class="op">=</span> initial_state</span>
<span id="cb52-1440"><a href="#cb52-1440" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(length):</span>
<span id="cb52-1441"><a href="#cb52-1441" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> scipy.ndimage.convolve(state, [weights], mode<span class="op">=</span><span class="st">"constant"</span>)</span>
<span id="cb52-1442"><a href="#cb52-1442" aria-hidden="true" tabindex="-1"></a>    neighbors[:, (<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>), :] <span class="op">+=</span> np.roll(state[:, (<span class="dv">1</span>, <span class="dv">3</span>), <span class="dv">2</span>], <span class="dv">1</span>, axis<span class="op">=</span><span class="dv">0</span>)[:, :, <span class="va">None</span>]</span>
<span id="cb52-1443"><a href="#cb52-1443" aria-hidden="true" tabindex="-1"></a>    neighbors[:, :, (<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>)] <span class="op">+=</span> np.roll(state[:, <span class="dv">2</span>, (<span class="dv">1</span>, <span class="dv">3</span>)], <span class="dv">1</span>, axis<span class="op">=</span><span class="dv">0</span>)[:, <span class="va">None</span>, :]</span>
<span id="cb52-1444"><a href="#cb52-1444" aria-hidden="true" tabindex="-1"></a>    neighbors[:, (<span class="dv">1</span>, <span class="dv">3</span>), <span class="dv">2</span>] <span class="op">+=</span> np.roll(state[:, (<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>), :], <span class="op">-</span><span class="dv">1</span>, axis<span class="op">=</span><span class="dv">0</span>).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb52-1445"><a href="#cb52-1445" aria-hidden="true" tabindex="-1"></a>    neighbors[:, <span class="dv">2</span>, (<span class="dv">1</span>, <span class="dv">3</span>)] <span class="op">+=</span> np.roll(state[:, :, (<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>)], <span class="op">-</span><span class="dv">1</span>, axis<span class="op">=</span><span class="dv">0</span>).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb52-1446"><a href="#cb52-1446" aria-hidden="true" tabindex="-1"></a>    changes <span class="op">=</span> neighbors <span class="op">!=</span> <span class="dv">1</span></span>
<span id="cb52-1447"><a href="#cb52-1447" aria-hidden="true" tabindex="-1"></a>    empty <span class="op">=</span> np.where(state <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb52-1448"><a href="#cb52-1448" aria-hidden="true" tabindex="-1"></a>    changes[empty] <span class="op">=</span> ((neighbors <span class="op">==</span> <span class="dv">1</span>) <span class="op">|</span> (neighbors <span class="op">==</span> <span class="dv">2</span>))[empty]</span>
<span id="cb52-1449"><a href="#cb52-1449" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> (state <span class="op">+</span> changes) <span class="op">%</span> <span class="dv">2</span></span>
<span id="cb52-1450"><a href="#cb52-1450" aria-hidden="true" tabindex="-1"></a>    state[:, <span class="dv">2</span>, <span class="dv">2</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-1451"><a href="#cb52-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1452"><a href="#cb52-1452" aria-hidden="true" tabindex="-1"></a>state.<span class="bu">sum</span>()</span>
<span id="cb52-1453"><a href="#cb52-1453" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-1454"><a href="#cb52-1454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1455"><a href="#cb52-1455" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 25: Cryostasis](https://adventofcode.com/2019/day/25)</span></span>
<span id="cb52-1456"><a href="#cb52-1456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1457"><a href="#cb52-1457" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb52-1458"><a href="#cb52-1458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1461"><a href="#cb52-1461" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb52-1462"><a href="#cb52-1462" aria-hidden="true" tabindex="-1"></a>program <span class="op">=</span> IntCodeProgram(load(<span class="dv">25</span>, <span class="st">"np"</span>), inputs<span class="op">=</span>[])</span>
<span id="cb52-1463"><a href="#cb52-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1464"><a href="#cb52-1464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-1465"><a href="#cb52-1465" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run():</span>
<span id="cb52-1466"><a href="#cb52-1466" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> char <span class="kw">in</span> program.run():</span>
<span id="cb52-1467"><a href="#cb52-1467" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> program.state <span class="op">!=</span> <span class="dv">1</span>:</span>
<span id="cb52-1468"><a href="#cb52-1468" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="bu">chr</span>(char), end<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb52-1469"><a href="#cb52-1469" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb52-1470"><a href="#cb52-1470" aria-hidden="true" tabindex="-1"></a>            s <span class="op">=</span> <span class="bu">input</span>().strip()</span>
<span id="cb52-1471"><a href="#cb52-1471" aria-hidden="true" tabindex="-1"></a>            program.inputs <span class="op">+=</span> [<span class="bu">ord</span>(x) <span class="cf">for</span> x <span class="kw">in</span> s <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>]</span>
<span id="cb52-1472"><a href="#cb52-1472" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/cutonbuminband/AOC">Github</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>