<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>AOC - 2022 Solutions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../qmd/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../qmd/2022.html">2022 Solutions</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">AOC</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2025.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2024 Solutions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2024.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2024 Solutions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2023.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2023 Solutions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2022.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">2022 Solutions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2021.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2021 Solutions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2020.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2020 Solutions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2019.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2019 Solutions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2018.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2018 Solutions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2017.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2017 Solutions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2016.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2016 Solutions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/2015.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2015 Solutions</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#imports" id="toc-imports" class="nav-link active" data-scroll-target="#imports">Imports</a></li>
  <li><a href="#day-1-calorie-counting" id="toc-day-1-calorie-counting" class="nav-link" data-scroll-target="#day-1-calorie-counting">Day 1: Calorie Counting</a>
  <ul class="collapse">
  <li><a href="#part-1" id="toc-part-1" class="nav-link" data-scroll-target="#part-1">Part 1</a></li>
  <li><a href="#part-2" id="toc-part-2" class="nav-link" data-scroll-target="#part-2">Part 2</a></li>
  </ul></li>
  <li><a href="#day-2-rock-paper-scissors" id="toc-day-2-rock-paper-scissors" class="nav-link" data-scroll-target="#day-2-rock-paper-scissors">Day 2: Rock Paper Scissors</a>
  <ul class="collapse">
  <li><a href="#part-1-1" id="toc-part-1-1" class="nav-link" data-scroll-target="#part-1-1">Part 1</a></li>
  <li><a href="#part-2-1" id="toc-part-2-1" class="nav-link" data-scroll-target="#part-2-1">Part 2</a></li>
  </ul></li>
  <li><a href="#day-3-rucksack-reorganization" id="toc-day-3-rucksack-reorganization" class="nav-link" data-scroll-target="#day-3-rucksack-reorganization">Day 3: Rucksack Reorganization</a>
  <ul class="collapse">
  <li><a href="#part-1-2" id="toc-part-1-2" class="nav-link" data-scroll-target="#part-1-2">Part 1</a></li>
  <li><a href="#part-2-2" id="toc-part-2-2" class="nav-link" data-scroll-target="#part-2-2">Part 2</a></li>
  </ul></li>
  <li><a href="#day-4-camp-cleanup" id="toc-day-4-camp-cleanup" class="nav-link" data-scroll-target="#day-4-camp-cleanup">Day 4: Camp Cleanup</a>
  <ul class="collapse">
  <li><a href="#part-1-3" id="toc-part-1-3" class="nav-link" data-scroll-target="#part-1-3">Part 1</a></li>
  <li><a href="#part-2-3" id="toc-part-2-3" class="nav-link" data-scroll-target="#part-2-3">Part 2</a></li>
  </ul></li>
  <li><a href="#day-5-supply-stacks" id="toc-day-5-supply-stacks" class="nav-link" data-scroll-target="#day-5-supply-stacks">Day 5: Supply Stacks</a>
  <ul class="collapse">
  <li><a href="#part-1-4" id="toc-part-1-4" class="nav-link" data-scroll-target="#part-1-4">Part 1</a></li>
  <li><a href="#part-2-4" id="toc-part-2-4" class="nav-link" data-scroll-target="#part-2-4">Part 2</a></li>
  </ul></li>
  <li><a href="#day-6-tuning-trouble" id="toc-day-6-tuning-trouble" class="nav-link" data-scroll-target="#day-6-tuning-trouble">Day 6: Tuning Trouble</a>
  <ul class="collapse">
  <li><a href="#part-1-5" id="toc-part-1-5" class="nav-link" data-scroll-target="#part-1-5">Part 1</a></li>
  <li><a href="#part-2-5" id="toc-part-2-5" class="nav-link" data-scroll-target="#part-2-5">Part 2</a></li>
  </ul></li>
  <li><a href="#day-7-no-space-left-on-device" id="toc-day-7-no-space-left-on-device" class="nav-link" data-scroll-target="#day-7-no-space-left-on-device">Day 7: No Space Left On Device</a>
  <ul class="collapse">
  <li><a href="#part-1-6" id="toc-part-1-6" class="nav-link" data-scroll-target="#part-1-6">Part 1</a></li>
  <li><a href="#part-2-6" id="toc-part-2-6" class="nav-link" data-scroll-target="#part-2-6">Part 2</a></li>
  </ul></li>
  <li><a href="#day-8-treetop-tree-house" id="toc-day-8-treetop-tree-house" class="nav-link" data-scroll-target="#day-8-treetop-tree-house">Day 8: Treetop Tree House</a>
  <ul class="collapse">
  <li><a href="#part-1-7" id="toc-part-1-7" class="nav-link" data-scroll-target="#part-1-7">Part 1</a></li>
  <li><a href="#part-2-7" id="toc-part-2-7" class="nav-link" data-scroll-target="#part-2-7">Part 2</a></li>
  <li><a href="#bonus" id="toc-bonus" class="nav-link" data-scroll-target="#bonus">Bonus</a></li>
  </ul></li>
  <li><a href="#day-9-rope-bridge" id="toc-day-9-rope-bridge" class="nav-link" data-scroll-target="#day-9-rope-bridge">Day 9: Rope Bridge</a>
  <ul class="collapse">
  <li><a href="#part-1-8" id="toc-part-1-8" class="nav-link" data-scroll-target="#part-1-8">Part 1</a></li>
  <li><a href="#part-2-8" id="toc-part-2-8" class="nav-link" data-scroll-target="#part-2-8">Part 2</a></li>
  </ul></li>
  <li><a href="#day-10-cathode-ray-tube" id="toc-day-10-cathode-ray-tube" class="nav-link" data-scroll-target="#day-10-cathode-ray-tube">Day 10: Cathode-Ray Tube</a>
  <ul class="collapse">
  <li><a href="#part-1-9" id="toc-part-1-9" class="nav-link" data-scroll-target="#part-1-9">Part 1</a></li>
  <li><a href="#part-2-9" id="toc-part-2-9" class="nav-link" data-scroll-target="#part-2-9">Part 2</a></li>
  </ul></li>
  <li><a href="#day-11-monkey-in-the-middle" id="toc-day-11-monkey-in-the-middle" class="nav-link" data-scroll-target="#day-11-monkey-in-the-middle">Day 11: Monkey in the Middle</a>
  <ul class="collapse">
  <li><a href="#part-1-10" id="toc-part-1-10" class="nav-link" data-scroll-target="#part-1-10">Part 1</a></li>
  <li><a href="#part-2-10" id="toc-part-2-10" class="nav-link" data-scroll-target="#part-2-10">Part 2</a></li>
  </ul></li>
  <li><a href="#day-12-hill-climbing-algorithm" id="toc-day-12-hill-climbing-algorithm" class="nav-link" data-scroll-target="#day-12-hill-climbing-algorithm">Day 12: Hill Climbing Algorithm</a>
  <ul class="collapse">
  <li><a href="#part-1-11" id="toc-part-1-11" class="nav-link" data-scroll-target="#part-1-11">Part 1</a></li>
  <li><a href="#part-2-11" id="toc-part-2-11" class="nav-link" data-scroll-target="#part-2-11">Part 2</a></li>
  </ul></li>
  <li><a href="#day-13-distress-signal" id="toc-day-13-distress-signal" class="nav-link" data-scroll-target="#day-13-distress-signal">Day 13: Distress Signal</a>
  <ul class="collapse">
  <li><a href="#part-1-12" id="toc-part-1-12" class="nav-link" data-scroll-target="#part-1-12">Part 1</a></li>
  <li><a href="#part-2-12" id="toc-part-2-12" class="nav-link" data-scroll-target="#part-2-12">Part 2</a></li>
  </ul></li>
  <li><a href="#day-14-regolith-reservoir" id="toc-day-14-regolith-reservoir" class="nav-link" data-scroll-target="#day-14-regolith-reservoir">Day 14: Regolith Reservoir</a>
  <ul class="collapse">
  <li><a href="#part-1-13" id="toc-part-1-13" class="nav-link" data-scroll-target="#part-1-13">Part 1</a></li>
  <li><a href="#part-2-13" id="toc-part-2-13" class="nav-link" data-scroll-target="#part-2-13">Part 2</a></li>
  </ul></li>
  <li><a href="#day-15-beacon-exclusion-zone" id="toc-day-15-beacon-exclusion-zone" class="nav-link" data-scroll-target="#day-15-beacon-exclusion-zone">Day 15: Beacon Exclusion Zone</a>
  <ul class="collapse">
  <li><a href="#part-1-14" id="toc-part-1-14" class="nav-link" data-scroll-target="#part-1-14">Part 1</a></li>
  <li><a href="#part-2-14" id="toc-part-2-14" class="nav-link" data-scroll-target="#part-2-14">Part 2</a></li>
  </ul></li>
  <li><a href="#day-16-proboscidea-volcanium" id="toc-day-16-proboscidea-volcanium" class="nav-link" data-scroll-target="#day-16-proboscidea-volcanium">Day 16: Proboscidea Volcanium</a>
  <ul class="collapse">
  <li><a href="#part-1-15" id="toc-part-1-15" class="nav-link" data-scroll-target="#part-1-15">Part 1</a></li>
  <li><a href="#part-2-15" id="toc-part-2-15" class="nav-link" data-scroll-target="#part-2-15">Part 2</a></li>
  </ul></li>
  <li><a href="#day-17-pyroclastic-flow" id="toc-day-17-pyroclastic-flow" class="nav-link" data-scroll-target="#day-17-pyroclastic-flow">Day 17: Pyroclastic Flow</a>
  <ul class="collapse">
  <li><a href="#part-1-16" id="toc-part-1-16" class="nav-link" data-scroll-target="#part-1-16">Part 1</a></li>
  <li><a href="#part-2-16" id="toc-part-2-16" class="nav-link" data-scroll-target="#part-2-16">Part 2</a></li>
  </ul></li>
  <li><a href="#day-18-boiling-boulders" id="toc-day-18-boiling-boulders" class="nav-link" data-scroll-target="#day-18-boiling-boulders">Day 18: Boiling Boulders</a>
  <ul class="collapse">
  <li><a href="#part-1-17" id="toc-part-1-17" class="nav-link" data-scroll-target="#part-1-17">Part 1</a></li>
  <li><a href="#part-2-17" id="toc-part-2-17" class="nav-link" data-scroll-target="#part-2-17">Part 2</a></li>
  </ul></li>
  <li><a href="#day-19-not-enough-minerals" id="toc-day-19-not-enough-minerals" class="nav-link" data-scroll-target="#day-19-not-enough-minerals">Day 19: Not Enough Minerals</a>
  <ul class="collapse">
  <li><a href="#part-1-18" id="toc-part-1-18" class="nav-link" data-scroll-target="#part-1-18">Part 1</a></li>
  <li><a href="#part-2-18" id="toc-part-2-18" class="nav-link" data-scroll-target="#part-2-18">Part 2</a></li>
  </ul></li>
  <li><a href="#day-20-grove-positioning-system" id="toc-day-20-grove-positioning-system" class="nav-link" data-scroll-target="#day-20-grove-positioning-system">Day 20: Grove Positioning System</a>
  <ul class="collapse">
  <li><a href="#part-1-19" id="toc-part-1-19" class="nav-link" data-scroll-target="#part-1-19">Part 1</a></li>
  <li><a href="#part-2-19" id="toc-part-2-19" class="nav-link" data-scroll-target="#part-2-19">Part 2</a></li>
  </ul></li>
  <li><a href="#day-21-monkey-math" id="toc-day-21-monkey-math" class="nav-link" data-scroll-target="#day-21-monkey-math">Day 21: Monkey Math</a>
  <ul class="collapse">
  <li><a href="#part-1-20" id="toc-part-1-20" class="nav-link" data-scroll-target="#part-1-20">Part 1</a></li>
  <li><a href="#part-2-20" id="toc-part-2-20" class="nav-link" data-scroll-target="#part-2-20">Part 2</a></li>
  </ul></li>
  <li><a href="#day-22-monkey-map" id="toc-day-22-monkey-map" class="nav-link" data-scroll-target="#day-22-monkey-map">Day 22: Monkey Map</a>
  <ul class="collapse">
  <li><a href="#part-1-21" id="toc-part-1-21" class="nav-link" data-scroll-target="#part-1-21">Part 1</a></li>
  <li><a href="#part-2-21" id="toc-part-2-21" class="nav-link" data-scroll-target="#part-2-21">Part 2</a></li>
  </ul></li>
  <li><a href="#day-23-unstable-diffusion" id="toc-day-23-unstable-diffusion" class="nav-link" data-scroll-target="#day-23-unstable-diffusion">Day 23: Unstable Diffusion</a>
  <ul class="collapse">
  <li><a href="#part-1-22" id="toc-part-1-22" class="nav-link" data-scroll-target="#part-1-22">Part 1</a></li>
  <li><a href="#part-2-22" id="toc-part-2-22" class="nav-link" data-scroll-target="#part-2-22">Part 2</a></li>
  </ul></li>
  <li><a href="#day-24-blizzard-basin" id="toc-day-24-blizzard-basin" class="nav-link" data-scroll-target="#day-24-blizzard-basin">Day 24: Blizzard Basin</a>
  <ul class="collapse">
  <li><a href="#part-1-23" id="toc-part-1-23" class="nav-link" data-scroll-target="#part-1-23">Part 1</a></li>
  <li><a href="#part-2-23" id="toc-part-2-23" class="nav-link" data-scroll-target="#part-2-23">Part 2</a></li>
  </ul></li>
  <li><a href="#day-25-full-of-hot-air" id="toc-day-25-full-of-hot-air" class="nav-link" data-scroll-target="#day-25-full-of-hot-air">Day 25: Full of Hot Air</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">2022 Solutions</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="imports" class="level1">
<h1>Imports</h1>
<div class="cell" data-execution_count="1">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> functools</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict, deque, namedtuple</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> queue <span class="im">import</span> PriorityQueue</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> more_itertools</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">1</span>, os.path.join(sys.path[<span class="dv">0</span>], <span class="st">".."</span>))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> utils</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>load <span class="op">=</span> utils.year_load(<span class="dv">2022</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="day-1-calorie-counting" class="level1">
<h1><a href="https://adventofcode.com/2022/day/1">Day 1: Calorie Counting</a></h1>
<section id="part-1" class="level2">
<h2 class="anchored" data-anchor-id="part-1">Part 1</h2>
<div class="cell" data-execution_count="2">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>elves <span class="op">=</span> [x.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>) <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">1</span>, <span class="st">"raw"</span>).split(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>)]</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>([<span class="bu">sum</span>([<span class="bu">int</span>(y) <span class="cf">for</span> y <span class="kw">in</span> x <span class="cf">if</span> y]) <span class="cf">for</span> x <span class="kw">in</span> elves])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2" class="level2">
<h2 class="anchored" data-anchor-id="part-2">Part 2</h2>
<div class="cell" data-execution_count="3">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(<span class="bu">sorted</span>([<span class="bu">sum</span>([<span class="bu">int</span>(y) <span class="cf">for</span> y <span class="kw">in</span> x <span class="cf">if</span> y]) <span class="cf">for</span> x <span class="kw">in</span> elves])[<span class="op">-</span><span class="dv">3</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-2-rock-paper-scissors" class="level1">
<h1><a href="https://adventofcode.com/2022/day/2">Day 2: Rock Paper Scissors</a></h1>
<section id="part-1-1" class="level2">
<h2 class="anchored" data-anchor-id="part-1-1">Part 1</h2>
<div class="cell" data-execution_count="4">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> [</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    [<span class="bu">ord</span>(x) <span class="op">-</span> <span class="bu">ord</span>(<span class="st">"A"</span>), <span class="bu">ord</span>(y) <span class="op">-</span> <span class="bu">ord</span>(<span class="st">"X"</span>)]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x, y <span class="kw">in</span> [x.split() <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">2</span>)]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>([line[<span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> ((line[<span class="dv">1</span>] <span class="op">-</span> line[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">3</span>) <span class="cf">for</span> line <span class="kw">in</span> lines])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-1" class="level2">
<h2 class="anchored" data-anchor-id="part-2-1">Part 2</h2>
<div class="cell" data-execution_count="5">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>([(line[<span class="dv">1</span>] <span class="op">+</span> line[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> line[<span class="dv">1</span>] <span class="cf">for</span> line <span class="kw">in</span> lines])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-3-rucksack-reorganization" class="level1">
<h1><a href="https://adventofcode.com/2022/day/3">Day 3: Rucksack Reorganization</a></h1>
<section id="part-1-2" class="level2">
<h2 class="anchored" data-anchor-id="part-1-2">Part 1</h2>
<div class="cell" data-execution_count="6">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> load(<span class="dv">3</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> lines:</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    letter <span class="op">=</span> <span class="bu">set</span>(l[: <span class="bu">len</span>(l) <span class="op">//</span> <span class="dv">2</span>]).intersection(<span class="bu">set</span>(l[<span class="bu">len</span>(l) <span class="op">//</span> <span class="dv">2</span> :])).pop()</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> <span class="bu">ord</span>(letter.upper()) <span class="op">-</span> <span class="bu">ord</span>(<span class="st">"A"</span>) <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">26</span> <span class="op">*</span> letter.isupper()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-2" class="level2">
<h2 class="anchored" data-anchor-id="part-2-2">Part 2</h2>
<div class="cell" data-execution_count="7">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> chunk <span class="kw">in</span> more_itertools.chunked(lines, <span class="dv">3</span>):</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    letter <span class="op">=</span> functools.<span class="bu">reduce</span>(<span class="kw">lambda</span> x, y: <span class="bu">set</span>(x).intersection(<span class="bu">set</span>(y)), chunk).pop()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> <span class="bu">ord</span>(letter.upper()) <span class="op">-</span> <span class="bu">ord</span>(<span class="st">"A"</span>) <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">26</span> <span class="op">*</span> letter.isupper()</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-4-camp-cleanup" class="level1">
<h1><a href="https://adventofcode.com/2022/day/4">Day 4: Camp Cleanup</a></h1>
<section id="part-1-3" class="level2">
<h2 class="anchored" data-anchor-id="part-1-3">Part 1</h2>
<div class="cell" data-execution_count="8">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>assignments <span class="op">=</span> load(<span class="dv">4</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>regex <span class="op">=</span> re.<span class="bu">compile</span>(<span class="st">"\d+"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>assignments <span class="op">=</span> <span class="bu">map</span>(<span class="kw">lambda</span> x: [<span class="bu">int</span>(y) <span class="cf">for</span> y <span class="kw">in</span> re.findall(regex, x)], assignments)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>assignments <span class="op">=</span> [<span class="bu">sorted</span>([a[:<span class="dv">2</span>], a[<span class="dv">2</span>:]]) <span class="cf">for</span> a <span class="kw">in</span> assignments]</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>((a[<span class="dv">1</span>] <span class="op">&gt;=</span> b[<span class="dv">1</span>] <span class="kw">or</span> a[<span class="dv">0</span>] <span class="op">==</span> b[<span class="dv">0</span>]) <span class="cf">for</span> a, b <span class="kw">in</span> assignments)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-3" class="level2">
<h2 class="anchored" data-anchor-id="part-2-3">Part 2</h2>
<div class="cell" data-execution_count="9">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>((a[<span class="dv">1</span>] <span class="op">&gt;=</span> b[<span class="dv">0</span>] <span class="kw">or</span> a[<span class="dv">0</span>] <span class="op">==</span> b[<span class="dv">0</span>]) <span class="cf">for</span> a, b <span class="kw">in</span> assignments)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-5-supply-stacks" class="level1">
<h1><a href="https://adventofcode.com/2022/day/5">Day 5: Supply Stacks</a></h1>
<section id="part-1-4" class="level2">
<h2 class="anchored" data-anchor-id="part-1-4">Part 1</h2>
<div class="cell" data-execution_count="10">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> load(<span class="dv">5</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>numbers <span class="op">=</span> [re.findall(<span class="st">"\d+"</span>, line) <span class="cf">for</span> line <span class="kw">in</span> lines]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>split <span class="op">=</span> np.argmax([<span class="bu">len</span>(x) <span class="cf">for</span> x <span class="kw">in</span> numbers])</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>instructions <span class="op">=</span> [[<span class="bu">int</span>(y) <span class="cf">for</span> y <span class="kw">in</span> x] <span class="cf">for</span> x <span class="kw">in</span> numbers[split <span class="op">+</span> <span class="dv">1</span> :] <span class="cf">if</span> x]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>initial_state <span class="op">=</span> <span class="bu">list</span>(itertools.zip_longest(<span class="op">*</span>lines[:split]))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>letters <span class="op">=</span> [re.findall(<span class="st">"[A-Z]"</span>, <span class="st">""</span>.join(column)) <span class="cf">for</span> column <span class="kw">in</span> initial_state]</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> [x[::<span class="op">-</span><span class="dv">1</span>] <span class="cf">for</span> x <span class="kw">in</span> letters.copy() <span class="cf">if</span> x]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n, source, dest <span class="kw">in</span> instructions:</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        p1[dest <span class="op">-</span> <span class="dv">1</span>].append(p1[source <span class="op">-</span> <span class="dv">1</span>].pop())</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">""</span>.join(x[<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> x <span class="cf">else</span> <span class="st">" "</span> <span class="cf">for</span> x <span class="kw">in</span> p1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-4" class="level2">
<h2 class="anchored" data-anchor-id="part-2-4">Part 2</h2>
<div class="cell" data-execution_count="11">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> [x[::<span class="op">-</span><span class="dv">1</span>] <span class="cf">for</span> x <span class="kw">in</span> letters.copy() <span class="cf">if</span> x]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n, source, dest <span class="kw">in</span> instructions:</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    p2[dest <span class="op">-</span> <span class="dv">1</span>] <span class="op">+=</span> p2[source <span class="op">-</span> <span class="dv">1</span>][<span class="op">-</span>n:]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    p2[source <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> p2[source <span class="op">-</span> <span class="dv">1</span>][:<span class="op">-</span>n]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">""</span>.join(x[<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> x <span class="cf">else</span> <span class="st">" "</span> <span class="cf">for</span> x <span class="kw">in</span> p2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-6-tuning-trouble" class="level1">
<h1><a href="https://adventofcode.com/2022/day/6">Day 6: Tuning Trouble</a></h1>
<section id="part-1-5" class="level2">
<h2 class="anchored" data-anchor-id="part-1-5">Part 1</h2>
<div class="cell" data-execution_count="12">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">6</span>)[<span class="dv">0</span>]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_marker(n):</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data) <span class="op">-</span> n <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(<span class="bu">set</span>(<span class="bu">list</span>(data[i : i <span class="op">+</span> n]))) <span class="op">==</span> n:</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> i <span class="op">+</span> n</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>find_marker(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-5" class="level2">
<h2 class="anchored" data-anchor-id="part-2-5">Part 2</h2>
<div class="cell" data-execution_count="13">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>find_marker(<span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-7-no-space-left-on-device" class="level1">
<h1><a href="https://adventofcode.com/2022/day/7">Day 7: No Space Left On Device</a></h1>
<section id="part-1-6" class="level2">
<h2 class="anchored" data-anchor-id="part-1-6">Part 1</h2>
<p>This requires a bit of tedious bookkeeping, but is otherwise straightforward.</p>
<p>Keeping track of full names is necessary, since “/foo/baz” and “/bar/baz” refer to two different directories.</p>
<p>The following code has a bug where it will show incorrect totals if the contents of the same directory are described more than once. Luckily, that doesn’t seem to ever happen.</p>
<div class="cell" data-execution_count="14">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> load(<span class="dv">7</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>directory <span class="op">=</span> {<span class="st">"/"</span>: {<span class="st">"children"</span>: [], <span class="st">"parent"</span>: <span class="va">None</span>, <span class="st">"weights"</span>: []}}</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_fullname(name, parent):</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>parent <span class="cf">if</span> parent <span class="op">!=</span> <span class="st">'/'</span> <span class="cf">else</span> <span class="st">''</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_directory(name, parent, directory):</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    fullname <span class="op">=</span> get_fullname(name, parent)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    directory[fullname] <span class="op">=</span> {<span class="st">"children"</span>: [], <span class="st">"parent"</span>: parent, <span class="st">"weights"</span>: []}</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    directory[parent][<span class="st">"children"</span>].append(fullname)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, line <span class="kw">in</span> <span class="bu">enumerate</span>(lines):</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"$ cd"</span> <span class="kw">in</span> line:</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        target <span class="op">=</span> line.split()[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> target <span class="op">==</span> <span class="st">".."</span>:</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>            cwd <span class="op">=</span> directory[cwd][<span class="st">"parent"</span>]</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> target <span class="op">==</span> <span class="st">"/"</span>:</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>            cwd <span class="op">=</span> <span class="st">"/"</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>            cwd <span class="op">=</span> get_fullname(target, cwd)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> line[<span class="dv">0</span>] <span class="op">!=</span> <span class="st">"$"</span>:</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>        metadata, name <span class="op">=</span> line.split()</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> metadata <span class="op">==</span> <span class="st">"dir"</span>:</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> name <span class="kw">not</span> <span class="kw">in</span> directory:</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>                add_directory(name, cwd, directory)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>            directory[cwd][<span class="st">"weights"</span>].append(<span class="bu">int</span>(metadata))</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> {}</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_weights(node):</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node <span class="kw">not</span> <span class="kw">in</span> weights:</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>        weights[node] <span class="op">=</span> <span class="bu">sum</span>(directory[node][<span class="st">"weights"</span>]) <span class="op">+</span> <span class="bu">sum</span>(</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>            calculate_weights(node) <span class="cf">for</span> node <span class="kw">in</span> directory[node][<span class="st">"children"</span>]</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> weights[node]</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>calculate_weights(<span class="st">"/"</span>)</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(weight <span class="cf">for</span> weight <span class="kw">in</span> weights.values() <span class="cf">if</span> weight <span class="op">&lt;=</span> <span class="dv">100_000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-6" class="level2">
<h2 class="anchored" data-anchor-id="part-2-6">Part 2</h2>
<p>The weight of every directory has been stored in the weight dict, so finding the smallest one that’s greater than a given threshold is trivial</p>
<div class="cell" data-execution_count="15">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>to_free <span class="op">=</span> weights[<span class="st">"/"</span>] <span class="op">-</span> <span class="dv">40_000_000</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">min</span>(weight <span class="cf">for</span> weight <span class="kw">in</span> weights.values() <span class="cf">if</span> weight <span class="op">&gt;=</span> to_free)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-8-treetop-tree-house" class="level1">
<h1><a href="https://adventofcode.com/2022/day/8">Day 8: Treetop Tree House</a></h1>
<section id="part-1-7" class="level2">
<h2 class="anchored" data-anchor-id="part-1-7">Part 1</h2>
<p>It really feels like there should be a slick array-based solution to this: calculate the cumulative max from each of the four directions, take the minimum of those four and compare with our array. But it doesn’t seem like numpy has easy functionality for calculating the cumulative max.</p>
<p>A bit off digging reveals the very useful ufunc <code>accumulate</code>, which does exactly what we need. Then it’s just a question of getting it to work in the four directions. Either we change the axis and direction of operation, or (as here) we transform the data from one orientation to another, do the accumulation, and transform back at the end.</p>
<div class="cell" data-execution_count="16">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.array([[<span class="bu">int</span>(char) <span class="cf">for</span> char <span class="kw">in</span> line] <span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">8</span>)])</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>masks <span class="op">=</span> []</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    transformed <span class="op">=</span> np.rot90(data, i)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> np.roll(np.maximum.accumulate(transformed), <span class="dv">1</span>, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    mask[<span class="dv">0</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    masks.append(np.rot90(mask, <span class="dv">4</span> <span class="op">-</span> i))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> np.<span class="bu">min</span>(masks, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>(data <span class="op">&gt;</span> mask).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-7" class="level2">
<h2 class="anchored" data-anchor-id="part-2-7">Part 2</h2>
<p>The conceptual approach for this is similar - find a way of calculating the score in one direction, then transform the data to use that operation for the other directions.</p>
<p>There are a couple of gotchas:</p>
<ul>
<li>The elves’ sightlines are blocked by trees of the same height, not just by trees of greater height. If we want to leverage <code>maximum</code> as an indicator, we need to decrease the value of the tree under consideration by one, since otherwise there’s no way of distinguishing between a, a - 1 (not blocked) and a, a (blocked).</li>
<li>The elves can see the tree that they’re being blocked by. If we try to account for this by just adding one to all the sightlines, we’ll get a bug when they can see all the way to the edge. Instead, we pretend that they can always see the last tree in the forest</li>
</ul>
<div class="cell" data-execution_count="17">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> scenic_score(data):</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> one_row(i):</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""How many trees can be seen looking down from row i"""</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>        current <span class="op">=</span> data.copy()</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        current[i] <span class="op">=</span> current[i] <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        mask <span class="op">=</span> np.maximum.accumulate(np.roll(current, <span class="op">-</span>i, axis<span class="op">=</span><span class="dv">0</span>)) <span class="op">&lt;=</span> current[i]</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        mask[<span class="op">-</span>i <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> mask[<span class="dv">1</span> : <span class="bu">len</span>(data) <span class="op">-</span> i].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array([one_row(i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data))])</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>scenic_scores <span class="op">=</span> []</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    scenic_scores.append(np.rot90(scenic_score(np.rot90(data, i)), <span class="dv">4</span> <span class="op">-</span> i))</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>np.product(scenic_scores, axis<span class="op">=</span><span class="dv">0</span>).<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="bonus" class="level2">
<h2 class="anchored" data-anchor-id="bonus">Bonus</h2>
<p>The grid here invites plotting. One thing we can plot is the shortest tree which would be visible at each location</p>
<div class="cell" data-execution_count="18">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>plt.imshow(mask <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>plt.xticks([]), plt.yticks([])</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> plt.colorbar()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2022_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">The shortest visible tree at each location</figcaption>
</figure>
</div>
</div>
</div>
<p>We can see how at the edges of the forest shorter trees are visible, but towards the center they’ve all been shadowed by taller trees.</p>
</section>
</section>
<section id="day-9-rope-bridge" class="level1">
<h1><a href="https://adventofcode.com/2022/day/9">Day 9: Rope Bridge</a></h1>
<section id="part-1-8" class="level2">
<h2 class="anchored" data-anchor-id="part-1-8">Part 1</h2>
<div class="cell" data-execution_count="19">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> {<span class="dv">2</span>: <span class="dv">1</span>, <span class="dv">2</span> <span class="op">+</span> <span class="ot">1j</span>: <span class="dv">1</span> <span class="op">+</span> <span class="ot">1j</span>, <span class="dv">2</span> <span class="op">+</span> <span class="ot">2j</span>: <span class="dv">1</span> <span class="op">+</span> <span class="ot">1j</span>, <span class="dv">1</span> <span class="op">+</span> <span class="ot">2j</span>: <span class="dv">1</span> <span class="op">+</span> <span class="ot">1j</span>}</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>deltas <span class="op">=</span> {k <span class="op">*</span> <span class="ot">1j</span><span class="op">**</span>i: v <span class="op">*</span> <span class="ot">1j</span><span class="op">**</span>i <span class="cf">for</span> k, v <span class="kw">in</span> base.items() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>)}</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>directions <span class="op">=</span> {<span class="st">"R"</span>: <span class="dv">1</span>, <span class="st">"L"</span>: <span class="op">-</span><span class="dv">1</span>, <span class="st">"U"</span>: <span class="ot">1j</span>, <span class="st">"D"</span>: <span class="op">-</span><span class="ot">1j</span>}</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>instructions <span class="op">=</span> [x.split() <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">9</span>)]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tail_moves(rope_length):</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    seen <span class="op">=</span> []</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    rope <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> rope_length</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> direction, count <span class="kw">in</span> instructions:</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">int</span>(count)):</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>            rope[<span class="dv">0</span>] <span class="op">+=</span> directions[direction]</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(rope)):</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                rope[i] <span class="op">+=</span> (</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                    deltas[rope[i <span class="op">-</span> <span class="dv">1</span>] <span class="op">-</span> rope[i]]</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">abs</span>(rope[i <span class="op">-</span> <span class="dv">1</span>] <span class="op">-</span> rope[i]) <span class="op">&gt;=</span> <span class="dv">2</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>            seen.append(rope[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> seen</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="bu">set</span>(tail_moves(<span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-8" class="level2">
<h2 class="anchored" data-anchor-id="part-2-8">Part 2</h2>
<div class="cell" data-execution_count="20">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="bu">set</span>(tail_moves(<span class="dv">10</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-10-cathode-ray-tube" class="level1">
<h1><a href="https://adventofcode.com/2022/day/10">Day 10: Cathode-Ray Tube</a></h1>
<section id="part-1-9" class="level2">
<h2 class="anchored" data-anchor-id="part-1-9">Part 1</h2>
<div class="cell" data-execution_count="21">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>instructions <span class="op">=</span> load(<span class="dv">10</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>deltas <span class="op">=</span> [</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">int</span>(element) <span class="cf">if</span> element[<span class="op">-</span><span class="dv">1</span>].isdigit() <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> line <span class="kw">in</span> instructions</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> element <span class="kw">in</span> line.split()</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run(f, result):</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cycle, x <span class="kw">in</span> <span class="bu">enumerate</span>(np.cumsum([<span class="dv">1</span>] <span class="op">+</span> deltas)):</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> f(x, cycle <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>run(<span class="kw">lambda</span> x, y: x <span class="op">*</span> y <span class="cf">if</span> y <span class="op">%</span> <span class="dv">40</span> <span class="op">==</span> <span class="dv">20</span> <span class="cf">else</span> <span class="dv">0</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-9" class="level2">
<h2 class="anchored" data-anchor-id="part-2-9">Part 2</h2>
<div class="cell" data-execution_count="22">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> draw_sprite(sprite_position, cycle):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"█"</span> <span class="cf">if</span> <span class="bu">abs</span>(sprite_position <span class="op">-</span> ((cycle <span class="op">-</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">40</span>)) <span class="op">&lt;=</span> <span class="dv">1</span> <span class="cf">else</span> <span class="st">" "</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>[run(draw_sprite, <span class="st">""</span>)[<span class="dv">40</span> <span class="op">*</span> i : <span class="dv">40</span> <span class="op">*</span> (i <span class="op">+</span> <span class="dv">1</span>)] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)], sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-11-monkey-in-the-middle" class="level1">
<h1><a href="https://adventofcode.com/2022/day/11">Day 11: Monkey in the Middle</a></h1>
<section id="part-1-10" class="level2">
<h2 class="anchored" data-anchor-id="part-1-10">Part 1</h2>
<div class="cell" data-execution_count="23">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">11</span>, <span class="st">"raw"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>monkeys <span class="op">=</span> data.split(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Monkey:</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, update, test):</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.update <span class="op">=</span> update</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.factor <span class="op">=</span> test[<span class="dv">0</span>]</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.target <span class="op">=</span> <span class="kw">lambda</span> x: test[<span class="dv">1</span>] <span class="cf">if</span> x <span class="op">%</span> <span class="va">self</span>.factor <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> test[<span class="dv">2</span>]</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>monkeys <span class="op">=</span> []</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>initial_items <span class="op">=</span> []</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> monkey <span class="kw">in</span> data.split(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>):</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> [line <span class="cf">for</span> line <span class="kw">in</span> monkey.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>) <span class="cf">if</span> line]</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    update <span class="op">=</span> <span class="bu">eval</span>(<span class="st">"lambda old: "</span> <span class="op">+</span> lines[<span class="dv">2</span>].split(<span class="st">" = "</span>)[<span class="dv">1</span>])</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    digits <span class="op">=</span> [[<span class="bu">int</span>(x) <span class="cf">for</span> x <span class="kw">in</span> re.findall(<span class="st">"\d+"</span>, line)] <span class="cf">for</span> line <span class="kw">in</span> lines]</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    monkeys.append(Monkey(update, [x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> digits[<span class="op">-</span><span class="dv">3</span>:]]))</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    initial_items.append(digits[<span class="dv">1</span>])</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run(rounds, function):</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    examined <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> <span class="bu">len</span>(monkeys)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> monkey, items <span class="kw">in</span> <span class="bu">zip</span>(monkeys, initial_items):</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>        monkey.items <span class="op">=</span> items.copy()</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(rounds):</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, monkey <span class="kw">in</span> <span class="bu">enumerate</span>(monkeys):</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>            examined[idx] <span class="op">+=</span> <span class="bu">len</span>(monkey.items)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(monkey.items)):</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>                item <span class="op">=</span> function((monkey.update(monkey.items.pop())))</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>                monkeys[monkey.target(item)].items.append(item)</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> examined</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>np.product(<span class="bu">sorted</span>(run(<span class="dv">20</span>, <span class="kw">lambda</span> x: x <span class="op">//</span> <span class="dv">3</span>))[<span class="op">-</span><span class="dv">2</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-10" class="level2">
<h2 class="anchored" data-anchor-id="part-2-10">Part 2</h2>
<div class="cell" data-execution_count="24">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>common_multiple <span class="op">=</span> np.product([x.factor <span class="cf">for</span> x <span class="kw">in</span> monkeys])</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>np.product(<span class="bu">sorted</span>(run(<span class="dv">10000</span>, <span class="kw">lambda</span> x: x <span class="op">%</span> common_multiple))[<span class="op">-</span><span class="dv">2</span>:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-12-hill-climbing-algorithm" class="level1">
<h1><a href="https://adventofcode.com/2022/day/12">Day 12: Hill Climbing Algorithm</a></h1>
<section id="part-1-11" class="level2">
<h2 class="anchored" data-anchor-id="part-1-11">Part 1</h2>
<div class="cell" data-execution_count="25">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [<span class="bu">list</span>(x) <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">12</span>)]</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>elevations <span class="op">=</span> np.array([[<span class="bu">ord</span>(char) <span class="op">-</span> <span class="bu">ord</span>(<span class="st">"a"</span>) <span class="cf">for</span> char <span class="kw">in</span> line] <span class="cf">for</span> line <span class="kw">in</span> data])</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>source <span class="op">=</span> <span class="bu">tuple</span>(x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> np.where(elevations <span class="op">==</span> <span class="bu">ord</span>(<span class="st">"S"</span>) <span class="op">-</span> <span class="bu">ord</span>(<span class="st">"a"</span>)))</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> <span class="bu">tuple</span>(x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> np.where(elevations <span class="op">==</span> <span class="bu">ord</span>(<span class="st">"E"</span>) <span class="op">-</span> <span class="bu">ord</span>(<span class="st">"a"</span>)))</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>elevations[source] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>elevations[target] <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>xmax, ymax <span class="op">=</span> elevations.shape</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> grid_neighbors(x, y):</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    candidates <span class="op">=</span> [(x <span class="op">-</span> <span class="dv">1</span>, y), (x <span class="op">+</span> <span class="dv">1</span>, y), (x, y <span class="op">-</span> <span class="dv">1</span>), (x, y <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [c <span class="cf">for</span> c <span class="kw">in</span> candidates <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;=</span> c[<span class="dv">0</span>] <span class="op">&lt;</span> xmax <span class="kw">and</span> <span class="dv">0</span> <span class="op">&lt;=</span> c[<span class="dv">1</span>] <span class="op">&lt;</span> ymax]</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_neighbors(x, y):</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [n <span class="cf">for</span> n <span class="kw">in</span> grid_neighbors(x, y) <span class="cf">if</span> elevations[n] <span class="op">-</span> elevations[x, y] <span class="op">&lt;=</span> <span class="dv">1</span>]</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> navigate(source, neighbor_func, stop_condition):</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    active <span class="op">=</span> deque([(<span class="dv">0</span>, source)])</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    seen <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> active:</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>        steps, current <span class="op">=</span> active.popleft()</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> stop_condition(current):</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> steps</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> current <span class="kw">in</span> seen:</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>        seen.add(current)</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> neighbor <span class="kw">in</span> neighbor_func(<span class="op">*</span>current):</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>            active.append((steps <span class="op">+</span> <span class="dv">1</span>, neighbor))</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.inf</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>navigate(source, find_neighbors, <span class="kw">lambda</span> x: x <span class="op">==</span> target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-11" class="level2">
<h2 class="anchored" data-anchor-id="part-2-11">Part 2</h2>
<div class="cell" data-execution_count="26">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reversed_neighbors(x, y):</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [n <span class="cf">for</span> n <span class="kw">in</span> grid_neighbors(x, y) <span class="cf">if</span> elevations[x, y] <span class="op">-</span> elevations[n] <span class="op">&lt;=</span> <span class="dv">1</span>]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>navigate(target, reversed_neighbors, <span class="kw">lambda</span> x: elevations[x] <span class="op">==</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-13-distress-signal" class="level1">
<h1><a href="https://adventofcode.com/2022/day/13">Day 13: Distress Signal</a></h1>
<section id="part-1-12" class="level2">
<h2 class="anchored" data-anchor-id="part-1-12">Part 1</h2>
<div class="cell" data-execution_count="27">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ast</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compare(left, right):</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(left, <span class="bu">int</span>) <span class="kw">and</span> <span class="bu">isinstance</span>(right, <span class="bu">int</span>):</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (left <span class="op">&gt;</span> right) <span class="op">+</span> (left <span class="op">&gt;=</span> right)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(left, <span class="bu">int</span>):</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> compare([left], right)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(right, <span class="bu">int</span>):</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> compare(left, [right])</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> left <span class="kw">and</span> <span class="kw">not</span> right:</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> left:</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> right:</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">2</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> compare(left[<span class="dv">0</span>], right[<span class="dv">0</span>])</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> val <span class="cf">if</span> (val <span class="op">==</span> <span class="dv">0</span> <span class="kw">or</span> val <span class="op">==</span> <span class="dv">2</span>) <span class="cf">else</span> compare(left[<span class="dv">1</span>:], right[<span class="dv">1</span>:])</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> load(<span class="dv">13</span>, <span class="st">"raw"</span>)[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, (left, right) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: x.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>), s.split(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>))):</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> compare(ast.literal_eval(left), ast.literal_eval(right))</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> val <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> idx <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-12" class="level2">
<h2 class="anchored" data-anchor-id="part-2-12">Part 2</h2>
<div class="cell" data-execution_count="28">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>dividers <span class="op">=</span> [[<span class="dv">2</span>]], [[<span class="dv">6</span>]]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>packets <span class="op">=</span> [</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    ast.literal_eval(packet) <span class="cf">for</span> pair <span class="kw">in</span> s.split(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>) <span class="cf">for</span> packet <span class="kw">in</span> pair.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>positions <span class="op">=</span> [</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">sum</span>(compare(divider, packet) <span class="op">==</span> <span class="dv">2</span> <span class="cf">for</span> packet <span class="kw">in</span> packets) <span class="cf">for</span> divider <span class="kw">in</span> dividers</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>(positions[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> (positions[<span class="dv">1</span>] <span class="op">+</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-14-regolith-reservoir" class="level1">
<h1><a href="https://adventofcode.com/2022/day/14">Day 14: Regolith Reservoir</a></h1>
<section id="part-1-13" class="level2">
<h2 class="anchored" data-anchor-id="part-1-13">Part 1</h2>
<div class="cell" data-execution_count="29">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">14</span>, <span class="st">"int"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>flat <span class="op">=</span> [val <span class="cf">for</span> line <span class="kw">in</span> data <span class="cf">for</span> val <span class="kw">in</span> line]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>xmin, xmax <span class="op">=</span> <span class="bu">min</span>(flat[::<span class="dv">2</span>]), <span class="bu">max</span>(flat[::<span class="dv">2</span>])</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>ymin, ymax <span class="op">=</span> <span class="bu">min</span>(flat[<span class="dv">1</span>::<span class="dv">2</span>]), <span class="bu">max</span>(flat[<span class="dv">1</span>::<span class="dv">2</span>])</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>air, rock, sand <span class="op">=</span> <span class="bu">ord</span>(<span class="st">"."</span>), <span class="bu">ord</span>(<span class="st">"#"</span>), <span class="bu">ord</span>(<span class="st">"o"</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>board <span class="op">=</span> np.zeros((ymax <span class="op">+</span> <span class="dv">1</span>, xmax <span class="op">-</span> xmin <span class="op">+</span> <span class="dv">3</span>), dtype<span class="op">=</span><span class="bu">int</span>) <span class="op">+</span> air</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> data:</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    chunks <span class="op">=</span> <span class="bu">list</span>(more_itertools.chunked(line, <span class="dv">2</span>))</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (current_x, current_y), (next_x, next_y) <span class="kw">in</span> <span class="bu">zip</span>(chunks, chunks[<span class="dv">1</span>:]):</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        current_y, next_y <span class="op">=</span> <span class="bu">sorted</span>([current_y, next_y])</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>        current_x, next_x <span class="op">=</span> <span class="bu">sorted</span>([current_x, next_x])</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> current_x <span class="op">==</span> next_x:</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>            board[current_y : next_y <span class="op">+</span> <span class="dv">1</span>, current_x <span class="op">-</span> xmin <span class="op">+</span> <span class="dv">1</span>] <span class="op">=</span> rock</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>            board[current_y, current_x <span class="op">-</span> xmin <span class="op">+</span> <span class="dv">1</span> : next_x <span class="op">-</span> xmin <span class="op">+</span> <span class="dv">2</span>] <span class="op">=</span> rock</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>initial_board <span class="op">=</span> board.copy()</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> <span class="dv">0</span>, <span class="dv">500</span> <span class="op">-</span> xmin <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>y, x <span class="op">=</span> start</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> y <span class="op">+</span> <span class="dv">1</span> <span class="op">&lt;</span> board.shape[<span class="dv">0</span>]:</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> board[y <span class="op">+</span> <span class="dv">1</span>, x] <span class="op">==</span> air:</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>        y <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> board[y <span class="op">+</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span>] <span class="op">==</span> air:</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>        y, x <span class="op">=</span> y <span class="op">+</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> board[y <span class="op">+</span> <span class="dv">1</span>, x <span class="op">+</span> <span class="dv">1</span>] <span class="op">==</span> air:</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>        y, x <span class="op">=</span> y <span class="op">+</span> <span class="dv">1</span>, x <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>        board[y, x] <span class="op">=</span> sand</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>        y, x <span class="op">=</span> start</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>(board <span class="op">==</span> sand).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-13" class="level2">
<h2 class="anchored" data-anchor-id="part-2-13">Part 2</h2>
<div class="cell" data-execution_count="30">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>board <span class="op">=</span> np.vstack([initial_board, np.zeros((<span class="dv">2</span>, board.shape[<span class="dv">1</span>]), dtype<span class="op">=</span><span class="bu">int</span>) <span class="op">+</span> air])</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>pad_width <span class="op">=</span> (board.shape[<span class="dv">0</span>] <span class="op">*</span> <span class="dv">2</span> <span class="op">-</span> board.shape[<span class="dv">1</span>]) <span class="op">//</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>padding <span class="op">=</span> np.zeros((board.shape[<span class="dv">0</span>], pad_width), dtype<span class="op">=</span><span class="bu">int</span>) <span class="op">+</span> air</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>board <span class="op">=</span> np.hstack([padding, board, padding])</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>board[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> rock</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> <span class="dv">0</span>, <span class="dv">500</span> <span class="op">-</span> xmin <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> pad_width</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>y, x <span class="op">=</span> start</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> board[y <span class="op">+</span> <span class="dv">1</span>, x] <span class="op">==</span> air:</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        y <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> board[y <span class="op">+</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span>] <span class="op">==</span> air:</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>        y, x <span class="op">=</span> y <span class="op">+</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> board[y <span class="op">+</span> <span class="dv">1</span>, x <span class="op">+</span> <span class="dv">1</span>] <span class="op">==</span> air:</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>        y, x <span class="op">=</span> y <span class="op">+</span> <span class="dv">1</span>, x <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        board[y, x] <span class="op">=</span> sand</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (y, x) <span class="op">==</span> start:</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>        y, x <span class="op">=</span> start</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>(board <span class="op">==</span> sand).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-15-beacon-exclusion-zone" class="level1">
<h1><a href="https://adventofcode.com/2022/day/15">Day 15: Beacon Exclusion Zone</a></h1>
<section id="part-1-14" class="level2">
<h2 class="anchored" data-anchor-id="part-1-14">Part 1</h2>
<div class="cell" data-execution_count="31">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> combine_two_intervals(i1, i2):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    i1, i2 <span class="op">=</span> <span class="bu">sorted</span>([i1, i2])</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i2[<span class="dv">0</span>] <span class="op">&lt;=</span> i1[<span class="dv">1</span>]:</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> i1[<span class="dv">0</span>], <span class="bu">max</span>(i1[<span class="dv">1</span>], i2[<span class="dv">1</span>])</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> combine_n_intervals(intervals):</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    active <span class="op">=</span> intervals.copy()</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> []</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> active:</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>        current <span class="op">=</span> active.pop()</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> index, previous <span class="kw">in</span> <span class="bu">enumerate</span>(result):</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>            new_interval <span class="op">=</span> combine_two_intervals(current, previous)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> new_interval:</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>                <span class="kw">del</span> result[index]</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>                active.append(new_interval)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>            result.append(current)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>y_target <span class="op">=</span> <span class="dv">2000000</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>fixes <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>intervals <span class="op">=</span> []</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, y, u, v <span class="kw">in</span> load(<span class="dv">15</span>, <span class="st">"int"</span>):</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> <span class="bu">abs</span>(x <span class="op">-</span> u) <span class="op">+</span> <span class="bu">abs</span>(y <span class="op">-</span> v)</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> v <span class="op">==</span> y_target:</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>        fixes.add(u)</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>    available <span class="op">=</span> r <span class="op">-</span> <span class="bu">abs</span>(y <span class="op">-</span> y_target)</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> available <span class="op">&gt;=</span> <span class="dv">0</span>:</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>        interval <span class="op">=</span> x <span class="op">-</span> available, x <span class="op">+</span> available <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>        intervals <span class="op">+=</span> [interval]</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>intervals <span class="op">=</span> combine_n_intervals(intervals)</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(x[<span class="dv">1</span>] <span class="op">-</span> x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> intervals) <span class="op">-</span> <span class="bu">len</span>(fixes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-14" class="level2">
<h2 class="anchored" data-anchor-id="part-2-14">Part 2</h2>
<p>To solve this quickly, we need to move from a representation of the problem in terms of the covered points to one that considers the beacons as the central object. From the problem description, we can see that the point we are interested in must lie just out of range of at least two beacons, since otherwise there would be more than one point which satisfies the criteria.</p>
<p>We’ll do a coordinate transformation so that we’re working in a basis of (x + y, x - y) coordinates; in that basis, the area covered by each beacon is an axis-aligned square. Determining whether (and where) two squares intersect can be done by looking at the two axes of the square separately. We can thus loop over pairs of beacons, and for each pair identify the points which would be just out of range of both beacons; for each of these points we can check whether it is in range of any of the other beacons. If it is not, we have found the point we were interested in and we are finished.</p>
<div class="cell" data-execution_count="32">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.array(load(<span class="dv">15</span>, <span class="st">"int"</span>))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>radii <span class="op">=</span> <span class="bu">abs</span>(np.squeeze(np.diff(data.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>), axis<span class="op">=</span><span class="dv">1</span>))).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>diamonds <span class="op">=</span> np.hstack([data[:, :<span class="dv">2</span>] <span class="op">@</span> [[<span class="dv">1</span>, <span class="dv">1</span>], [<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>]], radii.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)])</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> intersect_intervals(i0, i1):</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    new_left <span class="op">=</span> <span class="bu">max</span>(i0[<span class="dv">0</span>], i1[<span class="dv">0</span>])</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    new_right <span class="op">=</span> <span class="bu">min</span>(i0[<span class="dv">1</span>], i1[<span class="dv">1</span>])</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [new_left, new_right] <span class="cf">if</span> new_right <span class="op">&gt;=</span> new_left <span class="cf">else</span> []</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_on_square(point, centre, radius):</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">abs</span>(point[<span class="dv">0</span>] <span class="op">-</span> centre[<span class="dv">0</span>]) <span class="op">==</span> radius <span class="kw">or</span> <span class="bu">abs</span>(point[<span class="dv">1</span>] <span class="op">-</span> centre[<span class="dv">1</span>]) <span class="op">==</span> radius</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> intersect_diamonds(d0, d1):</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    x0, y0, r0 <span class="op">=</span> d0</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    x1, y1, r1 <span class="op">=</span> d1</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (x0 <span class="op">+</span> r0) <span class="op">%</span> <span class="dv">2</span> <span class="op">!=</span> (x1 <span class="op">+</span> r1) <span class="op">%</span> <span class="dv">2</span>:</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> []</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> intersect_intervals((x0 <span class="op">-</span> r0, x0 <span class="op">+</span> r0), (x1 <span class="op">-</span> r1, x1 <span class="op">+</span> r1)):</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> y <span class="kw">in</span> intersect_intervals((y0 <span class="op">-</span> r0, y0 <span class="op">+</span> r0), (y1 <span class="op">-</span> r1, y1 <span class="op">+</span> r1)):</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> is_on_square((x, y), (x0, y0), r0) <span class="kw">and</span> is_on_square(</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>                (x, y), (x1, y1), r1</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>            ):</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>                result.append((x, y))</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>done <span class="op">=</span> <span class="va">False</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>limit <span class="op">=</span> <span class="dv">4000000</span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> d0 <span class="kw">in</span> diamonds <span class="op">+</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>]:</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> d1 <span class="kw">in</span> diamonds <span class="op">+</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>]:</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (d0 <span class="op">==</span> d1).<span class="bu">all</span>():</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> x0, y0 <span class="kw">in</span> intersect_diamonds(d0, d1):</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> x, y, r <span class="kw">in</span> diamonds:</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">abs</span>(x0 <span class="op">-</span> x) <span class="op">&lt;=</span> r <span class="kw">and</span> <span class="bu">abs</span>(y0 <span class="op">-</span> y) <span class="op">&lt;=</span> r:</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>                real_x, real_y <span class="op">=</span> (x0 <span class="op">+</span> y0) <span class="op">//</span> <span class="dv">2</span>, (x0 <span class="op">-</span> y0) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">abs</span>(real_x) <span class="op">&lt;=</span> limit <span class="kw">and</span> <span class="bu">abs</span>(real_y) <span class="op">&lt;=</span> limit:</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>                    done <span class="op">=</span> <span class="va">True</span></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> done:</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> done:</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>limit <span class="op">*</span> real_x <span class="op">+</span> real_y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="33">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>centres <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">0</span>]])</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>radii <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>d0, d1 <span class="op">=</span> np.hstack([centres <span class="op">@</span> [[<span class="dv">1</span>, <span class="dv">1</span>], [<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>]], radii.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)])</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>intersect_diamonds(d0, d1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-16-proboscidea-volcanium" class="level1">
<h1><a href="https://adventofcode.com/2021/day/16">Day 16: Proboscidea Volcanium</a></h1>
<section id="part-1-15" class="level2">
<h2 class="anchored" data-anchor-id="part-1-15">Part 1</h2>
<p>We should start by loading the data, and trying to visualize the graph</p>
<div class="cell" data-execution_count="34">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sknetwork</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>graph <span class="op">=</span> {}</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>pressures <span class="op">=</span> {}</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">16</span>):</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    pressure <span class="op">=</span> <span class="bu">int</span>(re.findall(<span class="vs">r"\d+"</span>, line)[<span class="dv">0</span>])</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    left, right <span class="op">=</span> line.split(<span class="st">";"</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    node <span class="op">=</span> left.split()[<span class="dv">1</span>]</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> [</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>        x.strip() <span class="cf">for</span> x <span class="kw">in</span> re.sub(<span class="st">".*valves? (.*)"</span>, <span class="vs">r"\1"</span>, right[:<span class="op">-</span><span class="dv">1</span>]).split(<span class="st">","</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    graph[node] <span class="op">=</span> neighbors</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pressure <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>        pressures[node] <span class="op">=</span> pressure</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sknetwork.data.from_adjacency_list(graph, weighted<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> SVG</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sknetwork.embedding.force_atlas <span class="im">import</span> ForceAtlas</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>forceatlas2 <span class="op">=</span> ForceAtlas()</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>embedding <span class="op">=</span> forceatlas2.fit_transform(g.adjacency)</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>image <span class="op">=</span> sknetwork.visualization.svg_graph(g.adjacency, embedding, names<span class="op">=</span>g.names)</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>SVG(image)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="5">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2022_files/figure-html/cell-35-output-1.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">The network of rooms and valves, and how they link together</figcaption>
</figure>
</div>
</div>
</div>
<p>Looks pretty cool!</p>
<div class="cell" data-execution_count="35">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>distances <span class="op">=</span> {</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    (j, i): <span class="dv">0</span> <span class="cf">if</span> i <span class="op">==</span> j <span class="cf">else</span> <span class="dv">100</span> <span class="cf">if</span> i <span class="kw">not</span> <span class="kw">in</span> graph[j] <span class="cf">else</span> <span class="dv">1</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> graph</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> graph</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Very slick Floyd-Warshall: The distance between two nodes i and j is the minimum over</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># all paths from i to j, which in turn is the minimum of the sum d(i, k) + d(j,</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># k) over all nodes k. Shamelessly stolen. Could have been done with some</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># pathfinding instead, but that would have been slower.</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k, i, j <span class="kw">in</span> itertools.permutations(graph, <span class="dv">3</span>):</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    distances[i, j] <span class="op">=</span> <span class="bu">min</span>(distances[i, j], distances[i, k] <span class="op">+</span> distances[k, j])</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> expand(node, time_remaining):</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> {}</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each possible set of open valves, we store the result of opening them</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># in the optimal order. We take care not to exceed the time alloted to us,</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and not to open a valve twice.</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> inner(node, time_remaining, used_valves, flow):</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>        result[used_valves] <span class="op">=</span> <span class="bu">max</span>(result.get(used_valves, <span class="dv">0</span>), flow)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> other_node, pressure <span class="kw">in</span> pressures.items():</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>            new_time_remaining <span class="op">=</span> time_remaining <span class="op">-</span> distances[node, other_node] <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> new_time_remaining <span class="op">&lt;=</span> <span class="dv">0</span> <span class="kw">or</span> other_node <span class="kw">in</span> used_valves:</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>            inner(</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>                other_node,</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>                new_time_remaining,</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>                used_valves <span class="op">|</span> <span class="bu">frozenset</span>([other_node]),</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>                flow <span class="op">+</span> new_time_remaining <span class="op">*</span> pressure,</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>    inner(node, time_remaining, <span class="bu">frozenset</span>(), <span class="dv">0</span>)</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a><span class="co"># The result for part 1 is then</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>(expand(<span class="st">"AA"</span>, <span class="dv">30</span>).values())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-15" class="level2">
<h2 class="anchored" data-anchor-id="part-2-15">Part 2</h2>
<p>For part 2, we don’t need to consider the two agents together. We can just find the best pair of valve sets with no overlaps.</p>
<div class="cell" data-execution_count="36">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>part2_paths <span class="op">=</span> expand(<span class="st">"AA"</span>, <span class="dv">26</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    v1 <span class="op">+</span> v2</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> s1, v1 <span class="kw">in</span> part2_paths.items()</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> s2, v2 <span class="kw">in</span> part2_paths.items()</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> (s1 <span class="op">&amp;</span> s2)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-17-pyroclastic-flow" class="level1">
<h1><a href="https://adventofcode.com/2022/day/17">Day 17: Pyroclastic Flow</a></h1>
<section id="part-1-16" class="level2">
<h2 class="anchored" data-anchor-id="part-1-16">Part 1</h2>
<div class="cell" data-execution_count="37">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>shapes <span class="op">=</span> [</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    np.array(</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>        [[<span class="dv">0</span> <span class="cf">if</span> char <span class="op">==</span> <span class="st">"."</span> <span class="cf">else</span> <span class="dv">1</span> <span class="cf">for</span> char <span class="kw">in</span> line] <span class="cf">for</span> line <span class="kw">in</span> x.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)],</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>        dtype<span class="op">=</span><span class="bu">bool</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> [<span class="st">"####"</span>, <span class="st">".#.</span><span class="ch">\n</span><span class="st">###</span><span class="ch">\n</span><span class="st">.#."</span>, <span class="st">"..#</span><span class="ch">\n</span><span class="st">..#</span><span class="ch">\n</span><span class="st">###"</span>, <span class="st">"#</span><span class="ch">\n</span><span class="st">#</span><span class="ch">\n</span><span class="st">#</span><span class="ch">\n</span><span class="st">#"</span>, <span class="st">"##</span><span class="ch">\n</span><span class="st">##"</span>]</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>directions <span class="op">=</span> load(<span class="dv">17</span>, <span class="st">"raw"</span>).strip()</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> has_collision(x, y, shape, board):</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> y <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    height, width <span class="op">=</span> shape.shape</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    window <span class="op">=</span> np.pad(</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>        shape[<span class="bu">max</span>(<span class="dv">0</span>, height <span class="op">-</span> y <span class="op">-</span> <span class="dv">1</span>) :],</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>        [[<span class="dv">0</span>, <span class="dv">0</span>], [x, <span class="dv">7</span> <span class="op">-</span> x <span class="op">-</span> width]],</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"constant"</span>,</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    top_of_window <span class="op">=</span> y <span class="op">-</span> window.shape[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (board[top_of_window : top_of_window <span class="op">+</span> window.shape[<span class="dv">0</span>]] <span class="op">&amp;</span> window).<span class="bu">any</span>()</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_height(directions, n<span class="op">=</span><span class="dv">2022</span>):</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    board <span class="op">=</span> np.ones((<span class="dv">1</span>, <span class="dv">7</span>), dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    discard <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>    seen <span class="op">=</span> {}</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    cycle_length <span class="op">=</span> <span class="va">None</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>        shape <span class="op">=</span> shapes[i <span class="op">%</span> <span class="bu">len</span>(shapes)]</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>        height, width <span class="op">=</span> shape.shape</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> <span class="dv">2</span>, <span class="op">-</span><span class="dv">4</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>            direction <span class="op">=</span> directions[d]</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>            d <span class="op">=</span> (d <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="bu">len</span>(directions)</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> direction <span class="op">==</span> <span class="st">"&gt;"</span>:</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> x <span class="op">+</span> width <span class="op">!=</span> <span class="dv">7</span> <span class="kw">and</span> <span class="kw">not</span> has_collision(x <span class="op">+</span> <span class="dv">1</span>, y, shape, board):</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>                    x <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> x <span class="op">!=</span> <span class="dv">0</span> <span class="kw">and</span> <span class="kw">not</span> has_collision(x <span class="op">-</span> <span class="dv">1</span>, y, shape, board):</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>                    x <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> y <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span>:</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>                y <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> has_collision(x, y <span class="op">+</span> <span class="dv">1</span>, shape, board):</span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>                    old_board <span class="op">=</span> board.copy()</span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>                    board <span class="op">=</span> np.pad(</span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a>                        board, [[<span class="bu">max</span>(height <span class="op">-</span> y <span class="op">-</span> <span class="dv">1</span>, <span class="dv">0</span>), <span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">0</span>]], mode<span class="op">=</span><span class="st">"constant"</span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a>                    loc <span class="op">=</span> <span class="bu">max</span>(y <span class="op">-</span> height <span class="op">+</span> <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a>                    board[loc : loc <span class="op">+</span> height, x : x <span class="op">+</span> width] <span class="op">+=</span> shape</span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>                y <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>        row <span class="op">=</span> board.<span class="bu">all</span>(axis<span class="op">=</span><span class="dv">1</span>).argmax()</span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a>        discard <span class="op">+=</span> board.shape[<span class="dv">0</span>] <span class="op">-</span> row <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a>        board <span class="op">=</span> board[: row <span class="op">+</span> <span class="dv">1</span>]</span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> (i <span class="op">%</span> <span class="bu">len</span>(shapes), d, <span class="bu">tuple</span>(np.ravel(board)))</span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> state <span class="kw">in</span> seen:</span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> cycle_length <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a>                cycle_length <span class="op">=</span> i <span class="op">-</span> seen[state][<span class="dv">0</span>]</span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (i <span class="op">%</span> cycle_length) <span class="op">==</span> (n <span class="op">%</span> cycle_length):</span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a>                delta_h <span class="op">=</span> board.shape[<span class="dv">0</span>] <span class="op">+</span> discard <span class="op">-</span> seen[state][<span class="dv">1</span>]</span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> board.shape[<span class="dv">0</span>] <span class="op">+</span> discard <span class="op">+</span> delta_h <span class="op">*</span> ((n <span class="op">-</span> i) <span class="op">//</span> cycle_length)</span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a>        seen[state] <span class="op">=</span> i, board.shape[<span class="dv">0</span>] <span class="op">+</span> discard</span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> seen[state][<span class="dv">1</span>]</span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a>find_height(directions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-16" class="level2">
<h2 class="anchored" data-anchor-id="part-2-16">Part 2</h2>
<p>Actually simulating that many steps isn’t possible, so we should probably look for a loop of some kind. To avoid having to think too much, we’ll say that after any given rock has fallen the state is (shape<sub>index</sub>, wind<sub>index</sub>, hash of board above latest full line). If a state ever repeats, we know it will go on repeating forever, so we can just advance until we’re at the same point in the cycle as the very end, and then add on however many cycles we need</p>
<div class="cell" data-execution_count="38">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>find_height(directions, <span class="dv">1_000_000_000_000</span>) <span class="op">-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>There’s a weird off by one error in my code which is only present for some cases. I can’t be bothered to find out why.</p>
</section>
</section>
<section id="day-18-boiling-boulders" class="level1">
<h1><a href="https://adventofcode.com/2022/day/18">Day 18: Boiling Boulders</a></h1>
<section id="part-1-17" class="level2">
<h2 class="anchored" data-anchor-id="part-1-17">Part 1</h2>
<p>Idea: find all neighboring boxes by finding the union of the shifts along each of i,j,k,-i,-j,-k and subtracting the original shape. A given box might neighbor the original shape in up to six places, so to account for that I can take all the neighbors, shift them again along each of the axes, and for each shift, count how many boxes now overlap the original shape.</p>
<div class="cell" data-execution_count="39">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">18</span>, <span class="st">"np"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> to_set(arr):</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">set</span>(<span class="bu">tuple</span>(x) <span class="cf">for</span> x <span class="kw">in</span> arr)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> inflate(data):</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(data, <span class="bu">set</span>):</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> np.array(<span class="bu">list</span>(data))</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> to_set(np.vstack([row <span class="op">+</span> data <span class="cf">for</span> row <span class="kw">in</span> deltas])) <span class="op">-</span> occupied</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>occupied <span class="op">=</span> to_set(data)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>deltas <span class="op">=</span> (np.tile(np.eye(<span class="dv">3</span>, dtype<span class="op">=</span><span class="bu">int</span>), <span class="dv">2</span>) <span class="op">*</span> np.repeat((<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>), <span class="dv">3</span>)).T</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>nb <span class="op">=</span> inflate(data)</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> np.array(<span class="bu">list</span>(nb))</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>([<span class="bu">len</span>(to_set(arr <span class="op">+</span> delta) <span class="op">&amp;</span> occupied) <span class="cf">for</span> delta <span class="kw">in</span> deltas])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-17" class="level2">
<h2 class="anchored" data-anchor-id="part-2-17">Part 2</h2>
<p>For part 2, once we have identified which of the neighboring boxes represent external neighbors (i.e.&nbsp;are connected to the outside world), we can do exactly the same thing. The tricky thing is then to make this identification. Under the assumption that the droplet is connected, so that every box in the droplet is reachable from every other via a series of face, edge or corner moves, then every point the outside boundary is face-connected to every other after at most two inflations. I can then use a union find data structure to merge all the connected groups together, and the outside group is then the largest of all of these</p>
<div class="cell" data-execution_count="40">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.cluster.hierarchy <span class="im">import</span> DisjointSet</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>points <span class="op">=</span> inflate(data)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    points <span class="op">=</span> inflate(points)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>disjoint_set <span class="op">=</span> DisjointSet(points)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> points:</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    comparisons <span class="op">=</span> x <span class="op">+</span> np.eye(<span class="dv">3</span>, dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> comparison <span class="kw">in</span> comparisons:</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (y <span class="op">:=</span> <span class="bu">tuple</span>(comparison)) <span class="kw">in</span> disjoint_set:</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>            disjoint_set.merge(x, y)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>max_s <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subset <span class="kw">in</span> disjoint_set.subsets():</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(subset) <span class="op">&gt;</span> max_s:</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>        max_s <span class="op">=</span> <span class="bu">len</span>(subset)</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> subset</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> np.array(<span class="bu">list</span>(s <span class="op">&amp;</span> nb))</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>([<span class="bu">len</span>(to_set(arr <span class="op">+</span> delta) <span class="op">&amp;</span> occupied) <span class="cf">for</span> delta <span class="kw">in</span> deltas])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-19-not-enough-minerals" class="level1">
<h1><a href="https://adventofcode.com/2022/day/19">Day 19: Not Enough Minerals</a></h1>
<section id="part-1-18" class="level2">
<h2 class="anchored" data-anchor-id="part-1-18">Part 1</h2>
<p>The core of this problem is to develop an approach that can take a list of prices and generate an optimal build. Blindly taking every action probably won’t work, but is maybe worth examining as a first attempt.</p>
<p>Instead of simulating each of the 24 different time steps, we should focus on the build order, so the decision at any given point in time is which robot to build next. We should bail from any given branch if:</p>
<ul>
<li>The time has exceeded the maximum time available</li>
<li>We have built more robots of a given kind than are needed by any of the recipes</li>
<li>We’ve already seen a better situation: Suppose we’ve previously found a state with a given config of robots at t1, and now have built the same robots at a later time t2. If we could have the same or more resources at t2 by using the t1 config and just waiting, then the first build order is strictly better.</li>
</ul>
<div class="cell" data-execution_count="41">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> score(geodes, time, t_max<span class="op">=</span><span class="dv">24</span>):</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    time_remaining <span class="op">=</span> t_max <span class="op">-</span> time <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>(geodes <span class="op">+</span> time_remaining <span class="op">*</span> (time_remaining <span class="op">+</span> <span class="dv">1</span>) <span class="op">//</span> <span class="dv">2</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_better(t1, r1, g1, i, t2, r2, g2):</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span>  <span class="co"># (t2 &gt;= t1) and (g1 &gt;= g2) and ((r1 + (t2 - t1) * i) &gt;= r2).all()</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate(costs, t_max<span class="op">=</span><span class="dv">24</span>):</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    seen <span class="op">=</span> defaultdict(<span class="bu">dict</span>)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    max_prices <span class="op">=</span> costs.<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    income <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    resources <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    time <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    geodes <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    initial_state <span class="op">=</span> (</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>        score(geodes, time, t_max),</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>        time,</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>        geodes,</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">tuple</span>(income),</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">tuple</span>(resources),</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>    q <span class="op">=</span> PriorityQueue()</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    q.put(initial_state)</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>    max_geodes <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> q.qsize() <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>        _, time, geodes, income, resources <span class="op">=</span> q.get()</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>        income, resources <span class="op">=</span> np.array(income), np.array(resources)</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> time <span class="op">==</span> t_max:</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> t1, (r1, g1) <span class="kw">in</span> seen[<span class="bu">tuple</span>(income)].items():</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> is_better(t1, r1, g1, income, time, resources, geodes):</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>            seen[<span class="bu">tuple</span>(income)][time] <span class="op">=</span> (resources, geodes)</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> np.errstate(divide<span class="op">=</span><span class="st">"ignore"</span>, invalid<span class="op">=</span><span class="st">"ignore"</span>):</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>                waits <span class="op">=</span> (costs <span class="op">-</span> resources) <span class="op">/</span> income</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>            waits[np.isnan(waits)] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, wait <span class="kw">in</span> <span class="bu">enumerate</span>(np.ceil(waits.<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">1</span>))):</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>                wait <span class="op">=</span> <span class="bu">max</span>(wait, <span class="dv">0</span>)</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> time <span class="op">+</span> wait <span class="op">+</span> <span class="dv">1</span> <span class="op">&gt;</span> t_max:</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Turns to wait for resources, plus one to build</span></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>                dt <span class="op">=</span> <span class="bu">int</span>(wait) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>                new_time <span class="op">=</span> time <span class="op">+</span> dt</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>                new_income <span class="op">=</span> income.copy()</span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>                new_geodes <span class="op">=</span> geodes</span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">!=</span> <span class="dv">3</span>:</span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> income[idx] <span class="op">&gt;=</span> max_prices[idx]:</span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>                    new_income[idx] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>                    new_geodes <span class="op">+=</span> t_max <span class="op">-</span> new_time</span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> new_geodes <span class="op">&gt;</span> max_geodes:</span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>                        max_geodes <span class="op">=</span> new_geodes</span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>                new_resources <span class="op">=</span> resources.copy() <span class="op">+</span> income <span class="op">*</span> dt <span class="op">-</span> costs[idx]</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>                q.put(</span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a>                    (</span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a>                        score(new_geodes, new_time, t_max),</span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>                        new_time,</span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>                        new_geodes,</span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">tuple</span>(new_income),</span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">tuple</span>(new_resources),</span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> max_geodes</span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> blueprint_id, <span class="op">*</span>l <span class="kw">in</span> load(<span class="dv">19</span>, <span class="st">"int"</span>):</span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a>    costs <span class="op">=</span> np.array([[l[<span class="dv">0</span>], <span class="dv">0</span>, <span class="dv">0</span>], [l[<span class="dv">1</span>], <span class="dv">0</span>, <span class="dv">0</span>], [l[<span class="dv">2</span>], l[<span class="dv">3</span>], <span class="dv">0</span>], [l[<span class="dv">4</span>], <span class="dv">0</span>, l[<span class="dv">5</span>]]])</span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> blueprint_id <span class="op">*</span> evaluate(costs)</span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a>total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-18" class="level2">
<h2 class="anchored" data-anchor-id="part-2-18">Part 2</h2>
<div class="cell" data-execution_count="42">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, <span class="op">*</span>l <span class="kw">in</span> load(<span class="dv">19</span>, <span class="st">"int"</span>)[:<span class="dv">3</span>]:</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    costs <span class="op">=</span> np.array([[l[<span class="dv">0</span>], <span class="dv">0</span>, <span class="dv">0</span>], [l[<span class="dv">1</span>], <span class="dv">0</span>, <span class="dv">0</span>], [l[<span class="dv">2</span>], l[<span class="dv">3</span>], <span class="dv">0</span>], [l[<span class="dv">4</span>], <span class="dv">0</span>, l[<span class="dv">5</span>]]])</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    total <span class="op">*=</span> evaluate(costs, <span class="dv">32</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-20-grove-positioning-system" class="level1">
<h1><a href="https://adventofcode.com/2022/day/21">Day 20: Grove Positioning System</a></h1>
<section id="part-1-19" class="level2">
<h2 class="anchored" data-anchor-id="part-1-19">Part 1</h2>
<p>I was almost caught out by the fact that there can be duplicate entries in the data; my original linked list in a dictionary didn’t account for this, so nodes were silently dropped. Oops.</p>
<p>Otherwise the simple approach ended up working: make a list of node -&gt; (predecessor, successor), and to move a given element simply follow the pointers the relevant number of times.</p>
<p>To save time, I map each rotation to the range [-l/2, l/2] where l is the length of the linked list. The idea is that for a circular list of length l, moving l-1 steps to the right is the same as not moving, and since the list is doubly linked, moving one step to the left is better than moving l-2 steps to the right.</p>
<div class="cell" data-execution_count="43">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mix(data, n<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    unique_data <span class="op">=</span> <span class="bu">list</span>(<span class="bu">enumerate</span>(data))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    ll <span class="op">=</span> {</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>        k: [p, n]</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (k, p, n) <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>            unique_data,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>            [unique_data[<span class="op">-</span><span class="dv">1</span>]] <span class="op">+</span> unique_data[:<span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>            unique_data[<span class="dv">1</span>:] <span class="op">+</span> [unique_data[<span class="dv">0</span>]],</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> value <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>            mod <span class="op">=</span> <span class="bu">len</span>(data) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">=</span> mod <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>            shift <span class="op">=</span> (value[<span class="dv">1</span>] <span class="op">+</span> offset) <span class="op">%</span> mod <span class="op">-</span> offset</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> shift <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>            current <span class="op">=</span> ll[value]</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>            ll[current[<span class="dv">0</span>]][<span class="dv">1</span>] <span class="op">=</span> current[<span class="dv">1</span>]</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>            ll[current[<span class="dv">1</span>]][<span class="dv">0</span>] <span class="op">=</span> current[<span class="dv">0</span>]</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>            <span class="kw">del</span> ll[value]</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>            coord <span class="op">=</span> <span class="dv">1</span> <span class="cf">if</span> shift <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">abs</span>(shift)):</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>                current <span class="op">=</span> ll[current[coord]]</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>            succ <span class="op">=</span> current[coord]</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>            pred <span class="op">=</span> ll[succ][<span class="dv">1</span> <span class="op">-</span> coord]</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> shift <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>                pred, succ <span class="op">=</span> succ, pred</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>            ll[value] <span class="op">=</span> [pred, succ]</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>            ll[pred][<span class="dv">1</span>] <span class="op">=</span> value</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>            ll[succ][<span class="dv">0</span>] <span class="op">=</span> value</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> (data.index(<span class="dv">0</span>), <span class="dv">0</span>)</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> []</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(ll)):</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>        result.append(v[<span class="dv">1</span>])</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>        v <span class="op">=</span> ll[v][<span class="dv">1</span>]</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(result[((i <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">1000</span>) <span class="op">%</span> <span class="bu">len</span>(result)] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>))</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="bu">list</span>(load(<span class="st">"20"</span>, <span class="st">"np"</span>))</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>mix(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-19" class="level2">
<h2 class="anchored" data-anchor-id="part-2-19">Part 2</h2>
<div class="cell" data-execution_count="44">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>mix([x <span class="op">*</span> <span class="dv">811589153</span> <span class="cf">for</span> x <span class="kw">in</span> data], <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-21-monkey-math" class="level1">
<h1><a href="https://adventofcode.com/2022/day/21">Day 21: Monkey Math</a></h1>
<section id="part-1-20" class="level2">
<h2 class="anchored" data-anchor-id="part-1-20">Part 1</h2>
<p>We’ll use recursion and the call stack to keep track of the operations for us</p>
<div class="cell" data-execution_count="45">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> operator <span class="im">import</span> add, ifloordiv, mul, sub</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>instructions <span class="op">=</span> {}</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>lookup <span class="op">=</span> {<span class="st">"*"</span>: mul, <span class="st">"/"</span>: ifloordiv, <span class="st">"-"</span>: sub, <span class="st">"+"</span>: add}</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">21</span>):</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    lhs, rhs <span class="op">=</span> line.split(<span class="st">":"</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    operands <span class="op">=</span> rhs.split()</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(operands) <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>        instructions[lhs] <span class="op">=</span> {<span class="st">"dependencies"</span>: [], <span class="st">"value"</span>: <span class="bu">int</span>(operands[<span class="dv">0</span>])}</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>        instructions[lhs] <span class="op">=</span> {</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"dependencies"</span>: [operands[<span class="dv">0</span>], operands[<span class="dv">2</span>]],</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"operation"</span>: lookup[operands[<span class="dv">1</span>]],</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="at">@functools.cache</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> value(mystring):</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>    instruction <span class="op">=</span> instructions[mystring]</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> instruction[<span class="st">"dependencies"</span>]:</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> instruction[<span class="st">"value"</span>]</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> instruction[<span class="st">"operation"</span>](</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>[value(x) <span class="cf">for</span> x <span class="kw">in</span> instruction[<span class="st">"dependencies"</span>]]</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>value(<span class="st">"root"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-20" class="level2">
<h2 class="anchored" data-anchor-id="part-2-20">Part 2</h2>
<div class="cell" data-execution_count="46">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>value.cache_clear()</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>inverse_operations <span class="op">=</span> {sub: add, add: sub, mul: ifloordiv, ifloordiv: mul}</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"humn"</span> <span class="kw">in</span> instructions:</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">del</span> instructions[<span class="st">"humn"</span>]</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>instructions[<span class="st">"root"</span>][<span class="st">"operation"</span>] <span class="op">=</span> sub</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> balance(instruction, target):</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> instruction <span class="op">==</span> <span class="st">"humn"</span>:</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> target</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, dependency <span class="kw">in</span> <span class="bu">enumerate</span>(instructions[instruction][<span class="st">"dependencies"</span>]):</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>            v <span class="op">=</span> value(dependency)</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>            pos <span class="op">=</span> idx</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>            next_instruction <span class="op">=</span> dependency</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>    op <span class="op">=</span> instructions[instruction][<span class="st">"operation"</span>]</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pos <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> op <span class="kw">in</span> [ifloordiv, sub]:</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>        updated_target <span class="op">=</span> op(v, target)</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>        updated_target <span class="op">=</span> inverse_operations[op](target, v)</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> balance(next_instruction, updated_target)</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>balance(<span class="st">"root"</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-22-monkey-map" class="level1">
<h1><a href="https://adventofcode.com/2022/day/22">Day 22: Monkey Map</a></h1>
<section id="part-1-21" class="level2">
<h2 class="anchored" data-anchor-id="part-1-21">Part 1</h2>
<div class="cell" data-execution_count="47">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">22</span>, <span class="st">"raw"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>chart, instructions <span class="op">=</span> data.split(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> chart.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> <span class="bu">max</span>(<span class="bu">len</span>(x) <span class="cf">for</span> x <span class="kw">in</span> chart)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> [[x <span class="cf">for</span> x <span class="kw">in</span> line.ljust(target, <span class="st">" "</span>)] <span class="cf">for</span> line <span class="kw">in</span> chart]</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>board <span class="op">=</span> np.array(chart)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>start_x <span class="op">=</span> (board[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"."</span>).argmax()</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>y, x <span class="op">=</span> <span class="dv">0</span>, start_x</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>dy, dx <span class="op">=</span> <span class="dv">0</span>, <span class="dv">1</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>ymax, xmax <span class="op">=</span> board.shape</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>R <span class="op">=</span> np.array([[<span class="dv">0</span>, <span class="dv">1</span>], [<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>]])</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> <span class="op">-</span>R</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>matrices <span class="op">=</span> {<span class="st">"L"</span>: L, <span class="st">"R"</span>: R}</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>instructions <span class="op">=</span> instructions.replace(<span class="st">"R"</span>, <span class="st">" R "</span>).replace(<span class="st">"L"</span>, <span class="st">" L "</span>).split()</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> instruction <span class="kw">in</span> instructions:</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> instruction <span class="kw">in</span> <span class="st">"LR"</span>:</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>        dy, dx <span class="op">=</span> matrices[instruction] <span class="op">@</span> [dy, dx]</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">int</span>(instruction)):</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>            next_y, next_x <span class="op">=</span> (y <span class="op">+</span> dy) <span class="op">%</span> ymax, (x <span class="op">+</span> dx) <span class="op">%</span> xmax</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> board[next_y, next_x] <span class="op">==</span> <span class="st">" "</span>:</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>                next_y, next_x <span class="op">=</span> (next_y <span class="op">+</span> dy) <span class="op">%</span> ymax, (next_x <span class="op">+</span> dx) <span class="op">%</span> xmax</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> board[next_y, next_x] <span class="op">==</span> <span class="st">"#"</span>:</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>            y, x <span class="op">=</span> next_y, next_x</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>facings <span class="op">=</span> {(<span class="dv">0</span>, <span class="dv">1</span>): <span class="dv">0</span>, (<span class="dv">1</span>, <span class="dv">0</span>): <span class="dv">1</span>, (<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>): <span class="dv">2</span>, (<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>): <span class="dv">3</span>}</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>(y <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">1000</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> (x <span class="op">+</span> <span class="dv">1</span>) <span class="op">+</span> facings[dy, dx]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-21" class="level2">
<h2 class="anchored" data-anchor-id="part-2-21">Part 2</h2>
<p>Well.</p>
<p>The logic for this one is basically the same as for part one, with the only change being what happens when we hit an empty cell. Previously we just kept moving in the same direction until we landed back on the board; now we have to find which edge we should move to.</p>
<p>I considered trying to solve the edge pairing for all possible cube nets, but quickly concluded that hardcoding the specific net in my input was going to be much faster. I start off by building a mapping of edge pairings which tracks:</p>
<ul>
<li>Which pairs of edges are connected</li>
<li>What the rotation between the two edges is</li>
<li>Whether values along the two edges increase in the same direction. This is technically not necessary, since it’s basically included in the rotation, but it’s handy to have around.</li>
</ul>
<p>There are 14 outside edges, but they pair up two and two, so we only need to specify 7 of them and then add the reverse pairing to the mapping.</p>
<p>The edges are labelled with an arbitrary number, so we also need a way of identifying which edge we’re on. So for each edge, we’ll specify which two meta-squares of the net it joins, starting with the square on the cube and ending with the square off the cube.</p>
<p>When we hit an empty cell, we identify which edge we just crossed, and then move to the corresponding matching edge. There’s a bit of faffing to make sure that (say) top and bottom edges along the same square get different y coordinates, and then we finally add on how far along the edge we are.</p>
<p>That gives us the new position on the grid. If this position is empty, we rotate to face the new direction and move there. Otherwise we stay in place and don’t rotate.</p>
<div class="cell" data-execution_count="48">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>edge_pairings <span class="op">=</span> {</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>: [<span class="dv">9</span>, <span class="st">"R"</span>, <span class="dv">1</span>],</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>: [<span class="dv">8</span>, <span class="st">""</span>, <span class="dv">1</span>],</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>: [<span class="dv">5</span>, <span class="st">"RR"</span>, <span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>: [<span class="dv">4</span>, <span class="st">"R"</span>, <span class="dv">1</span>],</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">6</span>: [<span class="dv">7</span>, <span class="st">"R"</span>, <span class="dv">1</span>],</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">10</span>: [<span class="dv">13</span>, <span class="st">"RR"</span>, <span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">11</span>: [<span class="dv">12</span>, <span class="st">"R"</span>, <span class="dv">1</span>],</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> <span class="bu">list</span>(edge_pairings.keys()):</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    edge, direction, sign <span class="op">=</span> edge_pairings[key]</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    edge_pairings[edge] <span class="op">=</span> [key, direction.replace(<span class="st">"R"</span>, <span class="st">"L"</span>), sign]</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>edge_positions <span class="op">=</span> [</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">0</span>, <span class="dv">1</span>), (<span class="dv">3</span>, <span class="dv">1</span>)),</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">0</span>, <span class="dv">2</span>), (<span class="dv">3</span>, <span class="dv">2</span>)),</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">0</span>, <span class="dv">2</span>), (<span class="dv">0</span>, <span class="dv">0</span>)),</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">0</span>, <span class="dv">2</span>), (<span class="dv">1</span>, <span class="dv">2</span>)),</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">1</span>, <span class="dv">2</span>)),</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">2</span>, <span class="dv">1</span>), (<span class="dv">2</span>, <span class="dv">2</span>)),</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">2</span>, <span class="dv">1</span>), (<span class="dv">3</span>, <span class="dv">1</span>)),</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">3</span>, <span class="dv">0</span>), (<span class="dv">3</span>, <span class="dv">1</span>)),</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">3</span>, <span class="dv">0</span>), (<span class="dv">0</span>, <span class="dv">0</span>)),</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">3</span>, <span class="dv">0</span>), (<span class="dv">3</span>, <span class="dv">2</span>)),</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">2</span>, <span class="dv">0</span>), (<span class="dv">2</span>, <span class="dv">2</span>)),</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">2</span>, <span class="dv">0</span>), (<span class="dv">1</span>, <span class="dv">0</span>)),</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">1</span>, <span class="dv">0</span>)),</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">0</span>, <span class="dv">1</span>), (<span class="dv">0</span>, <span class="dv">0</span>)),</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>edge_lookup <span class="op">=</span> {edges: idx <span class="cf">for</span> idx, edges <span class="kw">in</span> <span class="bu">enumerate</span>(edge_positions)}</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>board_shape <span class="op">=</span> np.array([<span class="dv">4</span>, <span class="dv">3</span>])</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>y, x <span class="op">=</span> <span class="dv">0</span>, start_x</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>dy, dx <span class="op">=</span> <span class="dv">0</span>, <span class="dv">1</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> instruction <span class="kw">in</span> instructions:</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> instruction <span class="kw">in</span> <span class="st">"LR"</span>:</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>        dy, dx <span class="op">=</span> matrices[instruction] <span class="op">@</span> [dy, dx]</span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">int</span>(instruction)):</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>            next_y, next_x <span class="op">=</span> (y <span class="op">+</span> dy) <span class="op">%</span> ymax, (x <span class="op">+</span> dx) <span class="op">%</span> xmax</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> board[next_y, next_x] <span class="op">==</span> <span class="st">" "</span>:</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>                old_square <span class="op">=</span> y <span class="op">//</span> <span class="dv">50</span>, x <span class="op">//</span> <span class="dv">50</span></span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>                new_square <span class="op">=</span> next_y <span class="op">//</span> <span class="dv">50</span>, next_x <span class="op">//</span> <span class="dv">50</span></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>                edge <span class="op">=</span> edge_lookup[(old_square, new_square)]</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>                new_edge, rotations, sign <span class="op">=</span> edge_pairings[edge]</span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>                new_edge_position <span class="op">=</span> edge_positions[new_edge]</span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>                new_edge_delta <span class="op">=</span> np.diff(new_edge_position, axis<span class="op">=</span><span class="dv">0</span>).ravel()</span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>                next_y, next_x <span class="op">=</span> [x <span class="op">*</span> <span class="dv">50</span> <span class="cf">for</span> x <span class="kw">in</span> new_edge_position[<span class="dv">0</span>]]</span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>                next_y, next_x <span class="op">=</span> [next_y, next_x] <span class="op">+</span> <span class="dv">49</span> <span class="op">*</span> (</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a>                    (new_edge_delta <span class="op">%</span> board_shape) <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a>                offset <span class="op">=</span> x <span class="op">%</span> <span class="dv">50</span> <span class="cf">if</span> dx <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> y <span class="op">%</span> <span class="dv">50</span></span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a>                offset <span class="op">=</span> offset <span class="cf">if</span> sign <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">49</span> <span class="op">-</span> offset</span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a>                next_y, next_x <span class="op">=</span> [next_y, next_x] <span class="op">+</span> offset <span class="op">*</span> (new_edge_delta <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> board[next_y, next_x] <span class="op">!=</span> <span class="st">"#"</span>:</span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> rotation <span class="kw">in</span> rotations:</span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a>                        dy, dx <span class="op">=</span> matrices[rotation] <span class="op">@</span> [dy, dx]</span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> board[next_y, next_x] <span class="op">==</span> <span class="st">"#"</span>:</span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a>            y, x <span class="op">=</span> next_y, next_x</span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a>facings <span class="op">=</span> {(<span class="dv">0</span>, <span class="dv">1</span>): <span class="dv">0</span>, (<span class="dv">1</span>, <span class="dv">0</span>): <span class="dv">1</span>, (<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>): <span class="dv">2</span>, (<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>): <span class="dv">3</span>}</span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a>(y <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">1000</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> (x <span class="op">+</span> <span class="dv">1</span>) <span class="op">+</span> facings[dy, dx]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-23-unstable-diffusion" class="level1">
<h1><a href="https://adventofcode.com/2022/day/23">Day 23: Unstable Diffusion</a></h1>
<section id="part-1-22" class="level2">
<h2 class="anchored" data-anchor-id="part-1-22">Part 1</h2>
<div class="cell" data-execution_count="49">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>board <span class="op">=</span> np.array(</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    [[<span class="dv">1</span> <span class="cf">if</span> char <span class="op">==</span> <span class="st">"#"</span> <span class="cf">else</span> <span class="dv">0</span> <span class="cf">for</span> char <span class="kw">in</span> line] <span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">23</span>)],</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span><span class="bu">bool</span>,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate(board, n_rounds):</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> np.ones((<span class="dv">3</span>, <span class="dv">3</span>), dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    mask[<span class="dv">1</span>, <span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>]])</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    e, s, w <span class="op">=</span> n[::<span class="op">-</span><span class="dv">1</span>].T, n[::<span class="op">-</span><span class="dv">1</span>], n.T</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    Direction <span class="op">=</span> namedtuple(</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Direction"</span>, [<span class="st">"weights"</span>, <span class="st">"padding"</span>, <span class="st">"reverse_move"</span>, <span class="st">"bitmask"</span>]</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    north <span class="op">=</span> Direction(n, [[<span class="dv">0</span>, <span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">1</span>]], [<span class="dv">1</span>, <span class="dv">0</span>], <span class="dv">1</span>)</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    south <span class="op">=</span> Direction(s, [[<span class="dv">2</span>, <span class="dv">0</span>], [<span class="dv">1</span>, <span class="dv">1</span>]], [<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>], <span class="dv">2</span>)</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>    east <span class="op">=</span> Direction(e, [[<span class="dv">1</span>, <span class="dv">1</span>], [<span class="dv">2</span>, <span class="dv">0</span>]], [<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>], <span class="dv">4</span>)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>    west <span class="op">=</span> Direction(w, [[<span class="dv">1</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">2</span>]], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="dv">8</span>)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>    directions <span class="op">=</span> [north, south, west, east]</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> i <span class="op">&lt;</span> n_rounds:</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>        has_neighbors <span class="op">=</span> scipy.ndimage.convolve(board, mask, mode<span class="op">=</span><span class="st">"constant"</span>)</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>        stopped, rest <span class="op">=</span> (board <span class="op">&amp;</span> (<span class="op">~</span>has_neighbors)), (board <span class="op">&amp;</span> has_neighbors)</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>        proposed_moves <span class="op">=</span> np.pad(stopped.astype(<span class="bu">int</span>), <span class="dv">1</span>, mode<span class="op">=</span><span class="st">"constant"</span>)</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> d <span class="kw">in</span> directions:</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>            neighbors <span class="op">=</span> scipy.ndimage.correlate(board, d.weights, mode<span class="op">=</span><span class="st">"constant"</span>)</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>            proposed_moves <span class="op">+=</span> np.pad(</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>                (rest <span class="op">&amp;</span> <span class="op">~</span>neighbors) <span class="op">*</span> d.bitmask, d.padding, mode<span class="op">=</span><span class="st">"constant"</span></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>            rest <span class="op">&amp;=</span> neighbors</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>        proposed_moves <span class="op">+=</span> np.pad(rest, <span class="dv">1</span>, mode<span class="op">=</span><span class="st">"constant"</span>)</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Now unwind overlapping moves</span></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> d1 <span class="kw">in</span> directions[<span class="dv">1</span>:]:</span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>            multiples <span class="op">=</span> ((proposed_moves <span class="op">&amp;</span> d1.bitmask) <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (</span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>                proposed_moves <span class="op">!=</span> d1.bitmask</span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> point <span class="kw">in</span> np.argwhere(multiples):</span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> d2 <span class="kw">in</span> directions:</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> proposed_moves[<span class="bu">tuple</span>(point)] <span class="op">&amp;</span> d2.bitmask:</span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>                        proposed_moves[<span class="bu">tuple</span>(point <span class="op">+</span> d2.reverse_move)] <span class="op">=</span> d2.bitmask</span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a>                proposed_moves[<span class="bu">tuple</span>(point)] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a>        coords <span class="op">=</span> np.argwhere(proposed_moves)</span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a>        x_min, y_min <span class="op">=</span> coords.<span class="bu">min</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a>        x_max, y_max <span class="op">=</span> coords.<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a>        new_board <span class="op">=</span> proposed_moves[x_min : x_max <span class="op">+</span> <span class="dv">1</span>, y_min : y_max <span class="op">+</span> <span class="dv">1</span>] <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> board.shape <span class="op">==</span> new_board.shape <span class="kw">and</span> (board <span class="op">==</span> new_board).<span class="bu">all</span>():</span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a>        board <span class="op">=</span> new_board</span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a>        directions <span class="op">=</span> directions[<span class="dv">1</span>:] <span class="op">+</span> [directions[<span class="dv">0</span>]]</span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> i, (board <span class="op">==</span> <span class="dv">0</span>).<span class="bu">sum</span>()</span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a>simulate(board, <span class="dv">10</span>)[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-22" class="level2">
<h2 class="anchored" data-anchor-id="part-2-22">Part 2</h2>
<div class="cell" data-execution_count="50">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>simulate(board, np.inf)[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="day-24-blizzard-basin" class="level1">
<h1><a href="https://adventofcode.com/2022/day/24">Day 24: Blizzard Basin</a></h1>
<section id="part-1-23" class="level2">
<h2 class="anchored" data-anchor-id="part-1-23">Part 1</h2>
<p>This is a problem that seems to call for some pathfinding algorithms. We can account for the movement of the blizzards by making a function to answer the question “Is there a blizzard at position y, x at time t?”. With that in hand, we can just explore the full search space. To guide the search, we’ll use the (current tiime + manhattan distance to the goal node) as a score and always expand the lowest scoring state first, and stop when we’ve reached the target.</p>
<div class="cell" data-execution_count="51">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> np.array([<span class="bu">list</span>(x) <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">24</span>)])[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>chart_dict <span class="op">=</span> {}</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>directions <span class="op">=</span> [<span class="st">"&gt;"</span>, <span class="st">"&lt;"</span>, <span class="st">"^"</span>, <span class="st">"v"</span>]</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>updates <span class="op">=</span> {<span class="st">"&gt;"</span>: (<span class="dv">1</span>, <span class="dv">1</span>), <span class="st">"&lt;"</span>: (<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>), <span class="st">"^"</span>: (<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>), <span class="st">"v"</span>: (<span class="dv">0</span>, <span class="dv">1</span>)}</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> direction <span class="kw">in</span> directions:</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    positions <span class="op">=</span> defaultdict(<span class="bu">list</span>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y, x <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>np.where(chart <span class="op">==</span> direction)):</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>        (fixed, moving) <span class="op">=</span> (y, x) <span class="cf">if</span> direction <span class="kw">in</span> <span class="st">"&lt;&gt;"</span> <span class="cf">else</span> (x, y)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>        positions[fixed].append(moving)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    chart_dict[direction] <span class="op">=</span> positions</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> has_blizzard(y, x, time):</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    position <span class="op">=</span> y, x</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> direction <span class="kw">in</span> directions:</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>        moving, sign <span class="op">=</span> updates[direction]</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>        fixed <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> moving</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>        blizzards <span class="op">=</span> chart_dict[direction][position[fixed]]</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>        blizzard_positions <span class="op">=</span> [</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>            (b <span class="op">+</span> sign <span class="op">*</span> time) <span class="op">%</span> chart.shape[moving] <span class="cf">for</span> b <span class="kw">in</span> blizzards</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> position[moving] <span class="kw">in</span> blizzard_positions:</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> travel(chart, start, end, time):</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> <span class="bu">abs</span>(end[<span class="dv">0</span>] <span class="op">-</span> start[<span class="dv">0</span>]) <span class="op">+</span> <span class="bu">abs</span>(start[<span class="dv">1</span>] <span class="op">-</span> end[<span class="dv">1</span>]) <span class="op">+</span> time</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>    target_y, target_x <span class="op">=</span> end</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> score, time, start</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>    q <span class="op">=</span> PriorityQueue()</span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>    q.put(state)</span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>    seen <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> q.qsize() <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>        score, time, (y, x) <span class="op">=</span> q.get()</span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (y, x) <span class="op">==</span> end:</span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (time, y, x) <span class="kw">in</span> seen:</span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a>        seen.add((time, y, x))</span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (dy, dx) <span class="kw">in</span> [(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>), (<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>), (<span class="dv">0</span>, <span class="dv">0</span>), (<span class="dv">0</span>, <span class="dv">1</span>), (<span class="dv">1</span>, <span class="dv">0</span>)]:</span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a>            new_y, new_x <span class="op">=</span> y <span class="op">+</span> dy, x <span class="op">+</span> dx</span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (</span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a>                new_y <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a>                <span class="kw">or</span> (new_y <span class="op">==</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">and</span> new_x <span class="op">!=</span> <span class="dv">0</span>)</span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a>                <span class="kw">or</span> (new_y <span class="op">&gt;</span> chart.shape[<span class="dv">0</span>])</span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a>                <span class="kw">or</span> (new_y <span class="op">==</span> chart.shape[<span class="dv">0</span>] <span class="kw">and</span> new_x <span class="op">!=</span> chart.shape[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a>                <span class="kw">or</span> new_x <span class="op">&lt;</span> <span class="dv">0</span></span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true" tabindex="-1"></a>                <span class="kw">or</span> new_x <span class="op">&gt;=</span> chart.shape[<span class="dv">1</span>]</span>
<span id="cb51-51"><a href="#cb51-51" aria-hidden="true" tabindex="-1"></a>                <span class="kw">or</span> has_blizzard(new_y, new_x, time <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb51-52"><a href="#cb51-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-53"><a href="#cb51-53" aria-hidden="true" tabindex="-1"></a>            ):</span>
<span id="cb51-54"><a href="#cb51-54" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb51-55"><a href="#cb51-55" aria-hidden="true" tabindex="-1"></a>            score <span class="op">=</span> <span class="bu">abs</span>(target_y <span class="op">-</span> new_y) <span class="op">+</span> <span class="bu">abs</span>(target_x <span class="op">-</span> new_x) <span class="op">+</span> time <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb51-56"><a href="#cb51-56" aria-hidden="true" tabindex="-1"></a>            q.put((score, time <span class="op">+</span> <span class="dv">1</span>, (new_y, new_x)))</span>
<span id="cb51-57"><a href="#cb51-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> score</span>
<span id="cb51-58"><a href="#cb51-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-59"><a href="#cb51-59" aria-hidden="true" tabindex="-1"></a>bottom_y, right_x <span class="op">=</span> chart.shape</span>
<span id="cb51-60"><a href="#cb51-60" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> (<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb51-61"><a href="#cb51-61" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> (bottom_y, right_x <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb51-62"><a href="#cb51-62" aria-hidden="true" tabindex="-1"></a>first_leg <span class="op">=</span> travel(chart, start, end, <span class="dv">0</span>)</span>
<span id="cb51-63"><a href="#cb51-63" aria-hidden="true" tabindex="-1"></a>first_leg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-2-23" class="level2">
<h2 class="anchored" data-anchor-id="part-2-23">Part 2</h2>
<p>The above takes ~7 seconds on my machine (and it took 13 before I added the A* scoring logic), so using it to do three searches through the search space might not be feasible. On the other hand, the three searches can be made completely independent of one another, since arriving later at a checkpoint will always be worse than arriving earlier, since an early arrival could always wait in place until the later time.</p>
<div class="cell" data-execution_count="52">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> first_leg</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>waypoints <span class="op">=</span> [(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>), (bottom_y, right_x <span class="op">-</span> <span class="dv">1</span>)]</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> waypoint <span class="kw">in</span> waypoints:</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    start <span class="op">=</span> end</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    end <span class="op">=</span> waypoint</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    time <span class="op">=</span> travel(chart, start, end, time)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This actually works, but it still seems like there should be some slick-ish way of using the chinese remainder theorem or something similar to greatly reduce the search space, since we basically have four masks of residues that are invalid for (y, x, t) triples.</p>
</section>
</section>
<section id="day-25-full-of-hot-air" class="level1">
<h1><a href="https://adventofcode.com/2022/day/25">Day 25: Full of Hot Air</a></h1>
<div class="cell" data-execution_count="53">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>lookup <span class="op">=</span> {<span class="st">"2"</span>: <span class="dv">2</span>, <span class="st">"1"</span>: <span class="dv">1</span>, <span class="st">"0"</span>: <span class="dv">0</span>, <span class="st">"-"</span>: <span class="op">-</span><span class="dv">1</span>, <span class="st">"="</span>: <span class="op">-</span><span class="dv">2</span>}</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>reverse_lookup <span class="op">=</span> {<span class="dv">3</span>: <span class="st">"="</span>, <span class="dv">4</span>: <span class="st">"-"</span>}</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">25</span>):</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> functools.<span class="bu">reduce</span>(<span class="kw">lambda</span> x, y: <span class="dv">5</span> <span class="op">*</span> x <span class="op">+</span> lookup[y], line, <span class="dv">0</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dec2snafu(n):</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">""</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">%</span> <span class="dv">5</span> <span class="kw">in</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>]:</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> dec2snafu(n <span class="op">//</span> <span class="dv">5</span>) <span class="op">+</span> <span class="bu">str</span>(n <span class="op">%</span> <span class="dv">5</span>)</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dec2snafu(n <span class="op">//</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">1</span>) <span class="op">+</span> reverse_lookup[n <span class="op">%</span> <span class="dv">5</span>]</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>dec2snafu(total)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb54" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> 2022 Solutions</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu"># Imports</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: false</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> functools</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict, deque, namedtuple</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> queue <span class="im">import</span> PriorityQueue</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> more_itertools</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">1</span>, os.path.join(sys.path[<span class="dv">0</span>], <span class="st">".."</span>))</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> utils</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>load <span class="op">=</span> utils.year_load(<span class="dv">2022</span>)</span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 1: Calorie Counting](https://adventofcode.com/2022/day/1)</span></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>elves <span class="op">=</span> [x.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>) <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">1</span>, <span class="st">"raw"</span>).split(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>)]</span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>([<span class="bu">sum</span>([<span class="bu">int</span>(y) <span class="cf">for</span> y <span class="kw">in</span> x <span class="cf">if</span> y]) <span class="cf">for</span> x <span class="kw">in</span> elves])</span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(<span class="bu">sorted</span>([<span class="bu">sum</span>([<span class="bu">int</span>(y) <span class="cf">for</span> y <span class="kw">in</span> x <span class="cf">if</span> y]) <span class="cf">for</span> x <span class="kw">in</span> elves])[<span class="op">-</span><span class="dv">3</span>:])</span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 2: Rock Paper Scissors](https://adventofcode.com/2022/day/2)</span></span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-54"><a href="#cb54-54" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-55"><a href="#cb54-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-59"><a href="#cb54-59" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> [</span>
<span id="cb54-60"><a href="#cb54-60" aria-hidden="true" tabindex="-1"></a>    [<span class="bu">ord</span>(x) <span class="op">-</span> <span class="bu">ord</span>(<span class="st">"A"</span>), <span class="bu">ord</span>(y) <span class="op">-</span> <span class="bu">ord</span>(<span class="st">"X"</span>)]</span>
<span id="cb54-61"><a href="#cb54-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x, y <span class="kw">in</span> [x.split() <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">2</span>)]</span>
<span id="cb54-62"><a href="#cb54-62" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb54-63"><a href="#cb54-63" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>([line[<span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> ((line[<span class="dv">1</span>] <span class="op">-</span> line[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">3</span>) <span class="cf">for</span> line <span class="kw">in</span> lines])</span>
<span id="cb54-64"><a href="#cb54-64" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-65"><a href="#cb54-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-66"><a href="#cb54-66" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-67"><a href="#cb54-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-70"><a href="#cb54-70" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-71"><a href="#cb54-71" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>([(line[<span class="dv">1</span>] <span class="op">+</span> line[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> line[<span class="dv">1</span>] <span class="cf">for</span> line <span class="kw">in</span> lines])</span>
<span id="cb54-72"><a href="#cb54-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-73"><a href="#cb54-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-74"><a href="#cb54-74" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 3: Rucksack Reorganization](https://adventofcode.com/2022/day/3)</span></span>
<span id="cb54-75"><a href="#cb54-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-76"><a href="#cb54-76" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-77"><a href="#cb54-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-80"><a href="#cb54-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-81"><a href="#cb54-81" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-82"><a href="#cb54-82" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> load(<span class="dv">3</span>)</span>
<span id="cb54-83"><a href="#cb54-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> lines:</span>
<span id="cb54-84"><a href="#cb54-84" aria-hidden="true" tabindex="-1"></a>    letter <span class="op">=</span> <span class="bu">set</span>(l[: <span class="bu">len</span>(l) <span class="op">//</span> <span class="dv">2</span>]).intersection(<span class="bu">set</span>(l[<span class="bu">len</span>(l) <span class="op">//</span> <span class="dv">2</span> :])).pop()</span>
<span id="cb54-85"><a href="#cb54-85" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> <span class="bu">ord</span>(letter.upper()) <span class="op">-</span> <span class="bu">ord</span>(<span class="st">"A"</span>) <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">26</span> <span class="op">*</span> letter.isupper()</span>
<span id="cb54-86"><a href="#cb54-86" aria-hidden="true" tabindex="-1"></a>total</span>
<span id="cb54-87"><a href="#cb54-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-88"><a href="#cb54-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-89"><a href="#cb54-89" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-90"><a href="#cb54-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-93"><a href="#cb54-93" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-94"><a href="#cb54-94" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-95"><a href="#cb54-95" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> chunk <span class="kw">in</span> more_itertools.chunked(lines, <span class="dv">3</span>):</span>
<span id="cb54-96"><a href="#cb54-96" aria-hidden="true" tabindex="-1"></a>    letter <span class="op">=</span> functools.<span class="bu">reduce</span>(<span class="kw">lambda</span> x, y: <span class="bu">set</span>(x).intersection(<span class="bu">set</span>(y)), chunk).pop()</span>
<span id="cb54-97"><a href="#cb54-97" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> <span class="bu">ord</span>(letter.upper()) <span class="op">-</span> <span class="bu">ord</span>(<span class="st">"A"</span>) <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">26</span> <span class="op">*</span> letter.isupper()</span>
<span id="cb54-98"><a href="#cb54-98" aria-hidden="true" tabindex="-1"></a>total</span>
<span id="cb54-99"><a href="#cb54-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-100"><a href="#cb54-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-101"><a href="#cb54-101" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 4: Camp Cleanup](https://adventofcode.com/2022/day/4)</span></span>
<span id="cb54-102"><a href="#cb54-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-103"><a href="#cb54-103" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-104"><a href="#cb54-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-107"><a href="#cb54-107" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-108"><a href="#cb54-108" aria-hidden="true" tabindex="-1"></a>assignments <span class="op">=</span> load(<span class="dv">4</span>)</span>
<span id="cb54-109"><a href="#cb54-109" aria-hidden="true" tabindex="-1"></a>regex <span class="op">=</span> re.<span class="bu">compile</span>(<span class="st">"\d+"</span>)</span>
<span id="cb54-110"><a href="#cb54-110" aria-hidden="true" tabindex="-1"></a>assignments <span class="op">=</span> <span class="bu">map</span>(<span class="kw">lambda</span> x: [<span class="bu">int</span>(y) <span class="cf">for</span> y <span class="kw">in</span> re.findall(regex, x)], assignments)</span>
<span id="cb54-111"><a href="#cb54-111" aria-hidden="true" tabindex="-1"></a>assignments <span class="op">=</span> [<span class="bu">sorted</span>([a[:<span class="dv">2</span>], a[<span class="dv">2</span>:]]) <span class="cf">for</span> a <span class="kw">in</span> assignments]</span>
<span id="cb54-112"><a href="#cb54-112" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>((a[<span class="dv">1</span>] <span class="op">&gt;=</span> b[<span class="dv">1</span>] <span class="kw">or</span> a[<span class="dv">0</span>] <span class="op">==</span> b[<span class="dv">0</span>]) <span class="cf">for</span> a, b <span class="kw">in</span> assignments)</span>
<span id="cb54-113"><a href="#cb54-113" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-114"><a href="#cb54-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-115"><a href="#cb54-115" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-116"><a href="#cb54-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-119"><a href="#cb54-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-120"><a href="#cb54-120" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>((a[<span class="dv">1</span>] <span class="op">&gt;=</span> b[<span class="dv">0</span>] <span class="kw">or</span> a[<span class="dv">0</span>] <span class="op">==</span> b[<span class="dv">0</span>]) <span class="cf">for</span> a, b <span class="kw">in</span> assignments)</span>
<span id="cb54-121"><a href="#cb54-121" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-122"><a href="#cb54-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-123"><a href="#cb54-123" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 5: Supply Stacks](https://adventofcode.com/2022/day/5)</span></span>
<span id="cb54-124"><a href="#cb54-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-125"><a href="#cb54-125" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-126"><a href="#cb54-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-129"><a href="#cb54-129" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-130"><a href="#cb54-130" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> load(<span class="dv">5</span>)</span>
<span id="cb54-131"><a href="#cb54-131" aria-hidden="true" tabindex="-1"></a>numbers <span class="op">=</span> [re.findall(<span class="st">"\d+"</span>, line) <span class="cf">for</span> line <span class="kw">in</span> lines]</span>
<span id="cb54-132"><a href="#cb54-132" aria-hidden="true" tabindex="-1"></a>split <span class="op">=</span> np.argmax([<span class="bu">len</span>(x) <span class="cf">for</span> x <span class="kw">in</span> numbers])</span>
<span id="cb54-133"><a href="#cb54-133" aria-hidden="true" tabindex="-1"></a>instructions <span class="op">=</span> [[<span class="bu">int</span>(y) <span class="cf">for</span> y <span class="kw">in</span> x] <span class="cf">for</span> x <span class="kw">in</span> numbers[split <span class="op">+</span> <span class="dv">1</span> :] <span class="cf">if</span> x]</span>
<span id="cb54-134"><a href="#cb54-134" aria-hidden="true" tabindex="-1"></a>initial_state <span class="op">=</span> <span class="bu">list</span>(itertools.zip_longest(<span class="op">*</span>lines[:split]))</span>
<span id="cb54-135"><a href="#cb54-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-136"><a href="#cb54-136" aria-hidden="true" tabindex="-1"></a>letters <span class="op">=</span> [re.findall(<span class="st">"[A-Z]"</span>, <span class="st">""</span>.join(column)) <span class="cf">for</span> column <span class="kw">in</span> initial_state]</span>
<span id="cb54-137"><a href="#cb54-137" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> [x[::<span class="op">-</span><span class="dv">1</span>] <span class="cf">for</span> x <span class="kw">in</span> letters.copy() <span class="cf">if</span> x]</span>
<span id="cb54-138"><a href="#cb54-138" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n, source, dest <span class="kw">in</span> instructions:</span>
<span id="cb54-139"><a href="#cb54-139" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb54-140"><a href="#cb54-140" aria-hidden="true" tabindex="-1"></a>        p1[dest <span class="op">-</span> <span class="dv">1</span>].append(p1[source <span class="op">-</span> <span class="dv">1</span>].pop())</span>
<span id="cb54-141"><a href="#cb54-141" aria-hidden="true" tabindex="-1"></a><span class="co">""</span>.join(x[<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> x <span class="cf">else</span> <span class="st">" "</span> <span class="cf">for</span> x <span class="kw">in</span> p1)</span>
<span id="cb54-142"><a href="#cb54-142" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-143"><a href="#cb54-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-144"><a href="#cb54-144" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-145"><a href="#cb54-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-148"><a href="#cb54-148" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-149"><a href="#cb54-149" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> [x[::<span class="op">-</span><span class="dv">1</span>] <span class="cf">for</span> x <span class="kw">in</span> letters.copy() <span class="cf">if</span> x]</span>
<span id="cb54-150"><a href="#cb54-150" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n, source, dest <span class="kw">in</span> instructions:</span>
<span id="cb54-151"><a href="#cb54-151" aria-hidden="true" tabindex="-1"></a>    p2[dest <span class="op">-</span> <span class="dv">1</span>] <span class="op">+=</span> p2[source <span class="op">-</span> <span class="dv">1</span>][<span class="op">-</span>n:]</span>
<span id="cb54-152"><a href="#cb54-152" aria-hidden="true" tabindex="-1"></a>    p2[source <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> p2[source <span class="op">-</span> <span class="dv">1</span>][:<span class="op">-</span>n]</span>
<span id="cb54-153"><a href="#cb54-153" aria-hidden="true" tabindex="-1"></a><span class="co">""</span>.join(x[<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> x <span class="cf">else</span> <span class="st">" "</span> <span class="cf">for</span> x <span class="kw">in</span> p2)</span>
<span id="cb54-154"><a href="#cb54-154" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-155"><a href="#cb54-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-156"><a href="#cb54-156" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 6: Tuning Trouble](https://adventofcode.com/2022/day/6)</span></span>
<span id="cb54-157"><a href="#cb54-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-158"><a href="#cb54-158" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-159"><a href="#cb54-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-162"><a href="#cb54-162" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-163"><a href="#cb54-163" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">6</span>)[<span class="dv">0</span>]</span>
<span id="cb54-164"><a href="#cb54-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-165"><a href="#cb54-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-166"><a href="#cb54-166" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_marker(n):</span>
<span id="cb54-167"><a href="#cb54-167" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data) <span class="op">-</span> n <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb54-168"><a href="#cb54-168" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(<span class="bu">set</span>(<span class="bu">list</span>(data[i : i <span class="op">+</span> n]))) <span class="op">==</span> n:</span>
<span id="cb54-169"><a href="#cb54-169" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> i <span class="op">+</span> n</span>
<span id="cb54-170"><a href="#cb54-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-171"><a href="#cb54-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-172"><a href="#cb54-172" aria-hidden="true" tabindex="-1"></a>find_marker(<span class="dv">4</span>)</span>
<span id="cb54-173"><a href="#cb54-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-174"><a href="#cb54-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-175"><a href="#cb54-175" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-176"><a href="#cb54-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-179"><a href="#cb54-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-180"><a href="#cb54-180" aria-hidden="true" tabindex="-1"></a>find_marker(<span class="dv">14</span>)</span>
<span id="cb54-181"><a href="#cb54-181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-182"><a href="#cb54-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-183"><a href="#cb54-183" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 7: No Space Left On Device](https://adventofcode.com/2022/day/7)</span></span>
<span id="cb54-184"><a href="#cb54-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-185"><a href="#cb54-185" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-186"><a href="#cb54-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-187"><a href="#cb54-187" aria-hidden="true" tabindex="-1"></a>This requires a bit of tedious bookkeeping, but is otherwise straightforward.</span>
<span id="cb54-188"><a href="#cb54-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-189"><a href="#cb54-189" aria-hidden="true" tabindex="-1"></a>Keeping track of full names is necessary, since "/foo/baz" and "/bar/baz" refer to two different directories.</span>
<span id="cb54-190"><a href="#cb54-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-191"><a href="#cb54-191" aria-hidden="true" tabindex="-1"></a>The following code has a bug where it will show incorrect totals if the contents of the same directory are described more than once. Luckily, that doesn't seem to ever happen.</span>
<span id="cb54-192"><a href="#cb54-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-195"><a href="#cb54-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-196"><a href="#cb54-196" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> load(<span class="dv">7</span>)</span>
<span id="cb54-197"><a href="#cb54-197" aria-hidden="true" tabindex="-1"></a>directory <span class="op">=</span> {<span class="st">"/"</span>: {<span class="st">"children"</span>: [], <span class="st">"parent"</span>: <span class="va">None</span>, <span class="st">"weights"</span>: []}}</span>
<span id="cb54-198"><a href="#cb54-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-199"><a href="#cb54-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-200"><a href="#cb54-200" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_fullname(name, parent):</span>
<span id="cb54-201"><a href="#cb54-201" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>parent <span class="cf">if</span> parent <span class="op">!=</span> <span class="st">'/'</span> <span class="cf">else</span> <span class="st">''</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb54-202"><a href="#cb54-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-203"><a href="#cb54-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-204"><a href="#cb54-204" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_directory(name, parent, directory):</span>
<span id="cb54-205"><a href="#cb54-205" aria-hidden="true" tabindex="-1"></a>    fullname <span class="op">=</span> get_fullname(name, parent)</span>
<span id="cb54-206"><a href="#cb54-206" aria-hidden="true" tabindex="-1"></a>    directory[fullname] <span class="op">=</span> {<span class="st">"children"</span>: [], <span class="st">"parent"</span>: parent, <span class="st">"weights"</span>: []}</span>
<span id="cb54-207"><a href="#cb54-207" aria-hidden="true" tabindex="-1"></a>    directory[parent][<span class="st">"children"</span>].append(fullname)</span>
<span id="cb54-208"><a href="#cb54-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-209"><a href="#cb54-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-210"><a href="#cb54-210" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, line <span class="kw">in</span> <span class="bu">enumerate</span>(lines):</span>
<span id="cb54-211"><a href="#cb54-211" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"$ cd"</span> <span class="kw">in</span> line:</span>
<span id="cb54-212"><a href="#cb54-212" aria-hidden="true" tabindex="-1"></a>        target <span class="op">=</span> line.split()[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb54-213"><a href="#cb54-213" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> target <span class="op">==</span> <span class="st">".."</span>:</span>
<span id="cb54-214"><a href="#cb54-214" aria-hidden="true" tabindex="-1"></a>            cwd <span class="op">=</span> directory[cwd][<span class="st">"parent"</span>]</span>
<span id="cb54-215"><a href="#cb54-215" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> target <span class="op">==</span> <span class="st">"/"</span>:</span>
<span id="cb54-216"><a href="#cb54-216" aria-hidden="true" tabindex="-1"></a>            cwd <span class="op">=</span> <span class="st">"/"</span></span>
<span id="cb54-217"><a href="#cb54-217" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb54-218"><a href="#cb54-218" aria-hidden="true" tabindex="-1"></a>            cwd <span class="op">=</span> get_fullname(target, cwd)</span>
<span id="cb54-219"><a href="#cb54-219" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> line[<span class="dv">0</span>] <span class="op">!=</span> <span class="st">"$"</span>:</span>
<span id="cb54-220"><a href="#cb54-220" aria-hidden="true" tabindex="-1"></a>        metadata, name <span class="op">=</span> line.split()</span>
<span id="cb54-221"><a href="#cb54-221" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> metadata <span class="op">==</span> <span class="st">"dir"</span>:</span>
<span id="cb54-222"><a href="#cb54-222" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> name <span class="kw">not</span> <span class="kw">in</span> directory:</span>
<span id="cb54-223"><a href="#cb54-223" aria-hidden="true" tabindex="-1"></a>                add_directory(name, cwd, directory)</span>
<span id="cb54-224"><a href="#cb54-224" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb54-225"><a href="#cb54-225" aria-hidden="true" tabindex="-1"></a>            directory[cwd][<span class="st">"weights"</span>].append(<span class="bu">int</span>(metadata))</span>
<span id="cb54-226"><a href="#cb54-226" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> {}</span>
<span id="cb54-227"><a href="#cb54-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-228"><a href="#cb54-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-229"><a href="#cb54-229" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_weights(node):</span>
<span id="cb54-230"><a href="#cb54-230" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node <span class="kw">not</span> <span class="kw">in</span> weights:</span>
<span id="cb54-231"><a href="#cb54-231" aria-hidden="true" tabindex="-1"></a>        weights[node] <span class="op">=</span> <span class="bu">sum</span>(directory[node][<span class="st">"weights"</span>]) <span class="op">+</span> <span class="bu">sum</span>(</span>
<span id="cb54-232"><a href="#cb54-232" aria-hidden="true" tabindex="-1"></a>            calculate_weights(node) <span class="cf">for</span> node <span class="kw">in</span> directory[node][<span class="st">"children"</span>]</span>
<span id="cb54-233"><a href="#cb54-233" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb54-234"><a href="#cb54-234" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> weights[node]</span>
<span id="cb54-235"><a href="#cb54-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-236"><a href="#cb54-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-237"><a href="#cb54-237" aria-hidden="true" tabindex="-1"></a>calculate_weights(<span class="st">"/"</span>)</span>
<span id="cb54-238"><a href="#cb54-238" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(weight <span class="cf">for</span> weight <span class="kw">in</span> weights.values() <span class="cf">if</span> weight <span class="op">&lt;=</span> <span class="dv">100_000</span>)</span>
<span id="cb54-239"><a href="#cb54-239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-240"><a href="#cb54-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-241"><a href="#cb54-241" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-242"><a href="#cb54-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-243"><a href="#cb54-243" aria-hidden="true" tabindex="-1"></a>The weight of every directory has been stored in the weight dict, so finding the smallest one that's greater than a given threshold is trivial</span>
<span id="cb54-244"><a href="#cb54-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-247"><a href="#cb54-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-248"><a href="#cb54-248" aria-hidden="true" tabindex="-1"></a>to_free <span class="op">=</span> weights[<span class="st">"/"</span>] <span class="op">-</span> <span class="dv">40_000_000</span></span>
<span id="cb54-249"><a href="#cb54-249" aria-hidden="true" tabindex="-1"></a><span class="bu">min</span>(weight <span class="cf">for</span> weight <span class="kw">in</span> weights.values() <span class="cf">if</span> weight <span class="op">&gt;=</span> to_free)</span>
<span id="cb54-250"><a href="#cb54-250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-251"><a href="#cb54-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-252"><a href="#cb54-252" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 8: Treetop Tree House](https://adventofcode.com/2022/day/8)</span></span>
<span id="cb54-253"><a href="#cb54-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-254"><a href="#cb54-254" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-255"><a href="#cb54-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-256"><a href="#cb54-256" aria-hidden="true" tabindex="-1"></a>It really feels like there should be a slick array-based solution to this: calculate the cumulative max from each of the four directions, take the minimum of those four and compare with our array. But it doesn't seem like numpy has easy functionality for calculating the cumulative max.</span>
<span id="cb54-257"><a href="#cb54-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-258"><a href="#cb54-258" aria-hidden="true" tabindex="-1"></a>A bit off digging reveals the very useful ufunc <span class="in">`accumulate`</span>, which does exactly what we need. Then it's just a question of getting it to work in the four directions. Either we change the axis and direction of operation, or (as here) we transform the data from one orientation to another, do the accumulation, and transform back at the end.</span>
<span id="cb54-259"><a href="#cb54-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-262"><a href="#cb54-262" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-263"><a href="#cb54-263" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb54-264"><a href="#cb54-264" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: false</span></span>
<span id="cb54-265"><a href="#cb54-265" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.array([[<span class="bu">int</span>(char) <span class="cf">for</span> char <span class="kw">in</span> line] <span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">8</span>)])</span>
<span id="cb54-266"><a href="#cb54-266" aria-hidden="true" tabindex="-1"></a>masks <span class="op">=</span> []</span>
<span id="cb54-267"><a href="#cb54-267" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb54-268"><a href="#cb54-268" aria-hidden="true" tabindex="-1"></a>    transformed <span class="op">=</span> np.rot90(data, i)</span>
<span id="cb54-269"><a href="#cb54-269" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> np.roll(np.maximum.accumulate(transformed), <span class="dv">1</span>, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb54-270"><a href="#cb54-270" aria-hidden="true" tabindex="-1"></a>    mask[<span class="dv">0</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb54-271"><a href="#cb54-271" aria-hidden="true" tabindex="-1"></a>    masks.append(np.rot90(mask, <span class="dv">4</span> <span class="op">-</span> i))</span>
<span id="cb54-272"><a href="#cb54-272" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> np.<span class="bu">min</span>(masks, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb54-273"><a href="#cb54-273" aria-hidden="true" tabindex="-1"></a>(data <span class="op">&gt;</span> mask).<span class="bu">sum</span>()</span>
<span id="cb54-274"><a href="#cb54-274" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-275"><a href="#cb54-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-276"><a href="#cb54-276" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-277"><a href="#cb54-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-278"><a href="#cb54-278" aria-hidden="true" tabindex="-1"></a>The conceptual approach for this is similar - find a way of calculating the score in one direction, then transform the data to use that operation for the other directions.</span>
<span id="cb54-279"><a href="#cb54-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-280"><a href="#cb54-280" aria-hidden="true" tabindex="-1"></a>There are a couple of gotchas:</span>
<span id="cb54-281"><a href="#cb54-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-282"><a href="#cb54-282" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The elves' sightlines are blocked by trees of the same height, not just by trees of greater height. If we want to leverage <span class="in">`maximum`</span> as an indicator, we need to decrease the value of the tree under consideration by one, since otherwise there's no way of distinguishing between a, a - 1 (not blocked) and a, a (blocked).</span>
<span id="cb54-283"><a href="#cb54-283" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The elves can see the tree that they're being blocked by. If we try to account for this by just adding one to all the sightlines, we'll get a bug when they can see all the way to the edge. Instead, we pretend that they can always see the last tree in the forest</span>
<span id="cb54-284"><a href="#cb54-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-287"><a href="#cb54-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-288"><a href="#cb54-288" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb54-289"><a href="#cb54-289" aria-hidden="true" tabindex="-1"></a><span class="co"># | output: false</span></span>
<span id="cb54-290"><a href="#cb54-290" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> scenic_score(data):</span>
<span id="cb54-291"><a href="#cb54-291" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> one_row(i):</span>
<span id="cb54-292"><a href="#cb54-292" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""How many trees can be seen looking down from row i"""</span></span>
<span id="cb54-293"><a href="#cb54-293" aria-hidden="true" tabindex="-1"></a>        current <span class="op">=</span> data.copy()</span>
<span id="cb54-294"><a href="#cb54-294" aria-hidden="true" tabindex="-1"></a>        current[i] <span class="op">=</span> current[i] <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb54-295"><a href="#cb54-295" aria-hidden="true" tabindex="-1"></a>        mask <span class="op">=</span> np.maximum.accumulate(np.roll(current, <span class="op">-</span>i, axis<span class="op">=</span><span class="dv">0</span>)) <span class="op">&lt;=</span> current[i]</span>
<span id="cb54-296"><a href="#cb54-296" aria-hidden="true" tabindex="-1"></a>        mask[<span class="op">-</span>i <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb54-297"><a href="#cb54-297" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> mask[<span class="dv">1</span> : <span class="bu">len</span>(data) <span class="op">-</span> i].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb54-298"><a href="#cb54-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-299"><a href="#cb54-299" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array([one_row(i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data))])</span>
<span id="cb54-300"><a href="#cb54-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-301"><a href="#cb54-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-302"><a href="#cb54-302" aria-hidden="true" tabindex="-1"></a>scenic_scores <span class="op">=</span> []</span>
<span id="cb54-303"><a href="#cb54-303" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb54-304"><a href="#cb54-304" aria-hidden="true" tabindex="-1"></a>    scenic_scores.append(np.rot90(scenic_score(np.rot90(data, i)), <span class="dv">4</span> <span class="op">-</span> i))</span>
<span id="cb54-305"><a href="#cb54-305" aria-hidden="true" tabindex="-1"></a>np.product(scenic_scores, axis<span class="op">=</span><span class="dv">0</span>).<span class="bu">max</span>()</span>
<span id="cb54-306"><a href="#cb54-306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-307"><a href="#cb54-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-308"><a href="#cb54-308" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bonus</span></span>
<span id="cb54-309"><a href="#cb54-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-310"><a href="#cb54-310" aria-hidden="true" tabindex="-1"></a>The grid here invites plotting. One thing we can plot is the shortest tree which would be visible at each location</span>
<span id="cb54-311"><a href="#cb54-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-314"><a href="#cb54-314" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-315"><a href="#cb54-315" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: true</span></span>
<span id="cb54-316"><a href="#cb54-316" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-cap: "The shortest visible tree at each location"</span></span>
<span id="cb54-317"><a href="#cb54-317" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb54-318"><a href="#cb54-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-319"><a href="#cb54-319" aria-hidden="true" tabindex="-1"></a>plt.imshow(mask <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb54-320"><a href="#cb54-320" aria-hidden="true" tabindex="-1"></a>plt.xticks([]), plt.yticks([])</span>
<span id="cb54-321"><a href="#cb54-321" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> plt.colorbar()</span>
<span id="cb54-322"><a href="#cb54-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-323"><a href="#cb54-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-324"><a href="#cb54-324" aria-hidden="true" tabindex="-1"></a>We can see how at the edges of the forest shorter trees are visible, but towards the center they've all been shadowed by taller trees.</span>
<span id="cb54-325"><a href="#cb54-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-326"><a href="#cb54-326" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 9: Rope Bridge](https://adventofcode.com/2022/day/9)</span></span>
<span id="cb54-327"><a href="#cb54-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-328"><a href="#cb54-328" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-329"><a href="#cb54-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-332"><a href="#cb54-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-333"><a href="#cb54-333" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> {<span class="dv">2</span>: <span class="dv">1</span>, <span class="dv">2</span> <span class="op">+</span> <span class="ot">1j</span>: <span class="dv">1</span> <span class="op">+</span> <span class="ot">1j</span>, <span class="dv">2</span> <span class="op">+</span> <span class="ot">2j</span>: <span class="dv">1</span> <span class="op">+</span> <span class="ot">1j</span>, <span class="dv">1</span> <span class="op">+</span> <span class="ot">2j</span>: <span class="dv">1</span> <span class="op">+</span> <span class="ot">1j</span>}</span>
<span id="cb54-334"><a href="#cb54-334" aria-hidden="true" tabindex="-1"></a>deltas <span class="op">=</span> {k <span class="op">*</span> <span class="ot">1j</span><span class="op">**</span>i: v <span class="op">*</span> <span class="ot">1j</span><span class="op">**</span>i <span class="cf">for</span> k, v <span class="kw">in</span> base.items() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>)}</span>
<span id="cb54-335"><a href="#cb54-335" aria-hidden="true" tabindex="-1"></a>directions <span class="op">=</span> {<span class="st">"R"</span>: <span class="dv">1</span>, <span class="st">"L"</span>: <span class="op">-</span><span class="dv">1</span>, <span class="st">"U"</span>: <span class="ot">1j</span>, <span class="st">"D"</span>: <span class="op">-</span><span class="ot">1j</span>}</span>
<span id="cb54-336"><a href="#cb54-336" aria-hidden="true" tabindex="-1"></a>instructions <span class="op">=</span> [x.split() <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">9</span>)]</span>
<span id="cb54-337"><a href="#cb54-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-338"><a href="#cb54-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-339"><a href="#cb54-339" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tail_moves(rope_length):</span>
<span id="cb54-340"><a href="#cb54-340" aria-hidden="true" tabindex="-1"></a>    seen <span class="op">=</span> []</span>
<span id="cb54-341"><a href="#cb54-341" aria-hidden="true" tabindex="-1"></a>    rope <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> rope_length</span>
<span id="cb54-342"><a href="#cb54-342" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> direction, count <span class="kw">in</span> instructions:</span>
<span id="cb54-343"><a href="#cb54-343" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">int</span>(count)):</span>
<span id="cb54-344"><a href="#cb54-344" aria-hidden="true" tabindex="-1"></a>            rope[<span class="dv">0</span>] <span class="op">+=</span> directions[direction]</span>
<span id="cb54-345"><a href="#cb54-345" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(rope)):</span>
<span id="cb54-346"><a href="#cb54-346" aria-hidden="true" tabindex="-1"></a>                rope[i] <span class="op">+=</span> (</span>
<span id="cb54-347"><a href="#cb54-347" aria-hidden="true" tabindex="-1"></a>                    deltas[rope[i <span class="op">-</span> <span class="dv">1</span>] <span class="op">-</span> rope[i]]</span>
<span id="cb54-348"><a href="#cb54-348" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">abs</span>(rope[i <span class="op">-</span> <span class="dv">1</span>] <span class="op">-</span> rope[i]) <span class="op">&gt;=</span> <span class="dv">2</span></span>
<span id="cb54-349"><a href="#cb54-349" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb54-350"><a href="#cb54-350" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb54-351"><a href="#cb54-351" aria-hidden="true" tabindex="-1"></a>            seen.append(rope[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb54-352"><a href="#cb54-352" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> seen</span>
<span id="cb54-353"><a href="#cb54-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-354"><a href="#cb54-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-355"><a href="#cb54-355" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="bu">set</span>(tail_moves(<span class="dv">2</span>)))</span>
<span id="cb54-356"><a href="#cb54-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-357"><a href="#cb54-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-358"><a href="#cb54-358" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-359"><a href="#cb54-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-362"><a href="#cb54-362" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-363"><a href="#cb54-363" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="bu">set</span>(tail_moves(<span class="dv">10</span>)))</span>
<span id="cb54-364"><a href="#cb54-364" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-365"><a href="#cb54-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-366"><a href="#cb54-366" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 10: Cathode-Ray Tube](https://adventofcode.com/2022/day/10)</span></span>
<span id="cb54-367"><a href="#cb54-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-368"><a href="#cb54-368" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-369"><a href="#cb54-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-372"><a href="#cb54-372" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-373"><a href="#cb54-373" aria-hidden="true" tabindex="-1"></a>instructions <span class="op">=</span> load(<span class="dv">10</span>)</span>
<span id="cb54-374"><a href="#cb54-374" aria-hidden="true" tabindex="-1"></a>deltas <span class="op">=</span> [</span>
<span id="cb54-375"><a href="#cb54-375" aria-hidden="true" tabindex="-1"></a>    <span class="bu">int</span>(element) <span class="cf">if</span> element[<span class="op">-</span><span class="dv">1</span>].isdigit() <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb54-376"><a href="#cb54-376" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> line <span class="kw">in</span> instructions</span>
<span id="cb54-377"><a href="#cb54-377" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> element <span class="kw">in</span> line.split()</span>
<span id="cb54-378"><a href="#cb54-378" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb54-379"><a href="#cb54-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-380"><a href="#cb54-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-381"><a href="#cb54-381" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run(f, result):</span>
<span id="cb54-382"><a href="#cb54-382" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cycle, x <span class="kw">in</span> <span class="bu">enumerate</span>(np.cumsum([<span class="dv">1</span>] <span class="op">+</span> deltas)):</span>
<span id="cb54-383"><a href="#cb54-383" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> f(x, cycle <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb54-384"><a href="#cb54-384" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb54-385"><a href="#cb54-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-386"><a href="#cb54-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-387"><a href="#cb54-387" aria-hidden="true" tabindex="-1"></a>run(<span class="kw">lambda</span> x, y: x <span class="op">*</span> y <span class="cf">if</span> y <span class="op">%</span> <span class="dv">40</span> <span class="op">==</span> <span class="dv">20</span> <span class="cf">else</span> <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb54-388"><a href="#cb54-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-389"><a href="#cb54-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-390"><a href="#cb54-390" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-391"><a href="#cb54-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-394"><a href="#cb54-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-395"><a href="#cb54-395" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> draw_sprite(sprite_position, cycle):</span>
<span id="cb54-396"><a href="#cb54-396" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"█"</span> <span class="cf">if</span> <span class="bu">abs</span>(sprite_position <span class="op">-</span> ((cycle <span class="op">-</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">40</span>)) <span class="op">&lt;=</span> <span class="dv">1</span> <span class="cf">else</span> <span class="st">" "</span></span>
<span id="cb54-397"><a href="#cb54-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-398"><a href="#cb54-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-399"><a href="#cb54-399" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>[run(draw_sprite, <span class="st">""</span>)[<span class="dv">40</span> <span class="op">*</span> i : <span class="dv">40</span> <span class="op">*</span> (i <span class="op">+</span> <span class="dv">1</span>)] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)], sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb54-400"><a href="#cb54-400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-401"><a href="#cb54-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-402"><a href="#cb54-402" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 11: Monkey in the Middle](https://adventofcode.com/2022/day/11)</span></span>
<span id="cb54-403"><a href="#cb54-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-404"><a href="#cb54-404" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-405"><a href="#cb54-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-408"><a href="#cb54-408" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-409"><a href="#cb54-409" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">11</span>, <span class="st">"raw"</span>)</span>
<span id="cb54-410"><a href="#cb54-410" aria-hidden="true" tabindex="-1"></a>monkeys <span class="op">=</span> data.split(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>)</span>
<span id="cb54-411"><a href="#cb54-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-412"><a href="#cb54-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-413"><a href="#cb54-413" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Monkey:</span>
<span id="cb54-414"><a href="#cb54-414" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, update, test):</span>
<span id="cb54-415"><a href="#cb54-415" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.update <span class="op">=</span> update</span>
<span id="cb54-416"><a href="#cb54-416" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.factor <span class="op">=</span> test[<span class="dv">0</span>]</span>
<span id="cb54-417"><a href="#cb54-417" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.target <span class="op">=</span> <span class="kw">lambda</span> x: test[<span class="dv">1</span>] <span class="cf">if</span> x <span class="op">%</span> <span class="va">self</span>.factor <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> test[<span class="dv">2</span>]</span>
<span id="cb54-418"><a href="#cb54-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-419"><a href="#cb54-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-420"><a href="#cb54-420" aria-hidden="true" tabindex="-1"></a>monkeys <span class="op">=</span> []</span>
<span id="cb54-421"><a href="#cb54-421" aria-hidden="true" tabindex="-1"></a>initial_items <span class="op">=</span> []</span>
<span id="cb54-422"><a href="#cb54-422" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> monkey <span class="kw">in</span> data.split(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>):</span>
<span id="cb54-423"><a href="#cb54-423" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> [line <span class="cf">for</span> line <span class="kw">in</span> monkey.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>) <span class="cf">if</span> line]</span>
<span id="cb54-424"><a href="#cb54-424" aria-hidden="true" tabindex="-1"></a>    update <span class="op">=</span> <span class="bu">eval</span>(<span class="st">"lambda old: "</span> <span class="op">+</span> lines[<span class="dv">2</span>].split(<span class="st">" = "</span>)[<span class="dv">1</span>])</span>
<span id="cb54-425"><a href="#cb54-425" aria-hidden="true" tabindex="-1"></a>    digits <span class="op">=</span> [[<span class="bu">int</span>(x) <span class="cf">for</span> x <span class="kw">in</span> re.findall(<span class="st">"\d+"</span>, line)] <span class="cf">for</span> line <span class="kw">in</span> lines]</span>
<span id="cb54-426"><a href="#cb54-426" aria-hidden="true" tabindex="-1"></a>    monkeys.append(Monkey(update, [x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> digits[<span class="op">-</span><span class="dv">3</span>:]]))</span>
<span id="cb54-427"><a href="#cb54-427" aria-hidden="true" tabindex="-1"></a>    initial_items.append(digits[<span class="dv">1</span>])</span>
<span id="cb54-428"><a href="#cb54-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-429"><a href="#cb54-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-430"><a href="#cb54-430" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run(rounds, function):</span>
<span id="cb54-431"><a href="#cb54-431" aria-hidden="true" tabindex="-1"></a>    examined <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> <span class="bu">len</span>(monkeys)</span>
<span id="cb54-432"><a href="#cb54-432" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> monkey, items <span class="kw">in</span> <span class="bu">zip</span>(monkeys, initial_items):</span>
<span id="cb54-433"><a href="#cb54-433" aria-hidden="true" tabindex="-1"></a>        monkey.items <span class="op">=</span> items.copy()</span>
<span id="cb54-434"><a href="#cb54-434" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(rounds):</span>
<span id="cb54-435"><a href="#cb54-435" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, monkey <span class="kw">in</span> <span class="bu">enumerate</span>(monkeys):</span>
<span id="cb54-436"><a href="#cb54-436" aria-hidden="true" tabindex="-1"></a>            examined[idx] <span class="op">+=</span> <span class="bu">len</span>(monkey.items)</span>
<span id="cb54-437"><a href="#cb54-437" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(monkey.items)):</span>
<span id="cb54-438"><a href="#cb54-438" aria-hidden="true" tabindex="-1"></a>                item <span class="op">=</span> function((monkey.update(monkey.items.pop())))</span>
<span id="cb54-439"><a href="#cb54-439" aria-hidden="true" tabindex="-1"></a>                monkeys[monkey.target(item)].items.append(item)</span>
<span id="cb54-440"><a href="#cb54-440" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> examined</span>
<span id="cb54-441"><a href="#cb54-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-442"><a href="#cb54-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-443"><a href="#cb54-443" aria-hidden="true" tabindex="-1"></a>np.product(<span class="bu">sorted</span>(run(<span class="dv">20</span>, <span class="kw">lambda</span> x: x <span class="op">//</span> <span class="dv">3</span>))[<span class="op">-</span><span class="dv">2</span>:])</span>
<span id="cb54-444"><a href="#cb54-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-445"><a href="#cb54-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-446"><a href="#cb54-446" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-447"><a href="#cb54-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-450"><a href="#cb54-450" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-451"><a href="#cb54-451" aria-hidden="true" tabindex="-1"></a>common_multiple <span class="op">=</span> np.product([x.factor <span class="cf">for</span> x <span class="kw">in</span> monkeys])</span>
<span id="cb54-452"><a href="#cb54-452" aria-hidden="true" tabindex="-1"></a>np.product(<span class="bu">sorted</span>(run(<span class="dv">10000</span>, <span class="kw">lambda</span> x: x <span class="op">%</span> common_multiple))[<span class="op">-</span><span class="dv">2</span>:])</span>
<span id="cb54-453"><a href="#cb54-453" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-454"><a href="#cb54-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-455"><a href="#cb54-455" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 12: Hill Climbing Algorithm](https://adventofcode.com/2022/day/12)</span></span>
<span id="cb54-456"><a href="#cb54-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-457"><a href="#cb54-457" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-458"><a href="#cb54-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-461"><a href="#cb54-461" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-462"><a href="#cb54-462" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [<span class="bu">list</span>(x) <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">12</span>)]</span>
<span id="cb54-463"><a href="#cb54-463" aria-hidden="true" tabindex="-1"></a>elevations <span class="op">=</span> np.array([[<span class="bu">ord</span>(char) <span class="op">-</span> <span class="bu">ord</span>(<span class="st">"a"</span>) <span class="cf">for</span> char <span class="kw">in</span> line] <span class="cf">for</span> line <span class="kw">in</span> data])</span>
<span id="cb54-464"><a href="#cb54-464" aria-hidden="true" tabindex="-1"></a>source <span class="op">=</span> <span class="bu">tuple</span>(x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> np.where(elevations <span class="op">==</span> <span class="bu">ord</span>(<span class="st">"S"</span>) <span class="op">-</span> <span class="bu">ord</span>(<span class="st">"a"</span>)))</span>
<span id="cb54-465"><a href="#cb54-465" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> <span class="bu">tuple</span>(x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> np.where(elevations <span class="op">==</span> <span class="bu">ord</span>(<span class="st">"E"</span>) <span class="op">-</span> <span class="bu">ord</span>(<span class="st">"a"</span>)))</span>
<span id="cb54-466"><a href="#cb54-466" aria-hidden="true" tabindex="-1"></a>elevations[source] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-467"><a href="#cb54-467" aria-hidden="true" tabindex="-1"></a>elevations[target] <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb54-468"><a href="#cb54-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-469"><a href="#cb54-469" aria-hidden="true" tabindex="-1"></a>xmax, ymax <span class="op">=</span> elevations.shape</span>
<span id="cb54-470"><a href="#cb54-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-471"><a href="#cb54-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-472"><a href="#cb54-472" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> grid_neighbors(x, y):</span>
<span id="cb54-473"><a href="#cb54-473" aria-hidden="true" tabindex="-1"></a>    candidates <span class="op">=</span> [(x <span class="op">-</span> <span class="dv">1</span>, y), (x <span class="op">+</span> <span class="dv">1</span>, y), (x, y <span class="op">-</span> <span class="dv">1</span>), (x, y <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb54-474"><a href="#cb54-474" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [c <span class="cf">for</span> c <span class="kw">in</span> candidates <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;=</span> c[<span class="dv">0</span>] <span class="op">&lt;</span> xmax <span class="kw">and</span> <span class="dv">0</span> <span class="op">&lt;=</span> c[<span class="dv">1</span>] <span class="op">&lt;</span> ymax]</span>
<span id="cb54-475"><a href="#cb54-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-476"><a href="#cb54-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-477"><a href="#cb54-477" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_neighbors(x, y):</span>
<span id="cb54-478"><a href="#cb54-478" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [n <span class="cf">for</span> n <span class="kw">in</span> grid_neighbors(x, y) <span class="cf">if</span> elevations[n] <span class="op">-</span> elevations[x, y] <span class="op">&lt;=</span> <span class="dv">1</span>]</span>
<span id="cb54-479"><a href="#cb54-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-480"><a href="#cb54-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-481"><a href="#cb54-481" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> navigate(source, neighbor_func, stop_condition):</span>
<span id="cb54-482"><a href="#cb54-482" aria-hidden="true" tabindex="-1"></a>    active <span class="op">=</span> deque([(<span class="dv">0</span>, source)])</span>
<span id="cb54-483"><a href="#cb54-483" aria-hidden="true" tabindex="-1"></a>    seen <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb54-484"><a href="#cb54-484" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> active:</span>
<span id="cb54-485"><a href="#cb54-485" aria-hidden="true" tabindex="-1"></a>        steps, current <span class="op">=</span> active.popleft()</span>
<span id="cb54-486"><a href="#cb54-486" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> stop_condition(current):</span>
<span id="cb54-487"><a href="#cb54-487" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> steps</span>
<span id="cb54-488"><a href="#cb54-488" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> current <span class="kw">in</span> seen:</span>
<span id="cb54-489"><a href="#cb54-489" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb54-490"><a href="#cb54-490" aria-hidden="true" tabindex="-1"></a>        seen.add(current)</span>
<span id="cb54-491"><a href="#cb54-491" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> neighbor <span class="kw">in</span> neighbor_func(<span class="op">*</span>current):</span>
<span id="cb54-492"><a href="#cb54-492" aria-hidden="true" tabindex="-1"></a>            active.append((steps <span class="op">+</span> <span class="dv">1</span>, neighbor))</span>
<span id="cb54-493"><a href="#cb54-493" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.inf</span>
<span id="cb54-494"><a href="#cb54-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-495"><a href="#cb54-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-496"><a href="#cb54-496" aria-hidden="true" tabindex="-1"></a>navigate(source, find_neighbors, <span class="kw">lambda</span> x: x <span class="op">==</span> target)</span>
<span id="cb54-497"><a href="#cb54-497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-498"><a href="#cb54-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-499"><a href="#cb54-499" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-500"><a href="#cb54-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-503"><a href="#cb54-503" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-504"><a href="#cb54-504" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reversed_neighbors(x, y):</span>
<span id="cb54-505"><a href="#cb54-505" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [n <span class="cf">for</span> n <span class="kw">in</span> grid_neighbors(x, y) <span class="cf">if</span> elevations[x, y] <span class="op">-</span> elevations[n] <span class="op">&lt;=</span> <span class="dv">1</span>]</span>
<span id="cb54-506"><a href="#cb54-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-507"><a href="#cb54-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-508"><a href="#cb54-508" aria-hidden="true" tabindex="-1"></a>navigate(target, reversed_neighbors, <span class="kw">lambda</span> x: elevations[x] <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb54-509"><a href="#cb54-509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-510"><a href="#cb54-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-511"><a href="#cb54-511" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 13: Distress Signal](https://adventofcode.com/2022/day/13)</span></span>
<span id="cb54-512"><a href="#cb54-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-513"><a href="#cb54-513" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-514"><a href="#cb54-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-517"><a href="#cb54-517" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-518"><a href="#cb54-518" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ast</span>
<span id="cb54-519"><a href="#cb54-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-520"><a href="#cb54-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-521"><a href="#cb54-521" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compare(left, right):</span>
<span id="cb54-522"><a href="#cb54-522" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(left, <span class="bu">int</span>) <span class="kw">and</span> <span class="bu">isinstance</span>(right, <span class="bu">int</span>):</span>
<span id="cb54-523"><a href="#cb54-523" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (left <span class="op">&gt;</span> right) <span class="op">+</span> (left <span class="op">&gt;=</span> right)</span>
<span id="cb54-524"><a href="#cb54-524" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(left, <span class="bu">int</span>):</span>
<span id="cb54-525"><a href="#cb54-525" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> compare([left], right)</span>
<span id="cb54-526"><a href="#cb54-526" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(right, <span class="bu">int</span>):</span>
<span id="cb54-527"><a href="#cb54-527" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> compare(left, [right])</span>
<span id="cb54-528"><a href="#cb54-528" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> left <span class="kw">and</span> <span class="kw">not</span> right:</span>
<span id="cb54-529"><a href="#cb54-529" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb54-530"><a href="#cb54-530" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> left:</span>
<span id="cb54-531"><a href="#cb54-531" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb54-532"><a href="#cb54-532" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> right:</span>
<span id="cb54-533"><a href="#cb54-533" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">2</span></span>
<span id="cb54-534"><a href="#cb54-534" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> compare(left[<span class="dv">0</span>], right[<span class="dv">0</span>])</span>
<span id="cb54-535"><a href="#cb54-535" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> val <span class="cf">if</span> (val <span class="op">==</span> <span class="dv">0</span> <span class="kw">or</span> val <span class="op">==</span> <span class="dv">2</span>) <span class="cf">else</span> compare(left[<span class="dv">1</span>:], right[<span class="dv">1</span>:])</span>
<span id="cb54-536"><a href="#cb54-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-537"><a href="#cb54-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-538"><a href="#cb54-538" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-539"><a href="#cb54-539" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> load(<span class="dv">13</span>, <span class="st">"raw"</span>)[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb54-540"><a href="#cb54-540" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, (left, right) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: x.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>), s.split(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>))):</span>
<span id="cb54-541"><a href="#cb54-541" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> compare(ast.literal_eval(left), ast.literal_eval(right))</span>
<span id="cb54-542"><a href="#cb54-542" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> val <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb54-543"><a href="#cb54-543" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> idx <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb54-544"><a href="#cb54-544" aria-hidden="true" tabindex="-1"></a>total</span>
<span id="cb54-545"><a href="#cb54-545" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-546"><a href="#cb54-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-547"><a href="#cb54-547" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-548"><a href="#cb54-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-551"><a href="#cb54-551" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-552"><a href="#cb54-552" aria-hidden="true" tabindex="-1"></a>dividers <span class="op">=</span> [[<span class="dv">2</span>]], [[<span class="dv">6</span>]]</span>
<span id="cb54-553"><a href="#cb54-553" aria-hidden="true" tabindex="-1"></a>packets <span class="op">=</span> [</span>
<span id="cb54-554"><a href="#cb54-554" aria-hidden="true" tabindex="-1"></a>    ast.literal_eval(packet) <span class="cf">for</span> pair <span class="kw">in</span> s.split(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>) <span class="cf">for</span> packet <span class="kw">in</span> pair.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb54-555"><a href="#cb54-555" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb54-556"><a href="#cb54-556" aria-hidden="true" tabindex="-1"></a>positions <span class="op">=</span> [</span>
<span id="cb54-557"><a href="#cb54-557" aria-hidden="true" tabindex="-1"></a>    <span class="bu">sum</span>(compare(divider, packet) <span class="op">==</span> <span class="dv">2</span> <span class="cf">for</span> packet <span class="kw">in</span> packets) <span class="cf">for</span> divider <span class="kw">in</span> dividers</span>
<span id="cb54-558"><a href="#cb54-558" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb54-559"><a href="#cb54-559" aria-hidden="true" tabindex="-1"></a>(positions[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> (positions[<span class="dv">1</span>] <span class="op">+</span> <span class="dv">2</span>)</span>
<span id="cb54-560"><a href="#cb54-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-561"><a href="#cb54-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-562"><a href="#cb54-562" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 14: Regolith Reservoir](https://adventofcode.com/2022/day/14)</span></span>
<span id="cb54-563"><a href="#cb54-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-564"><a href="#cb54-564" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-565"><a href="#cb54-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-568"><a href="#cb54-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-569"><a href="#cb54-569" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">14</span>, <span class="st">"int"</span>)</span>
<span id="cb54-570"><a href="#cb54-570" aria-hidden="true" tabindex="-1"></a>flat <span class="op">=</span> [val <span class="cf">for</span> line <span class="kw">in</span> data <span class="cf">for</span> val <span class="kw">in</span> line]</span>
<span id="cb54-571"><a href="#cb54-571" aria-hidden="true" tabindex="-1"></a>xmin, xmax <span class="op">=</span> <span class="bu">min</span>(flat[::<span class="dv">2</span>]), <span class="bu">max</span>(flat[::<span class="dv">2</span>])</span>
<span id="cb54-572"><a href="#cb54-572" aria-hidden="true" tabindex="-1"></a>ymin, ymax <span class="op">=</span> <span class="bu">min</span>(flat[<span class="dv">1</span>::<span class="dv">2</span>]), <span class="bu">max</span>(flat[<span class="dv">1</span>::<span class="dv">2</span>])</span>
<span id="cb54-573"><a href="#cb54-573" aria-hidden="true" tabindex="-1"></a>air, rock, sand <span class="op">=</span> <span class="bu">ord</span>(<span class="st">"."</span>), <span class="bu">ord</span>(<span class="st">"#"</span>), <span class="bu">ord</span>(<span class="st">"o"</span>)</span>
<span id="cb54-574"><a href="#cb54-574" aria-hidden="true" tabindex="-1"></a>board <span class="op">=</span> np.zeros((ymax <span class="op">+</span> <span class="dv">1</span>, xmax <span class="op">-</span> xmin <span class="op">+</span> <span class="dv">3</span>), dtype<span class="op">=</span><span class="bu">int</span>) <span class="op">+</span> air</span>
<span id="cb54-575"><a href="#cb54-575" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> data:</span>
<span id="cb54-576"><a href="#cb54-576" aria-hidden="true" tabindex="-1"></a>    chunks <span class="op">=</span> <span class="bu">list</span>(more_itertools.chunked(line, <span class="dv">2</span>))</span>
<span id="cb54-577"><a href="#cb54-577" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (current_x, current_y), (next_x, next_y) <span class="kw">in</span> <span class="bu">zip</span>(chunks, chunks[<span class="dv">1</span>:]):</span>
<span id="cb54-578"><a href="#cb54-578" aria-hidden="true" tabindex="-1"></a>        current_y, next_y <span class="op">=</span> <span class="bu">sorted</span>([current_y, next_y])</span>
<span id="cb54-579"><a href="#cb54-579" aria-hidden="true" tabindex="-1"></a>        current_x, next_x <span class="op">=</span> <span class="bu">sorted</span>([current_x, next_x])</span>
<span id="cb54-580"><a href="#cb54-580" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> current_x <span class="op">==</span> next_x:</span>
<span id="cb54-581"><a href="#cb54-581" aria-hidden="true" tabindex="-1"></a>            board[current_y : next_y <span class="op">+</span> <span class="dv">1</span>, current_x <span class="op">-</span> xmin <span class="op">+</span> <span class="dv">1</span>] <span class="op">=</span> rock</span>
<span id="cb54-582"><a href="#cb54-582" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb54-583"><a href="#cb54-583" aria-hidden="true" tabindex="-1"></a>            board[current_y, current_x <span class="op">-</span> xmin <span class="op">+</span> <span class="dv">1</span> : next_x <span class="op">-</span> xmin <span class="op">+</span> <span class="dv">2</span>] <span class="op">=</span> rock</span>
<span id="cb54-584"><a href="#cb54-584" aria-hidden="true" tabindex="-1"></a>initial_board <span class="op">=</span> board.copy()</span>
<span id="cb54-585"><a href="#cb54-585" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> <span class="dv">0</span>, <span class="dv">500</span> <span class="op">-</span> xmin <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb54-586"><a href="#cb54-586" aria-hidden="true" tabindex="-1"></a>y, x <span class="op">=</span> start</span>
<span id="cb54-587"><a href="#cb54-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-588"><a href="#cb54-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-589"><a href="#cb54-589" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> y <span class="op">+</span> <span class="dv">1</span> <span class="op">&lt;</span> board.shape[<span class="dv">0</span>]:</span>
<span id="cb54-590"><a href="#cb54-590" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> board[y <span class="op">+</span> <span class="dv">1</span>, x] <span class="op">==</span> air:</span>
<span id="cb54-591"><a href="#cb54-591" aria-hidden="true" tabindex="-1"></a>        y <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-592"><a href="#cb54-592" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> board[y <span class="op">+</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span>] <span class="op">==</span> air:</span>
<span id="cb54-593"><a href="#cb54-593" aria-hidden="true" tabindex="-1"></a>        y, x <span class="op">=</span> y <span class="op">+</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb54-594"><a href="#cb54-594" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> board[y <span class="op">+</span> <span class="dv">1</span>, x <span class="op">+</span> <span class="dv">1</span>] <span class="op">==</span> air:</span>
<span id="cb54-595"><a href="#cb54-595" aria-hidden="true" tabindex="-1"></a>        y, x <span class="op">=</span> y <span class="op">+</span> <span class="dv">1</span>, x <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb54-596"><a href="#cb54-596" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb54-597"><a href="#cb54-597" aria-hidden="true" tabindex="-1"></a>        board[y, x] <span class="op">=</span> sand</span>
<span id="cb54-598"><a href="#cb54-598" aria-hidden="true" tabindex="-1"></a>        y, x <span class="op">=</span> start</span>
<span id="cb54-599"><a href="#cb54-599" aria-hidden="true" tabindex="-1"></a>(board <span class="op">==</span> sand).<span class="bu">sum</span>()</span>
<span id="cb54-600"><a href="#cb54-600" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-601"><a href="#cb54-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-602"><a href="#cb54-602" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-603"><a href="#cb54-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-606"><a href="#cb54-606" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-607"><a href="#cb54-607" aria-hidden="true" tabindex="-1"></a>board <span class="op">=</span> np.vstack([initial_board, np.zeros((<span class="dv">2</span>, board.shape[<span class="dv">1</span>]), dtype<span class="op">=</span><span class="bu">int</span>) <span class="op">+</span> air])</span>
<span id="cb54-608"><a href="#cb54-608" aria-hidden="true" tabindex="-1"></a>pad_width <span class="op">=</span> (board.shape[<span class="dv">0</span>] <span class="op">*</span> <span class="dv">2</span> <span class="op">-</span> board.shape[<span class="dv">1</span>]) <span class="op">//</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb54-609"><a href="#cb54-609" aria-hidden="true" tabindex="-1"></a>padding <span class="op">=</span> np.zeros((board.shape[<span class="dv">0</span>], pad_width), dtype<span class="op">=</span><span class="bu">int</span>) <span class="op">+</span> air</span>
<span id="cb54-610"><a href="#cb54-610" aria-hidden="true" tabindex="-1"></a>board <span class="op">=</span> np.hstack([padding, board, padding])</span>
<span id="cb54-611"><a href="#cb54-611" aria-hidden="true" tabindex="-1"></a>board[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> rock</span>
<span id="cb54-612"><a href="#cb54-612" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> <span class="dv">0</span>, <span class="dv">500</span> <span class="op">-</span> xmin <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> pad_width</span>
<span id="cb54-613"><a href="#cb54-613" aria-hidden="true" tabindex="-1"></a>y, x <span class="op">=</span> start</span>
<span id="cb54-614"><a href="#cb54-614" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb54-615"><a href="#cb54-615" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> board[y <span class="op">+</span> <span class="dv">1</span>, x] <span class="op">==</span> air:</span>
<span id="cb54-616"><a href="#cb54-616" aria-hidden="true" tabindex="-1"></a>        y <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-617"><a href="#cb54-617" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> board[y <span class="op">+</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span>] <span class="op">==</span> air:</span>
<span id="cb54-618"><a href="#cb54-618" aria-hidden="true" tabindex="-1"></a>        y, x <span class="op">=</span> y <span class="op">+</span> <span class="dv">1</span>, x <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb54-619"><a href="#cb54-619" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> board[y <span class="op">+</span> <span class="dv">1</span>, x <span class="op">+</span> <span class="dv">1</span>] <span class="op">==</span> air:</span>
<span id="cb54-620"><a href="#cb54-620" aria-hidden="true" tabindex="-1"></a>        y, x <span class="op">=</span> y <span class="op">+</span> <span class="dv">1</span>, x <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb54-621"><a href="#cb54-621" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb54-622"><a href="#cb54-622" aria-hidden="true" tabindex="-1"></a>        board[y, x] <span class="op">=</span> sand</span>
<span id="cb54-623"><a href="#cb54-623" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (y, x) <span class="op">==</span> start:</span>
<span id="cb54-624"><a href="#cb54-624" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb54-625"><a href="#cb54-625" aria-hidden="true" tabindex="-1"></a>        y, x <span class="op">=</span> start</span>
<span id="cb54-626"><a href="#cb54-626" aria-hidden="true" tabindex="-1"></a>(board <span class="op">==</span> sand).<span class="bu">sum</span>()</span>
<span id="cb54-627"><a href="#cb54-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-628"><a href="#cb54-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-629"><a href="#cb54-629" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 15: Beacon Exclusion Zone](https://adventofcode.com/2022/day/15)</span></span>
<span id="cb54-630"><a href="#cb54-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-631"><a href="#cb54-631" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-632"><a href="#cb54-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-635"><a href="#cb54-635" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-636"><a href="#cb54-636" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> combine_two_intervals(i1, i2):</span>
<span id="cb54-637"><a href="#cb54-637" aria-hidden="true" tabindex="-1"></a>    i1, i2 <span class="op">=</span> <span class="bu">sorted</span>([i1, i2])</span>
<span id="cb54-638"><a href="#cb54-638" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i2[<span class="dv">0</span>] <span class="op">&lt;=</span> i1[<span class="dv">1</span>]:</span>
<span id="cb54-639"><a href="#cb54-639" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> i1[<span class="dv">0</span>], <span class="bu">max</span>(i1[<span class="dv">1</span>], i2[<span class="dv">1</span>])</span>
<span id="cb54-640"><a href="#cb54-640" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb54-641"><a href="#cb54-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-642"><a href="#cb54-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-643"><a href="#cb54-643" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> combine_n_intervals(intervals):</span>
<span id="cb54-644"><a href="#cb54-644" aria-hidden="true" tabindex="-1"></a>    active <span class="op">=</span> intervals.copy()</span>
<span id="cb54-645"><a href="#cb54-645" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> []</span>
<span id="cb54-646"><a href="#cb54-646" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> active:</span>
<span id="cb54-647"><a href="#cb54-647" aria-hidden="true" tabindex="-1"></a>        current <span class="op">=</span> active.pop()</span>
<span id="cb54-648"><a href="#cb54-648" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> index, previous <span class="kw">in</span> <span class="bu">enumerate</span>(result):</span>
<span id="cb54-649"><a href="#cb54-649" aria-hidden="true" tabindex="-1"></a>            new_interval <span class="op">=</span> combine_two_intervals(current, previous)</span>
<span id="cb54-650"><a href="#cb54-650" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> new_interval:</span>
<span id="cb54-651"><a href="#cb54-651" aria-hidden="true" tabindex="-1"></a>                <span class="kw">del</span> result[index]</span>
<span id="cb54-652"><a href="#cb54-652" aria-hidden="true" tabindex="-1"></a>                active.append(new_interval)</span>
<span id="cb54-653"><a href="#cb54-653" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb54-654"><a href="#cb54-654" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb54-655"><a href="#cb54-655" aria-hidden="true" tabindex="-1"></a>            result.append(current)</span>
<span id="cb54-656"><a href="#cb54-656" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb54-657"><a href="#cb54-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-658"><a href="#cb54-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-659"><a href="#cb54-659" aria-hidden="true" tabindex="-1"></a>y_target <span class="op">=</span> <span class="dv">2000000</span></span>
<span id="cb54-660"><a href="#cb54-660" aria-hidden="true" tabindex="-1"></a>fixes <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb54-661"><a href="#cb54-661" aria-hidden="true" tabindex="-1"></a>intervals <span class="op">=</span> []</span>
<span id="cb54-662"><a href="#cb54-662" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, y, u, v <span class="kw">in</span> load(<span class="dv">15</span>, <span class="st">"int"</span>):</span>
<span id="cb54-663"><a href="#cb54-663" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> <span class="bu">abs</span>(x <span class="op">-</span> u) <span class="op">+</span> <span class="bu">abs</span>(y <span class="op">-</span> v)</span>
<span id="cb54-664"><a href="#cb54-664" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> v <span class="op">==</span> y_target:</span>
<span id="cb54-665"><a href="#cb54-665" aria-hidden="true" tabindex="-1"></a>        fixes.add(u)</span>
<span id="cb54-666"><a href="#cb54-666" aria-hidden="true" tabindex="-1"></a>    available <span class="op">=</span> r <span class="op">-</span> <span class="bu">abs</span>(y <span class="op">-</span> y_target)</span>
<span id="cb54-667"><a href="#cb54-667" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> available <span class="op">&gt;=</span> <span class="dv">0</span>:</span>
<span id="cb54-668"><a href="#cb54-668" aria-hidden="true" tabindex="-1"></a>        interval <span class="op">=</span> x <span class="op">-</span> available, x <span class="op">+</span> available <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb54-669"><a href="#cb54-669" aria-hidden="true" tabindex="-1"></a>        intervals <span class="op">+=</span> [interval]</span>
<span id="cb54-670"><a href="#cb54-670" aria-hidden="true" tabindex="-1"></a>intervals <span class="op">=</span> combine_n_intervals(intervals)</span>
<span id="cb54-671"><a href="#cb54-671" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(x[<span class="dv">1</span>] <span class="op">-</span> x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> intervals) <span class="op">-</span> <span class="bu">len</span>(fixes)</span>
<span id="cb54-672"><a href="#cb54-672" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-673"><a href="#cb54-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-674"><a href="#cb54-674" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-675"><a href="#cb54-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-676"><a href="#cb54-676" aria-hidden="true" tabindex="-1"></a>To solve this quickly, we need to move from a representation of the problem in terms of the covered points to one that considers the beacons as the central object. From the problem description, we can see that the point we are interested in must lie just out of range of at least two beacons, since otherwise there would be more than one point which satisfies the criteria.</span>
<span id="cb54-677"><a href="#cb54-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-678"><a href="#cb54-678" aria-hidden="true" tabindex="-1"></a>We'll do a coordinate transformation so that we're working in a basis of (x + y, x - y) coordinates; in that basis, the area covered by each beacon is an axis-aligned square. Determining whether (and where) two squares intersect can be done by looking at the two axes of the square separately. We can thus loop over pairs of beacons, and for each pair identify the points which would be just out of range of both beacons; for each of these points we can check whether it is in range of any of the other beacons. If it is not, we have found the point we were interested in and we are finished.</span>
<span id="cb54-679"><a href="#cb54-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-682"><a href="#cb54-682" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-683"><a href="#cb54-683" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> np.array(load(<span class="dv">15</span>, <span class="st">"int"</span>))</span>
<span id="cb54-684"><a href="#cb54-684" aria-hidden="true" tabindex="-1"></a>radii <span class="op">=</span> <span class="bu">abs</span>(np.squeeze(np.diff(data.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>), axis<span class="op">=</span><span class="dv">1</span>))).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb54-685"><a href="#cb54-685" aria-hidden="true" tabindex="-1"></a>diamonds <span class="op">=</span> np.hstack([data[:, :<span class="dv">2</span>] <span class="op">@</span> [[<span class="dv">1</span>, <span class="dv">1</span>], [<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>]], radii.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)])</span>
<span id="cb54-686"><a href="#cb54-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-687"><a href="#cb54-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-688"><a href="#cb54-688" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> intersect_intervals(i0, i1):</span>
<span id="cb54-689"><a href="#cb54-689" aria-hidden="true" tabindex="-1"></a>    new_left <span class="op">=</span> <span class="bu">max</span>(i0[<span class="dv">0</span>], i1[<span class="dv">0</span>])</span>
<span id="cb54-690"><a href="#cb54-690" aria-hidden="true" tabindex="-1"></a>    new_right <span class="op">=</span> <span class="bu">min</span>(i0[<span class="dv">1</span>], i1[<span class="dv">1</span>])</span>
<span id="cb54-691"><a href="#cb54-691" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [new_left, new_right] <span class="cf">if</span> new_right <span class="op">&gt;=</span> new_left <span class="cf">else</span> []</span>
<span id="cb54-692"><a href="#cb54-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-693"><a href="#cb54-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-694"><a href="#cb54-694" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_on_square(point, centre, radius):</span>
<span id="cb54-695"><a href="#cb54-695" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">abs</span>(point[<span class="dv">0</span>] <span class="op">-</span> centre[<span class="dv">0</span>]) <span class="op">==</span> radius <span class="kw">or</span> <span class="bu">abs</span>(point[<span class="dv">1</span>] <span class="op">-</span> centre[<span class="dv">1</span>]) <span class="op">==</span> radius</span>
<span id="cb54-696"><a href="#cb54-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-697"><a href="#cb54-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-698"><a href="#cb54-698" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> intersect_diamonds(d0, d1):</span>
<span id="cb54-699"><a href="#cb54-699" aria-hidden="true" tabindex="-1"></a>    x0, y0, r0 <span class="op">=</span> d0</span>
<span id="cb54-700"><a href="#cb54-700" aria-hidden="true" tabindex="-1"></a>    x1, y1, r1 <span class="op">=</span> d1</span>
<span id="cb54-701"><a href="#cb54-701" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (x0 <span class="op">+</span> r0) <span class="op">%</span> <span class="dv">2</span> <span class="op">!=</span> (x1 <span class="op">+</span> r1) <span class="op">%</span> <span class="dv">2</span>:</span>
<span id="cb54-702"><a href="#cb54-702" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb54-703"><a href="#cb54-703" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> []</span>
<span id="cb54-704"><a href="#cb54-704" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> intersect_intervals((x0 <span class="op">-</span> r0, x0 <span class="op">+</span> r0), (x1 <span class="op">-</span> r1, x1 <span class="op">+</span> r1)):</span>
<span id="cb54-705"><a href="#cb54-705" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> y <span class="kw">in</span> intersect_intervals((y0 <span class="op">-</span> r0, y0 <span class="op">+</span> r0), (y1 <span class="op">-</span> r1, y1 <span class="op">+</span> r1)):</span>
<span id="cb54-706"><a href="#cb54-706" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> is_on_square((x, y), (x0, y0), r0) <span class="kw">and</span> is_on_square(</span>
<span id="cb54-707"><a href="#cb54-707" aria-hidden="true" tabindex="-1"></a>                (x, y), (x1, y1), r1</span>
<span id="cb54-708"><a href="#cb54-708" aria-hidden="true" tabindex="-1"></a>            ):</span>
<span id="cb54-709"><a href="#cb54-709" aria-hidden="true" tabindex="-1"></a>                result.append((x, y))</span>
<span id="cb54-710"><a href="#cb54-710" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb54-711"><a href="#cb54-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-712"><a href="#cb54-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-713"><a href="#cb54-713" aria-hidden="true" tabindex="-1"></a>done <span class="op">=</span> <span class="va">False</span></span>
<span id="cb54-714"><a href="#cb54-714" aria-hidden="true" tabindex="-1"></a>limit <span class="op">=</span> <span class="dv">4000000</span></span>
<span id="cb54-715"><a href="#cb54-715" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> d0 <span class="kw">in</span> diamonds <span class="op">+</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>]:</span>
<span id="cb54-716"><a href="#cb54-716" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> d1 <span class="kw">in</span> diamonds <span class="op">+</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>]:</span>
<span id="cb54-717"><a href="#cb54-717" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (d0 <span class="op">==</span> d1).<span class="bu">all</span>():</span>
<span id="cb54-718"><a href="#cb54-718" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb54-719"><a href="#cb54-719" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> x0, y0 <span class="kw">in</span> intersect_diamonds(d0, d1):</span>
<span id="cb54-720"><a href="#cb54-720" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> x, y, r <span class="kw">in</span> diamonds:</span>
<span id="cb54-721"><a href="#cb54-721" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">abs</span>(x0 <span class="op">-</span> x) <span class="op">&lt;=</span> r <span class="kw">and</span> <span class="bu">abs</span>(y0 <span class="op">-</span> y) <span class="op">&lt;=</span> r:</span>
<span id="cb54-722"><a href="#cb54-722" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb54-723"><a href="#cb54-723" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb54-724"><a href="#cb54-724" aria-hidden="true" tabindex="-1"></a>                real_x, real_y <span class="op">=</span> (x0 <span class="op">+</span> y0) <span class="op">//</span> <span class="dv">2</span>, (x0 <span class="op">-</span> y0) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb54-725"><a href="#cb54-725" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">abs</span>(real_x) <span class="op">&lt;=</span> limit <span class="kw">and</span> <span class="bu">abs</span>(real_y) <span class="op">&lt;=</span> limit:</span>
<span id="cb54-726"><a href="#cb54-726" aria-hidden="true" tabindex="-1"></a>                    done <span class="op">=</span> <span class="va">True</span></span>
<span id="cb54-727"><a href="#cb54-727" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb54-728"><a href="#cb54-728" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> done:</span>
<span id="cb54-729"><a href="#cb54-729" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb54-730"><a href="#cb54-730" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> done:</span>
<span id="cb54-731"><a href="#cb54-731" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb54-732"><a href="#cb54-732" aria-hidden="true" tabindex="-1"></a>limit <span class="op">*</span> real_x <span class="op">+</span> real_y</span>
<span id="cb54-733"><a href="#cb54-733" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-734"><a href="#cb54-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-737"><a href="#cb54-737" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-738"><a href="#cb54-738" aria-hidden="true" tabindex="-1"></a>centres <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">0</span>]])</span>
<span id="cb54-739"><a href="#cb54-739" aria-hidden="true" tabindex="-1"></a>radii <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb54-740"><a href="#cb54-740" aria-hidden="true" tabindex="-1"></a>d0, d1 <span class="op">=</span> np.hstack([centres <span class="op">@</span> [[<span class="dv">1</span>, <span class="dv">1</span>], [<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>]], radii.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)])</span>
<span id="cb54-741"><a href="#cb54-741" aria-hidden="true" tabindex="-1"></a>intersect_diamonds(d0, d1)</span>
<span id="cb54-742"><a href="#cb54-742" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-743"><a href="#cb54-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-744"><a href="#cb54-744" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 16: Proboscidea Volcanium](https://adventofcode.com/2021/day/16)</span></span>
<span id="cb54-745"><a href="#cb54-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-746"><a href="#cb54-746" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-747"><a href="#cb54-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-748"><a href="#cb54-748" aria-hidden="true" tabindex="-1"></a>We should start by loading the data, and trying to visualize the graph</span>
<span id="cb54-749"><a href="#cb54-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-752"><a href="#cb54-752" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-753"><a href="#cb54-753" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval : true</span></span>
<span id="cb54-754"><a href="#cb54-754" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-cap: The network of rooms and valves, and how they link together</span></span>
<span id="cb54-755"><a href="#cb54-755" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sknetwork</span>
<span id="cb54-756"><a href="#cb54-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-757"><a href="#cb54-757" aria-hidden="true" tabindex="-1"></a>graph <span class="op">=</span> {}</span>
<span id="cb54-758"><a href="#cb54-758" aria-hidden="true" tabindex="-1"></a>pressures <span class="op">=</span> {}</span>
<span id="cb54-759"><a href="#cb54-759" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">16</span>):</span>
<span id="cb54-760"><a href="#cb54-760" aria-hidden="true" tabindex="-1"></a>    pressure <span class="op">=</span> <span class="bu">int</span>(re.findall(<span class="vs">r"\d+"</span>, line)[<span class="dv">0</span>])</span>
<span id="cb54-761"><a href="#cb54-761" aria-hidden="true" tabindex="-1"></a>    left, right <span class="op">=</span> line.split(<span class="st">";"</span>)</span>
<span id="cb54-762"><a href="#cb54-762" aria-hidden="true" tabindex="-1"></a>    node <span class="op">=</span> left.split()[<span class="dv">1</span>]</span>
<span id="cb54-763"><a href="#cb54-763" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> [</span>
<span id="cb54-764"><a href="#cb54-764" aria-hidden="true" tabindex="-1"></a>        x.strip() <span class="cf">for</span> x <span class="kw">in</span> re.sub(<span class="st">".*valves? (.*)"</span>, <span class="vs">r"\1"</span>, right[:<span class="op">-</span><span class="dv">1</span>]).split(<span class="st">","</span>)</span>
<span id="cb54-765"><a href="#cb54-765" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb54-766"><a href="#cb54-766" aria-hidden="true" tabindex="-1"></a>    graph[node] <span class="op">=</span> neighbors</span>
<span id="cb54-767"><a href="#cb54-767" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pressure <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb54-768"><a href="#cb54-768" aria-hidden="true" tabindex="-1"></a>        pressures[node] <span class="op">=</span> pressure</span>
<span id="cb54-769"><a href="#cb54-769" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sknetwork.data.from_adjacency_list(graph, weighted<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb54-770"><a href="#cb54-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-771"><a href="#cb54-771" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> SVG</span>
<span id="cb54-772"><a href="#cb54-772" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sknetwork.embedding.force_atlas <span class="im">import</span> ForceAtlas</span>
<span id="cb54-773"><a href="#cb54-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-774"><a href="#cb54-774" aria-hidden="true" tabindex="-1"></a>forceatlas2 <span class="op">=</span> ForceAtlas()</span>
<span id="cb54-775"><a href="#cb54-775" aria-hidden="true" tabindex="-1"></a>embedding <span class="op">=</span> forceatlas2.fit_transform(g.adjacency)</span>
<span id="cb54-776"><a href="#cb54-776" aria-hidden="true" tabindex="-1"></a>image <span class="op">=</span> sknetwork.visualization.svg_graph(g.adjacency, embedding, names<span class="op">=</span>g.names)</span>
<span id="cb54-777"><a href="#cb54-777" aria-hidden="true" tabindex="-1"></a>SVG(image)</span>
<span id="cb54-778"><a href="#cb54-778" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-779"><a href="#cb54-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-780"><a href="#cb54-780" aria-hidden="true" tabindex="-1"></a>Looks pretty cool!</span>
<span id="cb54-781"><a href="#cb54-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-784"><a href="#cb54-784" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-785"><a href="#cb54-785" aria-hidden="true" tabindex="-1"></a>distances <span class="op">=</span> {</span>
<span id="cb54-786"><a href="#cb54-786" aria-hidden="true" tabindex="-1"></a>    (j, i): <span class="dv">0</span> <span class="cf">if</span> i <span class="op">==</span> j <span class="cf">else</span> <span class="dv">100</span> <span class="cf">if</span> i <span class="kw">not</span> <span class="kw">in</span> graph[j] <span class="cf">else</span> <span class="dv">1</span></span>
<span id="cb54-787"><a href="#cb54-787" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> graph</span>
<span id="cb54-788"><a href="#cb54-788" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> graph</span>
<span id="cb54-789"><a href="#cb54-789" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-790"><a href="#cb54-790" aria-hidden="true" tabindex="-1"></a><span class="co"># Very slick Floyd-Warshall: The distance between two nodes i and j is the minimum over</span></span>
<span id="cb54-791"><a href="#cb54-791" aria-hidden="true" tabindex="-1"></a><span class="co"># all paths from i to j, which in turn is the minimum of the sum d(i, k) + d(j,</span></span>
<span id="cb54-792"><a href="#cb54-792" aria-hidden="true" tabindex="-1"></a><span class="co"># k) over all nodes k. Shamelessly stolen. Could have been done with some</span></span>
<span id="cb54-793"><a href="#cb54-793" aria-hidden="true" tabindex="-1"></a><span class="co"># pathfinding instead, but that would have been slower.</span></span>
<span id="cb54-794"><a href="#cb54-794" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k, i, j <span class="kw">in</span> itertools.permutations(graph, <span class="dv">3</span>):</span>
<span id="cb54-795"><a href="#cb54-795" aria-hidden="true" tabindex="-1"></a>    distances[i, j] <span class="op">=</span> <span class="bu">min</span>(distances[i, j], distances[i, k] <span class="op">+</span> distances[k, j])</span>
<span id="cb54-796"><a href="#cb54-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-797"><a href="#cb54-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-798"><a href="#cb54-798" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> expand(node, time_remaining):</span>
<span id="cb54-799"><a href="#cb54-799" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> {}</span>
<span id="cb54-800"><a href="#cb54-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-801"><a href="#cb54-801" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each possible set of open valves, we store the result of opening them</span></span>
<span id="cb54-802"><a href="#cb54-802" aria-hidden="true" tabindex="-1"></a>    <span class="co"># in the optimal order. We take care not to exceed the time alloted to us,</span></span>
<span id="cb54-803"><a href="#cb54-803" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and not to open a valve twice.</span></span>
<span id="cb54-804"><a href="#cb54-804" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> inner(node, time_remaining, used_valves, flow):</span>
<span id="cb54-805"><a href="#cb54-805" aria-hidden="true" tabindex="-1"></a>        result[used_valves] <span class="op">=</span> <span class="bu">max</span>(result.get(used_valves, <span class="dv">0</span>), flow)</span>
<span id="cb54-806"><a href="#cb54-806" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> other_node, pressure <span class="kw">in</span> pressures.items():</span>
<span id="cb54-807"><a href="#cb54-807" aria-hidden="true" tabindex="-1"></a>            new_time_remaining <span class="op">=</span> time_remaining <span class="op">-</span> distances[node, other_node] <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb54-808"><a href="#cb54-808" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> new_time_remaining <span class="op">&lt;=</span> <span class="dv">0</span> <span class="kw">or</span> other_node <span class="kw">in</span> used_valves:</span>
<span id="cb54-809"><a href="#cb54-809" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb54-810"><a href="#cb54-810" aria-hidden="true" tabindex="-1"></a>            inner(</span>
<span id="cb54-811"><a href="#cb54-811" aria-hidden="true" tabindex="-1"></a>                other_node,</span>
<span id="cb54-812"><a href="#cb54-812" aria-hidden="true" tabindex="-1"></a>                new_time_remaining,</span>
<span id="cb54-813"><a href="#cb54-813" aria-hidden="true" tabindex="-1"></a>                used_valves <span class="op">|</span> <span class="bu">frozenset</span>([other_node]),</span>
<span id="cb54-814"><a href="#cb54-814" aria-hidden="true" tabindex="-1"></a>                flow <span class="op">+</span> new_time_remaining <span class="op">*</span> pressure,</span>
<span id="cb54-815"><a href="#cb54-815" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb54-816"><a href="#cb54-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-817"><a href="#cb54-817" aria-hidden="true" tabindex="-1"></a>    inner(node, time_remaining, <span class="bu">frozenset</span>(), <span class="dv">0</span>)</span>
<span id="cb54-818"><a href="#cb54-818" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb54-819"><a href="#cb54-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-820"><a href="#cb54-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-821"><a href="#cb54-821" aria-hidden="true" tabindex="-1"></a><span class="co"># The result for part 1 is then</span></span>
<span id="cb54-822"><a href="#cb54-822" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>(expand(<span class="st">"AA"</span>, <span class="dv">30</span>).values())</span>
<span id="cb54-823"><a href="#cb54-823" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-824"><a href="#cb54-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-825"><a href="#cb54-825" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-826"><a href="#cb54-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-827"><a href="#cb54-827" aria-hidden="true" tabindex="-1"></a>For part 2, we don't need to consider the two agents together. We can just find the best pair of valve sets with no overlaps.</span>
<span id="cb54-828"><a href="#cb54-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-831"><a href="#cb54-831" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-832"><a href="#cb54-832" aria-hidden="true" tabindex="-1"></a>part2_paths <span class="op">=</span> expand(<span class="st">"AA"</span>, <span class="dv">26</span>)</span>
<span id="cb54-833"><a href="#cb54-833" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>(</span>
<span id="cb54-834"><a href="#cb54-834" aria-hidden="true" tabindex="-1"></a>    v1 <span class="op">+</span> v2</span>
<span id="cb54-835"><a href="#cb54-835" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> s1, v1 <span class="kw">in</span> part2_paths.items()</span>
<span id="cb54-836"><a href="#cb54-836" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> s2, v2 <span class="kw">in</span> part2_paths.items()</span>
<span id="cb54-837"><a href="#cb54-837" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> (s1 <span class="op">&amp;</span> s2)</span>
<span id="cb54-838"><a href="#cb54-838" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-839"><a href="#cb54-839" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-840"><a href="#cb54-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-841"><a href="#cb54-841" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 17: Pyroclastic Flow](https://adventofcode.com/2022/day/17)</span></span>
<span id="cb54-842"><a href="#cb54-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-843"><a href="#cb54-843" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-844"><a href="#cb54-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-847"><a href="#cb54-847" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-848"><a href="#cb54-848" aria-hidden="true" tabindex="-1"></a>shapes <span class="op">=</span> [</span>
<span id="cb54-849"><a href="#cb54-849" aria-hidden="true" tabindex="-1"></a>    np.array(</span>
<span id="cb54-850"><a href="#cb54-850" aria-hidden="true" tabindex="-1"></a>        [[<span class="dv">0</span> <span class="cf">if</span> char <span class="op">==</span> <span class="st">"."</span> <span class="cf">else</span> <span class="dv">1</span> <span class="cf">for</span> char <span class="kw">in</span> line] <span class="cf">for</span> line <span class="kw">in</span> x.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)],</span>
<span id="cb54-851"><a href="#cb54-851" aria-hidden="true" tabindex="-1"></a>        dtype<span class="op">=</span><span class="bu">bool</span>,</span>
<span id="cb54-852"><a href="#cb54-852" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-853"><a href="#cb54-853" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> [<span class="st">"####"</span>, <span class="st">".#.</span><span class="ch">\n</span><span class="st">###</span><span class="ch">\n</span><span class="st">.#."</span>, <span class="st">"..#</span><span class="ch">\n</span><span class="st">..#</span><span class="ch">\n</span><span class="st">###"</span>, <span class="st">"#</span><span class="ch">\n</span><span class="st">#</span><span class="ch">\n</span><span class="st">#</span><span class="ch">\n</span><span class="st">#"</span>, <span class="st">"##</span><span class="ch">\n</span><span class="st">##"</span>]</span>
<span id="cb54-854"><a href="#cb54-854" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb54-855"><a href="#cb54-855" aria-hidden="true" tabindex="-1"></a>directions <span class="op">=</span> load(<span class="dv">17</span>, <span class="st">"raw"</span>).strip()</span>
<span id="cb54-856"><a href="#cb54-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-857"><a href="#cb54-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-858"><a href="#cb54-858" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> has_collision(x, y, shape, board):</span>
<span id="cb54-859"><a href="#cb54-859" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> y <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb54-860"><a href="#cb54-860" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb54-861"><a href="#cb54-861" aria-hidden="true" tabindex="-1"></a>    height, width <span class="op">=</span> shape.shape</span>
<span id="cb54-862"><a href="#cb54-862" aria-hidden="true" tabindex="-1"></a>    window <span class="op">=</span> np.pad(</span>
<span id="cb54-863"><a href="#cb54-863" aria-hidden="true" tabindex="-1"></a>        shape[<span class="bu">max</span>(<span class="dv">0</span>, height <span class="op">-</span> y <span class="op">-</span> <span class="dv">1</span>) :],</span>
<span id="cb54-864"><a href="#cb54-864" aria-hidden="true" tabindex="-1"></a>        [[<span class="dv">0</span>, <span class="dv">0</span>], [x, <span class="dv">7</span> <span class="op">-</span> x <span class="op">-</span> width]],</span>
<span id="cb54-865"><a href="#cb54-865" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"constant"</span>,</span>
<span id="cb54-866"><a href="#cb54-866" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-867"><a href="#cb54-867" aria-hidden="true" tabindex="-1"></a>    top_of_window <span class="op">=</span> y <span class="op">-</span> window.shape[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb54-868"><a href="#cb54-868" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (board[top_of_window : top_of_window <span class="op">+</span> window.shape[<span class="dv">0</span>]] <span class="op">&amp;</span> window).<span class="bu">any</span>()</span>
<span id="cb54-869"><a href="#cb54-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-870"><a href="#cb54-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-871"><a href="#cb54-871" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_height(directions, n<span class="op">=</span><span class="dv">2022</span>):</span>
<span id="cb54-872"><a href="#cb54-872" aria-hidden="true" tabindex="-1"></a>    board <span class="op">=</span> np.ones((<span class="dv">1</span>, <span class="dv">7</span>), dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb54-873"><a href="#cb54-873" aria-hidden="true" tabindex="-1"></a>    discard <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb54-874"><a href="#cb54-874" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-875"><a href="#cb54-875" aria-hidden="true" tabindex="-1"></a>    seen <span class="op">=</span> {}</span>
<span id="cb54-876"><a href="#cb54-876" aria-hidden="true" tabindex="-1"></a>    cycle_length <span class="op">=</span> <span class="va">None</span></span>
<span id="cb54-877"><a href="#cb54-877" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb54-878"><a href="#cb54-878" aria-hidden="true" tabindex="-1"></a>        shape <span class="op">=</span> shapes[i <span class="op">%</span> <span class="bu">len</span>(shapes)]</span>
<span id="cb54-879"><a href="#cb54-879" aria-hidden="true" tabindex="-1"></a>        height, width <span class="op">=</span> shape.shape</span>
<span id="cb54-880"><a href="#cb54-880" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> <span class="dv">2</span>, <span class="op">-</span><span class="dv">4</span></span>
<span id="cb54-881"><a href="#cb54-881" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb54-882"><a href="#cb54-882" aria-hidden="true" tabindex="-1"></a>            direction <span class="op">=</span> directions[d]</span>
<span id="cb54-883"><a href="#cb54-883" aria-hidden="true" tabindex="-1"></a>            d <span class="op">=</span> (d <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="bu">len</span>(directions)</span>
<span id="cb54-884"><a href="#cb54-884" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> direction <span class="op">==</span> <span class="st">"&gt;"</span>:</span>
<span id="cb54-885"><a href="#cb54-885" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> x <span class="op">+</span> width <span class="op">!=</span> <span class="dv">7</span> <span class="kw">and</span> <span class="kw">not</span> has_collision(x <span class="op">+</span> <span class="dv">1</span>, y, shape, board):</span>
<span id="cb54-886"><a href="#cb54-886" aria-hidden="true" tabindex="-1"></a>                    x <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-887"><a href="#cb54-887" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb54-888"><a href="#cb54-888" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> x <span class="op">!=</span> <span class="dv">0</span> <span class="kw">and</span> <span class="kw">not</span> has_collision(x <span class="op">-</span> <span class="dv">1</span>, y, shape, board):</span>
<span id="cb54-889"><a href="#cb54-889" aria-hidden="true" tabindex="-1"></a>                    x <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb54-890"><a href="#cb54-890" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> y <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span>:</span>
<span id="cb54-891"><a href="#cb54-891" aria-hidden="true" tabindex="-1"></a>                y <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-892"><a href="#cb54-892" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb54-893"><a href="#cb54-893" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> has_collision(x, y <span class="op">+</span> <span class="dv">1</span>, shape, board):</span>
<span id="cb54-894"><a href="#cb54-894" aria-hidden="true" tabindex="-1"></a>                    old_board <span class="op">=</span> board.copy()</span>
<span id="cb54-895"><a href="#cb54-895" aria-hidden="true" tabindex="-1"></a>                    board <span class="op">=</span> np.pad(</span>
<span id="cb54-896"><a href="#cb54-896" aria-hidden="true" tabindex="-1"></a>                        board, [[<span class="bu">max</span>(height <span class="op">-</span> y <span class="op">-</span> <span class="dv">1</span>, <span class="dv">0</span>), <span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">0</span>]], mode<span class="op">=</span><span class="st">"constant"</span></span>
<span id="cb54-897"><a href="#cb54-897" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb54-898"><a href="#cb54-898" aria-hidden="true" tabindex="-1"></a>                    loc <span class="op">=</span> <span class="bu">max</span>(y <span class="op">-</span> height <span class="op">+</span> <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb54-899"><a href="#cb54-899" aria-hidden="true" tabindex="-1"></a>                    board[loc : loc <span class="op">+</span> height, x : x <span class="op">+</span> width] <span class="op">+=</span> shape</span>
<span id="cb54-900"><a href="#cb54-900" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb54-901"><a href="#cb54-901" aria-hidden="true" tabindex="-1"></a>                y <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-902"><a href="#cb54-902" aria-hidden="true" tabindex="-1"></a>        row <span class="op">=</span> board.<span class="bu">all</span>(axis<span class="op">=</span><span class="dv">1</span>).argmax()</span>
<span id="cb54-903"><a href="#cb54-903" aria-hidden="true" tabindex="-1"></a>        discard <span class="op">+=</span> board.shape[<span class="dv">0</span>] <span class="op">-</span> row <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb54-904"><a href="#cb54-904" aria-hidden="true" tabindex="-1"></a>        board <span class="op">=</span> board[: row <span class="op">+</span> <span class="dv">1</span>]</span>
<span id="cb54-905"><a href="#cb54-905" aria-hidden="true" tabindex="-1"></a>        state <span class="op">=</span> (i <span class="op">%</span> <span class="bu">len</span>(shapes), d, <span class="bu">tuple</span>(np.ravel(board)))</span>
<span id="cb54-906"><a href="#cb54-906" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> state <span class="kw">in</span> seen:</span>
<span id="cb54-907"><a href="#cb54-907" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> cycle_length <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb54-908"><a href="#cb54-908" aria-hidden="true" tabindex="-1"></a>                cycle_length <span class="op">=</span> i <span class="op">-</span> seen[state][<span class="dv">0</span>]</span>
<span id="cb54-909"><a href="#cb54-909" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (i <span class="op">%</span> cycle_length) <span class="op">==</span> (n <span class="op">%</span> cycle_length):</span>
<span id="cb54-910"><a href="#cb54-910" aria-hidden="true" tabindex="-1"></a>                delta_h <span class="op">=</span> board.shape[<span class="dv">0</span>] <span class="op">+</span> discard <span class="op">-</span> seen[state][<span class="dv">1</span>]</span>
<span id="cb54-911"><a href="#cb54-911" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> board.shape[<span class="dv">0</span>] <span class="op">+</span> discard <span class="op">+</span> delta_h <span class="op">*</span> ((n <span class="op">-</span> i) <span class="op">//</span> cycle_length)</span>
<span id="cb54-912"><a href="#cb54-912" aria-hidden="true" tabindex="-1"></a>        seen[state] <span class="op">=</span> i, board.shape[<span class="dv">0</span>] <span class="op">+</span> discard</span>
<span id="cb54-913"><a href="#cb54-913" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> seen[state][<span class="dv">1</span>]</span>
<span id="cb54-914"><a href="#cb54-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-915"><a href="#cb54-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-916"><a href="#cb54-916" aria-hidden="true" tabindex="-1"></a>find_height(directions)</span>
<span id="cb54-917"><a href="#cb54-917" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-918"><a href="#cb54-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-919"><a href="#cb54-919" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-920"><a href="#cb54-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-921"><a href="#cb54-921" aria-hidden="true" tabindex="-1"></a>Actually simulating that many steps isn't possible, so we should probably look for a loop of some kind. To avoid having to think too much, we'll say that after any given rock has fallen the state is (shape~index~, wind~index~, hash of board above latest full line). If a state ever repeats, we know it will go on repeating forever, so we can just advance until we're at the same point in the cycle as the very end, and then add on however many cycles we need</span>
<span id="cb54-922"><a href="#cb54-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-925"><a href="#cb54-925" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-926"><a href="#cb54-926" aria-hidden="true" tabindex="-1"></a>find_height(directions, <span class="dv">1_000_000_000_000</span>) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb54-927"><a href="#cb54-927" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-928"><a href="#cb54-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-929"><a href="#cb54-929" aria-hidden="true" tabindex="-1"></a>There's a weird off by one error in my code which is only present for some cases. I can't be bothered to find out why.</span>
<span id="cb54-930"><a href="#cb54-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-931"><a href="#cb54-931" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 18: Boiling Boulders](https://adventofcode.com/2022/day/18)</span></span>
<span id="cb54-932"><a href="#cb54-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-933"><a href="#cb54-933" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-934"><a href="#cb54-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-935"><a href="#cb54-935" aria-hidden="true" tabindex="-1"></a>Idea: find all neighboring boxes by finding the union of the shifts along each of i,j,k,-i,-j,-k and subtracting the original shape. A given box might neighbor the original shape in up to six places, so to account for that I can take all the neighbors, shift them again along each of the axes, and for each shift, count how many boxes now overlap the original shape.</span>
<span id="cb54-936"><a href="#cb54-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-939"><a href="#cb54-939" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-940"><a href="#cb54-940" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">18</span>, <span class="st">"np"</span>)</span>
<span id="cb54-941"><a href="#cb54-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-942"><a href="#cb54-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-943"><a href="#cb54-943" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> to_set(arr):</span>
<span id="cb54-944"><a href="#cb54-944" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">set</span>(<span class="bu">tuple</span>(x) <span class="cf">for</span> x <span class="kw">in</span> arr)</span>
<span id="cb54-945"><a href="#cb54-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-946"><a href="#cb54-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-947"><a href="#cb54-947" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> inflate(data):</span>
<span id="cb54-948"><a href="#cb54-948" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(data, <span class="bu">set</span>):</span>
<span id="cb54-949"><a href="#cb54-949" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> np.array(<span class="bu">list</span>(data))</span>
<span id="cb54-950"><a href="#cb54-950" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> to_set(np.vstack([row <span class="op">+</span> data <span class="cf">for</span> row <span class="kw">in</span> deltas])) <span class="op">-</span> occupied</span>
<span id="cb54-951"><a href="#cb54-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-952"><a href="#cb54-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-953"><a href="#cb54-953" aria-hidden="true" tabindex="-1"></a>occupied <span class="op">=</span> to_set(data)</span>
<span id="cb54-954"><a href="#cb54-954" aria-hidden="true" tabindex="-1"></a>deltas <span class="op">=</span> (np.tile(np.eye(<span class="dv">3</span>, dtype<span class="op">=</span><span class="bu">int</span>), <span class="dv">2</span>) <span class="op">*</span> np.repeat((<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>), <span class="dv">3</span>)).T</span>
<span id="cb54-955"><a href="#cb54-955" aria-hidden="true" tabindex="-1"></a>nb <span class="op">=</span> inflate(data)</span>
<span id="cb54-956"><a href="#cb54-956" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> np.array(<span class="bu">list</span>(nb))</span>
<span id="cb54-957"><a href="#cb54-957" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>([<span class="bu">len</span>(to_set(arr <span class="op">+</span> delta) <span class="op">&amp;</span> occupied) <span class="cf">for</span> delta <span class="kw">in</span> deltas])</span>
<span id="cb54-958"><a href="#cb54-958" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-959"><a href="#cb54-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-960"><a href="#cb54-960" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-961"><a href="#cb54-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-962"><a href="#cb54-962" aria-hidden="true" tabindex="-1"></a>For part 2, once we have identified which of the neighboring boxes represent external neighbors (i.e. are connected to the outside world), we can do exactly the same thing. The tricky thing is then to make this identification. Under the assumption that the droplet is connected, so that every box in the droplet is reachable from every other via a series of face, edge or corner moves, then every point the outside boundary is face-connected to every other after at most two inflations. I can then use a union find data structure to merge all the connected groups together, and the outside group is then the largest of all of these</span>
<span id="cb54-963"><a href="#cb54-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-966"><a href="#cb54-966" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-967"><a href="#cb54-967" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.cluster.hierarchy <span class="im">import</span> DisjointSet</span>
<span id="cb54-968"><a href="#cb54-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-969"><a href="#cb54-969" aria-hidden="true" tabindex="-1"></a>points <span class="op">=</span> inflate(data)</span>
<span id="cb54-970"><a href="#cb54-970" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb54-971"><a href="#cb54-971" aria-hidden="true" tabindex="-1"></a>    points <span class="op">=</span> inflate(points)</span>
<span id="cb54-972"><a href="#cb54-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-973"><a href="#cb54-973" aria-hidden="true" tabindex="-1"></a>disjoint_set <span class="op">=</span> DisjointSet(points)</span>
<span id="cb54-974"><a href="#cb54-974" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> points:</span>
<span id="cb54-975"><a href="#cb54-975" aria-hidden="true" tabindex="-1"></a>    comparisons <span class="op">=</span> x <span class="op">+</span> np.eye(<span class="dv">3</span>, dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb54-976"><a href="#cb54-976" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> comparison <span class="kw">in</span> comparisons:</span>
<span id="cb54-977"><a href="#cb54-977" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (y <span class="op">:=</span> <span class="bu">tuple</span>(comparison)) <span class="kw">in</span> disjoint_set:</span>
<span id="cb54-978"><a href="#cb54-978" aria-hidden="true" tabindex="-1"></a>            disjoint_set.merge(x, y)</span>
<span id="cb54-979"><a href="#cb54-979" aria-hidden="true" tabindex="-1"></a>max_s <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-980"><a href="#cb54-980" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subset <span class="kw">in</span> disjoint_set.subsets():</span>
<span id="cb54-981"><a href="#cb54-981" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(subset) <span class="op">&gt;</span> max_s:</span>
<span id="cb54-982"><a href="#cb54-982" aria-hidden="true" tabindex="-1"></a>        max_s <span class="op">=</span> <span class="bu">len</span>(subset)</span>
<span id="cb54-983"><a href="#cb54-983" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> subset</span>
<span id="cb54-984"><a href="#cb54-984" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> np.array(<span class="bu">list</span>(s <span class="op">&amp;</span> nb))</span>
<span id="cb54-985"><a href="#cb54-985" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>([<span class="bu">len</span>(to_set(arr <span class="op">+</span> delta) <span class="op">&amp;</span> occupied) <span class="cf">for</span> delta <span class="kw">in</span> deltas])</span>
<span id="cb54-986"><a href="#cb54-986" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-987"><a href="#cb54-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-988"><a href="#cb54-988" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 19: Not Enough Minerals](https://adventofcode.com/2022/day/19)</span></span>
<span id="cb54-989"><a href="#cb54-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-990"><a href="#cb54-990" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-991"><a href="#cb54-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-992"><a href="#cb54-992" aria-hidden="true" tabindex="-1"></a>The core of this problem is to develop an approach that can take a list of prices and generate an optimal build. Blindly taking every action probably won't work, but is maybe worth examining as a first attempt.</span>
<span id="cb54-993"><a href="#cb54-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-994"><a href="#cb54-994" aria-hidden="true" tabindex="-1"></a>Instead of simulating each of the 24 different time steps, we should focus on the build order, so the decision at any given point in time is which robot to build next. We should bail from any given branch if:</span>
<span id="cb54-995"><a href="#cb54-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-996"><a href="#cb54-996" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The time has exceeded the maximum time available</span>
<span id="cb54-997"><a href="#cb54-997" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We have built more robots of a given kind than are needed by any of the recipes</span>
<span id="cb54-998"><a href="#cb54-998" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We've already seen a better situation: Suppose we've previously found a state with a given config of robots at t1, and now have built the same robots at a later time t2. If we could have the same or more resources at t2 by using the t1 config and just waiting, then the first build order is strictly better.</span>
<span id="cb54-999"><a href="#cb54-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1002"><a href="#cb54-1002" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1003"><a href="#cb54-1003" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> score(geodes, time, t_max<span class="op">=</span><span class="dv">24</span>):</span>
<span id="cb54-1004"><a href="#cb54-1004" aria-hidden="true" tabindex="-1"></a>    time_remaining <span class="op">=</span> t_max <span class="op">-</span> time <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb54-1005"><a href="#cb54-1005" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>(geodes <span class="op">+</span> time_remaining <span class="op">*</span> (time_remaining <span class="op">+</span> <span class="dv">1</span>) <span class="op">//</span> <span class="dv">2</span>)</span>
<span id="cb54-1006"><a href="#cb54-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1007"><a href="#cb54-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1008"><a href="#cb54-1008" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_better(t1, r1, g1, i, t2, r2, g2):</span>
<span id="cb54-1009"><a href="#cb54-1009" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span>  <span class="co"># (t2 &gt;= t1) and (g1 &gt;= g2) and ((r1 + (t2 - t1) * i) &gt;= r2).all()</span></span>
<span id="cb54-1010"><a href="#cb54-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1011"><a href="#cb54-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1012"><a href="#cb54-1012" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate(costs, t_max<span class="op">=</span><span class="dv">24</span>):</span>
<span id="cb54-1013"><a href="#cb54-1013" aria-hidden="true" tabindex="-1"></a>    seen <span class="op">=</span> defaultdict(<span class="bu">dict</span>)</span>
<span id="cb54-1014"><a href="#cb54-1014" aria-hidden="true" tabindex="-1"></a>    max_prices <span class="op">=</span> costs.<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb54-1015"><a href="#cb54-1015" aria-hidden="true" tabindex="-1"></a>    income <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb54-1016"><a href="#cb54-1016" aria-hidden="true" tabindex="-1"></a>    resources <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb54-1017"><a href="#cb54-1017" aria-hidden="true" tabindex="-1"></a>    time <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-1018"><a href="#cb54-1018" aria-hidden="true" tabindex="-1"></a>    geodes <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-1019"><a href="#cb54-1019" aria-hidden="true" tabindex="-1"></a>    initial_state <span class="op">=</span> (</span>
<span id="cb54-1020"><a href="#cb54-1020" aria-hidden="true" tabindex="-1"></a>        score(geodes, time, t_max),</span>
<span id="cb54-1021"><a href="#cb54-1021" aria-hidden="true" tabindex="-1"></a>        time,</span>
<span id="cb54-1022"><a href="#cb54-1022" aria-hidden="true" tabindex="-1"></a>        geodes,</span>
<span id="cb54-1023"><a href="#cb54-1023" aria-hidden="true" tabindex="-1"></a>        <span class="bu">tuple</span>(income),</span>
<span id="cb54-1024"><a href="#cb54-1024" aria-hidden="true" tabindex="-1"></a>        <span class="bu">tuple</span>(resources),</span>
<span id="cb54-1025"><a href="#cb54-1025" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-1026"><a href="#cb54-1026" aria-hidden="true" tabindex="-1"></a>    q <span class="op">=</span> PriorityQueue()</span>
<span id="cb54-1027"><a href="#cb54-1027" aria-hidden="true" tabindex="-1"></a>    q.put(initial_state)</span>
<span id="cb54-1028"><a href="#cb54-1028" aria-hidden="true" tabindex="-1"></a>    max_geodes <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-1029"><a href="#cb54-1029" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> q.qsize() <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb54-1030"><a href="#cb54-1030" aria-hidden="true" tabindex="-1"></a>        _, time, geodes, income, resources <span class="op">=</span> q.get()</span>
<span id="cb54-1031"><a href="#cb54-1031" aria-hidden="true" tabindex="-1"></a>        income, resources <span class="op">=</span> np.array(income), np.array(resources)</span>
<span id="cb54-1032"><a href="#cb54-1032" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> time <span class="op">==</span> t_max:</span>
<span id="cb54-1033"><a href="#cb54-1033" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb54-1034"><a href="#cb54-1034" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> t1, (r1, g1) <span class="kw">in</span> seen[<span class="bu">tuple</span>(income)].items():</span>
<span id="cb54-1035"><a href="#cb54-1035" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> is_better(t1, r1, g1, income, time, resources, geodes):</span>
<span id="cb54-1036"><a href="#cb54-1036" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb54-1037"><a href="#cb54-1037" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb54-1038"><a href="#cb54-1038" aria-hidden="true" tabindex="-1"></a>            seen[<span class="bu">tuple</span>(income)][time] <span class="op">=</span> (resources, geodes)</span>
<span id="cb54-1039"><a href="#cb54-1039" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> np.errstate(divide<span class="op">=</span><span class="st">"ignore"</span>, invalid<span class="op">=</span><span class="st">"ignore"</span>):</span>
<span id="cb54-1040"><a href="#cb54-1040" aria-hidden="true" tabindex="-1"></a>                waits <span class="op">=</span> (costs <span class="op">-</span> resources) <span class="op">/</span> income</span>
<span id="cb54-1041"><a href="#cb54-1041" aria-hidden="true" tabindex="-1"></a>            waits[np.isnan(waits)] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-1042"><a href="#cb54-1042" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx, wait <span class="kw">in</span> <span class="bu">enumerate</span>(np.ceil(waits.<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">1</span>))):</span>
<span id="cb54-1043"><a href="#cb54-1043" aria-hidden="true" tabindex="-1"></a>                wait <span class="op">=</span> <span class="bu">max</span>(wait, <span class="dv">0</span>)</span>
<span id="cb54-1044"><a href="#cb54-1044" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> time <span class="op">+</span> wait <span class="op">+</span> <span class="dv">1</span> <span class="op">&gt;</span> t_max:</span>
<span id="cb54-1045"><a href="#cb54-1045" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb54-1046"><a href="#cb54-1046" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Turns to wait for resources, plus one to build</span></span>
<span id="cb54-1047"><a href="#cb54-1047" aria-hidden="true" tabindex="-1"></a>                dt <span class="op">=</span> <span class="bu">int</span>(wait) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb54-1048"><a href="#cb54-1048" aria-hidden="true" tabindex="-1"></a>                new_time <span class="op">=</span> time <span class="op">+</span> dt</span>
<span id="cb54-1049"><a href="#cb54-1049" aria-hidden="true" tabindex="-1"></a>                new_income <span class="op">=</span> income.copy()</span>
<span id="cb54-1050"><a href="#cb54-1050" aria-hidden="true" tabindex="-1"></a>                new_geodes <span class="op">=</span> geodes</span>
<span id="cb54-1051"><a href="#cb54-1051" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">!=</span> <span class="dv">3</span>:</span>
<span id="cb54-1052"><a href="#cb54-1052" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> income[idx] <span class="op">&gt;=</span> max_prices[idx]:</span>
<span id="cb54-1053"><a href="#cb54-1053" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">continue</span></span>
<span id="cb54-1054"><a href="#cb54-1054" aria-hidden="true" tabindex="-1"></a>                    new_income[idx] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-1055"><a href="#cb54-1055" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb54-1056"><a href="#cb54-1056" aria-hidden="true" tabindex="-1"></a>                    new_geodes <span class="op">+=</span> t_max <span class="op">-</span> new_time</span>
<span id="cb54-1057"><a href="#cb54-1057" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> new_geodes <span class="op">&gt;</span> max_geodes:</span>
<span id="cb54-1058"><a href="#cb54-1058" aria-hidden="true" tabindex="-1"></a>                        max_geodes <span class="op">=</span> new_geodes</span>
<span id="cb54-1059"><a href="#cb54-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1060"><a href="#cb54-1060" aria-hidden="true" tabindex="-1"></a>                new_resources <span class="op">=</span> resources.copy() <span class="op">+</span> income <span class="op">*</span> dt <span class="op">-</span> costs[idx]</span>
<span id="cb54-1061"><a href="#cb54-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1062"><a href="#cb54-1062" aria-hidden="true" tabindex="-1"></a>                q.put(</span>
<span id="cb54-1063"><a href="#cb54-1063" aria-hidden="true" tabindex="-1"></a>                    (</span>
<span id="cb54-1064"><a href="#cb54-1064" aria-hidden="true" tabindex="-1"></a>                        score(new_geodes, new_time, t_max),</span>
<span id="cb54-1065"><a href="#cb54-1065" aria-hidden="true" tabindex="-1"></a>                        new_time,</span>
<span id="cb54-1066"><a href="#cb54-1066" aria-hidden="true" tabindex="-1"></a>                        new_geodes,</span>
<span id="cb54-1067"><a href="#cb54-1067" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">tuple</span>(new_income),</span>
<span id="cb54-1068"><a href="#cb54-1068" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">tuple</span>(new_resources),</span>
<span id="cb54-1069"><a href="#cb54-1069" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb54-1070"><a href="#cb54-1070" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb54-1071"><a href="#cb54-1071" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> max_geodes</span>
<span id="cb54-1072"><a href="#cb54-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1073"><a href="#cb54-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1074"><a href="#cb54-1074" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-1075"><a href="#cb54-1075" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> blueprint_id, <span class="op">*</span>l <span class="kw">in</span> load(<span class="dv">19</span>, <span class="st">"int"</span>):</span>
<span id="cb54-1076"><a href="#cb54-1076" aria-hidden="true" tabindex="-1"></a>    costs <span class="op">=</span> np.array([[l[<span class="dv">0</span>], <span class="dv">0</span>, <span class="dv">0</span>], [l[<span class="dv">1</span>], <span class="dv">0</span>, <span class="dv">0</span>], [l[<span class="dv">2</span>], l[<span class="dv">3</span>], <span class="dv">0</span>], [l[<span class="dv">4</span>], <span class="dv">0</span>, l[<span class="dv">5</span>]]])</span>
<span id="cb54-1077"><a href="#cb54-1077" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> blueprint_id <span class="op">*</span> evaluate(costs)</span>
<span id="cb54-1078"><a href="#cb54-1078" aria-hidden="true" tabindex="-1"></a>total</span>
<span id="cb54-1079"><a href="#cb54-1079" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1080"><a href="#cb54-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1081"><a href="#cb54-1081" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-1082"><a href="#cb54-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1085"><a href="#cb54-1085" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1086"><a href="#cb54-1086" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb54-1087"><a href="#cb54-1087" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, <span class="op">*</span>l <span class="kw">in</span> load(<span class="dv">19</span>, <span class="st">"int"</span>)[:<span class="dv">3</span>]:</span>
<span id="cb54-1088"><a href="#cb54-1088" aria-hidden="true" tabindex="-1"></a>    costs <span class="op">=</span> np.array([[l[<span class="dv">0</span>], <span class="dv">0</span>, <span class="dv">0</span>], [l[<span class="dv">1</span>], <span class="dv">0</span>, <span class="dv">0</span>], [l[<span class="dv">2</span>], l[<span class="dv">3</span>], <span class="dv">0</span>], [l[<span class="dv">4</span>], <span class="dv">0</span>, l[<span class="dv">5</span>]]])</span>
<span id="cb54-1089"><a href="#cb54-1089" aria-hidden="true" tabindex="-1"></a>    total <span class="op">*=</span> evaluate(costs, <span class="dv">32</span>)</span>
<span id="cb54-1090"><a href="#cb54-1090" aria-hidden="true" tabindex="-1"></a>total</span>
<span id="cb54-1091"><a href="#cb54-1091" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1092"><a href="#cb54-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1093"><a href="#cb54-1093" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 20: Grove Positioning System](https://adventofcode.com/2022/day/21)</span></span>
<span id="cb54-1094"><a href="#cb54-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1095"><a href="#cb54-1095" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-1096"><a href="#cb54-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1097"><a href="#cb54-1097" aria-hidden="true" tabindex="-1"></a>I was almost caught out by the fact that there can be duplicate entries in the data; my original linked list in a dictionary didn't account for this, so nodes were silently dropped. Oops.</span>
<span id="cb54-1098"><a href="#cb54-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1099"><a href="#cb54-1099" aria-hidden="true" tabindex="-1"></a>Otherwise the simple approach ended up working: make a list of node -<span class="sc">\&gt;</span> (predecessor, successor), and to move a given element simply follow the pointers the relevant number of times.</span>
<span id="cb54-1100"><a href="#cb54-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1101"><a href="#cb54-1101" aria-hidden="true" tabindex="-1"></a>To save time, I map each rotation to the range <span class="sc">\[</span>-l/2, l/2<span class="sc">\]</span> where l is the length of the linked list. The idea is that for a circular list of length l, moving l-1 steps to the right is the same as not moving, and since the list is doubly linked, moving one step to the left is better than moving l-2 steps to the right.</span>
<span id="cb54-1102"><a href="#cb54-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1105"><a href="#cb54-1105" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1106"><a href="#cb54-1106" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mix(data, n<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb54-1107"><a href="#cb54-1107" aria-hidden="true" tabindex="-1"></a>    unique_data <span class="op">=</span> <span class="bu">list</span>(<span class="bu">enumerate</span>(data))</span>
<span id="cb54-1108"><a href="#cb54-1108" aria-hidden="true" tabindex="-1"></a>    ll <span class="op">=</span> {</span>
<span id="cb54-1109"><a href="#cb54-1109" aria-hidden="true" tabindex="-1"></a>        k: [p, n]</span>
<span id="cb54-1110"><a href="#cb54-1110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (k, p, n) <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb54-1111"><a href="#cb54-1111" aria-hidden="true" tabindex="-1"></a>            unique_data,</span>
<span id="cb54-1112"><a href="#cb54-1112" aria-hidden="true" tabindex="-1"></a>            [unique_data[<span class="op">-</span><span class="dv">1</span>]] <span class="op">+</span> unique_data[:<span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb54-1113"><a href="#cb54-1113" aria-hidden="true" tabindex="-1"></a>            unique_data[<span class="dv">1</span>:] <span class="op">+</span> [unique_data[<span class="dv">0</span>]],</span>
<span id="cb54-1114"><a href="#cb54-1114" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb54-1115"><a href="#cb54-1115" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb54-1116"><a href="#cb54-1116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb54-1117"><a href="#cb54-1117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> value <span class="kw">in</span> <span class="bu">enumerate</span>(data):</span>
<span id="cb54-1118"><a href="#cb54-1118" aria-hidden="true" tabindex="-1"></a>            mod <span class="op">=</span> <span class="bu">len</span>(data) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb54-1119"><a href="#cb54-1119" aria-hidden="true" tabindex="-1"></a>            offset <span class="op">=</span> mod <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb54-1120"><a href="#cb54-1120" aria-hidden="true" tabindex="-1"></a>            shift <span class="op">=</span> (value[<span class="dv">1</span>] <span class="op">+</span> offset) <span class="op">%</span> mod <span class="op">-</span> offset</span>
<span id="cb54-1121"><a href="#cb54-1121" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> shift <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb54-1122"><a href="#cb54-1122" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb54-1123"><a href="#cb54-1123" aria-hidden="true" tabindex="-1"></a>            current <span class="op">=</span> ll[value]</span>
<span id="cb54-1124"><a href="#cb54-1124" aria-hidden="true" tabindex="-1"></a>            ll[current[<span class="dv">0</span>]][<span class="dv">1</span>] <span class="op">=</span> current[<span class="dv">1</span>]</span>
<span id="cb54-1125"><a href="#cb54-1125" aria-hidden="true" tabindex="-1"></a>            ll[current[<span class="dv">1</span>]][<span class="dv">0</span>] <span class="op">=</span> current[<span class="dv">0</span>]</span>
<span id="cb54-1126"><a href="#cb54-1126" aria-hidden="true" tabindex="-1"></a>            <span class="kw">del</span> ll[value]</span>
<span id="cb54-1127"><a href="#cb54-1127" aria-hidden="true" tabindex="-1"></a>            coord <span class="op">=</span> <span class="dv">1</span> <span class="cf">if</span> shift <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb54-1128"><a href="#cb54-1128" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">abs</span>(shift)):</span>
<span id="cb54-1129"><a href="#cb54-1129" aria-hidden="true" tabindex="-1"></a>                current <span class="op">=</span> ll[current[coord]]</span>
<span id="cb54-1130"><a href="#cb54-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1131"><a href="#cb54-1131" aria-hidden="true" tabindex="-1"></a>            succ <span class="op">=</span> current[coord]</span>
<span id="cb54-1132"><a href="#cb54-1132" aria-hidden="true" tabindex="-1"></a>            pred <span class="op">=</span> ll[succ][<span class="dv">1</span> <span class="op">-</span> coord]</span>
<span id="cb54-1133"><a href="#cb54-1133" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> shift <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb54-1134"><a href="#cb54-1134" aria-hidden="true" tabindex="-1"></a>                pred, succ <span class="op">=</span> succ, pred</span>
<span id="cb54-1135"><a href="#cb54-1135" aria-hidden="true" tabindex="-1"></a>            ll[value] <span class="op">=</span> [pred, succ]</span>
<span id="cb54-1136"><a href="#cb54-1136" aria-hidden="true" tabindex="-1"></a>            ll[pred][<span class="dv">1</span>] <span class="op">=</span> value</span>
<span id="cb54-1137"><a href="#cb54-1137" aria-hidden="true" tabindex="-1"></a>            ll[succ][<span class="dv">0</span>] <span class="op">=</span> value</span>
<span id="cb54-1138"><a href="#cb54-1138" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> (data.index(<span class="dv">0</span>), <span class="dv">0</span>)</span>
<span id="cb54-1139"><a href="#cb54-1139" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> []</span>
<span id="cb54-1140"><a href="#cb54-1140" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(ll)):</span>
<span id="cb54-1141"><a href="#cb54-1141" aria-hidden="true" tabindex="-1"></a>        result.append(v[<span class="dv">1</span>])</span>
<span id="cb54-1142"><a href="#cb54-1142" aria-hidden="true" tabindex="-1"></a>        v <span class="op">=</span> ll[v][<span class="dv">1</span>]</span>
<span id="cb54-1143"><a href="#cb54-1143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(result[((i <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">1000</span>) <span class="op">%</span> <span class="bu">len</span>(result)] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>))</span>
<span id="cb54-1144"><a href="#cb54-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1145"><a href="#cb54-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1146"><a href="#cb54-1146" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="bu">list</span>(load(<span class="st">"20"</span>, <span class="st">"np"</span>))</span>
<span id="cb54-1147"><a href="#cb54-1147" aria-hidden="true" tabindex="-1"></a>mix(data)</span>
<span id="cb54-1148"><a href="#cb54-1148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1149"><a href="#cb54-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1150"><a href="#cb54-1150" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-1151"><a href="#cb54-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1154"><a href="#cb54-1154" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1155"><a href="#cb54-1155" aria-hidden="true" tabindex="-1"></a>mix([x <span class="op">*</span> <span class="dv">811589153</span> <span class="cf">for</span> x <span class="kw">in</span> data], <span class="dv">10</span>)</span>
<span id="cb54-1156"><a href="#cb54-1156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1157"><a href="#cb54-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1158"><a href="#cb54-1158" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 21: Monkey Math](https://adventofcode.com/2022/day/21)</span></span>
<span id="cb54-1159"><a href="#cb54-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1160"><a href="#cb54-1160" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-1161"><a href="#cb54-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1162"><a href="#cb54-1162" aria-hidden="true" tabindex="-1"></a>We'll use recursion and the call stack to keep track of the operations for us</span>
<span id="cb54-1163"><a href="#cb54-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1166"><a href="#cb54-1166" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1167"><a href="#cb54-1167" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> operator <span class="im">import</span> add, ifloordiv, mul, sub</span>
<span id="cb54-1168"><a href="#cb54-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1169"><a href="#cb54-1169" aria-hidden="true" tabindex="-1"></a>instructions <span class="op">=</span> {}</span>
<span id="cb54-1170"><a href="#cb54-1170" aria-hidden="true" tabindex="-1"></a>lookup <span class="op">=</span> {<span class="st">"*"</span>: mul, <span class="st">"/"</span>: ifloordiv, <span class="st">"-"</span>: sub, <span class="st">"+"</span>: add}</span>
<span id="cb54-1171"><a href="#cb54-1171" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">21</span>):</span>
<span id="cb54-1172"><a href="#cb54-1172" aria-hidden="true" tabindex="-1"></a>    lhs, rhs <span class="op">=</span> line.split(<span class="st">":"</span>)</span>
<span id="cb54-1173"><a href="#cb54-1173" aria-hidden="true" tabindex="-1"></a>    operands <span class="op">=</span> rhs.split()</span>
<span id="cb54-1174"><a href="#cb54-1174" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(operands) <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb54-1175"><a href="#cb54-1175" aria-hidden="true" tabindex="-1"></a>        instructions[lhs] <span class="op">=</span> {<span class="st">"dependencies"</span>: [], <span class="st">"value"</span>: <span class="bu">int</span>(operands[<span class="dv">0</span>])}</span>
<span id="cb54-1176"><a href="#cb54-1176" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb54-1177"><a href="#cb54-1177" aria-hidden="true" tabindex="-1"></a>        instructions[lhs] <span class="op">=</span> {</span>
<span id="cb54-1178"><a href="#cb54-1178" aria-hidden="true" tabindex="-1"></a>            <span class="st">"dependencies"</span>: [operands[<span class="dv">0</span>], operands[<span class="dv">2</span>]],</span>
<span id="cb54-1179"><a href="#cb54-1179" aria-hidden="true" tabindex="-1"></a>            <span class="st">"operation"</span>: lookup[operands[<span class="dv">1</span>]],</span>
<span id="cb54-1180"><a href="#cb54-1180" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb54-1181"><a href="#cb54-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1182"><a href="#cb54-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1183"><a href="#cb54-1183" aria-hidden="true" tabindex="-1"></a><span class="at">@functools.cache</span></span>
<span id="cb54-1184"><a href="#cb54-1184" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> value(mystring):</span>
<span id="cb54-1185"><a href="#cb54-1185" aria-hidden="true" tabindex="-1"></a>    instruction <span class="op">=</span> instructions[mystring]</span>
<span id="cb54-1186"><a href="#cb54-1186" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> instruction[<span class="st">"dependencies"</span>]:</span>
<span id="cb54-1187"><a href="#cb54-1187" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> instruction[<span class="st">"value"</span>]</span>
<span id="cb54-1188"><a href="#cb54-1188" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb54-1189"><a href="#cb54-1189" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> instruction[<span class="st">"operation"</span>](</span>
<span id="cb54-1190"><a href="#cb54-1190" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>[value(x) <span class="cf">for</span> x <span class="kw">in</span> instruction[<span class="st">"dependencies"</span>]]</span>
<span id="cb54-1191"><a href="#cb54-1191" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb54-1192"><a href="#cb54-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1193"><a href="#cb54-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1194"><a href="#cb54-1194" aria-hidden="true" tabindex="-1"></a>value(<span class="st">"root"</span>)</span>
<span id="cb54-1195"><a href="#cb54-1195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1196"><a href="#cb54-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1197"><a href="#cb54-1197" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-1198"><a href="#cb54-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1201"><a href="#cb54-1201" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1202"><a href="#cb54-1202" aria-hidden="true" tabindex="-1"></a>value.cache_clear()</span>
<span id="cb54-1203"><a href="#cb54-1203" aria-hidden="true" tabindex="-1"></a>inverse_operations <span class="op">=</span> {sub: add, add: sub, mul: ifloordiv, ifloordiv: mul}</span>
<span id="cb54-1204"><a href="#cb54-1204" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"humn"</span> <span class="kw">in</span> instructions:</span>
<span id="cb54-1205"><a href="#cb54-1205" aria-hidden="true" tabindex="-1"></a>    <span class="kw">del</span> instructions[<span class="st">"humn"</span>]</span>
<span id="cb54-1206"><a href="#cb54-1206" aria-hidden="true" tabindex="-1"></a>instructions[<span class="st">"root"</span>][<span class="st">"operation"</span>] <span class="op">=</span> sub</span>
<span id="cb54-1207"><a href="#cb54-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1208"><a href="#cb54-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1209"><a href="#cb54-1209" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> balance(instruction, target):</span>
<span id="cb54-1210"><a href="#cb54-1210" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> instruction <span class="op">==</span> <span class="st">"humn"</span>:</span>
<span id="cb54-1211"><a href="#cb54-1211" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> target</span>
<span id="cb54-1212"><a href="#cb54-1212" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, dependency <span class="kw">in</span> <span class="bu">enumerate</span>(instructions[instruction][<span class="st">"dependencies"</span>]):</span>
<span id="cb54-1213"><a href="#cb54-1213" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb54-1214"><a href="#cb54-1214" aria-hidden="true" tabindex="-1"></a>            v <span class="op">=</span> value(dependency)</span>
<span id="cb54-1215"><a href="#cb54-1215" aria-hidden="true" tabindex="-1"></a>            pos <span class="op">=</span> idx</span>
<span id="cb54-1216"><a href="#cb54-1216" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb54-1217"><a href="#cb54-1217" aria-hidden="true" tabindex="-1"></a>            next_instruction <span class="op">=</span> dependency</span>
<span id="cb54-1218"><a href="#cb54-1218" aria-hidden="true" tabindex="-1"></a>    op <span class="op">=</span> instructions[instruction][<span class="st">"operation"</span>]</span>
<span id="cb54-1219"><a href="#cb54-1219" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pos <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> op <span class="kw">in</span> [ifloordiv, sub]:</span>
<span id="cb54-1220"><a href="#cb54-1220" aria-hidden="true" tabindex="-1"></a>        updated_target <span class="op">=</span> op(v, target)</span>
<span id="cb54-1221"><a href="#cb54-1221" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb54-1222"><a href="#cb54-1222" aria-hidden="true" tabindex="-1"></a>        updated_target <span class="op">=</span> inverse_operations[op](target, v)</span>
<span id="cb54-1223"><a href="#cb54-1223" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> balance(next_instruction, updated_target)</span>
<span id="cb54-1224"><a href="#cb54-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1225"><a href="#cb54-1225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1226"><a href="#cb54-1226" aria-hidden="true" tabindex="-1"></a>balance(<span class="st">"root"</span>, <span class="dv">0</span>)</span>
<span id="cb54-1227"><a href="#cb54-1227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1228"><a href="#cb54-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1229"><a href="#cb54-1229" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 22: Monkey Map](https://adventofcode.com/2022/day/22)</span></span>
<span id="cb54-1230"><a href="#cb54-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1231"><a href="#cb54-1231" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-1232"><a href="#cb54-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1235"><a href="#cb54-1235" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1236"><a href="#cb54-1236" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load(<span class="dv">22</span>, <span class="st">"raw"</span>)</span>
<span id="cb54-1237"><a href="#cb54-1237" aria-hidden="true" tabindex="-1"></a>chart, instructions <span class="op">=</span> data.split(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>)</span>
<span id="cb54-1238"><a href="#cb54-1238" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> chart.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb54-1239"><a href="#cb54-1239" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> <span class="bu">max</span>(<span class="bu">len</span>(x) <span class="cf">for</span> x <span class="kw">in</span> chart)</span>
<span id="cb54-1240"><a href="#cb54-1240" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> [[x <span class="cf">for</span> x <span class="kw">in</span> line.ljust(target, <span class="st">" "</span>)] <span class="cf">for</span> line <span class="kw">in</span> chart]</span>
<span id="cb54-1241"><a href="#cb54-1241" aria-hidden="true" tabindex="-1"></a>board <span class="op">=</span> np.array(chart)</span>
<span id="cb54-1242"><a href="#cb54-1242" aria-hidden="true" tabindex="-1"></a>start_x <span class="op">=</span> (board[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"."</span>).argmax()</span>
<span id="cb54-1243"><a href="#cb54-1243" aria-hidden="true" tabindex="-1"></a>y, x <span class="op">=</span> <span class="dv">0</span>, start_x</span>
<span id="cb54-1244"><a href="#cb54-1244" aria-hidden="true" tabindex="-1"></a>dy, dx <span class="op">=</span> <span class="dv">0</span>, <span class="dv">1</span></span>
<span id="cb54-1245"><a href="#cb54-1245" aria-hidden="true" tabindex="-1"></a>ymax, xmax <span class="op">=</span> board.shape</span>
<span id="cb54-1246"><a href="#cb54-1246" aria-hidden="true" tabindex="-1"></a>R <span class="op">=</span> np.array([[<span class="dv">0</span>, <span class="dv">1</span>], [<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>]])</span>
<span id="cb54-1247"><a href="#cb54-1247" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> <span class="op">-</span>R</span>
<span id="cb54-1248"><a href="#cb54-1248" aria-hidden="true" tabindex="-1"></a>matrices <span class="op">=</span> {<span class="st">"L"</span>: L, <span class="st">"R"</span>: R}</span>
<span id="cb54-1249"><a href="#cb54-1249" aria-hidden="true" tabindex="-1"></a>instructions <span class="op">=</span> instructions.replace(<span class="st">"R"</span>, <span class="st">" R "</span>).replace(<span class="st">"L"</span>, <span class="st">" L "</span>).split()</span>
<span id="cb54-1250"><a href="#cb54-1250" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> instruction <span class="kw">in</span> instructions:</span>
<span id="cb54-1251"><a href="#cb54-1251" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> instruction <span class="kw">in</span> <span class="st">"LR"</span>:</span>
<span id="cb54-1252"><a href="#cb54-1252" aria-hidden="true" tabindex="-1"></a>        dy, dx <span class="op">=</span> matrices[instruction] <span class="op">@</span> [dy, dx]</span>
<span id="cb54-1253"><a href="#cb54-1253" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb54-1254"><a href="#cb54-1254" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">int</span>(instruction)):</span>
<span id="cb54-1255"><a href="#cb54-1255" aria-hidden="true" tabindex="-1"></a>            next_y, next_x <span class="op">=</span> (y <span class="op">+</span> dy) <span class="op">%</span> ymax, (x <span class="op">+</span> dx) <span class="op">%</span> xmax</span>
<span id="cb54-1256"><a href="#cb54-1256" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> board[next_y, next_x] <span class="op">==</span> <span class="st">" "</span>:</span>
<span id="cb54-1257"><a href="#cb54-1257" aria-hidden="true" tabindex="-1"></a>                next_y, next_x <span class="op">=</span> (next_y <span class="op">+</span> dy) <span class="op">%</span> ymax, (next_x <span class="op">+</span> dx) <span class="op">%</span> xmax</span>
<span id="cb54-1258"><a href="#cb54-1258" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> board[next_y, next_x] <span class="op">==</span> <span class="st">"#"</span>:</span>
<span id="cb54-1259"><a href="#cb54-1259" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb54-1260"><a href="#cb54-1260" aria-hidden="true" tabindex="-1"></a>            y, x <span class="op">=</span> next_y, next_x</span>
<span id="cb54-1261"><a href="#cb54-1261" aria-hidden="true" tabindex="-1"></a>facings <span class="op">=</span> {(<span class="dv">0</span>, <span class="dv">1</span>): <span class="dv">0</span>, (<span class="dv">1</span>, <span class="dv">0</span>): <span class="dv">1</span>, (<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>): <span class="dv">2</span>, (<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>): <span class="dv">3</span>}</span>
<span id="cb54-1262"><a href="#cb54-1262" aria-hidden="true" tabindex="-1"></a>(y <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">1000</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> (x <span class="op">+</span> <span class="dv">1</span>) <span class="op">+</span> facings[dy, dx]</span>
<span id="cb54-1263"><a href="#cb54-1263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1264"><a href="#cb54-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1265"><a href="#cb54-1265" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-1266"><a href="#cb54-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1267"><a href="#cb54-1267" aria-hidden="true" tabindex="-1"></a>Well.</span>
<span id="cb54-1268"><a href="#cb54-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1269"><a href="#cb54-1269" aria-hidden="true" tabindex="-1"></a>The logic for this one is basically the same as for part one, with the only change being what happens when we hit an empty cell. Previously we just kept moving in the same direction until we landed back on the board; now we have to find which edge we should move to.</span>
<span id="cb54-1270"><a href="#cb54-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1271"><a href="#cb54-1271" aria-hidden="true" tabindex="-1"></a>I considered trying to solve the edge pairing for all possible cube nets, but quickly concluded that hardcoding the specific net in my input was going to be much faster. I start off by building a mapping of edge pairings which tracks:</span>
<span id="cb54-1272"><a href="#cb54-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1273"><a href="#cb54-1273" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Which pairs of edges are connected</span>
<span id="cb54-1274"><a href="#cb54-1274" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What the rotation between the two edges is</span>
<span id="cb54-1275"><a href="#cb54-1275" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Whether values along the two edges increase in the same direction. This is technically not necessary, since it's basically included in the rotation, but it's handy to have around.</span>
<span id="cb54-1276"><a href="#cb54-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1277"><a href="#cb54-1277" aria-hidden="true" tabindex="-1"></a>There are 14 outside edges, but they pair up two and two, so we only need to specify 7 of them and then add the reverse pairing to the mapping.</span>
<span id="cb54-1278"><a href="#cb54-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1279"><a href="#cb54-1279" aria-hidden="true" tabindex="-1"></a>The edges are labelled with an arbitrary number, so we also need a way of identifying which edge we're on. So for each edge, we'll specify which two meta-squares of the net it joins, starting with the square on the cube and ending with the square off the cube.</span>
<span id="cb54-1280"><a href="#cb54-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1281"><a href="#cb54-1281" aria-hidden="true" tabindex="-1"></a>When we hit an empty cell, we identify which edge we just crossed, and then move to the corresponding matching edge. There's a bit of faffing to make sure that (say) top and bottom edges along the same square get different y coordinates, and then we finally add on how far along the edge we are.</span>
<span id="cb54-1282"><a href="#cb54-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1283"><a href="#cb54-1283" aria-hidden="true" tabindex="-1"></a>That gives us the new position on the grid. If this position is empty, we rotate to face the new direction and move there. Otherwise we stay in place and don't rotate.</span>
<span id="cb54-1284"><a href="#cb54-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1287"><a href="#cb54-1287" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1288"><a href="#cb54-1288" aria-hidden="true" tabindex="-1"></a>edge_pairings <span class="op">=</span> {</span>
<span id="cb54-1289"><a href="#cb54-1289" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>: [<span class="dv">9</span>, <span class="st">"R"</span>, <span class="dv">1</span>],</span>
<span id="cb54-1290"><a href="#cb54-1290" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>: [<span class="dv">8</span>, <span class="st">""</span>, <span class="dv">1</span>],</span>
<span id="cb54-1291"><a href="#cb54-1291" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>: [<span class="dv">5</span>, <span class="st">"RR"</span>, <span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb54-1292"><a href="#cb54-1292" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>: [<span class="dv">4</span>, <span class="st">"R"</span>, <span class="dv">1</span>],</span>
<span id="cb54-1293"><a href="#cb54-1293" aria-hidden="true" tabindex="-1"></a>    <span class="dv">6</span>: [<span class="dv">7</span>, <span class="st">"R"</span>, <span class="dv">1</span>],</span>
<span id="cb54-1294"><a href="#cb54-1294" aria-hidden="true" tabindex="-1"></a>    <span class="dv">10</span>: [<span class="dv">13</span>, <span class="st">"RR"</span>, <span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb54-1295"><a href="#cb54-1295" aria-hidden="true" tabindex="-1"></a>    <span class="dv">11</span>: [<span class="dv">12</span>, <span class="st">"R"</span>, <span class="dv">1</span>],</span>
<span id="cb54-1296"><a href="#cb54-1296" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-1297"><a href="#cb54-1297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1298"><a href="#cb54-1298" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> <span class="bu">list</span>(edge_pairings.keys()):</span>
<span id="cb54-1299"><a href="#cb54-1299" aria-hidden="true" tabindex="-1"></a>    edge, direction, sign <span class="op">=</span> edge_pairings[key]</span>
<span id="cb54-1300"><a href="#cb54-1300" aria-hidden="true" tabindex="-1"></a>    edge_pairings[edge] <span class="op">=</span> [key, direction.replace(<span class="st">"R"</span>, <span class="st">"L"</span>), sign]</span>
<span id="cb54-1301"><a href="#cb54-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1302"><a href="#cb54-1302" aria-hidden="true" tabindex="-1"></a>edge_positions <span class="op">=</span> [</span>
<span id="cb54-1303"><a href="#cb54-1303" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">0</span>, <span class="dv">1</span>), (<span class="dv">3</span>, <span class="dv">1</span>)),</span>
<span id="cb54-1304"><a href="#cb54-1304" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">0</span>, <span class="dv">2</span>), (<span class="dv">3</span>, <span class="dv">2</span>)),</span>
<span id="cb54-1305"><a href="#cb54-1305" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">0</span>, <span class="dv">2</span>), (<span class="dv">0</span>, <span class="dv">0</span>)),</span>
<span id="cb54-1306"><a href="#cb54-1306" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">0</span>, <span class="dv">2</span>), (<span class="dv">1</span>, <span class="dv">2</span>)),</span>
<span id="cb54-1307"><a href="#cb54-1307" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">1</span>, <span class="dv">2</span>)),</span>
<span id="cb54-1308"><a href="#cb54-1308" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">2</span>, <span class="dv">1</span>), (<span class="dv">2</span>, <span class="dv">2</span>)),</span>
<span id="cb54-1309"><a href="#cb54-1309" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">2</span>, <span class="dv">1</span>), (<span class="dv">3</span>, <span class="dv">1</span>)),</span>
<span id="cb54-1310"><a href="#cb54-1310" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">3</span>, <span class="dv">0</span>), (<span class="dv">3</span>, <span class="dv">1</span>)),</span>
<span id="cb54-1311"><a href="#cb54-1311" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">3</span>, <span class="dv">0</span>), (<span class="dv">0</span>, <span class="dv">0</span>)),</span>
<span id="cb54-1312"><a href="#cb54-1312" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">3</span>, <span class="dv">0</span>), (<span class="dv">3</span>, <span class="dv">2</span>)),</span>
<span id="cb54-1313"><a href="#cb54-1313" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">2</span>, <span class="dv">0</span>), (<span class="dv">2</span>, <span class="dv">2</span>)),</span>
<span id="cb54-1314"><a href="#cb54-1314" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">2</span>, <span class="dv">0</span>), (<span class="dv">1</span>, <span class="dv">0</span>)),</span>
<span id="cb54-1315"><a href="#cb54-1315" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">1</span>, <span class="dv">0</span>)),</span>
<span id="cb54-1316"><a href="#cb54-1316" aria-hidden="true" tabindex="-1"></a>    ((<span class="dv">0</span>, <span class="dv">1</span>), (<span class="dv">0</span>, <span class="dv">0</span>)),</span>
<span id="cb54-1317"><a href="#cb54-1317" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb54-1318"><a href="#cb54-1318" aria-hidden="true" tabindex="-1"></a>edge_lookup <span class="op">=</span> {edges: idx <span class="cf">for</span> idx, edges <span class="kw">in</span> <span class="bu">enumerate</span>(edge_positions)}</span>
<span id="cb54-1319"><a href="#cb54-1319" aria-hidden="true" tabindex="-1"></a>board_shape <span class="op">=</span> np.array([<span class="dv">4</span>, <span class="dv">3</span>])</span>
<span id="cb54-1320"><a href="#cb54-1320" aria-hidden="true" tabindex="-1"></a>y, x <span class="op">=</span> <span class="dv">0</span>, start_x</span>
<span id="cb54-1321"><a href="#cb54-1321" aria-hidden="true" tabindex="-1"></a>dy, dx <span class="op">=</span> <span class="dv">0</span>, <span class="dv">1</span></span>
<span id="cb54-1322"><a href="#cb54-1322" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> instruction <span class="kw">in</span> instructions:</span>
<span id="cb54-1323"><a href="#cb54-1323" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> instruction <span class="kw">in</span> <span class="st">"LR"</span>:</span>
<span id="cb54-1324"><a href="#cb54-1324" aria-hidden="true" tabindex="-1"></a>        dy, dx <span class="op">=</span> matrices[instruction] <span class="op">@</span> [dy, dx]</span>
<span id="cb54-1325"><a href="#cb54-1325" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb54-1326"><a href="#cb54-1326" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">int</span>(instruction)):</span>
<span id="cb54-1327"><a href="#cb54-1327" aria-hidden="true" tabindex="-1"></a>            next_y, next_x <span class="op">=</span> (y <span class="op">+</span> dy) <span class="op">%</span> ymax, (x <span class="op">+</span> dx) <span class="op">%</span> xmax</span>
<span id="cb54-1328"><a href="#cb54-1328" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> board[next_y, next_x] <span class="op">==</span> <span class="st">" "</span>:</span>
<span id="cb54-1329"><a href="#cb54-1329" aria-hidden="true" tabindex="-1"></a>                old_square <span class="op">=</span> y <span class="op">//</span> <span class="dv">50</span>, x <span class="op">//</span> <span class="dv">50</span></span>
<span id="cb54-1330"><a href="#cb54-1330" aria-hidden="true" tabindex="-1"></a>                new_square <span class="op">=</span> next_y <span class="op">//</span> <span class="dv">50</span>, next_x <span class="op">//</span> <span class="dv">50</span></span>
<span id="cb54-1331"><a href="#cb54-1331" aria-hidden="true" tabindex="-1"></a>                edge <span class="op">=</span> edge_lookup[(old_square, new_square)]</span>
<span id="cb54-1332"><a href="#cb54-1332" aria-hidden="true" tabindex="-1"></a>                new_edge, rotations, sign <span class="op">=</span> edge_pairings[edge]</span>
<span id="cb54-1333"><a href="#cb54-1333" aria-hidden="true" tabindex="-1"></a>                new_edge_position <span class="op">=</span> edge_positions[new_edge]</span>
<span id="cb54-1334"><a href="#cb54-1334" aria-hidden="true" tabindex="-1"></a>                new_edge_delta <span class="op">=</span> np.diff(new_edge_position, axis<span class="op">=</span><span class="dv">0</span>).ravel()</span>
<span id="cb54-1335"><a href="#cb54-1335" aria-hidden="true" tabindex="-1"></a>                next_y, next_x <span class="op">=</span> [x <span class="op">*</span> <span class="dv">50</span> <span class="cf">for</span> x <span class="kw">in</span> new_edge_position[<span class="dv">0</span>]]</span>
<span id="cb54-1336"><a href="#cb54-1336" aria-hidden="true" tabindex="-1"></a>                next_y, next_x <span class="op">=</span> [next_y, next_x] <span class="op">+</span> <span class="dv">49</span> <span class="op">*</span> (</span>
<span id="cb54-1337"><a href="#cb54-1337" aria-hidden="true" tabindex="-1"></a>                    (new_edge_delta <span class="op">%</span> board_shape) <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb54-1338"><a href="#cb54-1338" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb54-1339"><a href="#cb54-1339" aria-hidden="true" tabindex="-1"></a>                offset <span class="op">=</span> x <span class="op">%</span> <span class="dv">50</span> <span class="cf">if</span> dx <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> y <span class="op">%</span> <span class="dv">50</span></span>
<span id="cb54-1340"><a href="#cb54-1340" aria-hidden="true" tabindex="-1"></a>                offset <span class="op">=</span> offset <span class="cf">if</span> sign <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">49</span> <span class="op">-</span> offset</span>
<span id="cb54-1341"><a href="#cb54-1341" aria-hidden="true" tabindex="-1"></a>                next_y, next_x <span class="op">=</span> [next_y, next_x] <span class="op">+</span> offset <span class="op">*</span> (new_edge_delta <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb54-1342"><a href="#cb54-1342" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> board[next_y, next_x] <span class="op">!=</span> <span class="st">"#"</span>:</span>
<span id="cb54-1343"><a href="#cb54-1343" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> rotation <span class="kw">in</span> rotations:</span>
<span id="cb54-1344"><a href="#cb54-1344" aria-hidden="true" tabindex="-1"></a>                        dy, dx <span class="op">=</span> matrices[rotation] <span class="op">@</span> [dy, dx]</span>
<span id="cb54-1345"><a href="#cb54-1345" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> board[next_y, next_x] <span class="op">==</span> <span class="st">"#"</span>:</span>
<span id="cb54-1346"><a href="#cb54-1346" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb54-1347"><a href="#cb54-1347" aria-hidden="true" tabindex="-1"></a>            y, x <span class="op">=</span> next_y, next_x</span>
<span id="cb54-1348"><a href="#cb54-1348" aria-hidden="true" tabindex="-1"></a>facings <span class="op">=</span> {(<span class="dv">0</span>, <span class="dv">1</span>): <span class="dv">0</span>, (<span class="dv">1</span>, <span class="dv">0</span>): <span class="dv">1</span>, (<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>): <span class="dv">2</span>, (<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>): <span class="dv">3</span>}</span>
<span id="cb54-1349"><a href="#cb54-1349" aria-hidden="true" tabindex="-1"></a>(y <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">1000</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> (x <span class="op">+</span> <span class="dv">1</span>) <span class="op">+</span> facings[dy, dx]</span>
<span id="cb54-1350"><a href="#cb54-1350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1351"><a href="#cb54-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1352"><a href="#cb54-1352" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 23: Unstable Diffusion](https://adventofcode.com/2022/day/23)</span></span>
<span id="cb54-1353"><a href="#cb54-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1354"><a href="#cb54-1354" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-1355"><a href="#cb54-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1358"><a href="#cb54-1358" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1359"><a href="#cb54-1359" aria-hidden="true" tabindex="-1"></a>board <span class="op">=</span> np.array(</span>
<span id="cb54-1360"><a href="#cb54-1360" aria-hidden="true" tabindex="-1"></a>    [[<span class="dv">1</span> <span class="cf">if</span> char <span class="op">==</span> <span class="st">"#"</span> <span class="cf">else</span> <span class="dv">0</span> <span class="cf">for</span> char <span class="kw">in</span> line] <span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">23</span>)],</span>
<span id="cb54-1361"><a href="#cb54-1361" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span><span class="bu">bool</span>,</span>
<span id="cb54-1362"><a href="#cb54-1362" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-1363"><a href="#cb54-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1364"><a href="#cb54-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1365"><a href="#cb54-1365" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate(board, n_rounds):</span>
<span id="cb54-1366"><a href="#cb54-1366" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> np.ones((<span class="dv">3</span>, <span class="dv">3</span>), dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb54-1367"><a href="#cb54-1367" aria-hidden="true" tabindex="-1"></a>    mask[<span class="dv">1</span>, <span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-1368"><a href="#cb54-1368" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>]])</span>
<span id="cb54-1369"><a href="#cb54-1369" aria-hidden="true" tabindex="-1"></a>    e, s, w <span class="op">=</span> n[::<span class="op">-</span><span class="dv">1</span>].T, n[::<span class="op">-</span><span class="dv">1</span>], n.T</span>
<span id="cb54-1370"><a href="#cb54-1370" aria-hidden="true" tabindex="-1"></a>    Direction <span class="op">=</span> namedtuple(</span>
<span id="cb54-1371"><a href="#cb54-1371" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Direction"</span>, [<span class="st">"weights"</span>, <span class="st">"padding"</span>, <span class="st">"reverse_move"</span>, <span class="st">"bitmask"</span>]</span>
<span id="cb54-1372"><a href="#cb54-1372" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-1373"><a href="#cb54-1373" aria-hidden="true" tabindex="-1"></a>    north <span class="op">=</span> Direction(n, [[<span class="dv">0</span>, <span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">1</span>]], [<span class="dv">1</span>, <span class="dv">0</span>], <span class="dv">1</span>)</span>
<span id="cb54-1374"><a href="#cb54-1374" aria-hidden="true" tabindex="-1"></a>    south <span class="op">=</span> Direction(s, [[<span class="dv">2</span>, <span class="dv">0</span>], [<span class="dv">1</span>, <span class="dv">1</span>]], [<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>], <span class="dv">2</span>)</span>
<span id="cb54-1375"><a href="#cb54-1375" aria-hidden="true" tabindex="-1"></a>    east <span class="op">=</span> Direction(e, [[<span class="dv">1</span>, <span class="dv">1</span>], [<span class="dv">2</span>, <span class="dv">0</span>]], [<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>], <span class="dv">4</span>)</span>
<span id="cb54-1376"><a href="#cb54-1376" aria-hidden="true" tabindex="-1"></a>    west <span class="op">=</span> Direction(w, [[<span class="dv">1</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">2</span>]], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="dv">8</span>)</span>
<span id="cb54-1377"><a href="#cb54-1377" aria-hidden="true" tabindex="-1"></a>    directions <span class="op">=</span> [north, south, west, east]</span>
<span id="cb54-1378"><a href="#cb54-1378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1379"><a href="#cb54-1379" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-1380"><a href="#cb54-1380" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> i <span class="op">&lt;</span> n_rounds:</span>
<span id="cb54-1381"><a href="#cb54-1381" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb54-1382"><a href="#cb54-1382" aria-hidden="true" tabindex="-1"></a>        has_neighbors <span class="op">=</span> scipy.ndimage.convolve(board, mask, mode<span class="op">=</span><span class="st">"constant"</span>)</span>
<span id="cb54-1383"><a href="#cb54-1383" aria-hidden="true" tabindex="-1"></a>        stopped, rest <span class="op">=</span> (board <span class="op">&amp;</span> (<span class="op">~</span>has_neighbors)), (board <span class="op">&amp;</span> has_neighbors)</span>
<span id="cb54-1384"><a href="#cb54-1384" aria-hidden="true" tabindex="-1"></a>        proposed_moves <span class="op">=</span> np.pad(stopped.astype(<span class="bu">int</span>), <span class="dv">1</span>, mode<span class="op">=</span><span class="st">"constant"</span>)</span>
<span id="cb54-1385"><a href="#cb54-1385" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> d <span class="kw">in</span> directions:</span>
<span id="cb54-1386"><a href="#cb54-1386" aria-hidden="true" tabindex="-1"></a>            neighbors <span class="op">=</span> scipy.ndimage.correlate(board, d.weights, mode<span class="op">=</span><span class="st">"constant"</span>)</span>
<span id="cb54-1387"><a href="#cb54-1387" aria-hidden="true" tabindex="-1"></a>            proposed_moves <span class="op">+=</span> np.pad(</span>
<span id="cb54-1388"><a href="#cb54-1388" aria-hidden="true" tabindex="-1"></a>                (rest <span class="op">&amp;</span> <span class="op">~</span>neighbors) <span class="op">*</span> d.bitmask, d.padding, mode<span class="op">=</span><span class="st">"constant"</span></span>
<span id="cb54-1389"><a href="#cb54-1389" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb54-1390"><a href="#cb54-1390" aria-hidden="true" tabindex="-1"></a>            rest <span class="op">&amp;=</span> neighbors</span>
<span id="cb54-1391"><a href="#cb54-1391" aria-hidden="true" tabindex="-1"></a>        proposed_moves <span class="op">+=</span> np.pad(rest, <span class="dv">1</span>, mode<span class="op">=</span><span class="st">"constant"</span>)</span>
<span id="cb54-1392"><a href="#cb54-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1393"><a href="#cb54-1393" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Now unwind overlapping moves</span></span>
<span id="cb54-1394"><a href="#cb54-1394" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> d1 <span class="kw">in</span> directions[<span class="dv">1</span>:]:</span>
<span id="cb54-1395"><a href="#cb54-1395" aria-hidden="true" tabindex="-1"></a>            multiples <span class="op">=</span> ((proposed_moves <span class="op">&amp;</span> d1.bitmask) <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (</span>
<span id="cb54-1396"><a href="#cb54-1396" aria-hidden="true" tabindex="-1"></a>                proposed_moves <span class="op">!=</span> d1.bitmask</span>
<span id="cb54-1397"><a href="#cb54-1397" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb54-1398"><a href="#cb54-1398" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> point <span class="kw">in</span> np.argwhere(multiples):</span>
<span id="cb54-1399"><a href="#cb54-1399" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> d2 <span class="kw">in</span> directions:</span>
<span id="cb54-1400"><a href="#cb54-1400" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> proposed_moves[<span class="bu">tuple</span>(point)] <span class="op">&amp;</span> d2.bitmask:</span>
<span id="cb54-1401"><a href="#cb54-1401" aria-hidden="true" tabindex="-1"></a>                        proposed_moves[<span class="bu">tuple</span>(point <span class="op">+</span> d2.reverse_move)] <span class="op">=</span> d2.bitmask</span>
<span id="cb54-1402"><a href="#cb54-1402" aria-hidden="true" tabindex="-1"></a>                proposed_moves[<span class="bu">tuple</span>(point)] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-1403"><a href="#cb54-1403" aria-hidden="true" tabindex="-1"></a>        coords <span class="op">=</span> np.argwhere(proposed_moves)</span>
<span id="cb54-1404"><a href="#cb54-1404" aria-hidden="true" tabindex="-1"></a>        x_min, y_min <span class="op">=</span> coords.<span class="bu">min</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb54-1405"><a href="#cb54-1405" aria-hidden="true" tabindex="-1"></a>        x_max, y_max <span class="op">=</span> coords.<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb54-1406"><a href="#cb54-1406" aria-hidden="true" tabindex="-1"></a>        new_board <span class="op">=</span> proposed_moves[x_min : x_max <span class="op">+</span> <span class="dv">1</span>, y_min : y_max <span class="op">+</span> <span class="dv">1</span>] <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb54-1407"><a href="#cb54-1407" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> board.shape <span class="op">==</span> new_board.shape <span class="kw">and</span> (board <span class="op">==</span> new_board).<span class="bu">all</span>():</span>
<span id="cb54-1408"><a href="#cb54-1408" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb54-1409"><a href="#cb54-1409" aria-hidden="true" tabindex="-1"></a>        board <span class="op">=</span> new_board</span>
<span id="cb54-1410"><a href="#cb54-1410" aria-hidden="true" tabindex="-1"></a>        directions <span class="op">=</span> directions[<span class="dv">1</span>:] <span class="op">+</span> [directions[<span class="dv">0</span>]]</span>
<span id="cb54-1411"><a href="#cb54-1411" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> i, (board <span class="op">==</span> <span class="dv">0</span>).<span class="bu">sum</span>()</span>
<span id="cb54-1412"><a href="#cb54-1412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1413"><a href="#cb54-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1414"><a href="#cb54-1414" aria-hidden="true" tabindex="-1"></a>simulate(board, <span class="dv">10</span>)[<span class="dv">1</span>]</span>
<span id="cb54-1415"><a href="#cb54-1415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1416"><a href="#cb54-1416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1417"><a href="#cb54-1417" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-1418"><a href="#cb54-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1421"><a href="#cb54-1421" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1422"><a href="#cb54-1422" aria-hidden="true" tabindex="-1"></a>simulate(board, np.inf)[<span class="dv">0</span>]</span>
<span id="cb54-1423"><a href="#cb54-1423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1424"><a href="#cb54-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1425"><a href="#cb54-1425" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 24: Blizzard Basin](https://adventofcode.com/2022/day/24)</span></span>
<span id="cb54-1426"><a href="#cb54-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1427"><a href="#cb54-1427" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1</span></span>
<span id="cb54-1428"><a href="#cb54-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1429"><a href="#cb54-1429" aria-hidden="true" tabindex="-1"></a>This is a problem that seems to call for some pathfinding algorithms. We can account for the movement of the blizzards by making a function to answer the question "Is there a blizzard at position y, x at time t?". With that in hand, we can just explore the full search space. To guide the search, we'll use the (current tiime + manhattan distance to the goal node) as a score and always expand the lowest scoring state first, and stop when we've reached the target.</span>
<span id="cb54-1430"><a href="#cb54-1430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1433"><a href="#cb54-1433" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1434"><a href="#cb54-1434" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> np.array([<span class="bu">list</span>(x) <span class="cf">for</span> x <span class="kw">in</span> load(<span class="dv">24</span>)])[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb54-1435"><a href="#cb54-1435" aria-hidden="true" tabindex="-1"></a>chart_dict <span class="op">=</span> {}</span>
<span id="cb54-1436"><a href="#cb54-1436" aria-hidden="true" tabindex="-1"></a>directions <span class="op">=</span> [<span class="st">"&gt;"</span>, <span class="st">"&lt;"</span>, <span class="st">"^"</span>, <span class="st">"v"</span>]</span>
<span id="cb54-1437"><a href="#cb54-1437" aria-hidden="true" tabindex="-1"></a>updates <span class="op">=</span> {<span class="st">"&gt;"</span>: (<span class="dv">1</span>, <span class="dv">1</span>), <span class="st">"&lt;"</span>: (<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>), <span class="st">"^"</span>: (<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>), <span class="st">"v"</span>: (<span class="dv">0</span>, <span class="dv">1</span>)}</span>
<span id="cb54-1438"><a href="#cb54-1438" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> direction <span class="kw">in</span> directions:</span>
<span id="cb54-1439"><a href="#cb54-1439" aria-hidden="true" tabindex="-1"></a>    positions <span class="op">=</span> defaultdict(<span class="bu">list</span>)</span>
<span id="cb54-1440"><a href="#cb54-1440" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y, x <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>np.where(chart <span class="op">==</span> direction)):</span>
<span id="cb54-1441"><a href="#cb54-1441" aria-hidden="true" tabindex="-1"></a>        (fixed, moving) <span class="op">=</span> (y, x) <span class="cf">if</span> direction <span class="kw">in</span> <span class="st">"&lt;&gt;"</span> <span class="cf">else</span> (x, y)</span>
<span id="cb54-1442"><a href="#cb54-1442" aria-hidden="true" tabindex="-1"></a>        positions[fixed].append(moving)</span>
<span id="cb54-1443"><a href="#cb54-1443" aria-hidden="true" tabindex="-1"></a>    chart_dict[direction] <span class="op">=</span> positions</span>
<span id="cb54-1444"><a href="#cb54-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1445"><a href="#cb54-1445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1446"><a href="#cb54-1446" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> has_blizzard(y, x, time):</span>
<span id="cb54-1447"><a href="#cb54-1447" aria-hidden="true" tabindex="-1"></a>    position <span class="op">=</span> y, x</span>
<span id="cb54-1448"><a href="#cb54-1448" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> direction <span class="kw">in</span> directions:</span>
<span id="cb54-1449"><a href="#cb54-1449" aria-hidden="true" tabindex="-1"></a>        moving, sign <span class="op">=</span> updates[direction]</span>
<span id="cb54-1450"><a href="#cb54-1450" aria-hidden="true" tabindex="-1"></a>        fixed <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> moving</span>
<span id="cb54-1451"><a href="#cb54-1451" aria-hidden="true" tabindex="-1"></a>        blizzards <span class="op">=</span> chart_dict[direction][position[fixed]]</span>
<span id="cb54-1452"><a href="#cb54-1452" aria-hidden="true" tabindex="-1"></a>        blizzard_positions <span class="op">=</span> [</span>
<span id="cb54-1453"><a href="#cb54-1453" aria-hidden="true" tabindex="-1"></a>            (b <span class="op">+</span> sign <span class="op">*</span> time) <span class="op">%</span> chart.shape[moving] <span class="cf">for</span> b <span class="kw">in</span> blizzards</span>
<span id="cb54-1454"><a href="#cb54-1454" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb54-1455"><a href="#cb54-1455" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> position[moving] <span class="kw">in</span> blizzard_positions:</span>
<span id="cb54-1456"><a href="#cb54-1456" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb54-1457"><a href="#cb54-1457" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb54-1458"><a href="#cb54-1458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1459"><a href="#cb54-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1460"><a href="#cb54-1460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1461"><a href="#cb54-1461" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> travel(chart, start, end, time):</span>
<span id="cb54-1462"><a href="#cb54-1462" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> <span class="bu">abs</span>(end[<span class="dv">0</span>] <span class="op">-</span> start[<span class="dv">0</span>]) <span class="op">+</span> <span class="bu">abs</span>(start[<span class="dv">1</span>] <span class="op">-</span> end[<span class="dv">1</span>]) <span class="op">+</span> time</span>
<span id="cb54-1463"><a href="#cb54-1463" aria-hidden="true" tabindex="-1"></a>    target_y, target_x <span class="op">=</span> end</span>
<span id="cb54-1464"><a href="#cb54-1464" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> score, time, start</span>
<span id="cb54-1465"><a href="#cb54-1465" aria-hidden="true" tabindex="-1"></a>    q <span class="op">=</span> PriorityQueue()</span>
<span id="cb54-1466"><a href="#cb54-1466" aria-hidden="true" tabindex="-1"></a>    q.put(state)</span>
<span id="cb54-1467"><a href="#cb54-1467" aria-hidden="true" tabindex="-1"></a>    seen <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb54-1468"><a href="#cb54-1468" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> q.qsize() <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb54-1469"><a href="#cb54-1469" aria-hidden="true" tabindex="-1"></a>        score, time, (y, x) <span class="op">=</span> q.get()</span>
<span id="cb54-1470"><a href="#cb54-1470" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (y, x) <span class="op">==</span> end:</span>
<span id="cb54-1471"><a href="#cb54-1471" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb54-1472"><a href="#cb54-1472" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (time, y, x) <span class="kw">in</span> seen:</span>
<span id="cb54-1473"><a href="#cb54-1473" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb54-1474"><a href="#cb54-1474" aria-hidden="true" tabindex="-1"></a>        seen.add((time, y, x))</span>
<span id="cb54-1475"><a href="#cb54-1475" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (dy, dx) <span class="kw">in</span> [(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>), (<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>), (<span class="dv">0</span>, <span class="dv">0</span>), (<span class="dv">0</span>, <span class="dv">1</span>), (<span class="dv">1</span>, <span class="dv">0</span>)]:</span>
<span id="cb54-1476"><a href="#cb54-1476" aria-hidden="true" tabindex="-1"></a>            new_y, new_x <span class="op">=</span> y <span class="op">+</span> dy, x <span class="op">+</span> dx</span>
<span id="cb54-1477"><a href="#cb54-1477" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (</span>
<span id="cb54-1478"><a href="#cb54-1478" aria-hidden="true" tabindex="-1"></a>                new_y <span class="op">&lt;</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb54-1479"><a href="#cb54-1479" aria-hidden="true" tabindex="-1"></a>                <span class="kw">or</span> (new_y <span class="op">==</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">and</span> new_x <span class="op">!=</span> <span class="dv">0</span>)</span>
<span id="cb54-1480"><a href="#cb54-1480" aria-hidden="true" tabindex="-1"></a>                <span class="kw">or</span> (new_y <span class="op">&gt;</span> chart.shape[<span class="dv">0</span>])</span>
<span id="cb54-1481"><a href="#cb54-1481" aria-hidden="true" tabindex="-1"></a>                <span class="kw">or</span> (new_y <span class="op">==</span> chart.shape[<span class="dv">0</span>] <span class="kw">and</span> new_x <span class="op">!=</span> chart.shape[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb54-1482"><a href="#cb54-1482" aria-hidden="true" tabindex="-1"></a>                <span class="kw">or</span> new_x <span class="op">&lt;</span> <span class="dv">0</span></span>
<span id="cb54-1483"><a href="#cb54-1483" aria-hidden="true" tabindex="-1"></a>                <span class="kw">or</span> new_x <span class="op">&gt;=</span> chart.shape[<span class="dv">1</span>]</span>
<span id="cb54-1484"><a href="#cb54-1484" aria-hidden="true" tabindex="-1"></a>                <span class="kw">or</span> has_blizzard(new_y, new_x, time <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb54-1485"><a href="#cb54-1485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1486"><a href="#cb54-1486" aria-hidden="true" tabindex="-1"></a>            ):</span>
<span id="cb54-1487"><a href="#cb54-1487" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb54-1488"><a href="#cb54-1488" aria-hidden="true" tabindex="-1"></a>            score <span class="op">=</span> <span class="bu">abs</span>(target_y <span class="op">-</span> new_y) <span class="op">+</span> <span class="bu">abs</span>(target_x <span class="op">-</span> new_x) <span class="op">+</span> time <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb54-1489"><a href="#cb54-1489" aria-hidden="true" tabindex="-1"></a>            q.put((score, time <span class="op">+</span> <span class="dv">1</span>, (new_y, new_x)))</span>
<span id="cb54-1490"><a href="#cb54-1490" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> score</span>
<span id="cb54-1491"><a href="#cb54-1491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1492"><a href="#cb54-1492" aria-hidden="true" tabindex="-1"></a>bottom_y, right_x <span class="op">=</span> chart.shape</span>
<span id="cb54-1493"><a href="#cb54-1493" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> (<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb54-1494"><a href="#cb54-1494" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> (bottom_y, right_x <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb54-1495"><a href="#cb54-1495" aria-hidden="true" tabindex="-1"></a>first_leg <span class="op">=</span> travel(chart, start, end, <span class="dv">0</span>)</span>
<span id="cb54-1496"><a href="#cb54-1496" aria-hidden="true" tabindex="-1"></a>first_leg</span>
<span id="cb54-1497"><a href="#cb54-1497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1498"><a href="#cb54-1498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1499"><a href="#cb54-1499" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2</span></span>
<span id="cb54-1500"><a href="#cb54-1500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1501"><a href="#cb54-1501" aria-hidden="true" tabindex="-1"></a>The above takes \~7 seconds on my machine (and it took 13 before I added the A<span class="sc">\*</span> scoring logic), so using it to do three searches through the search space might not be feasible. On the other hand, the three searches can be made completely independent of one another, since arriving later at a checkpoint will always be worse than arriving earlier, since an early arrival could always wait in place until the later time.</span>
<span id="cb54-1502"><a href="#cb54-1502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1505"><a href="#cb54-1505" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1506"><a href="#cb54-1506" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> first_leg</span>
<span id="cb54-1507"><a href="#cb54-1507" aria-hidden="true" tabindex="-1"></a>waypoints <span class="op">=</span> [(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>), (bottom_y, right_x <span class="op">-</span> <span class="dv">1</span>)]</span>
<span id="cb54-1508"><a href="#cb54-1508" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> waypoint <span class="kw">in</span> waypoints:</span>
<span id="cb54-1509"><a href="#cb54-1509" aria-hidden="true" tabindex="-1"></a>    start <span class="op">=</span> end</span>
<span id="cb54-1510"><a href="#cb54-1510" aria-hidden="true" tabindex="-1"></a>    end <span class="op">=</span> waypoint</span>
<span id="cb54-1511"><a href="#cb54-1511" aria-hidden="true" tabindex="-1"></a>    time <span class="op">=</span> travel(chart, start, end, time)</span>
<span id="cb54-1512"><a href="#cb54-1512" aria-hidden="true" tabindex="-1"></a>time</span>
<span id="cb54-1513"><a href="#cb54-1513" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1514"><a href="#cb54-1514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1515"><a href="#cb54-1515" aria-hidden="true" tabindex="-1"></a>This actually works, but it still seems like there should be some slick-ish way of using the chinese remainder theorem or something similar to greatly reduce the search space, since we basically have four masks of residues that are invalid for (y, x, t) triples.</span>
<span id="cb54-1516"><a href="#cb54-1516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1517"><a href="#cb54-1517" aria-hidden="true" tabindex="-1"></a><span class="fu"># [Day 25: Full of Hot Air](https://adventofcode.com/2022/day/25)</span></span>
<span id="cb54-1518"><a href="#cb54-1518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1521"><a href="#cb54-1521" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb54-1522"><a href="#cb54-1522" aria-hidden="true" tabindex="-1"></a>lookup <span class="op">=</span> {<span class="st">"2"</span>: <span class="dv">2</span>, <span class="st">"1"</span>: <span class="dv">1</span>, <span class="st">"0"</span>: <span class="dv">0</span>, <span class="st">"-"</span>: <span class="op">-</span><span class="dv">1</span>, <span class="st">"="</span>: <span class="op">-</span><span class="dv">2</span>}</span>
<span id="cb54-1523"><a href="#cb54-1523" aria-hidden="true" tabindex="-1"></a>reverse_lookup <span class="op">=</span> {<span class="dv">3</span>: <span class="st">"="</span>, <span class="dv">4</span>: <span class="st">"-"</span>}</span>
<span id="cb54-1524"><a href="#cb54-1524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1525"><a href="#cb54-1525" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-1526"><a href="#cb54-1526" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> load(<span class="dv">25</span>):</span>
<span id="cb54-1527"><a href="#cb54-1527" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> functools.<span class="bu">reduce</span>(<span class="kw">lambda</span> x, y: <span class="dv">5</span> <span class="op">*</span> x <span class="op">+</span> lookup[y], line, <span class="dv">0</span>)</span>
<span id="cb54-1528"><a href="#cb54-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1529"><a href="#cb54-1529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1530"><a href="#cb54-1530" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dec2snafu(n):</span>
<span id="cb54-1531"><a href="#cb54-1531" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb54-1532"><a href="#cb54-1532" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">""</span></span>
<span id="cb54-1533"><a href="#cb54-1533" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">%</span> <span class="dv">5</span> <span class="kw">in</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>]:</span>
<span id="cb54-1534"><a href="#cb54-1534" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> dec2snafu(n <span class="op">//</span> <span class="dv">5</span>) <span class="op">+</span> <span class="bu">str</span>(n <span class="op">%</span> <span class="dv">5</span>)</span>
<span id="cb54-1535"><a href="#cb54-1535" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dec2snafu(n <span class="op">//</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">1</span>) <span class="op">+</span> reverse_lookup[n <span class="op">%</span> <span class="dv">5</span>]</span>
<span id="cb54-1536"><a href="#cb54-1536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1537"><a href="#cb54-1537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1538"><a href="#cb54-1538" aria-hidden="true" tabindex="-1"></a>dec2snafu(total)</span>
<span id="cb54-1539"><a href="#cb54-1539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../index.html">Front page</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/cutonbuminband/AOC">Github</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>